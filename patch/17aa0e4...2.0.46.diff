diff --git a/framework/BaseYii.php b/framework/BaseYii.php
index 002b0f61ed8..1195b2349a0 100644
--- a/src/BaseYii.php
+++ b/src/BaseYii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii;
@@ -93,7 +93,7 @@ class BaseYii
      */
     public static function getVersion()
     {
-        return '2.0.44-dev';
+        return '2.0.46-dev';
     }
 
     /**
@@ -130,7 +130,7 @@ public static function getVersion()
      */
     public static function getAlias($alias, $throwException = true)
     {
-        if (strncmp($alias, '@', 1) !== 0) {
+        if (strncmp((string)$alias, '@', 1) !== 0) {
             // not an alias
             return $alias;
         }
@@ -203,11 +203,11 @@ public static function getRootAlias($alias)
      * @param string $alias the alias name (e.g. "@yii"). It must start with a '@' character.
      * It may contain the forward-slash '/' which serves as a boundary character when performing
      * alias translation by [[getAlias()]].
-     * @param string $path the path corresponding to the alias. If this is null, the alias will
+     * @param string|null $path the path corresponding to the alias. If this is null, the alias will
      * be removed. Trailing '/' and '\' characters will be trimmed. This can be
      *
      * - a directory or a file path (e.g. `/tmp`, `/tmp/main.txt`)
-     * - a URL (e.g. `http://www.yiiframework.com`)
+     * - a URL (e.g. `https://www.yiiframework.com`)
      * - a path alias (e.g. `@yii/base`). In this case, the path alias will be converted into the
      *   actual path first by calling [[getAlias()]].
      *
@@ -262,7 +262,7 @@ public static function setAlias($alias, $path)
      *    to include the file associated with the corresponding path alias
      *    (e.g. `@yii/base/Component.php`);
      *
-     * This autoloader allows loading classes that follow the [PSR-4 standard](http://www.php-fig.org/psr/psr-4/)
+     * This autoloader allows loading classes that follow the [PSR-4 standard](https://www.php-fig.org/psr/psr-4/)
      * and have its top-level namespace or sub-namespaces defined as path aliases.
      *
      * Example: When aliases `@yii` and `@yii/bootstrap` are defined, classes in the `yii\bootstrap` namespace
@@ -384,7 +384,7 @@ public static function getLogger()
 
     /**
      * Sets the logger object.
-     * @param Logger $logger the logger object.
+     * @param Logger|null $logger the logger object.
      */
     public static function setLogger($logger)
     {
@@ -502,7 +502,7 @@ public static function endProfile($token, $category = 'application')
     public static function powered()
     {
         return \Yii::t('yii', 'Powered by {yii}', [
-            'yii' => '<a href="http://www.yiiframework.com/" rel="external">' . \Yii::t('yii',
+            'yii' => '<a href="https://www.yiiframework.com/" rel="external">' . \Yii::t('yii',
                     'Yii Framework') . '</a>',
         ]);
     }
@@ -528,7 +528,7 @@ public static function powered()
      * @param string $category the message category.
      * @param string $message the message to be translated.
      * @param array $params the parameters that will be used to replace the corresponding placeholders in the message.
-     * @param string $language the language code (e.g. `en-US`, `en`). If this is null, the current
+     * @param string|null $language the language code (e.g. `en-US`, `en`). If this is null, the current
      * [[\yii\base\Application::language|application language]] will be used.
      * @return string the translated message.
      */
diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index da783b578fe..5750f041f53 100644
--- a/src/CHANGELOG.md
+++ b/src/CHANGELOG.md
@@ -1,36 +1,106 @@
 Yii Framework 2 Change Log
 ==========================
 
-2.0.44 under development
+2.0.46 under development
 ------------------------
 
-- Enh #13105: Add yiiActiveForm validate_only property for skipping form auto-submission (ptolomaues)
-- Enh #18967: Use proper attribute names for tabular data in `yii\widgets\ActiveField::addAriaAttributes()` (AnkIF)
-- Bug #18798: Fix `StringHelper::dirname()` when passing string with a trailing slash (perlexed)
-- Enh #18328: Raise warning when trying to register a file after `View::endPage()` has been called (perlexed)
-- Enh #18812: Added error messages and optimized "error" methods in `yii\helpers\BaseJson` (WinterSilence, samdark)
-- Chg #18823: Rollback changes #18806 in `yii\validators\ExistValidator::checkTargetRelationExistence()` (WinterSilence)
-- Enh #18826: Add ability to turn the sorting off for a clicked column in GridView with multisort (ditibal)
+- Bug #19467: Revert changes in `Inflector::camel2words()` introduced in #19204 (samdark)
+- Bug #19471: Enable console commands on hostings with disabled `exec()` function (WinterSilence, lubosdz)
+- Bug #19469: Fix a virtual relation not working because of new isset checks in `\yii\db\ActiveRelationTrait` (wvanheumen)
+- Bug #19380: Fix PHP 8.1 passing non string to trim() in `yii\db\Query` (wa1kb0y)
+- Bug #19272: Fix bug in dirty attributes check on multidimensional array (speedplli)
+- Bug #19349: Fix PHP 8.1 error when attribute and label of `yii\grid\DataColumn` are empty (githubjeka)
+- Bug #19243: Handle `finfo_open` for tar.xz as `application/octet-stream` on PHP 8.1 (longthanhtran)
+- Bug #19235: Fix return type compatibility of `yii\web\SessionIterator` class methods for PHP 8.1 (virtual-designer)
+- Bug #19256: Pass missed `$view` to user's callback in `yii\validators\InlineValidator::clientValidateAttribute()` (WinterSilence)
+- Enh #19270: Replace deprecated `scss` converter in `yii\web\AssetConverter::$commands` (WinterSilence)
+- Enh #19254: Support specifying custom characters for `yii.validation.trim()` and replace deprecated `jQuery.trim()` (WinterSilence)
+- Bug #19291: Reset errors and validators in `yii\base\Model::__clone()` (WinterSilence)
+- Enh #19295: Added alias `text/rtf` for mime-type `application/rtf` (lesha724)
+- Enh #19308: Add `yii\web\UploadedFile::$fullPath` represents 'full_path' key added in PHP 8.1 (WinterSilence)
+- Bug #19303: Fix serialization in `yii\caching\Dependency::generateReusableHash()` (WinterSilence)
+- Enh #19304: Add filtering validator `yii\validators\TrimValidator` (WinterSilence)
+- Enh #19309: Optimize `yii\base\Model::attributes()` (WinterSilence)
+- Bug #19322: Revert force setting value to empty string in case it's `null` in `yii\validators\FilterValidator::validateAttribute()` (bizley)
+- Bug #19324: Fix `yii\helpers\BaseHtml::renderSelectOptions()` giving wrong selection for boolean attributes (adnandautovic)
+- Bug #19329: Fix `yii\web\GroupUrlRule` to properly normalize prefix (bizley)
+- Bug #19328: Passing null to parameter #1 ($string) of type string is deprecated in `yii\db\oci\Schema` (Arkeins)
+- Enh #19318: Add support for typecasting PHP 8.1 enums (EtienneBruines)
+- Bug #19237: Fix OCI PHP 8.1 passing `null` to trim() (longthanhtran)
+- Bug #19312: Fix PHP 8.1 error when passing null to `yii\helpers\BaseInflector` (WinterSilence)
+- Bug #19368: Fix PHP 8.1 error when `$fileMimeType` is `null` in `yii\validators\FileValidator::validateMimeType()` (bizley)
+- Enh #19384: Normalize `setBodyParams()` and `getBodyParam()` in `yii\web\Request` (WinterSilence, albertborsos)
+- Bug #19386: Fix recursive calling `yii\helpers\BaseArrayHelper::htmlDecode()` (WinterSilence)
+- Bug #19407: Fix `yii\validators\UniqueValidator` and `yii\validators\ExistValidator` to respect `skipOnError` option for target attributes (bizley)
+- Bug #19418: Fix `yii\filters\auth\CompositeAuth` ignoring `only` and `except` options (lesha724)
+- Enh #19401: Delay `exit(1)` in `yii\base\ErrorHandler::handleFatalError` (arrilot)
+- Bug #19402: Add shutdown event and fix working directory in `yii\base\ErrorHandler` (WinterSilence)
+- Enh #19416: Update and improve configurations for `yii\console\controllers\MessageController` (WinterSilence)
+- Bug #19403: Fix types in `yii\web\SessionIterator` (WinterSilence)
+- Enh #19420: Update list of JS callbacks in `yii\widgets\MaskedInput` (WinterSilence)
+- Bug #19400: Fix passing null in `yii\web\Response::redirect()` (bizley)
+- Enh #19437: Add support to specify request port by trusted proxies in `\yii\web\Request::getServerPort()` (rhertogh)
+- Bug #19445: Fix caching in `yii\i18n\Formatter::getUnitMessage()` (WinterSilence)
+- Bug #19454: Fix PDO exception code not properly passed to `yii\db\Exception` (Roguyt)
+- Bug #19477: cast shell_exec() output to string (schmunk42)
+- Bug #19481: Exception is always empty in ErrorHandler when handling fatal error (Renkas)
+- Bug #19462: Fix validator client options to encode HTML tags (bizley)
+- Bug #19259: Fix `yii\log\FileTarget` locking and always rotate files only by copy (bizley, mikehaertl)
+
+2.0.45 February 11, 2022
+------------------------
+
+- Bug #19004: Container::resolveCallableDependencies() unable to handle union and intersection types (sartor)
+- Bug #19041: Fix PHP 8.1 issues (longthanhtran, samdark, pamparam83, sartor, githubjeka)
+- Bug #19047: Fix deprecated preg_match() passing null parameters #2 in db\mysql\Schema.php (longthanhtran)
+- Bug #19130: Fix DbSession breaks in some case (longthanhtran)
+- Bug #19138: Allow digits in language code (ntesic)
+- Bug #19148: Fix undefined array key errors in `yii\db\ActiveRelationTrait` (stevekr)
+- Bug #19182: RBAC Migration failed when use oracle with oci8 (Murolike)
+- Bug #19187: Fix `yii\filters\PageCache` to store original headers names instead of normalized ones (bizley)
+- Bug #19191: Change `\Exception` to `\Throwable` in `BadRequestHttpException` and `HttpException` (Dmitrijlin)
+- Bug #19204: Support numbers in Inflector::camel2words (longthanhtran)
+- Enh #18821: Allow `yii\db\ExpressionInterface` as column in `yii\db\conditions\InBuilder` (ntesic)
+- Enh #19171: Added `$pagination` and `$sort` to `\yii\rest\IndexAction` for easy configuration (rhertogh)
+
+
+2.0.44 December 30, 2021
+------------------------
+
+- Bug #17119: Fix `yii\caching\Cache::multiSet()` to use `yii\caching\Cache::$defaultDuration` when no duration is passed (OscarBarrett)
 - Bug #18646: Remove stale identity data from session if `IdentityInterface::findIdentity()` returns `null` (mikehaertl)
+- Bug #18660: Fix database migration template does not work with namespaced migrations when migration name does not include namespace (iridance)
+- Bug #18798: Fix `StringHelper::dirname()` when passing string with a trailing slash (perlexed)
 - Bug #18832: Fix `Inflector::camel2words()` adding extra spaces (brandonkelly)
-- Enh #18762: Added `yii\helpers\Json::$keepObjectType` and `yii\web\JsonResponseFormatter::$keepObjectType` in order to avoid changing zero-indexed objects to array in `yii\helpers\Json::encode()` (zebraf1)
-- Enh #18783: Add support for URI namespaced tags in `XmlResponseFormatter` (WinterSilence, samdark)
-- Enh #18783: Add `XmlResponseFormatter::$objectTagToLowercase` option to lowercase object tags (WinterSilence, samdark)
-- Bug #18845: Fix duplicating `id` in `MigrateController::addDefaultPrimaryKey()` (WinterSilence, samdark)
-- Bug #17119: Fix `yii\caching\Cache::multiSet()` to use `yii\caching\Cache::$defaultDuration` when no duration is passed (OscarBarrett)
 - Bug #18842: Fix `yii\base\Controller::bindInjectedParams()` to not throw error when argument of `ReflectionUnionType` type is passed (bizley)
-- Enh #18858: Reduce memory usage in `yii\base\View::afterRender` method (LeoOnTheEarth)
+- Bug #18845: Fix duplicating `id` in `MigrateController::addDefaultPrimaryKey()` (WinterSilence, samdark)
 - Bug #18880: Fix `yii\helpers\ArrayHelper::toArray()` for `DateTime` objects in PHP >= 7.4 (rhertogh)
 - Bug #18883: Fix `yii\web\HeaderCollection::fromArray()` now ensures lower case keys (rhertogh)
-- Enh #18899: Replace usages of `strpos` with `strncmp` and remove redundant usage of `array_merge` and `array_values` (AlexGx)
 - Bug #18898: Fix `yii\helpers\Inflector::camel2words()` to work with words ending with 0 (michaelarnauts)
-- Enh #18904: Improve Captcha client-side validation (hexkir)
-- Bug #18913: Add filename validation for `MessageSource::getMessageFilePath()` (uaoleg)
 - Bug #18909: Fix bug with binding default action parameters for controllers (bizley)
+- Bug #18913: Add filename validation for `MessageSource::getMessageFilePath()` (uaoleg)
 - Bug #18955: Check `yiisoft/yii2-swiftmailer` before using as default mailer in `yii\base\Application` (WinterSilence)
 - Bug #18988: Fix default value of `yii\console\controllers\MessageController::$translator` (WinterSilence)
 - Bug #18993: Load defaults by `attributes()` in `yii\db\ActiveRecord::loadDefaultValues()` (WinterSilence)
 - Bug #19021: Fix return type in PhpDoc `yii\db\Migration` functions `up()`, `down()`, `safeUp()` and `safeDown()` (WinterSilence, rhertogh)
+- Bug #19030: Add DI container usage to `yii\base\Widget::end()` (papppeter)
+- Bug #19031: Fix displaying console help for parameters with declared types (WinterSilence)
+- Bug #19096: Fix `Request::getIsConsoleRequest()` may return erroneously when testing a Web application in Codeception (WinterSilence)
+- Enh #13105: Add yiiActiveForm `validate_only` property for skipping form auto-submission (ptolomaues)
+- Enh #18328: Raise warning when trying to register a file after `View::endPage()` has been called (perlexed)
+- Enh #18762: Add `yii\helpers\Json::$keepObjectType` and `yii\web\JsonResponseFormatter::$keepObjectType` in order to avoid changing zero-indexed objects to array in `yii\helpers\Json::encode()` (zebraf1)
+- Enh #18783: Add support for URI namespaced tags in `XmlResponseFormatter` (WinterSilence, samdark)
+- Enh #18783: Add `XmlResponseFormatter::$objectTagToLowercase` option to lowercase object tags (WinterSilence, samdark)
+- Enh #18812: Add error messages and optimize "error" methods in `yii\helpers\BaseJson` (WinterSilence, samdark)
+- Enh #18826: Add ability to turn the sorting off for a clicked column in GridView with multisort (ditibal)
+- Enh #18858: Reduce memory usage in `yii\base\View::afterRender` method (LeoOnTheEarth)
+- Enh #18899: Replace usages of `strpos` with `strncmp` and remove redundant usage of `array_merge` and `array_values` (AlexGx)
+- Enh #18904: Improve Captcha client-side validation (hexkir)
+- Enh #18967: Use proper attribute names for tabular data in `yii\widgets\ActiveField::addAriaAttributes()` (AnkIF)
+- Enh #19005: Add `yii\base\Module::setControllerPath()` (WinterSilence)
+- Enh #19098: Add `yii\helper\BaseHtml::$normalizeClassAttribute` to fix duplicate classes (WinterSilence)
+- Enh #19108: Optimize `Component::hasEventHandlers()` and `Component::trigger()` (WinterSilence)
+- Chg #18823: Rollback changes from #18806 in `yii\validators\ExistValidator::checkTargetRelationExistence()` (WinterSilence)
 
 
 2.0.43 August 09, 2021
@@ -2555,14 +2625,14 @@ Yii Framework 2 Change Log
 - Bug: `yii\helpers\Json::encode()`` did not handle objects that implement `JsonSerializable` interface correctly (cebe)
 - Bug: Fixed issue with tabular input on `yii\widgets\ActiveField::radio()` and `yii\widgets\ActiveField::checkbox()` (jom)
 - Bug: Fixed the issue that query cache returns the same data for the same SQL but different query methods (qiangxue)
-- Bug: Fixed URL parsing so it's now properly giving 404 for URLs like `http://example.com//////site/about` (samdark)
+- Bug: Fixed URL parsing so it's now properly giving 404 for URLs like `https://example.com//////site/about` (samdark)
 - Bug: Fixed `yii\console\controllers\HelpController::getModuleCommands()` issue where it attempts to scan a module's controller directory when it doesn't exist (jom)
 - Bug: Fixed an issue with FileHelper and not accessible directories which resulted in endless loop (cebe)
 - Bug: Fixed `yii\base\Model::load()` returned `true` if `$data` and `formName` were empty (samdark)
 - Bug: Fixed issue with `yii\db\ActiveRelationTrait` preventing `yii\db\ActiveQuery` from clearing events and behaviors on clone (jom)
 - Bug: `yii\db\Query::queryScalar()` wasn't making `SELECT DISTINCT` queries subqueries (jom)
 - Bug: Fixed use `$files` instead of `self::$_files[$key]` to allow inheritance (pgaultier)
-- Enh #46: Added Image extension based on [Imagine library](http://imagine.readthedocs.org) (tonydspaniard)
+- Enh #46: Added Image extension based on [Imagine library](https://imagine.readthedocs.io/) (tonydspaniard)
 - Enh #364: Improve `yii\helpers\Inflector::slug()` with `intl` transliteration. Improved transliteration char map. (tonydspaniard)
 - Enh #497: Removed `yii\log\Target::logUser` and added `yii\log\Target::prefix` to support customizing message prefix (qiangxue)
 - Enh #499: Decoupled `Rule` from RBAC `Item` (samdark, qiangxue)
diff --git a/framework/README.md b/framework/README.md
index 161f8d13a01..4ff5e6d5a28 100644
--- a/src/README.md
+++ b/src/README.md
@@ -10,7 +10,7 @@ For license information check the [LICENSE](LICENSE.md)-file.
 Installation
 ------------
 
-The preferred way to install the Yii framework is through [composer](http://getcomposer.org/download/).
+The preferred way to install the Yii framework is through [composer](https://getcomposer.org/download/).
 
 Refer to [Bower and NPM Assets installation](https://www.yiiframework.com/doc/guide/2.0/en/structure-assets#bower-npm-assets) to select an asset installation method.
 
diff --git a/framework/UPGRADE.md b/framework/UPGRADE.md
index 8a9a20a4737..5ae7f63efc4 100644
--- a/src/UPGRADE.md
+++ b/src/UPGRADE.md
@@ -12,7 +12,7 @@ Upgrading in general is as simple as updating your dependency in your composer.j
 running `composer update`. In a big application however there may be more things to consider,
 which are explained in the following.
 
-> Note: This document assumes you have composer [installed globally](http://www.yiiframework.com/doc-2.0/guide-start-installation.html#installing-composer)
+> Note: This document assumes you have composer [installed globally](https://www.yiiframework.com/doc-2.0/guide-start-installation.html#installing-composer)
 so that you can run the `composer` command. If you have a `composer.phar` file inside of your project you need to
 replace `composer` with `php composer.phar` in the following.
 
@@ -51,10 +51,26 @@ if you want to upgrade from version A to version C and there is
 version B between A and C, you need to follow the instructions
 for both A and B.
 
+Upgrade from Yii 2.0.45
+-----------------------
+
+* Changes in `Inflector::camel2words()` introduced in 2.0.45 were reverted so it works as in pre-2.0.45. If you need
+  2.0.45 behavior, [introduce your own method](https://github.com/yiisoft/yii2/pull/19495/files).
+* `yii\log\FileTarget::$rotateByCopy` is now deprecated and setting it to `false` has no effect since rotating of 
+  the files is done only by copy.
+
+Upgrade from Yii 2.0.44
+-----------------------
+
+* `yii\filters\PageCache::$cacheHeaders` now takes a case-sensitive list of header names since PageCache is no longer 
+  storing the normalized (lowercase) versions of them so make sure this list is properly updated and your page cache 
+  is recreated.
+
 Upgrade from Yii 2.0.43
 -----------------------
 
-* `Json::encode()` can now handle zero-indexed objects in same way as `json_encode()` and keep them as objects. In order to avoid breaking backwards compatibility this behavior could be enabled by a new option flag but is disabled by default.
+* `Json::encode()` can now handle zero-indexed objects in same way as `json_encode()` and keep them as objects. In order 
+  to avoid breaking backwards compatibility this behavior could be enabled by a new option flag but is disabled by default.
   * Set `yii/helpers/Json::$keepObjectType = true` anywhere in your application code
   * Or configure json response formatter to enable it for all JSON responses:
       ```php
@@ -68,7 +84,8 @@ Upgrade from Yii 2.0.43
         ],
       ],
       ```
-* `yii\caching\Cache::multiSet()` now uses the default cache duration (`yii\caching\Cache::$defaultDuration`) when no duration is provided. A duration of 0 should be explicitly passed if items should not expire.
+* `yii\caching\Cache::multiSet()` now uses the default cache duration (`yii\caching\Cache::$defaultDuration`) when no 
+  duration is provided. A duration of 0 should be explicitly passed if items should not expire.
 
 Upgrade from Yii 2.0.42
 -----------------------
@@ -450,7 +467,7 @@ Upgrade from Yii 2.0.13
 * `yii\db\QueryBuilder::conditionBuilders` property and method-based condition builders are no longer used. 
   Class-based conditions and builders are introduced instead to provide more flexibility, extensibility and
   space to customization. In case you rely on that property or override any of default condition builders, follow the 
-  special [guide article](http://www.yiiframework.com/doc-2.0/guide-db-query-builder.html#adding-custom-conditions-and-expressions)
+  special [guide article](https://www.yiiframework.com/doc-2.0/guide-db-query-builder.html#adding-custom-conditions-and-expressions)
   to update your code.
 
 * Protected method `yii\db\ActiveQueryTrait::createModels()` does not apply indexes as defined in `indexBy` property anymore.  
@@ -481,7 +498,7 @@ Upgrade from Yii 2.0.12
   was insecure as the header could have been set by a malicious client on a non-HTTPS connection.
   With 2.0.13 Yii adds support for configuring trusted proxies. If your application runs behind a reverse proxy and relies on
   `getIsSecureConnection()` to return the value form the `X-Forwarded-Proto` header you need to explicitly allow
-  this in the Request configuration. See the [guide](http://www.yiiframework.com/doc-2.0/guide-runtime-requests.html#trusted-proxies) for more information.
+  this in the Request configuration. See the [guide](https://www.yiiframework.com/doc-2.0/guide-runtime-requests.html#trusted-proxies) for more information.
 
   This setting also affects you when Yii is running on IIS webserver, which sets the `X-Rewrite-Url` header.
   This header is now filtered by default and must be listed in trusted hosts to be detected by Yii:
@@ -674,7 +691,7 @@ Upgrade from Yii 2.0.6
   initialization to support wider range of allowed characters. Because of this change:
 
   - You are required to flush your application cache to remove outdated `UrlRule` serialized objects.
-    See the [Cache Flushing Guide](http://www.yiiframework.com/doc-2.0/guide-caching-data.html#cache-flushing)
+    See the [Cache Flushing Guide](https://www.yiiframework.com/doc-2.0/guide-caching-data.html#cache-flushing)
   - If you implement `parseRequest()` or `createUrl()` and rely on parameter names, call `substitutePlaceholderNames()`
     in order to replace temporary IDs with parameter names after doing matching.
 
@@ -750,7 +767,7 @@ If you've extended `yii\base\Security` to override any of the config constants y
 Upgrade from Yii 2.0.0
 ----------------------
 
-* Upgraded Twitter Bootstrap to [version 3.3.x](http://blog.getbootstrap.com/2014/10/29/bootstrap-3-3-0-released/).
+* Upgraded Twitter Bootstrap to [version 3.3.x](https://blog.getbootstrap.com/2014/10/29/bootstrap-3-3-0-released/).
   If you need to use an older version (i.e. stick with 3.2.x) you can specify that in your `composer.json` by
   adding the following line in the `require` section:
 
diff --git a/framework/Yii.php b/framework/Yii.php
index 4226770df37..d02b95a231a 100644
--- a/src/Yii.php
+++ b/src/Yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 require __DIR__ . '/BaseYii.php';
diff --git a/framework/assets/yii.activeForm.js b/framework/assets/yii.activeForm.js
index 671f6dcc9f6..b12f812c37d 100644
--- a/src/assets/yii.activeForm.js
+++ b/src/assets/yii.activeForm.js
@@ -3,9 +3,9 @@
  *
  * This is the JavaScript widget used by the yii\widgets\ActiveForm widget.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
diff --git a/framework/assets/yii.captcha.js b/framework/assets/yii.captcha.js
index 7293183e76d..930d43d7e83 100644
--- a/src/assets/yii.captcha.js
+++ b/src/assets/yii.captcha.js
@@ -3,9 +3,9 @@
  *
  * This is the JavaScript widget used by the yii\captcha\Captcha widget.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
diff --git a/framework/assets/yii.gridView.js b/framework/assets/yii.gridView.js
index 25ff9600e10..825ff5044db 100644
--- a/src/assets/yii.gridView.js
+++ b/src/assets/yii.gridView.js
@@ -3,9 +3,9 @@
  *
  * This is the JavaScript widget used by the yii\grid\GridView widget.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
diff --git a/framework/assets/yii.js b/framework/assets/yii.js
index b22c364c6fc..6384d07d172 100644
--- a/src/assets/yii.js
+++ b/src/assets/yii.js
@@ -1,9 +1,9 @@
 /**
  * Yii JavaScript module.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
@@ -511,7 +511,7 @@ window.yii = (function ($) {
         return false;
     }
 
-    // http://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex
+    // https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex/6969486#6969486
     function escapeRegExp(str) {
         return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
     }
diff --git a/framework/assets/yii.validation.js b/framework/assets/yii.validation.js
index 2f1e06039b1..2cae037e3c1 100644
--- a/src/assets/yii.validation.js
+++ b/src/assets/yii.validation.js
@@ -3,9 +3,9 @@
  *
  * This JavaScript module provides the validation methods for the built-in validators.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
@@ -24,7 +24,7 @@ yii.validation = (function ($) {
             var valid = false;
             if (options.requiredValue === undefined) {
                 var isString = typeof value == 'string' || value instanceof String;
-                if (options.strict && value !== undefined || !options.strict && !pub.isEmpty(isString ? $.trim(value) : value)) {
+                if (options.strict && value !== undefined || !options.strict && !pub.isEmpty(isString ? trimString(value) : value)) {
                     valid = true;
                 }
             } else if (!options.strict && value == options.requiredValue || options.strict && value === options.requiredValue) {
@@ -243,8 +243,17 @@ yii.validation = (function ($) {
             }
 
             value = $input.val();
-            if (!options.skipOnEmpty || !pub.isEmpty(value)) {
-                value = $.trim(value);
+            if (
+                (!options.skipOnEmpty || !pub.isEmpty(value))
+                && (!options.skipOnArray || !Array.isArray(value))
+            ) {
+                if (Array.isArray(value)) {
+                    for (var i = 0; i < value.length; i++) {
+                        value[i] = trimString(value[i], options);
+                    }
+                } else {
+                    value = trimString(value, options);
+                }
                 $input.val(value);
             }
 
@@ -467,5 +476,25 @@ yii.validation = (function ($) {
         }
     }
 
+    /**
+     * PHP: `trim($path, ' /')`, JS: `yii.helpers.trim(path, {chars: ' /'})`
+     */
+    function trimString(value, options = {skipOnEmpty: true, chars: null}) {
+        if (options.skipOnEmpty !== false && pub.isEmpty(value)) {
+            return value;
+        }
+
+        value = new String(value);
+        if (options.chars || !String.prototype.trim) {
+            var chars = !options.chars
+                ? ' \\s\xA0'
+                : options.chars.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g, '\$1');
+
+            return value.replace(new RegExp('^[' + chars + ']+|[' + chars + ']+$', 'g'), '');
+        }
+
+        return value.trim();
+    }
+
     return pub;
 })(jQuery);
diff --git a/framework/base/Action.php b/framework/base/Action.php
index 5a9413cf296..45d95c59cbf 100644
--- a/src/base/Action.php
+++ b/src/base/Action.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -30,8 +30,7 @@
  *
  * For more details and usage information on Action, see the [guide article on actions](guide:structure-controllers).
  *
- * @property-read string $uniqueId The unique ID of this action among the whole application. This property is
- * read-only.
+ * @property-read string $uniqueId The unique ID of this action among the whole application.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
diff --git a/framework/base/ActionEvent.php b/framework/base/ActionEvent.php
index 54a9f6ef640..ab03d7366f1 100644
--- a/src/base/ActionEvent.php
+++ b/src/base/ActionEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/ActionFilter.php b/framework/base/ActionFilter.php
index 10d745a3b2e..83f00574d14 100644
--- a/src/base/ActionFilter.php
+++ b/src/base/ActionFilter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -36,7 +36,7 @@ class ActionFilter extends Behavior
      *
      * @see except
      */
-    public $only;
+    public $only = [];
     /**
      * @var array list of action IDs that this filter should not apply to.
      * @see only
diff --git a/framework/base/Application.php b/framework/base/Application.php
index 3e095447c17..380f3a2017a 100644
--- a/src/base/Application.php
+++ b/src/base/Application.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -14,40 +14,32 @@
  *
  * For more details and usage information on Application, see the [guide article on applications](guide:structure-applications).
  *
- * @property-read \yii\web\AssetManager $assetManager The asset manager application component. This property
- * is read-only.
- * @property-read \yii\rbac\ManagerInterface $authManager The auth manager application component. Null is
- * returned if auth manager is not configured. This property is read-only.
+ * @property-read \yii\web\AssetManager $assetManager The asset manager application component.
+ * @property-read \yii\rbac\ManagerInterface|null $authManager The auth manager application component or null
+ * if it's not configured.
  * @property string $basePath The root directory of the application.
  * @property-read \yii\caching\CacheInterface $cache The cache application component. Null if the component is
- * not enabled. This property is read-only.
- * @property-write array $container Values given in terms of name-value pairs. This property is write-only.
- * @property-read \yii\db\Connection $db The database connection. This property is read-only.
+ * not enabled.
+ * @property-write array $container Values given in terms of name-value pairs.
+ * @property-read \yii\db\Connection $db The database connection.
  * @property-read \yii\web\ErrorHandler|\yii\console\ErrorHandler $errorHandler The error handler application
- * component. This property is read-only.
- * @property-read \yii\i18n\Formatter $formatter The formatter application component. This property is
- * read-only.
- * @property-read \yii\i18n\I18N $i18n The internationalization application component. This property is
- * read-only.
- * @property-read \yii\log\Dispatcher $log The log dispatcher application component. This property is
- * read-only.
- * @property-read \yii\mail\MailerInterface $mailer The mailer application component. This property is
- * read-only.
- * @property-read \yii\web\Request|\yii\console\Request $request The request component. This property is
- * read-only.
- * @property-read \yii\web\Response|\yii\console\Response $response The response component. This property is
- * read-only.
+ * component.
+ * @property-read \yii\i18n\Formatter $formatter The formatter application component.
+ * @property-read \yii\i18n\I18N $i18n The internationalization application component.
+ * @property-read \yii\log\Dispatcher $log The log dispatcher application component.
+ * @property-read \yii\mail\MailerInterface $mailer The mailer application component.
+ * @property-read \yii\web\Request|\yii\console\Request $request The request component.
+ * @property-read \yii\web\Response|\yii\console\Response $response The response component.
  * @property string $runtimePath The directory that stores runtime files. Defaults to the "runtime"
  * subdirectory under [[basePath]].
- * @property-read \yii\base\Security $security The security application component. This property is read-only.
+ * @property-read \yii\base\Security $security The security application component.
  * @property string $timeZone The time zone used by this application.
- * @property-read string $uniqueId The unique ID of the module. This property is read-only.
- * @property-read \yii\web\UrlManager $urlManager The URL manager for this application. This property is
- * read-only.
+ * @property-read string $uniqueId The unique ID of the module.
+ * @property-read \yii\web\UrlManager $urlManager The URL manager for this application.
  * @property string $vendorPath The directory that stores vendor files. Defaults to "vendor" directory under
  * [[basePath]].
  * @property-read View|\yii\web\View $view The view application component that is used to render various view
- * files. This property is read-only.
+ * files.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -109,7 +101,7 @@ abstract class Application extends Module
     public $charset = 'UTF-8';
     /**
      * @var string the language that is meant to be used for end users. It is recommended that you
-     * use [IETF language tags](http://en.wikipedia.org/wiki/IETF_language_tag). For example, `en` stands
+     * use [IETF language tags](https://en.wikipedia.org/wiki/IETF_language_tag). For example, `en` stands
      * for English, while `en-US` stands for English (United States).
      * @see sourceLanguage
      */
@@ -134,7 +126,7 @@ abstract class Application extends Module
      */
     public $requestedRoute;
     /**
-     * @var Action the requested Action. If null, it means the request cannot be resolved into an action.
+     * @var Action|null the requested Action. If null, it means the request cannot be resolved into an action.
      */
     public $requestedAction;
     /**
@@ -142,7 +134,7 @@ abstract class Application extends Module
      */
     public $requestedParams;
     /**
-     * @var array list of installed Yii extensions. Each array element represents a single extension
+     * @var array|null list of installed Yii extensions. Each array element represents a single extension
      * with the following structure:
      *
      * ```php
@@ -525,7 +517,7 @@ public function getErrorHandler()
 
     /**
      * Returns the cache component.
-     * @return \yii\caching\CacheInterface the cache application component. Null if the component is not enabled.
+     * @return \yii\caching\CacheInterface|null the cache application component. Null if the component is not enabled.
      */
     public function getCache()
     {
@@ -651,7 +643,7 @@ public function coreComponents()
      * This method replaces the `exit()` function by ensuring the application life cycle is completed
      * before terminating the application.
      * @param int $status the exit status (value 0 means normal exit while other values mean abnormal exit).
-     * @param Response $response the response to be sent. If not set, the default application [[response]] component will be used.
+     * @param Response|null $response the response to be sent. If not set, the default application [[response]] component will be used.
      * @throws ExitException if the application is in testing mode
      */
     public function end($status = 0, $response = null)
diff --git a/framework/base/ArrayAccessTrait.php b/framework/base/ArrayAccessTrait.php
index 87a1db1d61c..177894e5549 100644
--- a/src/base/ArrayAccessTrait.php
+++ b/src/base/ArrayAccessTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -26,6 +26,7 @@ trait ArrayAccessTrait
      * It will be implicitly called when you use `foreach` to traverse the collection.
      * @return \ArrayIterator an iterator for traversing the cookies in the collection.
      */
+    #[\ReturnTypeWillChange]
     public function getIterator()
     {
         return new \ArrayIterator($this->data);
@@ -36,6 +37,7 @@ public function getIterator()
      * This method is required by Countable interface.
      * @return int number of data elements.
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         return count($this->data);
@@ -46,6 +48,7 @@ public function count()
      * @param mixed $offset the offset to check on
      * @return bool
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return isset($this->data[$offset]);
@@ -56,6 +59,7 @@ public function offsetExists($offset)
      * @param int $offset the offset to retrieve element.
      * @return mixed the element at the offset, null if no element is found at the offset
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         return isset($this->data[$offset]) ? $this->data[$offset] : null;
@@ -66,6 +70,7 @@ public function offsetGet($offset)
      * @param int $offset the offset to set element
      * @param mixed $item the element value
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $item)
     {
         $this->data[$offset] = $item;
@@ -75,6 +80,7 @@ public function offsetSet($offset, $item)
      * This method is required by the interface [[\ArrayAccess]].
      * @param mixed $offset the offset to unset element
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         unset($this->data[$offset]);
diff --git a/framework/base/Arrayable.php b/framework/base/Arrayable.php
index 97dabf4ad88..c278f61ee16 100644
--- a/src/base/Arrayable.php
+++ b/src/base/Arrayable.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/ArrayableTrait.php b/framework/base/ArrayableTrait.php
index d2093fd8592..310c007486e 100644
--- a/src/base/ArrayableTrait.php
+++ b/src/base/ArrayableTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/BaseObject.php b/framework/base/BaseObject.php
index e5d4e1001c8..174fcd1e998 100644
--- a/src/base/BaseObject.php
+++ b/src/base/BaseObject.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Behavior.php b/framework/base/Behavior.php
index 034d7114385..4e72f489c7a 100644
--- a/src/base/Behavior.php
+++ b/src/base/Behavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/BootstrapInterface.php b/framework/base/BootstrapInterface.php
index ed55ecdd135..3775fcac9fd 100644
--- a/src/base/BootstrapInterface.php
+++ b/src/base/BootstrapInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Component.php b/framework/base/Component.php
index 32f714cbcba..d6121705fa4 100644
--- a/src/base/Component.php
+++ b/src/base/Component.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -93,8 +93,7 @@
  *
  * For more details and usage information on Component, see the [guide article on components](guide:concept-components).
  *
- * @property-read Behavior[] $behaviors List of behaviors attached to this component. This property is
- * read-only.
+ * @property-read Behavior[] $behaviors List of behaviors attached to this component.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -465,13 +464,17 @@ public function hasEventHandlers($name)
     {
         $this->ensureBehaviors();
 
+        if (!empty($this->_events[$name])) {
+            return true;
+        }
+
         foreach ($this->_eventWildcards as $wildcard => $handlers) {
             if (!empty($handlers) && StringHelper::matchWildcard($wildcard, $name)) {
                 return true;
             }
         }
 
-        return !empty($this->_events[$name]) || Event::hasHandlers($this, $name);
+        return Event::hasHandlers($this, $name);
     }
 
     /**
@@ -541,7 +544,7 @@ public function on($name, $handler, $data = null, $append = true)
      * wildcard will be removed, while handlers registered with plain names matching this wildcard will remain.
      *
      * @param string $name event name
-     * @param callable $handler the event handler to be removed.
+     * @param callable|null $handler the event handler to be removed.
      * If it is null, all handlers attached to the named event will be removed.
      * @return bool if a handler is found and detached
      * @see on()
@@ -594,10 +597,12 @@ public function off($name, $handler = null)
 
     /**
      * Triggers an event.
-     * This method represents the happening of an event. It invokes
-     * all attached handlers for the event including class-level handlers.
+     *
+     * This method represents the happening of an event. It invokes all attached handlers for the event
+     * including class-level handlers.
+     *
      * @param string $name the event name
-     * @param Event $event the event parameter. If not set, a default [[Event]] object will be created.
+     * @param Event|null $event the event instance. If not set, a default [[Event]] object will be created.
      */
     public function trigger($name, Event $event = null)
     {
@@ -606,15 +611,15 @@ public function trigger($name, Event $event = null)
         $eventHandlers = [];
         foreach ($this->_eventWildcards as $wildcard => $handlers) {
             if (StringHelper::matchWildcard($wildcard, $name)) {
-                $eventHandlers = array_merge($eventHandlers, $handlers);
+                $eventHandlers[] = $handlers;
             }
         }
-
         if (!empty($this->_events[$name])) {
-            $eventHandlers = array_merge($eventHandlers, $this->_events[$name]);
+            $eventHandlers[] = $this->_events[$name];
         }
 
         if (!empty($eventHandlers)) {
+            $eventHandlers = call_user_func_array('array_merge', $eventHandlers);
             if ($event === null) {
                 $event = new Event();
             }
@@ -640,7 +645,7 @@ public function trigger($name, Event $event = null)
     /**
      * Returns the named behavior object.
      * @param string $name the behavior name
-     * @return null|Behavior the behavior object, or null if the behavior does not exist
+     * @return Behavior|null the behavior object, or null if the behavior does not exist
      */
     public function getBehavior($name)
     {
@@ -698,7 +703,7 @@ public function attachBehaviors($behaviors)
      * Detaches a behavior from the component.
      * The behavior's [[Behavior::detach()]] method will be invoked.
      * @param string $name the behavior's name.
-     * @return null|Behavior the detached behavior. Null if the behavior does not exist.
+     * @return Behavior|null the detached behavior. Null if the behavior does not exist.
      */
     public function detachBehavior($name)
     {
diff --git a/framework/base/Configurable.php b/framework/base/Configurable.php
index e934079c440..9982d6f627c 100644
--- a/src/base/Configurable.php
+++ b/src/base/Configurable.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Controller.php b/framework/base/Controller.php
index 0c79060ceff..2205712fb28 100644
--- a/src/base/Controller.php
+++ b/src/base/Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -16,12 +16,9 @@
  *
  * For more details and usage information on Controller, see the [guide article on controllers](guide:structure-controllers).
  *
- * @property-read Module[] $modules All ancestor modules that this controller is located within. This property
- * is read-only.
+ * @property-read Module[] $modules All ancestor modules that this controller is located within.
  * @property-read string $route The route (module ID, controller ID and action ID) of the current request.
- * This property is read-only.
- * @property-read string $uniqueId The controller ID that is prefixed with the module ID (if any). This
- * property is read-only.
+ * @property-read string $uniqueId The controller ID that is prefixed with the module ID (if any).
  * @property View|\yii\web\View $view The view object that can be used to render views or view files.
  * @property string $viewPath The directory containing the view files for this controller.
  *
@@ -54,7 +51,7 @@ class Controller extends Component implements ViewContextInterface
      */
     public $defaultAction = 'index';
     /**
-     * @var null|string|false the name of the layout to be applied to this controller's views.
+     * @var string|null|false the name of the layout to be applied to this controller's views.
      * This property mainly affects the behavior of [[render()]].
      * Defaults to null, meaning the actual layout value should inherit that from [[module]]'s layout value.
      * If false, no layout will be applied.
diff --git a/framework/base/DynamicContentAwareInterface.php b/framework/base/DynamicContentAwareInterface.php
index 2367f0837be..58e2625c550 100644
--- a/src/base/DynamicContentAwareInterface.php
+++ b/src/base/DynamicContentAwareInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/DynamicContentAwareTrait.php b/framework/base/DynamicContentAwareTrait.php
index b19382e93ea..8496c8973b8 100644
--- a/src/base/DynamicContentAwareTrait.php
+++ b/src/base/DynamicContentAwareTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/DynamicModel.php b/framework/base/DynamicModel.php
index 4510596d95a..027da6d1982 100644
--- a/src/base/DynamicModel.php
+++ b/src/base/DynamicModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -10,7 +10,9 @@
 use yii\validators\Validator;
 
 /**
- * DynamicModel is a model class primarily used to support ad hoc data validation.
+ * DynamicModel is a model class that supports defining attributes at run-time (the so-called
+ * "dynamic attributes") using its constructor or [[defineAttribute()]]. DynamicModel can be used
+ * to support ad hoc data validation.
  *
  * The typical usage of DynamicModel is as follows,
  *
@@ -33,7 +35,7 @@
  * The [[validateData()]] method creates an instance of DynamicModel, defines the attributes
  * using the given data (`name` and `email` in this example), and then calls [[Model::validate()]].
  *
- * You can check the validation result by [[hasErrors()]], like you do with a normal model.
+ * You can check the validation result using [[hasErrors()]], like you do with a normal model.
  * You may also access the dynamic attributes defined through the model instance, e.g.,
  * `$model->name` and `$model->email`.
  *
@@ -46,31 +48,26 @@
  *     ->validate();
  * ```
  *
- * DynamicModel implements the above ad-hoc data validation feature by supporting the so-called
- * "dynamic attributes". It basically allows an attribute to be defined dynamically through its constructor
- * or [[defineAttribute()]].
- *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
 class DynamicModel extends Model
 {
+    /**
+     * @var mixed[] dynamic attribute values (name => value).
+     */
     private $_attributes = [];
     /**
-     * Array of the dynamic attribute labels.
-     * Used to as form field labels and in validation errors.
-     *
-     * @see attributeLabels()
-     * @see setAttributeLabels()
-     * @see setAttributeLabel()
+     * @var string[] dynamic attribute labels (name => label).
+     * Used as form field labels and in validation error messages.
      * @since 2.0.35
      */
     private $_attributeLabels = [];
 
 
     /**
-     * Constructors.
-     * @param array $attributes the dynamic attributes (name-value pairs, or names) being defined
+     * Constructor.
+     * @param array $attributes the attributes (name-value pairs, or names) being defined.
      * @param array $config the configuration array to be applied to this object.
      */
     public function __construct(array $attributes = [], $config = [])
@@ -151,7 +148,7 @@ public function canSetProperty($name, $checkVars = true, $checkBehaviors = true)
 
     /**
      * Returns a value indicating whether the model has an attribute with the specified name.
-     * @param string $name the name of the attribute
+     * @param string $name the name of the attribute.
      * @return bool whether the model has an attribute with the specified name.
      * @since 2.0.16
      */
@@ -162,8 +159,8 @@ public function hasAttribute($name)
 
     /**
      * Defines an attribute.
-     * @param string $name the attribute name
-     * @param mixed $value the attribute value
+     * @param string $name the attribute name.
+     * @param mixed $value the attribute value.
      */
     public function defineAttribute($name, $value = null)
     {
@@ -172,7 +169,7 @@ public function defineAttribute($name, $value = null)
 
     /**
      * Undefines an attribute.
-     * @param string $name the attribute name
+     * @param string $name the attribute name.
      */
     public function undefineAttribute($name)
     {
@@ -183,15 +180,15 @@ public function undefineAttribute($name)
      * Adds a validation rule to this model.
      * You can also directly manipulate [[validators]] to add or remove validation rules.
      * This method provides a shortcut.
-     * @param string|array $attributes the attribute(s) to be validated by the rule
+     * @param string|array $attributes the attribute(s) to be validated by the rule.
      * @param string|Validator|\Closure $validator the validator. This can be either:
      *  * a built-in validator name listed in [[builtInValidators]];
      *  * a method name of the model class;
      *  * an anonymous function;
      *  * a validator class name.
      *  * a Validator.
-     * @param array $options the options (name-value pairs) to be applied to the validator
-     * @return $this the model itself
+     * @param array $options the options (name-value pairs) to be applied to the validator.
+     * @return $this
      */
     public function addRule($attributes, $validator, $options = [])
     {
@@ -212,9 +209,9 @@ public function addRule($attributes, $validator, $options = [])
      * Validates the given data with the specified validation rules.
      * This method will create a DynamicModel instance, populate it with the data to be validated,
      * create the specified validation rules, and then validate the data using these rules.
-     * @param array $data the data (name-value pairs) to be validated
+     * @param array $data the data (name-value pairs) to be validated.
      * @param array $rules the validation rules. Please refer to [[Model::rules()]] on the format of this parameter.
-     * @return static the model instance that contains the data being validated
+     * @return static the model instance that contains the data being validated.
      * @throws InvalidConfigException if a validation rule is not specified correctly.
      */
     public static function validateData(array $data, $rules = [])
@@ -249,13 +246,10 @@ public function attributes()
     }
 
     /**
-     * Sets the attribute labels in a massive way.
-     *
-     * @see attributeLabels()
-     * @since 2.0.35
-     *
-     * @param array $labels Array of attribute labels
+     * Sets the labels for all attributes.
+     * @param string[] $labels attribute labels.
      * @return $this
+     * @since 2.0.35
      */
     public function setAttributeLabels(array $labels = [])
     {
@@ -265,14 +259,11 @@ public function setAttributeLabels(array $labels = [])
     }
 
     /**
-     * Sets a label for an attribute.
-     *
-     * @see attributeLabels()
-     * @since 2.0.35
-     *
-     * @param string $attribute Attribute name
-     * @param string $label Attribute label value
+     * Sets a label for a single attribute.
+     * @param string $attribute attribute name.
+     * @param string $label attribute label value.
      * @return $this
+     * @since 2.0.35
      */
     public function setAttributeLabel($attribute, $label)
     {
@@ -282,10 +273,10 @@ public function setAttributeLabel($attribute, $label)
     }
 
     /**
-     * {@inheritDoc}
+     * {@inheritdoc}
      */
     public function attributeLabels()
     {
-        return array_merge(parent::attributeLabels(), $this->_attributeLabels);
+        return $this->_attributeLabels;
     }
 }
diff --git a/framework/base/ErrorException.php b/framework/base/ErrorException.php
index 657b8e390b8..8f051a57e1c 100644
--- a/src/base/ErrorException.php
+++ b/src/base/ErrorException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -38,7 +38,7 @@ class ErrorException extends \ErrorException
      * @param int $severity [optional]
      * @param string $filename [optional]
      * @param int $lineno [optional]
-     * @param \Throwable|\Exception $previous [optional]
+     * @param \Throwable|null $previous [optional]
      */
     public function __construct($message = '', $code = 0, $severity = 1, $filename = __FILE__, $lineno = __LINE__, $previous = null)
     {
@@ -54,7 +54,7 @@ public function __construct($message = '', $code = 0, $severity = 1, $filename =
                     $frame['function'] = 'unknown';
                 }
 
-                // Xdebug < 2.1.1: http://bugs.xdebug.org/view.php?id=695
+                // Xdebug < 2.1.1: https://bugs.xdebug.org/view.php?id=695
                 if (!isset($frame['type']) || $frame['type'] === 'static') {
                     $frame['type'] = '::';
                 } elseif ($frame['type'] === 'dynamic') {
diff --git a/framework/base/ErrorHandler.php b/framework/base/ErrorHandler.php
index 4b36d481ec3..81a20f0a3c9 100644
--- a/src/base/ErrorHandler.php
+++ b/src/base/ErrorHandler.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -26,6 +26,12 @@
  */
 abstract class ErrorHandler extends Component
 {
+    /**
+     * @event Event an event that is triggered when the handler is called by shutdown function via [[handleFatalError()]].
+     * @since 2.0.46
+     */
+    const EVENT_SHUTDOWN = 'shutdown';
+
     /**
      * @var bool whether to discard any existing page output before error display. Defaults to true.
      */
@@ -38,7 +44,7 @@ abstract class ErrorHandler extends Component
      */
     public $memoryReserveSize = 262144;
     /**
-     * @var \Exception|null the exception that is being handled currently.
+     * @var \Throwable|null the exception that is being handled currently.
      */
     public $exception;
     /**
@@ -53,13 +59,17 @@ abstract class ErrorHandler extends Component
      */
     private $_memoryReserve;
     /**
-     * @var \Exception from HHVM error that stores backtrace
+     * @var \Throwable from HHVM error that stores backtrace
      */
     private $_hhvmException;
     /**
      * @var bool whether this instance has been registered using `register()`
      */
     private $_registered = false;
+    /**
+     * @var string the current working directory
+     */
+    private $_workingDirectory;
 
 
     public function init()
@@ -70,6 +80,7 @@ public function init()
 
     /**
      * Register this error handler.
+     *
      * @since 2.0.32 this will not do anything if the error handler was already registered
      */
     public function register()
@@ -83,7 +94,11 @@ public function register()
                 set_error_handler([$this, 'handleError']);
             }
             if ($this->memoryReserveSize > 0) {
-                $this->_memoryReserve = str_repeat('x', $this->memoryReserveSize);
+                $this->_memoryReserve = str_pad('', $this->memoryReserveSize, 'x');
+            }
+            // to restore working directory in shutdown handler
+            if (PHP_SAPI !== 'cli') {
+                $this->_workingDirectory = getcwd();
             }
             register_shutdown_function([$this, 'handleFatalError']);
             $this->_registered = true;
@@ -97,6 +112,8 @@ public function register()
     public function unregister()
     {
         if ($this->_registered) {
+            $this->_memoryReserve = null;
+            $this->_workingDirectory = null;
             restore_error_handler();
             restore_exception_handler();
             $this->_registered = false;
@@ -108,7 +125,7 @@ public function unregister()
      *
      * This method is implemented as a PHP exception handler.
      *
-     * @param \Exception $exception the exception that is not caught
+     * @param \Throwable $exception the exception that is not caught
      */
     public function handleException($exception)
     {
@@ -153,8 +170,8 @@ public function handleException($exception)
 
     /**
      * Handles exception thrown during exception processing in [[handleException()]].
-     * @param \Exception|\Throwable $exception Exception that was thrown during main exception processing.
-     * @param \Exception $previousException Main exception processed in [[handleException()]].
+     * @param \Throwable $exception Exception that was thrown during main exception processing.
+     * @param \Throwable $previousException Main exception processed in [[handleException()]].
      * @since 2.0.11
      */
     protected function handleFallbackExceptionMessage($exception, $previousException)
@@ -264,47 +281,70 @@ public function handleFatalError()
     {
         unset($this->_memoryReserve);
 
+        if (isset($this->_workingDirectory)) {
+            // fix working directory for some Web servers e.g. Apache
+            chdir($this->_workingDirectory);
+            // flush memory
+            unset($this->_workingDirectory);
+        }
+
+        $error = error_get_last();
+        if ($error === null) {
+            return;
+        }
+
         // load ErrorException manually here because autoloading them will not work
         // when error occurs while autoloading a class
         if (!class_exists('yii\\base\\ErrorException', false)) {
             require_once __DIR__ . '/ErrorException.php';
         }
+        if (!ErrorException::isFatalError($error)) {
+            return;
+        }
 
-        $error = error_get_last();
+        if (!empty($this->_hhvmException)) {
+            $this->exception = $this->_hhvmException;
+        } else {
+            $this->exception = new ErrorException(
+                $error['message'],
+                $error['type'],
+                $error['type'],
+                $error['file'],
+                $error['line']
+            );
+        }
+        unset($error);
 
-        if (ErrorException::isFatalError($error)) {
-            if (!empty($this->_hhvmException)) {
-                $exception = $this->_hhvmException;
-            } else {
-                $exception = new ErrorException($error['message'], $error['type'], $error['type'], $error['file'], $error['line']);
-            }
-            $this->exception = $exception;
+        $this->logException($this->exception);
 
-            $this->logException($exception);
+        if ($this->discardExistingOutput) {
+            $this->clearOutput();
+        }
+        $this->renderException($this->exception);
 
-            if ($this->discardExistingOutput) {
-                $this->clearOutput();
-            }
-            $this->renderException($exception);
+        // need to explicitly flush logs because exit() next will terminate the app immediately
+        Yii::getLogger()->flush(true);
+        if (defined('HHVM_VERSION')) {
+            flush();
+        }
 
-            // need to explicitly flush logs because exit() next will terminate the app immediately
-            Yii::getLogger()->flush(true);
-            if (defined('HHVM_VERSION')) {
-                flush();
-            }
+        $this->trigger(static::EVENT_SHUTDOWN);
+
+        // ensure it is called after user-defined shutdown functions
+        register_shutdown_function(function () {
             exit(1);
-        }
+        });
     }
 
     /**
      * Renders the exception.
-     * @param \Exception|\Error|\Throwable $exception the exception to be rendered.
+     * @param \Throwable $exception the exception to be rendered.
      */
     abstract protected function renderException($exception);
 
     /**
      * Logs the given exception.
-     * @param \Exception $exception the exception to be logged
+     * @param \Throwable $exception the exception to be logged
      * @since 2.0.3 this method is now public.
      */
     public function logException($exception)
@@ -336,7 +376,8 @@ public function clearOutput()
      *
      * This method can be used to convert exceptions inside of methods like `__toString()`
      * to PHP errors because exceptions cannot be thrown inside of them.
-     * @param \Exception|\Throwable $exception the exception to convert to a PHP error.
+     * @param \Throwable $exception the exception to convert to a PHP error.
+     * @return never
      */
     public static function convertExceptionToError($exception)
     {
@@ -345,7 +386,7 @@ public static function convertExceptionToError($exception)
 
     /**
      * Converts an exception into a simple string.
-     * @param \Exception|\Error|\Throwable $exception the exception being converted
+     * @param \Throwable $exception the exception being converted
      * @return string the string representation of the exception.
      */
     public static function convertExceptionToString($exception)
@@ -363,7 +404,7 @@ public static function convertExceptionToString($exception)
 
     /**
      * Converts an exception into a string that has verbose information about the exception and its trace.
-     * @param \Exception|\Error|\Throwable $exception the exception being converted
+     * @param \Throwable $exception the exception being converted
      * @return string the string representation of the exception.
      *
      * @since 2.0.14
diff --git a/framework/base/Event.php b/framework/base/Event.php
index 3cb85dce018..ac2fdc43466 100644
--- a/src/base/Event.php
+++ b/src/base/Event.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -34,7 +34,7 @@ class Event extends BaseObject
      */
     public $name;
     /**
-     * @var object the sender of this event. If not set, this property will be
+     * @var object|null the sender of this event. If not set, this property will be
      * set as the object whose `trigger()` method is called.
      * This property may also be a `null` when this event is a
      * class-level event which is triggered in a static context.
@@ -130,7 +130,7 @@ public static function on($class, $name, $handler, $data = null, $append = true)
      *
      * @param string $class the fully qualified class name from which the event handler needs to be detached.
      * @param string $name the event name.
-     * @param callable $handler the event handler to be removed.
+     * @param callable|null $handler the event handler to be removed.
      * If it is `null`, all handlers attached to the named event will be removed.
      * @return bool whether a handler is found and detached.
      * @see on()
@@ -257,7 +257,7 @@ class_implements($class, true)
      * for the specified class and all its parent classes.
      * @param string|object $class the object or the fully qualified class name specifying the class-level event.
      * @param string $name the event name.
-     * @param Event $event the event parameter. If not set, a default [[Event]] object will be created.
+     * @param Event|null $event the event parameter. If not set, a default [[Event]] object will be created.
      */
     public static function trigger($class, $name, $event = null)
     {
diff --git a/framework/base/Exception.php b/framework/base/Exception.php
index 040225bf5e3..2a9bfe6eb1e 100644
--- a/src/base/Exception.php
+++ b/src/base/Exception.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/ExitException.php b/framework/base/ExitException.php
index 4fde6a8e800..de7eb65f0a0 100644
--- a/src/base/ExitException.php
+++ b/src/base/ExitException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -28,11 +28,15 @@ class ExitException extends \Exception
      * @param int $status the exit status code
      * @param string $message error message
      * @param int $code error code
-     * @param \Throwable|\Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
     public function __construct($status = 0, $message = null, $code = 0, $previous = null)
     {
         $this->statusCode = $status;
-        parent::__construct($message, $code, $previous);
+        if ($previous === null) {
+            parent::__construct((string)$message, $code);
+        } else {
+            parent::__construct((string)$message, $code, $previous);
+        }
     }
 }
diff --git a/framework/base/InlineAction.php b/framework/base/InlineAction.php
index b55f6b026ec..73804dd3eb8 100644
--- a/src/base/InlineAction.php
+++ b/src/base/InlineAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/InvalidArgumentException.php b/framework/base/InvalidArgumentException.php
index 7f96d3494d5..20a7c6c759e 100644
--- a/src/base/InvalidArgumentException.php
+++ b/src/base/InvalidArgumentException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/InvalidCallException.php b/framework/base/InvalidCallException.php
index 1710946e1e4..b33f1239662 100644
--- a/src/base/InvalidCallException.php
+++ b/src/base/InvalidCallException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/InvalidConfigException.php b/framework/base/InvalidConfigException.php
index 953675f9303..1279c94220e 100644
--- a/src/base/InvalidConfigException.php
+++ b/src/base/InvalidConfigException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/InvalidParamException.php b/framework/base/InvalidParamException.php
index e67ccc69525..0024602eca5 100644
--- a/src/base/InvalidParamException.php
+++ b/src/base/InvalidParamException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/InvalidRouteException.php b/framework/base/InvalidRouteException.php
index 43bed6ef923..50f994f89b1 100644
--- a/src/base/InvalidRouteException.php
+++ b/src/base/InvalidRouteException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/InvalidValueException.php b/framework/base/InvalidValueException.php
index a4786e297eb..7f7fcf9b9b1 100644
--- a/src/base/InvalidValueException.php
+++ b/src/base/InvalidValueException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Model.php b/framework/base/Model.php
index 204242143c1..774b5513eee 100644
--- a/src/base/Model.php
+++ b/src/base/Model.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -38,19 +38,18 @@
  * For more details and usage information on Model, see the [guide article on models](guide:structure-models).
  *
  * @property-read \yii\validators\Validator[] $activeValidators The validators applicable to the current
- * [[scenario]]. This property is read-only.
+ * [[scenario]].
  * @property array $attributes Attribute values (name => value).
- * @property-read array $errors An array of errors for all attributes. Empty array is returned if no error.
- * The result is a two-dimensional array. See [[getErrors()]] for detailed description. This property is
- * read-only.
+ * @property-read array $errors Errors for all attributes or the specified attribute. Empty array is returned
+ * if no error. See [[getErrors()]] for detailed description. Note that when returning errors for all attributes,
+ * the result is a two-dimensional array, like the following: ```php [ 'username' => [ 'Username is required.',
+ * 'Username must contain only word characters.', ], 'email' => [ 'Email address is invalid.', ] ] ``` .
  * @property-read array $firstErrors The first errors. The array keys are the attribute names, and the array
- * values are the corresponding error messages. An empty array will be returned if there is no error. This
- * property is read-only.
- * @property-read ArrayIterator $iterator An iterator for traversing the items in the list. This property is
- * read-only.
+ * values are the corresponding error messages. An empty array will be returned if there is no error.
+ * @property-read ArrayIterator $iterator An iterator for traversing the items in the list.
  * @property string $scenario The scenario that this model is in. Defaults to [[SCENARIO_DEFAULT]].
  * @property-read ArrayObject|\yii\validators\Validator[] $validators All the validators declared in the
- * model. This property is read-only.
+ * model.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -261,21 +260,15 @@ public function formName()
 
     /**
      * Returns the list of attribute names.
+     *
      * By default, this method returns all public non-static properties of the class.
      * You may override this method to change the default behavior.
-     * @return array list of attribute names.
+     *
+     * @return string[] list of attribute names.
      */
     public function attributes()
     {
-        $class = new ReflectionClass($this);
-        $names = [];
-        foreach ($class->getProperties(\ReflectionProperty::IS_PUBLIC) as $property) {
-            if (!$property->isStatic()) {
-                $names[] = $property->getName();
-            }
-        }
-
-        return $names;
+        return array_keys(Yii::getObjectVars($this));
     }
 
     /**
@@ -561,7 +554,7 @@ public function hasErrors($attribute = null)
 
     /**
      * Returns the errors for all attributes or a single attribute.
-     * @param string|null $attribute attribute name. Use null to retrieve errors for all attributes. 
+     * @param string|null $attribute attribute name. Use null to retrieve errors for all attributes.
      * @return array errors for all attributes or the specified attribute. Empty array is returned if no error.
      * See [[getErrors()]] for detailed description.
      * Note that when returning errors for all attributes, the result is a two-dimensional array, like the following:
@@ -996,6 +989,7 @@ public function fields()
      * This method is required by the interface [[\IteratorAggregate]].
      * @return ArrayIterator an iterator for traversing the items in the list.
      */
+    #[\ReturnTypeWillChange]
     public function getIterator()
     {
         $attributes = $this->getAttributes();
@@ -1009,6 +1003,7 @@ public function getIterator()
      * @param string $offset the offset to check on.
      * @return bool whether or not an offset exists.
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return isset($this->$offset);
@@ -1021,6 +1016,7 @@ public function offsetExists($offset)
      * @param string $offset the offset to retrieve element.
      * @return mixed the element at the offset, null if no element is found at the offset
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         return $this->$offset;
@@ -1033,6 +1029,7 @@ public function offsetGet($offset)
      * @param string $offset the offset to set element
      * @param mixed $value the element value
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $value)
     {
         $this->$offset = $value;
@@ -1044,8 +1041,20 @@ public function offsetSet($offset, $value)
      * It is implicitly called when you use something like `unset($model[$offset])`.
      * @param string $offset the offset to unset element
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         $this->$offset = null;
     }
+
+    /**
+     * {@inheritdoc}
+     */
+    public function __clone()
+    {
+        parent::__clone();
+
+        $this->_errors = null;
+        $this->_validators = null;
+    }
 }
diff --git a/framework/base/ModelEvent.php b/framework/base/ModelEvent.php
index fffcfe19994..7e45bfb49b6 100644
--- a/src/base/ModelEvent.php
+++ b/src/base/ModelEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Module.php b/framework/base/Module.php
index 2562f0ca1fa..06671edc087 100644
--- a/src/base/Module.php
+++ b/src/base/Module.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -25,13 +25,12 @@
  *
  * @property-write array $aliases List of path aliases to be defined. The array keys are alias names (must
  * start with `@`) and the array values are the corresponding paths or aliases. See [[setAliases()]] for an
- * example. This property is write-only.
+ * example.
  * @property string $basePath The root directory of the module.
- * @property-read string $controllerPath The directory that contains the controller classes. This property is
- * read-only.
+ * @property string $controllerPath The directory that contains the controller classes.
  * @property string $layoutPath The root directory of layout files. Defaults to "[[viewPath]]/layouts".
  * @property array $modules The modules (indexed by their IDs).
- * @property-read string $uniqueId The unique ID of the module. This property is read-only.
+ * @property-read string $uniqueId The unique ID of the module.
  * @property string $version The version of this module. Note that the type of this property differs in getter
  * and setter. See [[getVersion()]] and [[setVersion()]] for details.
  * @property string $viewPath The root directory of view files. Defaults to "[[basePath]]/views".
@@ -115,6 +114,10 @@ class Module extends ServiceLocator
      * @var string the root directory of the module.
      */
     private $_basePath;
+    /**
+     * @var string The root directory that contains the controller classes for this module.
+     */
+    private $_controllerPath;
     /**
      * @var string the root directory that contains view files for this module
      */
@@ -128,7 +131,7 @@ class Module extends ServiceLocator
      */
     private $_modules = [];
     /**
-     * @var string|callable the version of this module.
+     * @var string|callable|null the version of this module.
      * Version can be specified as a PHP callback, which can accept module instance as an argument and should
      * return the actual version. For example:
      *
@@ -148,7 +151,7 @@ class Module extends ServiceLocator
     /**
      * Constructor.
      * @param string $id the ID of this module.
-     * @param Module $parent the parent module (if any).
+     * @param Module|null $parent the parent module (if any).
      * @param array $config name-value pairs that will be used to initialize the object properties.
      */
     public function __construct($id, $parent = null, $config = [])
@@ -254,7 +257,22 @@ public function setBasePath($path)
      */
     public function getControllerPath()
     {
-        return Yii::getAlias('@' . str_replace('\\', '/', $this->controllerNamespace));
+        if ($this->_controllerPath === null) {
+            $this->_controllerPath = Yii::getAlias('@' . str_replace('\\', '/', $this->controllerNamespace));
+        }
+
+        return $this->_controllerPath;
+    }
+
+    /**
+     * Sets the directory that contains the controller classes.
+     * @param string $path the root directory that contains the controller classes.
+     * @throws InvalidArgumentException if the directory is invalid.
+     * @since 2.0.44
+     */
+    public function setControllerPath($path)
+    {
+        $this->_controllerPath = Yii::getAlias($path);
     }
 
     /**
@@ -324,7 +342,7 @@ public function getVersion()
 
     /**
      * Sets current module version.
-     * @param string|callable $version the version of this module.
+     * @param string|callable|null $version the version of this module.
      * Version can be specified as a PHP callback, which can accept module instance as an argument and should
      * return the actual version. For example:
      *
diff --git a/framework/base/NotSupportedException.php b/framework/base/NotSupportedException.php
index d5832c62209..4161fb737f4 100644
--- a/src/base/NotSupportedException.php
+++ b/src/base/NotSupportedException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Object.php b/framework/base/Object.php
index 52e354ec387..20b68f16958 100644
--- a/src/base/Object.php
+++ b/src/base/Object.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Request.php b/framework/base/Request.php
index 1271ae6629f..3f7f5aaed16 100644
--- a/src/base/Request.php
+++ b/src/base/Request.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Response.php b/framework/base/Response.php
index 2508319835c..6429df6a884 100644
--- a/src/base/Response.php
+++ b/src/base/Response.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Security.php b/framework/base/Security.php
index 6276bf5a584..e8281b2a6c8 100644
--- a/src/base/Security.php
+++ b/src/base/Security.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -146,7 +146,7 @@ public function encryptByPassword($data, $password)
      * to hash input or output data.
      * @param string $data the data to encrypt
      * @param string $inputKey the input to use for encryption and authentication
-     * @param string $info optional context and application specific information, see [[hkdf()]]
+     * @param string|null $info optional context and application specific information, see [[hkdf()]]
      * @return string the encrypted data as byte string
      * @see decryptByKey()
      * @see encryptByPassword()
@@ -172,7 +172,7 @@ public function decryptByPassword($data, $password)
      * Verifies and decrypts data encrypted with [[encryptByKey()]].
      * @param string $data the encrypted data to decrypt
      * @param string $inputKey the input to use for encryption and authentication
-     * @param string $info optional context and application specific information, see [[hkdf()]]
+     * @param string|null $info optional context and application specific information, see [[hkdf()]]
      * @return bool|string the decrypted data or false on authentication failure
      * @see encryptByKey()
      */
@@ -286,8 +286,8 @@ protected function decrypt($data, $passwordBased, $secret, $info)
      * Recommend use one of the SHA-2 hash algorithms: sha224, sha256, sha384 or sha512.
      * @param string $algo a hash algorithm supported by `hash_hmac()`, e.g. 'SHA-256'
      * @param string $inputKey the source key
-     * @param string $salt the random salt
-     * @param string $info optional info to bind the derived key material to application-
+     * @param string|null $salt the random salt
+     * @param string|null $info optional info to bind the derived key material to application-
      * and context-specific information, e.g. a user ID or API version, see
      * [RFC 5869](https://tools.ietf.org/html/rfc5869)
      * @param int $length length of the output key in bytes. If 0, the output key is
@@ -298,7 +298,7 @@ protected function decrypt($data, $passwordBased, $secret, $info)
     public function hkdf($algo, $inputKey, $salt = null, $info = null, $length = 0)
     {
         if (function_exists('hash_hkdf')) {
-            $outputKey = hash_hkdf($algo, $inputKey, $length, $info, $salt);
+            $outputKey = hash_hkdf((string)$algo, (string)$inputKey, $length, (string)$info, (string)$salt);
             if ($outputKey === false) {
                 throw new InvalidArgumentException('Invalid parameters to hash_hkdf()');
             }
@@ -340,7 +340,7 @@ public function hkdf($algo, $inputKey, $salt = null, $info = null, $length = 0)
 
     /**
      * Derives a key from the given password using the standard PBKDF2 algorithm.
-     * Implements HKDF2 specified in [RFC 2898](http://tools.ietf.org/html/rfc2898#section-5.2)
+     * Implements HKDF2 specified in [RFC 2898](https://datatracker.ietf.org/doc/html/rfc2898#section-5.2)
      * Recommend use one of the SHA-2 hash algorithms: sha224, sha256, sha384 or sha512.
      * @param string $algo a hash algorithm supported by `hash_hmac()`, e.g. 'SHA-256'
      * @param string $password the source password
@@ -529,7 +529,7 @@ public function generateRandomString($length = 32)
      * ```
      *
      * @param string $password The password to be hashed.
-     * @param int $cost Cost parameter used by the Blowfish hash algorithm.
+     * @param int|null $cost Cost parameter used by the Blowfish hash algorithm.
      * The higher the value of cost,
      * the longer it takes to generate the hash and to verify a password against it. Higher cost
      * therefore slows down a brute-force attack. For best protection against brute-force attacks,
@@ -627,7 +627,7 @@ protected function generateSalt($cost = 13)
 
     /**
      * Performs string comparison using timing attack resistant approach.
-     * @see http://codereview.stackexchange.com/questions/13512
+     * @see https://codereview.stackexchange.com/q/13512
      * @param string $expected string to compare.
      * @param string $actual user-supplied string.
      * @return bool whether strings are equal.
diff --git a/framework/base/StaticInstanceInterface.php b/framework/base/StaticInstanceInterface.php
index 67883479591..12cce4bfbc8 100644
--- a/src/base/StaticInstanceInterface.php
+++ b/src/base/StaticInstanceInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/StaticInstanceTrait.php b/framework/base/StaticInstanceTrait.php
index 106ba8620ff..17e1241e6f9 100644
--- a/src/base/StaticInstanceTrait.php
+++ b/src/base/StaticInstanceTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Theme.php b/framework/base/Theme.php
index b50334426eb..2f9669071eb 100644
--- a/src/base/Theme.php
+++ b/src/base/Theme.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -74,7 +74,7 @@
 class Theme extends Component
 {
     /**
-     * @var array the mapping between view directories and their corresponding themed versions.
+     * @var array|null the mapping between view directories and their corresponding themed versions.
      * This property is used by [[applyTo()]] when a view is trying to apply the theme.
      * [Path aliases](guide:concept-aliases) can be used when specifying directories.
      * If this property is empty or not set, a mapping [[Application::basePath]] to [[basePath]] will be used.
diff --git a/framework/base/UnknownClassException.php b/framework/base/UnknownClassException.php
index 8f25353cdd5..eaa03ee87bc 100644
--- a/src/base/UnknownClassException.php
+++ b/src/base/UnknownClassException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/UnknownMethodException.php b/framework/base/UnknownMethodException.php
index 6e334903150..f4b510133ff 100644
--- a/src/base/UnknownMethodException.php
+++ b/src/base/UnknownMethodException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/UnknownPropertyException.php b/framework/base/UnknownPropertyException.php
index 8f7eeaaa841..884bd0254fa 100644
--- a/src/base/UnknownPropertyException.php
+++ b/src/base/UnknownPropertyException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/UserException.php b/framework/base/UserException.php
index 01ca602f141..7d293e6d53f 100644
--- a/src/base/UserException.php
+++ b/src/base/UserException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/View.php b/framework/base/View.php
index 1cb79cfcf92..159b2dbe2e0 100644
--- a/src/base/View.php
+++ b/src/base/View.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -21,7 +21,7 @@
  * For more details and usage information on View, see the [guide article on views](guide:structure-views).
  *
  * @property-read string|bool $viewFile The view file currently being rendered. False if no view file is being
- * rendered. This property is read-only.
+ * rendered.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -54,7 +54,7 @@ class View extends Component implements DynamicContentAwareInterface
      */
     public $params = [];
     /**
-     * @var array a list of available renderers indexed by their corresponding supported file extensions.
+     * @var array|null a list of available renderers indexed by their corresponding supported file extensions.
      * Each renderer may be a view renderer object or the configuration for creating the renderer object.
      * For example, the following configuration enables both Smarty and Twig view renderers:
      *
@@ -74,7 +74,7 @@ class View extends Component implements DynamicContentAwareInterface
      */
     public $defaultExtension = 'php';
     /**
-     * @var Theme|array|string the theme object or the configuration for creating the theme object.
+     * @var Theme|array|string|null the theme object or the configuration for creating the theme object.
      * If not set, it means theming is not enabled.
      */
     public $theme;
@@ -142,7 +142,7 @@ public function init()
      *
      * @param string $view the view name.
      * @param array $params the parameters (name-value pairs) that will be extracted and made available in the view file.
-     * @param object $context the context to be assigned to the view and can later be accessed via [[context]]
+     * @param object|null $context the context to be assigned to the view and can later be accessed via [[context]]
      * in the view. If the context implements [[ViewContextInterface]], it may also be used to locate
      * the view file corresponding to a relative view name.
      * @return string the rendering result
@@ -160,7 +160,7 @@ public function render($view, $params = [], $context = null)
      * Finds the view file based on the given view name.
      * @param string $view the view name or the [path alias](guide:concept-aliases) of the view file. Please refer to [[render()]]
      * on how to specify this parameter.
-     * @param object $context the context to be assigned to the view and can later be accessed via [[context]]
+     * @param object|null $context the context to be assigned to the view and can later be accessed via [[context]]
      * in the view. If the context implements [[ViewContextInterface]], it may also be used to locate
      * the view file corresponding to a relative view name.
      * @return string the view file path. Note that the file may not exist.
@@ -215,7 +215,7 @@ protected function findViewFile($view, $context = null)
      *
      * @param string $viewFile the view file. This can be either an absolute file path or an alias of it.
      * @param array $params the parameters (name-value pairs) that will be extracted and made available in the view file.
-     * @param object $context the context that the view should use for rendering the view. If null,
+     * @param object|null $context the context that the view should use for rendering the view. If null,
      * existing [[context]] will be used.
      * @return string the rendering result
      * @throws ViewNotFoundException if the view file does not exist
@@ -335,7 +335,7 @@ public function afterRender($viewFile, $params, &$output)
      * @param string $_file_ the view file.
      * @param array $_params_ the parameters (name-value pairs) that will be extracted and made available in the view file.
      * @return string the rendering result
-     * @throws \Exception
+     * @throws \Throwable
      */
     public function renderPhpFile($_file_, $_params_ = [])
     {
diff --git a/framework/base/ViewContextInterface.php b/framework/base/ViewContextInterface.php
index f6d26e0abca..df2834c0d5c 100644
--- a/src/base/ViewContextInterface.php
+++ b/src/base/ViewContextInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/ViewEvent.php b/framework/base/ViewEvent.php
index a06fa0770d6..2a63eaaf188 100644
--- a/src/base/ViewEvent.php
+++ b/src/base/ViewEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/ViewNotFoundException.php b/framework/base/ViewNotFoundException.php
index d1b9c8c2026..ece5a00db6e 100644
--- a/src/base/ViewNotFoundException.php
+++ b/src/base/ViewNotFoundException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/ViewRenderer.php b/framework/base/ViewRenderer.php
index dcee8022ad6..7cbcb702815 100644
--- a/src/base/ViewRenderer.php
+++ b/src/base/ViewRenderer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/base/Widget.php b/framework/base/Widget.php
index a43a5652bb6..450caac9c9b 100644
--- a/src/base/Widget.php
+++ b/src/base/Widget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
@@ -19,8 +19,7 @@
  * setter. See [[getId()]] and [[setId()]] for details.
  * @property \yii\web\View $view The view object that can be used to render views or view files. Note that the
  * type of this property differs in getter and setter. See [[getView()]] and [[setView()]] for details.
- * @property-read string $viewPath The directory containing the view files for this widget. This property is
- * read-only.
+ * @property-read string $viewPath The directory containing the view files for this widget.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -104,7 +103,13 @@ public static function end()
     {
         if (!empty(self::$stack)) {
             $widget = array_pop(self::$stack);
-            if (get_class($widget) === get_called_class()) {
+
+            $calledClass = get_called_class();
+            if (Yii::$container->has($calledClass) && isset(Yii::$container->getDefinitions()[$calledClass]['class'])) {
+                $calledClass = Yii::$container->getDefinitions()[$calledClass]['class'];
+            }
+
+            if (get_class($widget) === $calledClass) {
                 /* @var $widget Widget */
                 if ($widget->beforeRun()) {
                     $result = $widget->run();
@@ -126,7 +131,7 @@ public static function end()
      * The widget rendering result is returned by this method.
      * @param array $config name-value pairs that will be used to initialize the object properties
      * @return string the rendering result of the widget.
-     * @throws \Exception
+     * @throws \Throwable
      */
     public static function widget($config = [])
     {
@@ -147,6 +152,12 @@ public static function widget($config = [])
                 ob_end_clean();
             }
             throw $e;
+        } catch (\Throwable $e) {
+            // close the output buffer opened above if it has not been closed already
+            if (ob_get_level() > 0) {
+                ob_end_clean();
+            }
+            throw $e;
         }
 
         return ob_get_clean() . $out;
@@ -206,7 +217,8 @@ public function setView($view)
 
     /**
      * Executes the widget.
-     * @return string the result of widget execution to be outputted.
+     *
+     * @return string|void the rendering result may be directly "echoed" or returned as a string
      */
     public function run()
     {
diff --git a/framework/base/WidgetEvent.php b/framework/base/WidgetEvent.php
index 6ec5ae8b282..eaa1850b85b 100644
--- a/src/base/WidgetEvent.php
+++ b/src/base/WidgetEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\base;
diff --git a/framework/behaviors/AttributeBehavior.php b/framework/behaviors/AttributeBehavior.php
index 0b4ba8b3a62..8cad0edf74d 100644
--- a/src/behaviors/AttributeBehavior.php
+++ b/src/behaviors/AttributeBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
diff --git a/framework/behaviors/AttributeTypecastBehavior.php b/framework/behaviors/AttributeTypecastBehavior.php
index 33520bde3bc..541f4f95cad 100644
--- a/src/behaviors/AttributeTypecastBehavior.php
+++ b/src/behaviors/AttributeTypecastBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
@@ -121,7 +121,7 @@ class AttributeTypecastBehavior extends Behavior
      */
     public $owner;
     /**
-     * @var array attribute typecast map in format: attributeName => type.
+     * @var array|null attribute typecast map in format: attributeName => type.
      * Type can be set via PHP callable, which accept raw value as an argument and should return
      * typecast result.
      * For example:
@@ -214,7 +214,7 @@ public function attach($owner)
 
     /**
      * Typecast owner attributes according to [[attributeTypes]].
-     * @param array $attributeNames list of attribute names that should be type-casted.
+     * @param array|null $attributeNames list of attribute names that should be type-casted.
      * If this parameter is empty, it means any attribute listed in the [[attributeTypes]]
      * should be type-casted.
      */
diff --git a/framework/behaviors/AttributesBehavior.php b/framework/behaviors/AttributesBehavior.php
index e1b0f874ea5..df093864a34 100644
--- a/src/behaviors/AttributesBehavior.php
+++ b/src/behaviors/AttributesBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
diff --git a/framework/behaviors/BlameableBehavior.php b/framework/behaviors/BlameableBehavior.php
index b4c7ab07882..f83b8b3f28c 100755
--- a/src/behaviors/BlameableBehavior.php
+++ b/src/behaviors/BlameableBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
diff --git a/framework/behaviors/CacheableWidgetBehavior.php b/framework/behaviors/CacheableWidgetBehavior.php
index c6d4cd32c5c..2ac37517c5a 100644
--- a/src/behaviors/CacheableWidgetBehavior.php
+++ b/src/behaviors/CacheableWidgetBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
diff --git a/framework/behaviors/OptimisticLockBehavior.php b/framework/behaviors/OptimisticLockBehavior.php
index b3fd6a405b3..92243f5c71e 100644
--- a/src/behaviors/OptimisticLockBehavior.php
+++ b/src/behaviors/OptimisticLockBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
diff --git a/framework/behaviors/SluggableBehavior.php b/framework/behaviors/SluggableBehavior.php
index b62ade8ea2c..c18bd4fa2dd 100644
--- a/src/behaviors/SluggableBehavior.php
+++ b/src/behaviors/SluggableBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
@@ -111,7 +111,7 @@ class SluggableBehavior extends AttributeBehavior
      */
     public $uniqueValidator = [];
     /**
-     * @var callable slug unique value generator. It is used in case [[ensureUnique]] enabled and generated
+     * @var callable|null slug unique value generator. It is used in case [[ensureUnique]] enabled and generated
      * slug is not unique. This should be a PHP callable with following signature:
      *
      * ```php
diff --git a/framework/behaviors/TimestampBehavior.php b/framework/behaviors/TimestampBehavior.php
index 7f79fe3bc9d..bb0d6ca273b 100644
--- a/src/behaviors/TimestampBehavior.php
+++ b/src/behaviors/TimestampBehavior.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\behaviors;
diff --git a/framework/caching/ApcCache.php b/framework/caching/ApcCache.php
index 32b74eb5fbb..8e30ea43c83 100644
--- a/src/caching/ApcCache.php
+++ b/src/caching/ApcCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/ArrayCache.php b/framework/caching/ArrayCache.php
index aabbb966f39..d8fdaf61b18 100644
--- a/src/caching/ArrayCache.php
+++ b/src/caching/ArrayCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/Cache.php b/framework/caching/Cache.php
index a4afaee5eb4..5e1828ef850 100644
--- a/src/caching/Cache.php
+++ b/src/caching/Cache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -62,7 +62,7 @@ abstract class Cache extends Component implements CacheInterface
      */
     public $keyPrefix;
     /**
-     * @var null|array|false the functions used to serialize and unserialize cached data. Defaults to null, meaning
+     * @var array|null|false the functions used to serialize and unserialize cached data. Defaults to null, meaning
      * using the default PHP `serialize()` and `unserialize()` functions. If you want to use some more efficient
      * serializer (e.g. [igbinary](https://pecl.php.net/package/igbinary)), you may configure this property with
      * a two-element array. The first element specifies the serialization function, and the second the deserialization
@@ -135,7 +135,7 @@ public function get($key)
         if ($value === false || $this->serializer === false) {
             return $value;
         } elseif ($this->serializer === null) {
-            $value = unserialize($value);
+            $value = unserialize((string)$value);
         } else {
             $value = call_user_func($this->serializer[1], $value);
         }
@@ -229,9 +229,9 @@ public function multiGet($keys)
      * @param mixed $key a key identifying the value to be cached. This can be a simple string or
      * a complex data structure consisting of factors representing the key.
      * @param mixed $value the value to be cached
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * default [[defaultDuration]] value is used.
-     * @param Dependency $dependency dependency of the cached item. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached item. If the dependency changes,
      * the corresponding value in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return bool whether the value is successfully stored into cache
@@ -261,9 +261,9 @@ public function set($key, $value, $duration = null, $dependency = null)
      * expiration time will be replaced with the new ones, respectively.
      *
      * @param array $items the items to be cached, as key-value pairs.
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * default [[defaultDuration]] value is used.
-     * @param Dependency $dependency dependency of the cached items. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached items. If the dependency changes,
      * the corresponding values in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return array array of failed keys
@@ -280,9 +280,9 @@ public function mset($items, $duration = null, $dependency = null)
      * expiration time will be replaced with the new ones, respectively.
      *
      * @param array $items the items to be cached, as key-value pairs.
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * default [[defaultDuration]] value is used.
-     * @param Dependency $dependency dependency of the cached items. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached items. If the dependency changes,
      * the corresponding values in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return array array of failed keys
@@ -319,7 +319,7 @@ public function multiSet($items, $duration = null, $dependency = null)
      *
      * @param array $items the items to be cached, as key-value pairs.
      * @param int $duration default number of seconds in which the cached values will expire. 0 means never expire.
-     * @param Dependency $dependency dependency of the cached items. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached items. If the dependency changes,
      * the corresponding values in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return array array of failed keys
@@ -336,7 +336,7 @@ public function madd($items, $duration = 0, $dependency = null)
      *
      * @param array $items the items to be cached, as key-value pairs.
      * @param int $duration default number of seconds in which the cached values will expire. 0 means never expire.
-     * @param Dependency $dependency dependency of the cached items. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached items. If the dependency changes,
      * the corresponding values in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return array array of failed keys
@@ -370,7 +370,7 @@ public function multiAdd($items, $duration = 0, $dependency = null)
      * a complex data structure consisting of factors representing the key.
      * @param mixed $value the value to be cached
      * @param int $duration the number of seconds in which the cached value will expire. 0 means never expire.
-     * @param Dependency $dependency dependency of the cached item. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached item. If the dependency changes,
      * the corresponding value in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return bool whether the value is successfully stored into cache
@@ -526,6 +526,7 @@ protected function addValues($data, $duration)
      * @param string $key a key identifying the cached value
      * @return bool
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($key)
     {
         return $this->get($key) !== false;
@@ -537,6 +538,7 @@ public function offsetExists($key)
      * @param string $key a key identifying the cached value
      * @return mixed the value stored in cache, false if the value is not in the cache or expired.
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($key)
     {
         return $this->get($key);
@@ -550,6 +552,7 @@ public function offsetGet($key)
      * @param string $key the key identifying the value to be cached
      * @param mixed $value the value to be cached
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($key, $value)
     {
         $this->set($key, $value);
@@ -560,6 +563,7 @@ public function offsetSet($key, $value)
      * This method is required by the interface [[\ArrayAccess]].
      * @param string $key the key of the value to be deleted
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($key)
     {
         $this->delete($key);
@@ -586,9 +590,9 @@ public function offsetUnset($key)
      * If you use $callable that can return `false`, then keep in mind that [[getOrSet()]] may work inefficiently
      * because the [[yii\caching\Cache::get()]] method uses `false` return value to indicate the data item is not found
      * in the cache. Thus, caching of `false` value will lead to unnecessary internal calls.
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * [[defaultDuration]] value will be used.
-     * @param Dependency $dependency dependency of the cached item. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached item. If the dependency changes,
      * the corresponding value in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is `false`.
      * @return mixed result of $callable execution
diff --git a/framework/caching/CacheInterface.php b/framework/caching/CacheInterface.php
index 2b14c25e397..0ff387eff1c 100644
--- a/src/caching/CacheInterface.php
+++ b/src/caching/CacheInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -97,9 +97,9 @@ public function multiGet($keys);
      * @param mixed $key a key identifying the value to be cached. This can be a simple string or
      * a complex data structure consisting of factors representing the key.
      * @param mixed $value the value to be cached
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * default [[defaultDuration]] value is used.
-     * @param Dependency $dependency dependency of the cached item. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached item. If the dependency changes,
      * the corresponding value in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return bool whether the value is successfully stored into cache
@@ -112,9 +112,9 @@ public function set($key, $value, $duration = null, $dependency = null);
      * expiration time will be replaced with the new ones, respectively.
      *
      * @param array $items the items to be cached, as key-value pairs.
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * default [[defaultDuration]] value is used.
-     * @param Dependency $dependency dependency of the cached items. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached items. If the dependency changes,
      * the corresponding values in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return array array of failed keys
@@ -128,7 +128,7 @@ public function multiSet($items, $duration = null, $dependency = null);
      * a complex data structure consisting of factors representing the key.
      * @param mixed $value the value to be cached
      * @param int $duration the number of seconds in which the cached value will expire. 0 means never expire.
-     * @param Dependency $dependency dependency of the cached item. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached item. If the dependency changes,
      * the corresponding value in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return bool whether the value is successfully stored into cache
@@ -141,7 +141,7 @@ public function add($key, $value, $duration = 0, $dependency = null);
      *
      * @param array $items the items to be cached, as key-value pairs.
      * @param int $duration default number of seconds in which the cached values will expire. 0 means never expire.
-     * @param Dependency $dependency dependency of the cached items. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached items. If the dependency changes,
      * the corresponding values in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is false.
      * @return array array of failed keys
@@ -182,9 +182,9 @@ public function flush();
      * a complex data structure consisting of factors representing the key.
      * @param callable|\Closure $callable the callable or closure that will be used to generate a value to be cached.
      * In case $callable returns `false`, the value will not be cached.
-     * @param int $duration default duration in seconds before the cache will expire. If not set,
+     * @param int|null $duration default duration in seconds before the cache will expire. If not set,
      * [[defaultDuration]] value will be used.
-     * @param Dependency $dependency dependency of the cached item. If the dependency changes,
+     * @param Dependency|null $dependency dependency of the cached item. If the dependency changes,
      * the corresponding value in the cache will be invalidated when it is fetched via [[get()]].
      * This parameter is ignored if [[serializer]] is `false`.
      * @return mixed result of $callable execution
diff --git a/framework/caching/ChainedDependency.php b/framework/caching/ChainedDependency.php
index ecacb90be0a..b318ea8516a 100644
--- a/src/caching/ChainedDependency.php
+++ b/src/caching/ChainedDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/DbCache.php b/framework/caching/DbCache.php
index 3cd211ec013..5bf3b02dedd 100644
--- a/src/caching/DbCache.php
+++ b/src/caching/DbCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/DbDependency.php b/framework/caching/DbDependency.php
index f16ef4a1be0..43a51d9266e 100644
--- a/src/caching/DbDependency.php
+++ b/src/caching/DbDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/DbQueryDependency.php b/framework/caching/DbQueryDependency.php
index 3aafd0f457e..ac358292809 100644
--- a/src/caching/DbQueryDependency.php
+++ b/src/caching/DbQueryDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -41,7 +41,7 @@ class DbQueryDependency extends Dependency
      */
     public $query;
     /**
-     * @var string|callable method which should be invoked in over the [[query]] object.
+     * @var string|callable|null method which should be invoked in over the [[query]] object.
      *
      * If specified as a string an own query method with such name will be invoked, passing [[db]] value as its
      * first argument. For example: `exists`, `all`.
diff --git a/framework/caching/Dependency.php b/framework/caching/Dependency.php
index 9093e8ef196..e558bfef8c4 100644
--- a/src/caching/Dependency.php
+++ b/src/caching/Dependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -99,16 +99,28 @@ public static function resetReusableData()
 
     /**
      * Generates a unique hash that can be used for retrieving reusable dependency data.
+     *
      * @return string a unique hash value for this cache dependency.
      * @see reusable
      */
     protected function generateReusableHash()
     {
-        $data = $this->data;
-        $this->data = null;  // https://github.com/yiisoft/yii2/issues/3052
-        $key = sha1(serialize($this));
-        $this->data = $data;
-        return $key;
+        $clone = clone $this;
+        $clone->data = null; // https://github.com/yiisoft/yii2/issues/3052
+
+        try {
+            $serialized = serialize($clone);
+        } catch (\Exception $e) {
+            // unserializable properties are nulled
+            foreach ($clone as $name => $value) {
+                if (is_object($value) && $value instanceof \Closure) {
+                    $clone->{$name} = null;
+                }
+            }
+            $serialized = serialize($clone);
+        }
+
+        return sha1($serialized);
     }
 
     /**
diff --git a/framework/caching/DummyCache.php b/framework/caching/DummyCache.php
index b8db22bc389..8530712ddf5 100644
--- a/src/caching/DummyCache.php
+++ b/src/caching/DummyCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/ExpressionDependency.php b/framework/caching/ExpressionDependency.php
index 09d6756bf83..c0ec1e1d5e4 100644
--- a/src/caching/ExpressionDependency.php
+++ b/src/caching/ExpressionDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/FileCache.php b/framework/caching/FileCache.php
index 52a80c67b35..053d04f295c 100644
--- a/src/caching/FileCache.php
+++ b/src/caching/FileCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -57,7 +57,7 @@ class FileCache extends Cache
      */
     public $gcProbability = 10;
     /**
-     * @var int the permission to be set for newly created cache files.
+     * @var int|null the permission to be set for newly created cache files.
      * This value will be used by PHP chmod() function. No umask will be applied.
      * If not set, the permission will be determined by the current environment.
      */
diff --git a/framework/caching/FileDependency.php b/framework/caching/FileDependency.php
index b3e94fcc410..7b9cfb66432 100644
--- a/src/caching/FileDependency.php
+++ b/src/caching/FileDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/MemCache.php b/framework/caching/MemCache.php
index 9c1e1791a3f..a1918c90f58 100644
--- a/src/caching/MemCache.php
+++ b/src/caching/MemCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -56,7 +56,7 @@
  * For more details and usage information on Cache, see the [guide article on caching](guide:caching-overview).
  *
  * @property-read \Memcache|\Memcached $memcache The memcache (or memcached) object used by this cache
- * component. This property is read-only.
+ * component.
  * @property MemCacheServer[] $servers List of memcache server configurations. Note that the type of this
  * property differs in getter and setter. See [[getServers()]] and [[setServers()]] for details.
  *
diff --git a/framework/caching/MemCacheServer.php b/framework/caching/MemCacheServer.php
index 96d10c46ad7..4701db12c81 100644
--- a/src/caching/MemCacheServer.php
+++ b/src/caching/MemCacheServer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/TagDependency.php b/framework/caching/TagDependency.php
index 9e484e9dd55..99dae2fb670 100644
--- a/src/caching/TagDependency.php
+++ b/src/caching/TagDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/WinCache.php b/framework/caching/WinCache.php
index 3201311b15a..d89935411c6 100644
--- a/src/caching/WinCache.php
+++ b/src/caching/WinCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -10,7 +10,7 @@
 /**
  * WinCache provides Windows Cache caching in terms of an application component.
  *
- * To use this application component, the [WinCache PHP extension](http://www.iis.net/expand/wincacheforphp)
+ * To use this application component, the [WinCache PHP extension](https://www.iis.net/downloads/microsoft/wincache-extension)
  * must be loaded. Also note that "wincache.ucenabled" should be set to "On" in your php.ini file.
  *
  * See [[Cache]] manual for common cache operations that are supported by WinCache.
diff --git a/framework/caching/XCache.php b/framework/caching/XCache.php
index 9d084fe630b..19d1bec9c00 100644
--- a/src/caching/XCache.php
+++ b/src/caching/XCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/ZendDataCache.php b/framework/caching/ZendDataCache.php
index 24a9ce6365d..ed2eac0c0a7 100644
--- a/src/caching/ZendDataCache.php
+++ b/src/caching/ZendDataCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
diff --git a/framework/caching/migrations/m150909_153426_cache_init.php b/framework/caching/migrations/m150909_153426_cache_init.php
index 0e3e0b8383d..714178cd89b 100644
--- a/src/caching/migrations/m150909_153426_cache_init.php
+++ b/src/caching/migrations/m150909_153426_cache_init.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\base\InvalidConfigException;
@@ -41,7 +41,7 @@ public function up()
 
         $tableOptions = null;
         if ($this->db->driverName === 'mysql') {
-            // http://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
+            // https://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
             $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
         }
 
diff --git a/framework/caching/migrations/schema-mssql.sql b/framework/caching/migrations/schema-mssql.sql
index fc6670fe613..1ef982b1e6b 100644
--- a/src/caching/migrations/schema-mssql.sql
+++ b/src/caching/migrations/schema-mssql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 if object_id('[cache]', 'U') is not null
diff --git a/framework/caching/migrations/schema-mysql.sql b/framework/caching/migrations/schema-mysql.sql
index b1ba454a038..b45b033bcde 100644
--- a/src/caching/migrations/schema-mysql.sql
+++ b/src/caching/migrations/schema-mysql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/caching/migrations/schema-oci.sql b/framework/caching/migrations/schema-oci.sql
index bc5178008a9..6c4e9447cc8 100644
--- a/src/caching/migrations/schema-oci.sql
+++ b/src/caching/migrations/schema-oci.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/caching/migrations/schema-pgsql.sql b/framework/caching/migrations/schema-pgsql.sql
index 8d510b9af0a..2d699e67453 100644
--- a/src/caching/migrations/schema-pgsql.sql
+++ b/src/caching/migrations/schema-pgsql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/caching/migrations/schema-sqlite.sql b/framework/caching/migrations/schema-sqlite.sql
index 63349d3d026..59d44f4c9e1 100644
--- a/src/caching/migrations/schema-sqlite.sql
+++ b/src/caching/migrations/schema-sqlite.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/captcha/Captcha.php b/framework/captcha/Captcha.php
index b85843f4422..a86fd188ec1 100644
--- a/src/captcha/Captcha.php
+++ b/src/captcha/Captcha.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\captcha;
@@ -17,7 +17,7 @@
 /**
  * Captcha renders a CAPTCHA image and an input field that takes user-entered verification code.
  *
- * Captcha is used together with [[CaptchaAction]] to provide [CAPTCHA](http://en.wikipedia.org/wiki/Captcha) - a way
+ * Captcha is used together with [[CaptchaAction]] to provide [CAPTCHA](https://en.wikipedia.org/wiki/CAPTCHA) - a way
  * of preventing website spamming.
  *
  * The image element rendered by Captcha will display a CAPTCHA image generated by
diff --git a/framework/captcha/CaptchaAction.php b/framework/captcha/CaptchaAction.php
index c3b9c420e27..1518d0904d1 100644
--- a/src/captcha/CaptchaAction.php
+++ b/src/captcha/CaptchaAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\captcha;
@@ -17,7 +17,7 @@
  * CaptchaAction renders a CAPTCHA image.
  *
  * CaptchaAction is used together with [[Captcha]] and [[\yii\captcha\CaptchaValidator]]
- * to provide the [CAPTCHA](http://en.wikipedia.org/wiki/Captcha) feature.
+ * to provide the [CAPTCHA](https://en.wikipedia.org/wiki/CAPTCHA) feature.
  *
  * By configuring the properties of CaptchaAction, you may customize the appearance of
  * the generated CAPTCHA images, such as the font color, the background color, etc.
@@ -31,7 +31,7 @@
  *    to be validated by the 'captcha' validator.
  * 3. In the controller view, insert a [[Captcha]] widget in the form.
  *
- * @property-read string $verifyCode The verification code. This property is read-only.
+ * @property-read string $verifyCode The verification code.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -91,7 +91,7 @@ class CaptchaAction extends Action
      */
     public $fontFile = '@yii/captcha/SpicyRice.ttf';
     /**
-     * @var string the fixed verification code. When this property is set,
+     * @var string|null the fixed verification code. When this property is set,
      * [[getVerifyCode()]] will always return the value of this property.
      * This is mainly used in automated tests where we want to be able to reproduce
      * the same verification code each time we run the tests.
@@ -99,7 +99,7 @@ class CaptchaAction extends Action
      */
     public $fixedVerifyCode;
     /**
-     * @var string the rendering library to use. Currently supported only 'gd' and 'imagick'.
+     * @var string|null the rendering library to use. Currently supported only 'gd' and 'imagick'.
      * If not set, library will be determined automatically.
      * @since 2.0.7
      */
diff --git a/framework/captcha/CaptchaAsset.php b/framework/captcha/CaptchaAsset.php
index 8af07e17a9f..e028b455305 100644
--- a/src/captcha/CaptchaAsset.php
+++ b/src/captcha/CaptchaAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\captcha;
diff --git a/framework/captcha/CaptchaValidator.php b/framework/captcha/CaptchaValidator.php
index 9bcedca4497..c84f199c50c 100644
--- a/src/captcha/CaptchaValidator.php
+++ b/src/captcha/CaptchaValidator.php
@@ -1,14 +1,15 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\captcha;
 
 use Yii;
 use yii\base\InvalidConfigException;
+use yii\helpers\Json;
 use yii\validators\ValidationAsset;
 use yii\validators\Validator;
 
@@ -89,7 +90,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'yii.validation.captcha(value, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ');';
+        return 'yii.validation.captcha(value, messages, ' . Json::htmlEncode($options) . ');';
     }
 
     /**
diff --git a/framework/classes.php b/framework/classes.php
index 028210c63d4..439f757ce0b 100644
--- a/src/classes.php
+++ b/src/classes.php
@@ -5,9 +5,9 @@
  * This file is automatically generated by the "build classmap" command under the "build" folder.
  * Do not modify it directly.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return [
@@ -347,6 +347,7 @@
   'yii\validators\StringValidator' => YII2_PATH . '/validators/StringValidator.php',
   'yii\validators\UniqueValidator' => YII2_PATH . '/validators/UniqueValidator.php',
   'yii\validators\UrlValidator' => YII2_PATH . '/validators/UrlValidator.php',
+  'yii\validators\TrimValidator' => YII2_PATH . '/validators/TrimValidator.php',
   'yii\validators\ValidationAsset' => YII2_PATH . '/validators/ValidationAsset.php',
   'yii\validators\Validator' => YII2_PATH . '/validators/Validator.php',
   'yii\web\Application' => YII2_PATH . '/web/Application.php',
diff --git a/framework/composer.json b/framework/composer.json
index 2875edb6657..aaafa056878 100644
--- a/src/composer.json
+++ b/src/composer.json
@@ -29,7 +29,7 @@
         {
             "name": "Carsten Brandt",
             "email": "mail@cebe.cc",
-            "homepage": "https://cebe.cc/",
+            "homepage": "https://www.cebe.cc/",
             "role": "Core framework development"
         },
         {
@@ -57,8 +57,8 @@
     ],
     "support": {
         "issues": "https://github.com/yiisoft/yii2/issues?state=open",
-        "forum": "http://www.yiiframework.com/forum/",
-        "wiki": "http://www.yiiframework.com/wiki/",
+        "forum": "https://forum.yiiframework.com/",
+        "wiki": "https://www.yiiframework.com/wiki",
         "irc": "ircs://irc.libera.chat:6697/yii",
         "source": "https://github.com/yiisoft/yii2"
     },
diff --git a/framework/console/Application.php b/framework/console/Application.php
index 4ee2535249d..1ec070a55d2 100644
--- a/src/console/Application.php
+++ b/src/console/Application.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
@@ -50,10 +50,9 @@
  * yii help
  * ```
  *
- * @property-read ErrorHandler $errorHandler The error handler application component. This property is
- * read-only.
- * @property-read Request $request The request component. This property is read-only.
- * @property-read Response $response The response component. This property is read-only.
+ * @property-read ErrorHandler $errorHandler The error handler application component.
+ * @property-read Request $request The request component.
+ * @property-read Response $response The response component.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -171,7 +170,7 @@ public function handleRequest($request)
      *
      * @param string $route the route that specifies the action.
      * @param array $params the parameters to be passed to the action
-     * @return int|Response the result of the action. This can be either an exit code or Response object.
+     * @return int|Response|null the result of the action. This can be either an exit code or Response object.
      * Exit code 0 means normal, and other values mean abnormal. Exit code of `null` is treated as `0` as well.
      * @throws Exception if the route is invalid
      */
diff --git a/framework/console/Controller.php b/framework/console/Controller.php
index 6fb573db946..64ba3682508 100644
--- a/src/console/Controller.php
+++ b/src/console/Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
@@ -28,12 +28,10 @@
  * where `<route>` is a route to a controller action and the params will be populated as properties of a command.
  * See [[options()]] for details.
  *
- * @property-read string $help This property is read-only.
- * @property-read string $helpSummary This property is read-only.
- * @property-read array $passedOptionValues The properties corresponding to the passed options. This property
- * is read-only.
- * @property-read array $passedOptions The names of the options passed during execution. This property is
- * read-only.
+ * @property-read string $help The help information for this controller.
+ * @property-read string $helpSummary The one-line short summary describing this controller.
+ * @property-read array $passedOptionValues The properties corresponding to the passed options.
+ * @property-read array $passedOptions The names of the options passed during execution.
  * @property Request $request
  * @property Response $response
  *
@@ -545,60 +543,69 @@ public function getActionHelp($action)
      * The returned value should be an array. The keys are the argument names, and the values are
      * the corresponding help information. Each value must be an array of the following structure:
      *
-     * - required: boolean, whether this argument is required.
-     * - type: string, the PHP type of this argument.
-     * - default: string, the default value of this argument
-     * - comment: string, the comment of this argument
+     * - required: bool, whether this argument is required
+     * - type: string|null, the PHP type(s) of this argument
+     * - default: mixed, the default value of this argument
+     * - comment: string, the description of this argument
      *
-     * The default implementation will return the help information extracted from the doc-comment of
-     * the parameters corresponding to the action method.
+     * The default implementation will return the help information extracted from the Reflection or
+     * DocBlock of the parameters corresponding to the action method.
      *
-     * @param Action $action
+     * @param Action $action the action instance
      * @return array the help information of the action arguments
      */
     public function getActionArgsHelp($action)
     {
         $method = $this->getActionMethodReflection($action);
+
         $tags = $this->parseDocCommentTags($method);
-        $params = isset($tags['param']) ? (array) $tags['param'] : [];
+        $tags['param'] = isset($tags['param']) ? (array) $tags['param'] : [];
+        $phpDocParams = [];
+        foreach ($tags['param'] as $i => $tag) {
+            if (preg_match('/^(?<type>\S+)(\s+\$(?<name>\w+))?(?<comment>.*)/us', $tag, $matches) === 1) {
+                $key = empty($matches['name']) ? $i : $matches['name'];
+                $phpDocParams[$key] = ['type' => $matches['type'], 'comment' => $matches['comment']];
+            }
+        }
+        unset($tags);
 
         $args = [];
 
-        /** @var \ReflectionParameter $reflection */
-        foreach ($method->getParameters() as $i => $reflection) {
-            if (PHP_VERSION_ID >= 80000) {
-                $class = $reflection->getType();
-            } else {
-                $class = $reflection->getClass();
-            }
-
-            if ($class !== null) {
-                continue;
+        /** @var \ReflectionParameter $parameter */
+        foreach ($method->getParameters() as $i => $parameter) {
+            $type = null;
+            $comment = '';
+            if (PHP_MAJOR_VERSION > 5 && $parameter->hasType()) {
+                $reflectionType = $parameter->getType();
+                if (PHP_VERSION_ID >= 70100) {
+                    $types = method_exists($reflectionType, 'getTypes') ? $reflectionType->getTypes() : [$reflectionType];
+                    foreach ($types as $key => $reflectionType) {
+                        $types[$key] = $reflectionType->getName();
+                    }
+                    $type = implode('|', $types);
+                } else {
+                    $type = (string) $reflectionType;
+                }
             }
-            $name = $reflection->getName();
-            $tag = isset($params[$i]) ? $params[$i] : '';
-            if (preg_match('/^(\S+)\s+(\$\w+\s+)?(.*)/s', $tag, $matches)) {
-                $type = $matches[1];
-                $comment = $matches[3];
-            } else {
-                $type = null;
-                $comment = $tag;
+            // find PhpDoc tag by property name or position
+            $key = isset($phpDocParams[$parameter->name]) ? $parameter->name : (isset($phpDocParams[$i]) ? $i : null);
+            if ($key !== null) {
+                $comment = $phpDocParams[$key]['comment'];
+                if ($type === null && !empty($phpDocParams[$key]['type'])) {
+                    $type = $phpDocParams[$key]['type'];
+                }
             }
-            if ($reflection->isDefaultValueAvailable()) {
-                $args[$name] = [
-                    'required' => false,
-                    'type' => $type,
-                    'default' => $reflection->getDefaultValue(),
-                    'comment' => $comment,
-                ];
-            } else {
-                $args[$name] = [
-                    'required' => true,
-                    'type' => $type,
-                    'default' => null,
-                    'comment' => $comment,
-                ];
+            // if type still not detected, then using type of default value
+            if ($type === null && $parameter->isDefaultValueAvailable() && $parameter->getDefaultValue() !== null) {
+                $type = gettype($parameter->getDefaultValue());
             }
+
+            $args[$parameter->name] = [
+                'required' => !$parameter->isOptional(),
+                'type' => $type,
+                'default' => $parameter->isDefaultValueAvailable() ? $parameter->getDefaultValue() : null,
+                'comment' => $comment,
+            ];
         }
 
         return $args;
@@ -673,7 +680,7 @@ public function getActionOptionsHelp($action)
 
     /**
      * @param Action $action
-     * @return \ReflectionMethod
+     * @return \ReflectionFunctionAbstract
      */
     protected function getActionMethodReflection($action)
     {
@@ -690,7 +697,7 @@ protected function getActionMethodReflection($action)
 
     /**
      * Parses the comment block into tags.
-     * @param \Reflector $reflection the comment block
+     * @param \ReflectionClass|\ReflectionProperty|\ReflectionFunctionAbstract $reflection the comment block
      * @return array the parsed tags
      */
     protected function parseDocCommentTags($reflection)
@@ -718,7 +725,7 @@ protected function parseDocCommentTags($reflection)
     /**
      * Returns the first line of docblock.
      *
-     * @param \Reflector $reflection
+     * @param \ReflectionClass|\ReflectionProperty|\ReflectionFunctionAbstract $reflection
      * @return string
      */
     protected function parseDocCommentSummary($reflection)
@@ -734,7 +741,7 @@ protected function parseDocCommentSummary($reflection)
     /**
      * Returns full description from the docblock.
      *
-     * @param \Reflector $reflection
+     * @param \ReflectionClass|\ReflectionProperty|\ReflectionFunctionAbstract $reflection
      * @return string
      */
     protected function parseDocCommentDetail($reflection)
diff --git a/framework/console/ErrorHandler.php b/framework/console/ErrorHandler.php
index 526de75dfac..c2a976d0429 100644
--- a/src/console/ErrorHandler.php
+++ b/src/console/ErrorHandler.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
@@ -25,7 +25,7 @@ class ErrorHandler extends \yii\base\ErrorHandler
 {
     /**
      * Renders an exception using ansi format for console output.
-     * @param \Exception $exception the exception to be rendered.
+     * @param \Throwable $exception the exception to be rendered.
      */
     protected function renderException($exception)
     {
diff --git a/framework/console/Exception.php b/framework/console/Exception.php
index 41a01e475a0..59ee7d71acb 100644
--- a/src/console/Exception.php
+++ b/src/console/Exception.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
diff --git a/framework/console/ExitCode.php b/framework/console/ExitCode.php
index 50ee57a5594..311f5027d54 100644
--- a/src/console/ExitCode.php
+++ b/src/console/ExitCode.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
@@ -10,7 +10,7 @@
 /**
  * This class provides constants for defining console command exit codes.
  *
- * The exit codes follow the codes defined in the [FreeBSD sysexits(3)](http://man.openbsd.org/sysexits) manual page.
+ * The exit codes follow the codes defined in the [FreeBSD sysexits(3)](https://man.openbsd.org/sysexits) manual page.
  *
  * These constants can be used in console controllers for example like this:
  *
@@ -30,7 +30,7 @@
  *
  * @author Tom Worster <fsb@thefsb.org>
  * @author Alexander Makarov <sam@rmcreative.ru>
- * @see http://man.openbsd.org/sysexits
+ * @see https://man.openbsd.org/sysexits
  * @since 2.0.13
  */
 class ExitCode
diff --git a/framework/console/Markdown.php b/framework/console/Markdown.php
index 0e62a812279..c67626affac 100644
--- a/src/console/Markdown.php
+++ b/src/console/Markdown.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
diff --git a/framework/console/Request.php b/framework/console/Request.php
index be76ff4cf46..eee35ca6edb 100644
--- a/src/console/Request.php
+++ b/src/console/Request.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
diff --git a/framework/console/Response.php b/framework/console/Response.php
index eff85c601e9..b3a99799784 100644
--- a/src/console/Response.php
+++ b/src/console/Response.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
diff --git a/framework/console/UnknownCommandException.php b/framework/console/UnknownCommandException.php
index 29d00799b42..917887c86be 100644
--- a/src/console/UnknownCommandException.php
+++ b/src/console/UnknownCommandException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console;
@@ -34,9 +34,9 @@ class UnknownCommandException extends Exception
      * @param string $route the route of the command that could not be found.
      * @param Application $application the console application instance involved.
      * @param int $code the Exception code.
-     * @param \Exception $previous the previous exception used for the exception chaining.
+     * @param \Throwable|null $previous the previous exception used for the exception chaining.
      */
-    public function __construct($route, $application, $code = 0, \Exception $previous = null)
+    public function __construct($route, $application, $code = 0, $previous = null)
     {
         $this->command = $route;
         $this->application = $application;
diff --git a/framework/console/controllers/AssetController.php b/framework/console/controllers/AssetController.php
index 4f2e492dcea..cd9c3aeaffa 100644
--- a/src/console/controllers/AssetController.php
+++ b/src/console/controllers/AssetController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
@@ -544,7 +544,7 @@ protected function compressCssFiles($inputFiles, $outputFile)
         if (is_string($this->cssCompressor)) {
             $tmpFile = $outputFile . '.tmp';
             $this->combineCssFiles($inputFiles, $tmpFile);
-            $this->stdout(shell_exec(strtr($this->cssCompressor, [
+            $this->stdout((string)shell_exec(strtr($this->cssCompressor, [
                 '{from}' => escapeshellarg($tmpFile),
                 '{to}' => escapeshellarg($outputFile),
             ])));
diff --git a/framework/console/controllers/BaseMigrateController.php b/framework/console/controllers/BaseMigrateController.php
index 24280c36e7c..88792516a27 100644
--- a/src/console/controllers/BaseMigrateController.php
+++ b/src/console/controllers/BaseMigrateController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
@@ -85,14 +85,14 @@ abstract class BaseMigrateController extends Controller
      */
     public $templateFile;
     /**
-     * @var int the permission to be set for newly generated migration files.
+     * @var int|null the permission to be set for newly generated migration files.
      * This value will be used by PHP chmod() function. No umask will be applied.
      * If not set, the permission will be determined by the current environment.
      * @since 2.0.43
      */
     public $newFileMode;
     /**
-     * @var string|int the user and/or group ownership to be set for newly generated migration files.
+     * @var string|int|null the user and/or group ownership to be set for newly generated migration files.
      * If not set, the ownership will be determined by the current environment.
      * @since 2.0.43
      * @see FileHelper::changeOwnership()
@@ -992,7 +992,7 @@ protected function getMigrationNameLimit()
 
     /**
      * Returns the migration history.
-     * @param int $limit the maximum number of records in the history to be returned. `null` for "no limit".
+     * @param int|null $limit the maximum number of records in the history to be returned. `null` for "no limit".
      * @return array the migration history
      */
     abstract protected function getMigrationHistory($limit);
diff --git a/framework/console/controllers/CacheController.php b/framework/console/controllers/CacheController.php
index 8675c53410c..d5d0a756e4c 100644
--- a/src/console/controllers/CacheController.php
+++ b/src/console/controllers/CacheController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
@@ -38,7 +38,7 @@
  * Flushing web cache could be either done by:
  *
  * - Putting a php file under web root and calling it via HTTP
- * - Using [Cachetool](http://gordalina.github.io/cachetool/)
+ * - Using [Cachetool](https://gordalina.github.io/cachetool/)
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
  * @author Mark Jebri <mark.github@yandex.ru>
diff --git a/framework/console/controllers/FixtureController.php b/framework/console/controllers/FixtureController.php
index 667c2a56bcf..d13c4b7bd3b 100644
--- a/src/console/controllers/FixtureController.php
+++ b/src/console/controllers/FixtureController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
diff --git a/framework/console/controllers/HelpController.php b/framework/console/controllers/HelpController.php
index 712fa76028a..b7d5db7a936 100644
--- a/src/console/controllers/HelpController.php
+++ b/src/console/controllers/HelpController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
@@ -30,7 +30,7 @@
  * In the above, if the command name is not provided, all
  * available commands will be displayed.
  *
- * @property-read array $commands All available command names. This property is read-only.
+ * @property-read array $commands All available command names.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -41,7 +41,7 @@ class HelpController extends Controller
      * Displays available commands or the detailed information
      * about a particular command.
      *
-     * @param string $command The name of the command to show help about.
+     * @param string|null $command The name of the command to show help about.
      * If not provided, all available commands will be displayed.
      * @return int the exit status
      * @throws Exception if the command for help is unknown
@@ -473,8 +473,8 @@ protected function getSubCommandHelp($controller, $actionID)
      */
     protected function formatOptionHelp($name, $required, $type, $defaultValue, $comment)
     {
-        $comment = trim($comment);
-        $type = trim($type);
+        $comment = trim((string)$comment);
+        $type = trim((string)$type);
         if (strncmp($type, 'bool', 4) === 0) {
             $type = 'boolean, 0 or 1';
         }
diff --git a/framework/console/controllers/MessageController.php b/framework/console/controllers/MessageController.php
index 5eb1e312a08..e1a73576903 100644
--- a/src/console/controllers/MessageController.php
+++ b/src/console/controllers/MessageController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
@@ -84,7 +84,7 @@ class MessageController extends \yii\console\Controller
      */
     public $markUnused = true;
     /**
-     * @var array list of patterns that specify which files/directories should NOT be processed.
+     * @var array|null list of patterns that specify which files/directories should NOT be processed.
      * If empty or not set, all files/directories will be processed.
      * See helpers/FileHelper::findFiles() description for pattern matching rules.
      * If a file/directory matches both a pattern in "only" and "except", it will NOT be processed.
@@ -99,7 +99,7 @@ class MessageController extends \yii\console\Controller
         '/BaseYii.php', // contains examples about Yii::t()
     ];
     /**
-     * @var array list of patterns that specify which files (not directories) should be processed.
+     * @var array|null list of patterns that specify which files (not directories) should be processed.
      * If empty or not set, all files will be processed.
      * See helpers/FileHelper::findFiles() description for pattern matching rules.
      * If a file/directory matches both a pattern in "only" and "except", it will NOT be processed.
@@ -286,7 +286,7 @@ public function actionConfigTemplate($filePath)
      * This command will search through source code files and extract
      * messages that need to be translated in different languages.
      *
-     * @param string $configFile the path or alias of the configuration file.
+     * @param string|null $configFile the path or alias of the configuration file.
      * You may use the "yii message/config" command to generate
      * this file and then customize it for your needs.
      * @throws Exception on failure.
diff --git a/framework/console/controllers/MigrateController.php b/framework/console/controllers/MigrateController.php
index 8bf011fe42a..17b6a76389a 100644
--- a/src/console/controllers/MigrateController.php
+++ b/src/console/controllers/MigrateController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
@@ -406,7 +406,7 @@ protected function generateMigrationSourceCode($params)
 
         $name = $params['name'];
         if ($params['namespace']) {
-            $name = substr($name, strrpos($name, '\\') + 1);
+            $name = substr($name, (strrpos($name, '\\') ?: -1) + 1);
         }
 
         $templateFile = $this->templateFile;
diff --git a/framework/console/controllers/ServeController.php b/framework/console/controllers/ServeController.php
index 7df3b67c8f8..68a7e50c286 100644
--- a/src/console/controllers/ServeController.php
+++ b/src/console/controllers/ServeController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\controllers;
diff --git a/framework/console/widgets/Table.php b/framework/console/widgets/Table.php
index 99fd5d23234..4862e88b6be 100644
--- a/src/console/widgets/Table.php
+++ b/src/console/widgets/Table.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\console\widgets;
@@ -40,8 +40,8 @@
  *     ],
  * ]);
  *
- * @property-write string $listPrefix List prefix. This property is write-only.
- * @property-write int $screenWidth Screen width. This property is write-only.
+ * @property-write string $listPrefix List prefix.
+ * @property-write int $screenWidth Screen width.
  *
  * @author Daniel Gomez Pan <pana_1990@hotmail.com>
  * @since 2.0.13
diff --git a/framework/data/ActiveDataFilter.php b/framework/data/ActiveDataFilter.php
index 5c46d0a449b..be5704aa675 100644
--- a/src/data/ActiveDataFilter.php
+++ b/src/data/ActiveDataFilter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
diff --git a/framework/data/ActiveDataProvider.php b/framework/data/ActiveDataProvider.php
index 477ca7aee8d..a8b6e158ecf 100644
--- a/src/data/ActiveDataProvider.php
+++ b/src/data/ActiveDataProvider.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
diff --git a/framework/data/ArrayDataProvider.php b/framework/data/ArrayDataProvider.php
index 5e507800a07..657bcd2a1c3 100644
--- a/src/data/ArrayDataProvider.php
+++ b/src/data/ArrayDataProvider.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
@@ -53,7 +53,7 @@
 class ArrayDataProvider extends BaseDataProvider
 {
     /**
-     * @var string|callable the column that is used as the key of the data models.
+     * @var string|callable|null the column that is used as the key of the data models.
      * This can be either a column name, or a callable that returns the key value of a given data model.
      * If this is not set, the index of the [[models]] array will be used.
      * @see getKeys()
diff --git a/framework/data/BaseDataProvider.php b/framework/data/BaseDataProvider.php
index 5be48a17712..82af0aa7c47 100644
--- a/src/data/BaseDataProvider.php
+++ b/src/data/BaseDataProvider.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
@@ -16,7 +16,7 @@
  *
  * For more details and usage information on BaseDataProvider, see the [guide article on data providers](guide:output-data-providers).
  *
- * @property-read int $count The number of data models in the current page. This property is read-only.
+ * @property-read int $count The number of data models in the current page.
  * @property array $keys The list of key values corresponding to [[models]]. Each data model in [[models]] is
  * uniquely identified by the corresponding key value in this array.
  * @property array $models The list of data models in the current page.
@@ -37,7 +37,7 @@ abstract class BaseDataProvider extends Component implements DataProviderInterfa
      */
     private static $counter = 0;
     /**
-     * @var string an ID that uniquely identifies the data provider among all data providers.
+     * @var string|null an ID that uniquely identifies the data provider among all data providers.
      * Generated automatically the following way in case it is not set:
      *
      * - First data provider ID is empty.
diff --git a/framework/data/DataFilter.php b/framework/data/DataFilter.php
index c07e2a86407..057509203fe 100644
--- a/src/data/DataFilter.php
+++ b/src/data/DataFilter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
@@ -613,7 +613,7 @@ protected function validateAttributeCondition($attribute, $condition)
      * Validates operator condition.
      * @param string $operator raw operator control keyword.
      * @param mixed $condition attribute condition.
-     * @param string $attribute attribute name.
+     * @param string|null $attribute attribute name.
      */
     protected function validateOperatorCondition($operator, $condition, $attribute = null)
     {
diff --git a/framework/data/DataProviderInterface.php b/framework/data/DataProviderInterface.php
index 0260c381e8f..95aa2fb7ec3 100644
--- a/src/data/DataProviderInterface.php
+++ b/src/data/DataProviderInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
diff --git a/framework/data/Pagination.php b/framework/data/Pagination.php
index 247d907aa8a..e74bc09afcf 100644
--- a/src/data/Pagination.php
+++ b/src/data/Pagination.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
@@ -60,13 +60,13 @@
  *
  * @property-read int $limit The limit of the data. This may be used to set the LIMIT value for a SQL
  * statement for fetching the current page of data. Note that if the page size is infinite, a value -1 will be
- * returned. This property is read-only.
+ * returned.
  * @property-read array $links The links for navigational purpose. The array keys specify the purpose of the
- * links (e.g. [[LINK_FIRST]]), and the array values are the corresponding URLs. This property is read-only.
+ * links (e.g. [[LINK_FIRST]]), and the array values are the corresponding URLs.
  * @property-read int $offset The offset of the data. This may be used to set the OFFSET value for a SQL
- * statement for fetching the current page of data. This property is read-only.
+ * statement for fetching the current page of data.
  * @property int $page The zero-based current page number.
- * @property-read int $pageCount Number of pages. This property is read-only.
+ * @property-read int $pageCount Number of pages.
  * @property int $pageSize The number of items per page. If it is less than 1, it means the page size is
  * infinite, and thus a single page contains all items.
  *
@@ -96,12 +96,12 @@ class Pagination extends BaseObject implements Linkable
      */
     public $forcePageParam = true;
     /**
-     * @var string the route of the controller action for displaying the paged contents.
+     * @var string|null the route of the controller action for displaying the paged contents.
      * If not set, it means using the currently requested route.
      */
     public $route;
     /**
-     * @var array parameters (name => value) that should be used to obtain the current page number
+     * @var array|null parameters (name => value) that should be used to obtain the current page number
      * and to create new pagination URLs. If not set, all parameters from $_GET will be used instead.
      *
      * In order to add hash to all links use `array_merge($_GET, ['#' => 'my-hash'])`.
@@ -111,7 +111,7 @@ class Pagination extends BaseObject implements Linkable
      */
     public $params;
     /**
-     * @var \yii\web\UrlManager the URL manager used for creating pagination URLs. If not set,
+     * @var \yii\web\UrlManager|null the URL manager used for creating pagination URLs. If not set,
      * the "urlManager" application component will be used.
      */
     public $urlManager;
@@ -250,7 +250,7 @@ public function setPageSize($value, $validatePageSize = false)
      * Creates the URL suitable for pagination with the specified page number.
      * This method is mainly called by pagers when creating URLs used to perform pagination.
      * @param int $page the zero-based page number that the URL should point to.
-     * @param int $pageSize the number of items on each page. If not set, the value of [[pageSize]] will be used.
+     * @param int|null $pageSize the number of items on each page. If not set, the value of [[pageSize]] will be used.
      * @param bool $absolute whether to create an absolute URL. Defaults to `false`.
      * @return string the created URL
      * @see params
@@ -339,7 +339,7 @@ public function getLinks($absolute = false)
      * Returns the value of the specified query parameter.
      * This method returns the named parameter value from [[params]]. Null is returned if the value does not exist.
      * @param string $name the parameter name
-     * @param string $defaultValue the value to be returned when the specified parameter does not exist in [[params]].
+     * @param string|null $defaultValue the value to be returned when the specified parameter does not exist in [[params]].
      * @return string|null the parameter value
      */
     protected function getQueryParam($name, $defaultValue = null)
diff --git a/framework/data/Sort.php b/framework/data/Sort.php
index bbb1ce9b336..5b7ff3b77db 100644
--- a/src/data/Sort.php
+++ b/src/data/Sort.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
@@ -72,7 +72,7 @@
  * `SORT_ASC` for ascending order or `SORT_DESC` for descending order. Note that the type of this property
  * differs in getter and setter. See [[getAttributeOrders()]] and [[setAttributeOrders()]] for details.
  * @property-read array $orders The columns (keys) and their corresponding sort directions (values). This can
- * be passed to [[\yii\db\Query::orderBy()]] to construct a DB query. This property is read-only.
+ * be passed to [[\yii\db\Query::orderBy()]] to construct a DB query.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -159,7 +159,7 @@ class Sort extends BaseObject
      */
     public $defaultOrder;
     /**
-     * @var string the route of the controller action for displaying the sorted contents.
+     * @var string|null the route of the controller action for displaying the sorted contents.
      * If not set, it means using the currently requested route.
      */
     public $route;
@@ -168,7 +168,7 @@ class Sort extends BaseObject
      */
     public $separator = ',';
     /**
-     * @var array parameters (name => value) that should be used to obtain the current sort directions
+     * @var array|null parameters (name => value) that should be used to obtain the current sort directions
      * and to create new sort URLs. If not set, `$_GET` will be used instead.
      *
      * In order to add hash to all links use `array_merge($_GET, ['#' => 'my-hash'])`.
@@ -181,7 +181,7 @@ class Sort extends BaseObject
      */
     public $params;
     /**
-     * @var \yii\web\UrlManager the URL manager used for creating sort URLs. If not set,
+     * @var \yii\web\UrlManager|null the URL manager used for creating sort URLs. If not set,
      * the `urlManager` application component will be used.
      */
     public $urlManager;
diff --git a/framework/data/SqlDataProvider.php b/framework/data/SqlDataProvider.php
index cf851ef8f92..5a8f9631de5 100644
--- a/src/data/SqlDataProvider.php
+++ b/src/data/SqlDataProvider.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\data;
@@ -80,7 +80,7 @@ class SqlDataProvider extends BaseDataProvider
      */
     public $params = [];
     /**
-     * @var string|callable the column that is used as the key of the data models.
+     * @var string|callable|null the column that is used as the key of the data models.
      * This can be either a column name, or a callable that returns the key value of a given data model.
      *
      * If this is not set, the keys of the [[models]] array will be used.
diff --git a/framework/db/ActiveQuery.php b/framework/db/ActiveQuery.php
index 434b59cd598..413255fcfeb 100644
--- a/src/db/ActiveQuery.php
+++ b/src/db/ActiveQuery.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -81,12 +81,12 @@ class ActiveQuery extends Query implements ActiveQueryInterface
     const EVENT_INIT = 'init';
 
     /**
-     * @var string the SQL statement to be executed for retrieving AR records.
+     * @var string|null the SQL statement to be executed for retrieving AR records.
      * This is set by [[ActiveRecord::findBySql()]].
      */
     public $sql;
     /**
-     * @var string|array the join condition to be used when this query is used in a relational context.
+     * @var string|array|null the join condition to be used when this query is used in a relational context.
      * The condition will be used in the ON part when [[ActiveQuery::joinWith()]] is called.
      * Otherwise, the condition will be used in the WHERE part of a query.
      * Please refer to [[Query::where()]] on how to specify this parameter.
@@ -94,7 +94,7 @@ class ActiveQuery extends Query implements ActiveQueryInterface
      */
     public $on;
     /**
-     * @var array a list of relations that this query should be joined with
+     * @var array|null a list of relations that this query should be joined with
      */
     public $joinWith;
 
@@ -124,7 +124,7 @@ public function init()
 
     /**
      * Executes query and returns all results as an array.
-     * @param Connection $db the DB connection used to create the DB command.
+     * @param Connection|null $db the DB connection used to create the DB command.
      * If null, the DB connection returned by [[modelClass]] will be used.
      * @return array|ActiveRecord[] the query results. If the query results in nothing, an empty array will be returned.
      */
@@ -778,7 +778,7 @@ public function orOnCondition($condition, $params = [])
      * @param array $link the link between the junction table and the table associated with [[primaryModel]].
      * The keys of the array represent the columns in the junction table, and the values represent the columns
      * in the [[primaryModel]] table.
-     * @param callable $callable a PHP callback for customizing the relation associated with the junction table.
+     * @param callable|null $callable a PHP callback for customizing the relation associated with the junction table.
      * Its signature should be `function($query)`, where `$query` is the query to be customized.
      * @return $this the query object itself
      * @throws InvalidConfigException when query is not initialized properly
diff --git a/framework/db/ActiveQueryInterface.php b/framework/db/ActiveQueryInterface.php
index 9150e8bc2ec..c424a4919cb 100644
--- a/src/db/ActiveQueryInterface.php
+++ b/src/db/ActiveQueryInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -31,7 +31,7 @@ public function asArray($value = true);
 
     /**
      * Executes query and returns a single row of result.
-     * @param Connection $db the DB connection used to create the DB command.
+     * @param Connection|null $db the DB connection used to create the DB command.
      * If `null`, the DB connection returned by [[ActiveQueryTrait::$modelClass|modelClass]] will be used.
      * @return ActiveRecordInterface|array|null a single row of query result. Depending on the setting of [[asArray]],
      * the query result may be either an array or an ActiveRecord object. `null` will be returned
@@ -92,7 +92,7 @@ public function with();
     /**
      * Specifies the relation associated with the junction table for use in relational query.
      * @param string $relationName the relation name. This refers to a relation declared in the [[ActiveRelationTrait::primaryModel|primaryModel]] of the relation.
-     * @param callable $callable a PHP callback for customizing the relation associated with the junction table.
+     * @param callable|null $callable a PHP callback for customizing the relation associated with the junction table.
      * Its signature should be `function($query)`, where `$query` is the query to be customized.
      * @return $this the relation object itself.
      */
diff --git a/framework/db/ActiveQueryTrait.php b/framework/db/ActiveQueryTrait.php
index 9bb1cc758d0..e2de1dd12d9 100644
--- a/src/db/ActiveQueryTrait.php
+++ b/src/db/ActiveQueryTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ActiveRecord.php b/framework/db/ActiveRecord.php
index face7132b76..0b95da9e62d 100644
--- a/src/db/ActiveRecord.php
+++ b/src/db/ActiveRecord.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -17,7 +17,7 @@
 /**
  * ActiveRecord is the base class for classes representing relational data in terms of objects.
  *
- * Active Record implements the [Active Record design pattern](http://en.wikipedia.org/wiki/Active_record).
+ * Active Record implements the [Active Record design pattern](https://en.wikipedia.org/wiki/Active_record_pattern).
  * The premise behind Active Record is that an individual [[ActiveRecord]] object is associated with a specific
  * row in a database table. The object's attributes are mapped to the columns of the corresponding table.
  * Referencing an Active Record attribute is equivalent to accessing the corresponding table column for that record.
@@ -70,8 +70,8 @@
  *
  * For more details and usage information on ActiveRecord, see the [guide article on ActiveRecord](guide:db-active-record).
  *
- * @method ActiveQuery hasMany($class, array $link) see [[BaseActiveRecord::hasMany()]] for more info
- * @method ActiveQuery hasOne($class, array $link) see [[BaseActiveRecord::hasOne()]] for more info
+ * @method ActiveQuery hasMany($class, array $link) See [[BaseActiveRecord::hasMany()]] for more info.
+ * @method ActiveQuery hasOne($class, array $link) See [[BaseActiveRecord::hasOne()]] for more info.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Carsten Brandt <mail@cebe.cc>
@@ -392,7 +392,7 @@ public static function updateAllCounters($counters, $condition = '', $params = [
      *
      * For a large set of models you might consider using [[ActiveQuery::each()]] to keep memory usage within limits.
      *
-     * @param string|array $condition the conditions that will be put in the WHERE part of the DELETE SQL.
+     * @param string|array|null $condition the conditions that will be put in the WHERE part of the DELETE SQL.
      * Please refer to [[Query::where()]] on how to specify this parameter.
      * @param array $params the parameters (name => value) to be bound to the query.
      * @return int the number of rows deleted
@@ -470,7 +470,7 @@ public static function primaryKey()
      */
     public function attributes()
     {
-        return array_keys(static::getTableSchema()->columns);
+        return static::getTableSchema()->getColumnNames();
     }
 
     /**
@@ -554,10 +554,10 @@ public static function populateRecord($record, $row)
      * @param bool $runValidation whether to perform validation (calling [[validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributes list of attributes that need to be saved. Defaults to `null`,
+     * @param array|null $attributes list of attributes that need to be saved. Defaults to `null`,
      * meaning all attributes that are loaded from DB will be saved.
      * @return bool whether the attributes are valid and the record is inserted successfully.
-     * @throws \Exception in case insert failed.
+     * @throws \Throwable in case insert failed.
      */
     public function insert($runValidation = true, $attributes = null)
     {
@@ -591,7 +591,7 @@ public function insert($runValidation = true, $attributes = null)
 
     /**
      * Inserts an ActiveRecord into DB without considering transaction.
-     * @param array $attributes list of attributes that need to be saved. Defaults to `null`,
+     * @param array|null $attributes list of attributes that need to be saved. Defaults to `null`,
      * meaning all attributes that are loaded from DB will be saved.
      * @return bool whether the record is inserted successfully.
      */
@@ -661,13 +661,13 @@ protected function insertInternal($attributes = null)
      * @param bool $runValidation whether to perform validation (calling [[validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributeNames list of attributes that need to be saved. Defaults to `null`,
+     * @param array|null $attributeNames list of attributes that need to be saved. Defaults to `null`,
      * meaning all attributes that are loaded from DB will be saved.
      * @return int|false the number of rows affected, or false if validation fails
      * or [[beforeSave()]] stops the updating process.
      * @throws StaleObjectException if [[optimisticLock|optimistic locking]] is enabled and the data
      * being updated is outdated.
-     * @throws \Exception in case update failed.
+     * @throws \Throwable in case update failed.
      */
     public function update($runValidation = true, $attributeNames = null)
     {
@@ -716,7 +716,7 @@ public function update($runValidation = true, $attributeNames = null)
      * Note that it is possible the number of rows deleted is 0, even though the deletion execution is successful.
      * @throws StaleObjectException if [[optimisticLock|optimistic locking]] is enabled and the data
      * being deleted is outdated.
-     * @throws \Exception in case delete failed.
+     * @throws \Throwable in case delete failed.
      */
     public function delete()
     {
diff --git a/framework/db/ActiveRecordInterface.php b/framework/db/ActiveRecordInterface.php
index dfa9ed3096e..d845e9d32cb 100644
--- a/src/db/ActiveRecordInterface.php
+++ b/src/db/ActiveRecordInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -79,9 +79,6 @@ public function getPrimaryKey($asArray = false);
      * @param bool $asArray whether to return the primary key value as an array. If true,
      * the return value will be an array with column name as key and column value as value.
      * If this is `false` (default), a scalar value will be returned for non-composite primary key.
-     * @property mixed The old primary key value. An array (column name => column value) is
-     * returned if the primary key is composite. A string is returned otherwise (`null` will be
-     * returned if the key value is `null`).
      * @return mixed the old primary key value. An array (column name => column value) is returned if the primary key
      * is composite or `$asArray` is true. A string is returned otherwise (`null` will be returned if
      * the key value is `null`).
@@ -313,7 +310,7 @@ public static function updateAll($attributes, $condition = null);
      * Customer::deleteAll([status = 3]);
      * ```
      *
-     * @param array $condition the condition that matches the records that should get deleted.
+     * @param array|null $condition the condition that matches the records that should get deleted.
      * Please refer to [[QueryInterface::where()]] on how to specify this parameter.
      * An empty condition will match all records.
      * @return int the number of rows deleted
@@ -338,7 +335,7 @@ public static function deleteAll($condition = null);
      * @param bool $runValidation whether to perform validation (calling [[\yii\base\Model::validate()|validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributeNames list of attribute names that need to be saved. Defaults to `null`,
+     * @param array|null $attributeNames list of attribute names that need to be saved. Defaults to `null`,
      * meaning all attributes that are loaded from DB will be saved.
      * @return bool whether the saving succeeded (i.e. no validation errors occurred).
      */
@@ -359,7 +356,7 @@ public function save($runValidation = true, $attributeNames = null);
      * @param bool $runValidation whether to perform validation (calling [[\yii\base\Model::validate()|validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributes list of attributes that need to be saved. Defaults to `null`,
+     * @param array|null $attributes list of attributes that need to be saved. Defaults to `null`,
      * meaning all attributes that are loaded from DB will be saved.
      * @return bool whether the attributes are valid and the record is inserted successfully.
      */
@@ -380,7 +377,7 @@ public function insert($runValidation = true, $attributes = null);
      * @param bool $runValidation whether to perform validation (calling [[\yii\base\Model::validate()|validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributeNames list of attributes that need to be saved. Defaults to `null`,
+     * @param array|null $attributeNames list of attributes that need to be saved. Defaults to `null`,
      * meaning all attributes that are loaded from DB will be saved.
      * @return int|bool the number of rows affected, or `false` if validation fails
      * or updating process is stopped for other reasons.
diff --git a/framework/db/ActiveRelationTrait.php b/framework/db/ActiveRelationTrait.php
index 8f2a6e44289..687777f23bb 100644
--- a/src/db/ActiveRelationTrait.php
+++ b/src/db/ActiveRelationTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -17,8 +17,8 @@
  * @author Carsten Brandt <mail@cebe.cc>
  * @since 2.0
  *
- * @method ActiveRecordInterface one($db = null)
- * @method ActiveRecordInterface[] all($db = null)
+ * @method ActiveRecordInterface|array|null one($db = null) See [[ActiveQueryInterface::one()]] for more info.
+ * @method ActiveRecordInterface[] all($db = null) See [[ActiveQueryInterface::all()]] for more info.
  * @property ActiveRecord $modelClass
  */
 trait ActiveRelationTrait
@@ -98,7 +98,7 @@ public function __clone()
      * ```
      *
      * @param string $relationName the relation name. This refers to a relation declared in [[primaryModel]].
-     * @param callable $callable a PHP callback for customizing the relation associated with the junction table.
+     * @param callable|null $callable a PHP callback for customizing the relation associated with the junction table.
      * Its signature should be `function($query)`, where `$query` is the query to be customized.
      * @return $this the relation object itself.
      */
@@ -289,7 +289,12 @@ public function populateRelation($name, &$primaryModels)
             $link = array_values($deepViaQuery->link);
         }
         foreach ($primaryModels as $i => $primaryModel) {
-            if ($this->multiple && count($link) === 1 && is_array($keys = $primaryModel[reset($link)])) {
+            $keys = null;
+            if ($this->multiple && count($link) === 1) {
+                $primaryModelKey = reset($link);
+                $keys = isset($primaryModel[$primaryModelKey]) ? $primaryModel[$primaryModelKey] : null;
+            }
+            if (is_array($keys)) {
                 $value = [];
                 foreach ($keys as $key) {
                     $key = $this->normalizeModelKey($key);
@@ -386,8 +391,8 @@ private function populateInverseRelation(&$primaryModels, $models, $primaryName,
     /**
      * @param array $models
      * @param array $link
-     * @param array $viaModels
-     * @param null|self $viaQuery
+     * @param array|null $viaModels
+     * @param self|null $viaQuery
      * @param bool $checkMultiple
      * @return array
      */
@@ -523,7 +528,8 @@ private function filterByModels($models)
             // single key
             $attribute = reset($this->link);
             foreach ($models as $model) {
-                if (($value = $model[$attribute]) !== null) {
+                $value = isset($model[$attribute]) || (is_object($model) && property_exists($model, $attribute)) ? $model[$attribute] : null;
+                if ($value !== null) {
                     if (is_array($value)) {
                         $values = array_merge($values, $value);
                     } elseif ($value instanceof ArrayExpression && $value->getDimension() === 1) {
@@ -574,13 +580,15 @@ private function filterByModels($models)
     /**
      * @param ActiveRecordInterface|array $model
      * @param array $attributes
-     * @return string
+     * @return string|false
      */
     private function getModelKey($model, $attributes)
     {
         $key = [];
         foreach ($attributes as $attribute) {
-            $key[] = $this->normalizeModelKey($model[$attribute]);
+            if (isset($model[$attribute]) || (is_object($model) && property_exists($model, $attribute))) {
+                $key[] = $this->normalizeModelKey($model[$attribute]);
+            }
         }
         if (count($key) > 1) {
             return serialize($key);
diff --git a/framework/db/AfterSaveEvent.php b/framework/db/AfterSaveEvent.php
index 516cc28918e..3efccc10ec1 100644
--- a/src/db/AfterSaveEvent.php
+++ b/src/db/AfterSaveEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ArrayExpression.php b/framework/db/ArrayExpression.php
index e473eb10ec2..c4ba9d6f0c4 100644
--- a/src/db/ArrayExpression.php
+++ b/src/db/ArrayExpression.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -28,7 +28,7 @@
 class ArrayExpression implements ExpressionInterface, \ArrayAccess, \Countable, \IteratorAggregate
 {
     /**
-     * @var null|string the type of the array elements. Defaults to `null` which means the type is
+     * @var string|null the type of the array elements. Defaults to `null` which means the type is
      * not explicitly specified.
      *
      * Note that in case when type is not specified explicitly and DBMS can not guess it from the context,
@@ -68,7 +68,7 @@ public function __construct($value, $type = null, $dimension = 1)
     }
 
     /**
-     * @return null|string
+     * @return string|null
      */
     public function getType()
     {
@@ -104,6 +104,7 @@ public function getDimension()
      * The return value will be casted to boolean if non-boolean was returned.
      * @since 2.0.14
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return isset($this->value[$offset]);
@@ -119,6 +120,7 @@ public function offsetExists($offset)
      * @return mixed Can return all value types.
      * @since 2.0.14
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         return $this->value[$offset];
@@ -137,6 +139,7 @@ public function offsetGet($offset)
      * @return void
      * @since 2.0.14
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $value)
     {
         $this->value[$offset] = $value;
@@ -152,6 +155,7 @@ public function offsetSet($offset, $value)
      * @return void
      * @since 2.0.14
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         unset($this->value[$offset]);
@@ -167,6 +171,7 @@ public function offsetUnset($offset)
      * The return value is cast to an integer.
      * @since 2.0.14
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         return count($this->value);
@@ -181,6 +186,7 @@ public function count()
      * @since 2.0.14.1
      * @throws InvalidConfigException when ArrayExpression contains QueryInterface object
      */
+    #[\ReturnTypeWillChange]
     public function getIterator()
     {
         $value = $this->getValue();
diff --git a/framework/db/BaseActiveRecord.php b/framework/db/BaseActiveRecord.php
index d5675479c10..cc0de7d07f0 100644
--- a/src/db/BaseActiveRecord.php
+++ b/src/db/BaseActiveRecord.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -23,19 +23,17 @@
  *
  * See [[\yii\db\ActiveRecord]] for a concrete implementation.
  *
- * @property-read array $dirtyAttributes The changed attribute values (name-value pairs). This property is
- * read-only.
+ * @property-read array $dirtyAttributes The changed attribute values (name-value pairs).
  * @property bool $isNewRecord Whether the record is new and should be inserted when calling [[save()]].
  * @property array $oldAttributes The old attribute values (name-value pairs). Note that the type of this
  * property differs in getter and setter. See [[getOldAttributes()]] and [[setOldAttributes()]] for details.
  * @property-read mixed $oldPrimaryKey The old primary key value. An array (column name => column value) is
  * returned if the primary key is composite. A string is returned otherwise (null will be returned if the key
- * value is null). This property is read-only.
+ * value is null).
  * @property-read mixed $primaryKey The primary key value. An array (column name => column value) is returned
  * if the primary key is composite. A string is returned otherwise (null will be returned if the key value is
- * null). This property is read-only.
- * @property-read array $relatedRecords An array of related records indexed by relation names. This property
- * is read-only.
+ * null).
+ * @property-read array $relatedRecords An array of related records indexed by relation names.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Carsten Brandt <mail@cebe.cc>
@@ -198,7 +196,7 @@ public static function updateAllCounters($counters, $condition = '')
      * Customer::deleteAll('status = 3');
      * ```
      *
-     * @param string|array $condition the conditions that will be put in the WHERE part of the DELETE SQL.
+     * @param string|array|null $condition the conditions that will be put in the WHERE part of the DELETE SQL.
      * Please refer to [[Query::where()]] on how to specify this parameter.
      * @return int the number of rows deleted
      * @throws NotSupportedException if not overridden.
@@ -231,7 +229,7 @@ public static function deleteAll($condition = null)
      *    and implement necessary business logic (e.g. merging the changes, prompting stated data)
      *    to resolve the conflict.
      *
-     * @return string the column name that stores the lock version of a table row.
+     * @return string|null the column name that stores the lock version of a table row.
      * If `null` is returned (default implemented), optimistic locking will not be supported.
      */
     public function optimisticLock()
@@ -641,7 +639,7 @@ public function getDirtyAttributes($names = null)
             }
         } else {
             foreach ($this->_attributes as $name => $value) {
-                if (isset($names[$name]) && (!array_key_exists($name, $this->_oldAttributes) || $value !== $this->_oldAttributes[$name])) {
+                if (isset($names[$name]) && (!array_key_exists($name, $this->_oldAttributes) || $this->isAttributeDirty($name, $value))) {
                     $attributes[$name] = $value;
                 }
             }
@@ -668,7 +666,7 @@ public function getDirtyAttributes($names = null)
      * @param bool $runValidation whether to perform validation (calling [[validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributeNames list of attribute names that need to be saved. Defaults to null,
+     * @param array|null $attributeNames list of attribute names that need to be saved. Defaults to null,
      * meaning all attributes that are loaded from DB will be saved.
      * @return bool whether the saving succeeded (i.e. no validation errors occurred).
      */
@@ -725,7 +723,7 @@ public function save($runValidation = true, $attributeNames = null)
      * @param bool $runValidation whether to perform validation (calling [[validate()]])
      * before saving the record. Defaults to `true`. If the validation fails, the record
      * will not be saved to the database and this method will return `false`.
-     * @param array $attributeNames list of attribute names that need to be saved. Defaults to null,
+     * @param array|null $attributeNames list of attribute names that need to be saved. Defaults to null,
      * meaning all attributes that are loaded from DB will be saved.
      * @return int|false the number of rows affected, or `false` if validation fails
      * or [[beforeSave()]] stops the updating process.
@@ -785,7 +783,7 @@ public function updateAttributes($attributes)
 
     /**
      * @see update()
-     * @param array $attributes attributes to update
+     * @param array|null $attributes attributes to update
      * @return int|false the number of rows affected, or false if [[beforeSave()]] stops the updating process.
      * @throws StaleObjectException
      */
@@ -992,7 +990,7 @@ public function beforeSave($insert)
      *
      * Note that no automatic type conversion performed by default. You may use
      * [[\yii\behaviors\AttributeTypecastBehavior]] to facilitate attribute typecasting.
-     * See http://www.yiiframework.com/doc-2.0/guide-db-active-record.html#attributes-typecasting.
+     * See https://www.yiiframework.com/doc-2.0/guide-db-active-record.html#attributes-typecasting.
      */
     public function afterSave($insert, $changedAttributes)
     {
@@ -1112,9 +1110,6 @@ public function equals($record)
      * @param bool $asArray whether to return the primary key value as an array. If `true`,
      * the return value will be an array with column names as keys and column values as values.
      * Note that for composite primary keys, an array will always be returned regardless of this parameter value.
-     * @property mixed The primary key value. An array (column name => column value) is returned if
-     * the primary key is composite. A string is returned otherwise (null will be returned if
-     * the key value is null).
      * @return mixed the primary key value. An array (column name => column value) is returned if the primary key
      * is composite or `$asArray` is `true`. A string is returned otherwise (null will be returned if
      * the key value is null).
@@ -1142,9 +1137,6 @@ public function getPrimaryKey($asArray = false)
      * @param bool $asArray whether to return the primary key value as an array. If `true`,
      * the return value will be an array with column name as key and column value as value.
      * If this is `false` (default), a scalar value will be returned for non-composite primary key.
-     * @property mixed The old primary key value. An array (column name => column value) is
-     * returned if the primary key is composite. A string is returned otherwise (null will be
-     * returned if the key value is null).
      * @return mixed the old primary key value. An array (column name => column value) is returned if the primary key
      * is composite or `$asArray` is `true`. A string is returned otherwise (null will be returned if
      * the key value is null).
@@ -1221,6 +1213,7 @@ public static function instantiate($row)
      * @param mixed $offset the offset to check on
      * @return bool whether there is an element at the specified offset.
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return $this->__isset($offset);
@@ -1232,7 +1225,7 @@ public function offsetExists($offset)
      * It can be declared in either the Active Record class itself or one of its behaviors.
      * @param string $name the relation name, e.g. `orders` for a relation defined via `getOrders()` method (case-sensitive).
      * @param bool $throwException whether to throw exception if the relation does not exist.
-     * @return ActiveQueryInterface|ActiveQuery the relational query object. If the relation does not exist
+     * @return ActiveQueryInterface|ActiveQuery|null the relational query object. If the relation does not exist
      * and `$throwException` is `false`, `null` will be returned.
      * @throws InvalidArgumentException if the named relation does not exist.
      */
@@ -1761,4 +1754,20 @@ private function setRelationDependencies($name, $relation, $viaRelationName = nu
             $this->setRelationDependencies($name, $viaQuery, $viaRelationName);
         }
     }
+
+    /**
+     * @param string $attribute
+     * @param mixed  $value
+     * @return bool
+     */
+    private function isAttributeDirty($attribute, $value)
+    {
+        $old_attribute = $this->oldAttributes[$attribute];
+        if (is_array($value) && is_array($this->oldAttributes[$attribute])) {
+            $value = ArrayHelper::recursiveSort($value);
+            $old_attribute = ArrayHelper::recursiveSort($old_attribute);
+        }
+
+        return $value !== $old_attribute;
+    }
 }
diff --git a/framework/db/BatchQueryResult.php b/framework/db/BatchQueryResult.php
index c473d0ecd23..db8e8c28946 100644
--- a/src/db/BatchQueryResult.php
+++ b/src/db/BatchQueryResult.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -43,7 +43,7 @@ class BatchQueryResult extends Component implements \Iterator
     const EVENT_FINISH = 'finish';
 
     /**
-     * @var Connection the DB connection to be used when performing batch query.
+     * @var Connection|null the DB connection to be used when performing batch query.
      * If null, the "db" application component will be used.
      */
     public $db;
@@ -114,6 +114,7 @@ public function reset()
      * Resets the iterator to the initial state.
      * This method is required by the interface [[\Iterator]].
      */
+    #[\ReturnTypeWillChange]
     public function rewind()
     {
         $this->reset();
@@ -124,6 +125,7 @@ public function rewind()
      * Moves the internal pointer to the next dataset.
      * This method is required by the interface [[\Iterator]].
      */
+    #[\ReturnTypeWillChange]
     public function next()
     {
         if ($this->_batch === null || !$this->each || $this->each && next($this->_batch) === false) {
@@ -197,6 +199,7 @@ protected function getRows()
      * This method is required by the interface [[\Iterator]].
      * @return int the index of the current row.
      */
+    #[\ReturnTypeWillChange]
     public function key()
     {
         return $this->_key;
@@ -207,6 +210,7 @@ public function key()
      * This method is required by the interface [[\Iterator]].
      * @return mixed the current dataset.
      */
+    #[\ReturnTypeWillChange]
     public function current()
     {
         return $this->_value;
@@ -217,6 +221,7 @@ public function current()
      * This method is required by the interface [[\Iterator]].
      * @return bool whether there is a valid dataset at the current position.
      */
+    #[\ReturnTypeWillChange]
     public function valid()
     {
         return !empty($this->_batch);
diff --git a/framework/db/CheckConstraint.php b/framework/db/CheckConstraint.php
index 94b3f4a9f55..585032cfe80 100644
--- a/src/db/CheckConstraint.php
+++ b/src/db/CheckConstraint.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ColumnSchema.php b/framework/db/ColumnSchema.php
index 5eb6b7b891b..74e1ddea84b 100644
--- a/src/db/ColumnSchema.php
+++ b/src/db/ColumnSchema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -161,8 +161,15 @@ protected function typecast($value)
                     return $value;
                 }
 
+                if (PHP_VERSION_ID >= 80100 && is_object($value) && $value instanceof \BackedEnum) {
+                    return (string) $value->value;
+                }
+
                 return (string) $value;
             case 'integer':
+                if (PHP_VERSION_ID >= 80100 && is_object($value) && $value instanceof \BackedEnum) {
+                    return (int) $value->value;
+                }
                 return (int) $value;
             case 'boolean':
                 // treating a 0 bit value as false too
diff --git a/framework/db/ColumnSchemaBuilder.php b/framework/db/ColumnSchemaBuilder.php
index b9616148da2..756b4b8aa8b 100644
--- a/src/db/ColumnSchemaBuilder.php
+++ b/src/db/ColumnSchemaBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -124,8 +124,8 @@ class ColumnSchemaBuilder extends BaseObject
      * Create a column schema builder instance giving the type and value precision.
      *
      * @param string $type type of the column. See [[$type]].
-     * @param int|string|array $length length or precision of the column. See [[$length]].
-     * @param \yii\db\Connection $db the current database connection. See [[$db]].
+     * @param int|string|array|null $length length or precision of the column. See [[$length]].
+     * @param \yii\db\Connection|null $db the current database connection. See [[$db]].
      * @param array $config name-value pairs that will be used to initialize the object properties
      */
     public function __construct($type, $length = null, $db = null, $config = [])
diff --git a/framework/db/Command.php b/framework/db/Command.php
index 53be1470dec..1ef5a59a82d 100644
--- a/src/db/Command.php
+++ b/src/db/Command.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -103,7 +103,7 @@ class Command extends Component
      */
     private $_refreshTableName;
     /**
-     * @var string|false|null the isolation level to use for this transaction.
+     * @var string|null|false the isolation level to use for this transaction.
      * See [[Transaction::begin()]] for details.
      */
     private $_isolationLevel = false;
@@ -116,10 +116,10 @@ class Command extends Component
 
     /**
      * Enables query cache for this command.
-     * @param int $duration the number of seconds that query result of this command can remain valid in the cache.
+     * @param int|null $duration the number of seconds that query result of this command can remain valid in the cache.
      * If this is not set, the value of [[Connection::queryCacheDuration]] will be used instead.
      * Use 0 to indicate that the cached data will never expire.
-     * @param \yii\caching\Dependency $dependency the cache dependency associated with the cached query result.
+     * @param \yii\caching\Dependency|null $dependency the cache dependency associated with the cached query result.
      * @return $this the command object itself
      */
     public function cache($duration = null, $dependency = null)
@@ -237,7 +237,7 @@ public function getRawSql()
      * this may improve performance.
      * For SQL statement with binding parameters, this method is invoked
      * automatically.
-     * @param bool $forRead whether this method is called for a read query. If null, it means
+     * @param bool|null $forRead whether this method is called for a read query. If null, it means
      * the SQL statement should be used to determine whether it is for read or write.
      * @throws Exception if there is any DB error
      */
@@ -269,10 +269,10 @@ public function prepare($forRead = null)
         } catch (\Exception $e) {
             $message = $e->getMessage() . "\nFailed to prepare SQL: $sql";
             $errorInfo = $e instanceof \PDOException ? $e->errorInfo : null;
-            throw new Exception($message, $errorInfo, (int) $e->getCode(), $e);
+            throw new Exception($message, $errorInfo, $e->getCode(), $e);
         } catch (\Throwable $e) {
             $message = $e->getMessage() . "\nFailed to prepare SQL: $sql";
-            throw new Exception($message, null, (int) $e->getCode(), $e);
+            throw new Exception($message, null, $e->getCode(), $e);
         }
     }
 
@@ -292,8 +292,8 @@ public function cancel()
      * the form `:name`. For a prepared statement using question mark
      * placeholders, this will be the 1-indexed position of the parameter.
      * @param mixed $value the PHP variable to bind to the SQL statement parameter (passed by reference)
-     * @param int $dataType SQL data type of the parameter. If null, the type is determined by the PHP type of the value.
-     * @param int $length length of the data type
+     * @param int|null $dataType SQL data type of the parameter. If null, the type is determined by the PHP type of the value.
+     * @param int|null $length length of the data type
      * @param mixed $driverOptions the driver-specific options
      * @return $this the current command being executed
      * @see https://www.php.net/manual/en/function.PDOStatement-bindParam.php
@@ -336,7 +336,7 @@ protected function bindPendingParams()
      * the form `:name`. For a prepared statement using question mark
      * placeholders, this will be the 1-indexed position of the parameter.
      * @param mixed $value The value to bind to the parameter
-     * @param int $dataType SQL data type of the parameter. If null, the type is determined by the PHP type of the value.
+     * @param int|null $dataType SQL data type of the parameter. If null, the type is determined by the PHP type of the value.
      * @return $this the current command being executed
      * @see https://www.php.net/manual/en/function.PDOStatement-bindValue.php
      */
@@ -399,7 +399,7 @@ public function query()
 
     /**
      * Executes the SQL statement and returns ALL rows at once.
-     * @param int $fetchMode the result fetch mode. Please refer to [PHP manual](https://www.php.net/manual/en/function.PDOStatement-setFetchMode.php)
+     * @param int|null $fetchMode the result fetch mode. Please refer to [PHP manual](https://www.php.net/manual/en/function.PDOStatement-setFetchMode.php)
      * for valid fetch modes. If this parameter is null, the value set in [[fetchMode]] will be used.
      * @return array all rows of the query result. Each array element is an array representing a row of data.
      * An empty array is returned if the query results in nothing.
@@ -413,7 +413,7 @@ public function queryAll($fetchMode = null)
     /**
      * Executes the SQL statement and returns the first row of the result.
      * This method is best used when only the first row of result is needed for a query.
-     * @param int $fetchMode the result fetch mode. Please refer to [PHP manual](https://www.php.net/manual/en/pdostatement.setfetchmode.php)
+     * @param int|null $fetchMode the result fetch mode. Please refer to [PHP manual](https://www.php.net/manual/en/pdostatement.setfetchmode.php)
      * for valid fetch modes. If this parameter is null, the value set in [[fetchMode]] will be used.
      * @return array|false the first row (in terms of an array) of the query result. False is returned if the query
      * results in nothing.
@@ -533,7 +533,7 @@ public function batchInsert($table, $columns, $rows)
      * ```php
      * $sql = $queryBuilder->upsert('pages', [
      *     'name' => 'Front page',
-     *     'url' => 'http://example.com/', // url is unique
+     *     'url' => 'https://example.com/', // url is unique
      *     'visits' => 0,
      * ], [
      *     'visits' => new \yii\db\Expression('visits + 1'),
@@ -641,7 +641,7 @@ public function delete($table, $condition = '', $params = [])
      *
      * @param string $table the name of the table to be created. The name will be properly quoted by the method.
      * @param array $columns the columns (name => definition) in the new table.
-     * @param string $options additional SQL fragment that will be appended to the generated SQL.
+     * @param string|null $options additional SQL fragment that will be appended to the generated SQL.
      * @return $this the command object itself
      */
     public function createTable($table, $columns, $options = null)
@@ -693,7 +693,7 @@ public function truncateTable($table)
      * @param string $table the table that the new column will be added to. The table name will be properly quoted by the method.
      * @param string $column the name of the new column. The name will be properly quoted by the method.
      * @param string $type the column type. [[\yii\db\QueryBuilder::getColumnType()]] will be called
-     * to convert the give column type to the physical one. For example, `string` will be converted
+     * to convert the given column type to the physical one. For example, `string` will be converted
      * as `varchar(255)`, and `string not null` becomes `varchar(255) not null`.
      * @return $this the command object itself
      */
@@ -783,8 +783,8 @@ public function dropPrimaryKey($name, $table)
      * @param string|array $columns the name of the column to that the constraint will be added on. If there are multiple columns, separate them with commas.
      * @param string $refTable the table that the foreign key references to.
      * @param string|array $refColumns the name of the column that the foreign key references to. If there are multiple columns, separate them with commas.
-     * @param string $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
-     * @param string $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
      * @return $this the command object itself
      */
     public function addForeignKey($name, $table, $columns, $refTable, $refColumns, $delete = null, $update = null)
@@ -1136,7 +1136,7 @@ protected function logQuery($category)
     /**
      * Performs the actual DB query of a SQL statement.
      * @param string $method method of PDOStatement to be called
-     * @param int $fetchMode the result fetch mode. Please refer to [PHP manual](https://www.php.net/manual/en/function.PDOStatement-setFetchMode.php)
+     * @param int|null $fetchMode the result fetch mode. Please refer to [PHP manual](https://www.php.net/manual/en/function.PDOStatement-setFetchMode.php)
      * for valid fetch modes. If this parameter is null, the value set in [[fetchMode]] will be used.
      * @return mixed the method execution result
      * @throws Exception if the query causes any problem
diff --git a/framework/db/Connection.php b/framework/db/Connection.php
index 74b954ffa43..fae67b054e8 100644
--- a/src/db/Connection.php
+++ b/src/db/Connection.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -111,24 +111,22 @@
  * ```
  *
  * @property string $driverName Name of the DB driver.
- * @property-read bool $isActive Whether the DB connection is established. This property is read-only.
+ * @property-read bool $isActive Whether the DB connection is established.
  * @property-read string $lastInsertID The row ID of the last row inserted, or the last value retrieved from
- * the sequence object. This property is read-only.
+ * the sequence object.
  * @property-read Connection $master The currently active master connection. `null` is returned if there is no
- * master available. This property is read-only.
- * @property-read PDO $masterPdo The PDO instance for the currently active master connection. This property is
- * read-only.
+ * master available.
+ * @property-read PDO $masterPdo The PDO instance for the currently active master connection.
  * @property QueryBuilder $queryBuilder The query builder for the current DB connection. Note that the type of
  * this property differs in getter and setter. See [[getQueryBuilder()]] and [[setQueryBuilder()]] for details.
- * @property-read Schema $schema The schema information for the database opened by this connection. This
- * property is read-only.
- * @property-read string $serverVersion Server version as a string. This property is read-only.
+ * @property-read Schema $schema The schema information for the database opened by this connection.
+ * @property-read string $serverVersion Server version as a string.
  * @property-read Connection $slave The currently active slave connection. `null` is returned if there is no
- * slave available and `$fallbackToMaster` is false. This property is read-only.
+ * slave available and `$fallbackToMaster` is false.
  * @property-read PDO $slavePdo The PDO instance for the currently active slave connection. `null` is returned
- * if no slave connection is available and `$fallbackToMaster` is false. This property is read-only.
+ * if no slave connection is available and `$fallbackToMaster` is false.
  * @property-read Transaction|null $transaction The currently active transaction. Null if no active
- * transaction. This property is read-only.
+ * transaction.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -164,11 +162,11 @@ class Connection extends Component
      */
     public $dsn;
     /**
-     * @var string the username for establishing DB connection. Defaults to `null` meaning no username to use.
+     * @var string|null the username for establishing DB connection. Defaults to `null` meaning no username to use.
      */
     public $username;
     /**
-     * @var string the password for establishing DB connection. Defaults to `null` meaning no password to use.
+     * @var string|null the password for establishing DB connection. Defaults to `null` meaning no password to use.
      */
     public $password;
     /**
@@ -179,7 +177,7 @@ class Connection extends Component
      */
     public $attributes;
     /**
-     * @var PDO the PHP PDO instance associated with this DB connection.
+     * @var PDO|null the PHP PDO instance associated with this DB connection.
      * This property is mainly managed by [[open()]] and [[close()]] methods.
      * When a DB connection is active, this property will represent a PDO instance;
      * otherwise, it will be null.
@@ -238,7 +236,7 @@ class Connection extends Component
      */
     public $queryCache = 'cache';
     /**
-     * @var string the charset used for database connection. The property is only used
+     * @var string|null the charset used for database connection. The property is only used
      * for MySQL, PostgreSQL and CUBRID databases. Defaults to null, meaning using default charset
      * as configured by the database.
      *
@@ -250,7 +248,7 @@ class Connection extends Component
      */
     public $charset;
     /**
-     * @var bool whether to turn on prepare emulation. Defaults to false, meaning PDO
+     * @var bool|null whether to turn on prepare emulation. Defaults to false, meaning PDO
      * will use the native prepare support if available. For some databases (such as MySQL),
      * this may need to be set true so that PDO can emulate the prepare support to bypass
      * the buggy native prepare support.
@@ -286,7 +284,7 @@ class Connection extends Component
         'cubrid' => 'yii\db\cubrid\Schema', // CUBRID
     ];
     /**
-     * @var string Custom PDO wrapper class. If not set, it will use [[PDO]] or [[\yii\db\mssql\PDO]] when MSSQL is used.
+     * @var string|null Custom PDO wrapper class. If not set, it will use [[PDO]] or [[\yii\db\mssql\PDO]] when MSSQL is used.
      * @see pdo
      */
     public $pdoClass;
@@ -323,7 +321,7 @@ class Connection extends Component
         'cubrid' => 'yii\db\Command', // CUBRID
     ];
     /**
-     * @var bool whether to enable [savepoint](http://en.wikipedia.org/wiki/Savepoint).
+     * @var bool whether to enable [savepoint](https://en.wikipedia.org/wiki/Savepoint).
      * Note that if the underlying DBMS does not support savepoint, setting this property to be true will have no effect.
      */
     public $enableSavepoint = true;
@@ -494,12 +492,12 @@ public function getIsActive()
      *
      * @param callable $callable a PHP callable that contains DB queries which will make use of query cache.
      * The signature of the callable is `function (Connection $db)`.
-     * @param int $duration the number of seconds that query results can remain valid in the cache. If this is
+     * @param int|null $duration the number of seconds that query results can remain valid in the cache. If this is
      * not set, the value of [[queryCacheDuration]] will be used instead.
      * Use 0 to indicate that the cached data will never expire.
-     * @param \yii\caching\Dependency $dependency the cache dependency associated with the cached query results.
+     * @param \yii\caching\Dependency|null $dependency the cache dependency associated with the cached query results.
      * @return mixed the return result of the callable
-     * @throws \Exception if there is any exception during query
+     * @throws \Throwable if there is any exception during query
      * @see enableQueryCache
      * @see queryCache
      * @see noCache()
@@ -540,7 +538,7 @@ public function cache(callable $callable, $duration = null, $dependency = null)
      * @param callable $callable a PHP callable that contains DB queries which should not use query cache.
      * The signature of the callable is `function (Connection $db)`.
      * @return mixed the return result of the callable
-     * @throws \Exception if there is any exception during query
+     * @throws \Throwable if there is any exception during query
      * @see enableQueryCache
      * @see queryCache
      * @see cache()
@@ -564,9 +562,9 @@ public function noCache(callable $callable)
     /**
      * Returns the current query cache information.
      * This method is used internally by [[Command]].
-     * @param int $duration the preferred caching duration. If null, it will be ignored.
-     * @param \yii\caching\Dependency $dependency the preferred caching dependency. If null, it will be ignored.
-     * @return array the current query cache information, or null if query cache is not enabled.
+     * @param int|null $duration the preferred caching duration. If null, it will be ignored.
+     * @param \yii\caching\Dependency|null $dependency the preferred caching dependency. If null, it will be ignored.
+     * @return array|null the current query cache information, or null if query cache is not enabled.
      * @internal
      */
     public function getQueryCacheInfo($duration, $dependency)
@@ -646,7 +644,7 @@ public function open()
                 Yii::endProfile($token, __METHOD__);
             }
 
-            throw new Exception($e->getMessage(), $e->errorInfo, (int) $e->getCode(), $e);
+            throw new Exception($e->getMessage(), $e->errorInfo, $e->getCode(), $e);
         }
     }
 
@@ -738,6 +736,11 @@ protected function initConnection()
                 $this->pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, $this->emulatePrepare);
             }
         }
+
+        if (PHP_VERSION_ID >= 80100 && $this->getDriverName() === 'sqlite') {
+            $this->pdo->setAttribute(PDO::ATTR_STRINGIFY_FETCHES, true);
+        }
+
         if (!$this->isSybase && in_array($this->getDriverName(), ['mssql', 'dblib'], true)) {
             $this->pdo->exec('SET ANSI_NULL_DFLT_ON ON');
         }
@@ -749,7 +752,7 @@ protected function initConnection()
 
     /**
      * Creates a command for execution.
-     * @param string $sql the SQL statement to be executed
+     * @param string|null $sql the SQL statement to be executed
      * @param array $params the parameters to be bound to the SQL statement
      * @return Command the DB command
      */
@@ -802,7 +805,7 @@ public function beginTransaction($isolationLevel = null)
      * @param callable $callback a valid PHP callback that performs the job. Accepts connection instance as parameter.
      * @param string|null $isolationLevel The isolation level to use for this transaction.
      * See [[Transaction::begin()]] for details.
-     * @throws \Exception if there is any exception during query. In this case the transaction will be rolled back.
+     * @throws \Throwable if there is any exception during query. In this case the transaction will be rolled back.
      * @return mixed result of callback function
      */
     public function transaction(callable $callback, $isolationLevel = null)
@@ -1001,12 +1004,12 @@ function ($matches) {
     /**
      * Returns the name of the DB driver. Based on the the current [[dsn]], in case it was not set explicitly
      * by an end user.
-     * @return string name of the DB driver
+     * @return string|null name of the DB driver
      */
     public function getDriverName()
     {
         if ($this->_driverName === null) {
-            if (($pos = strpos($this->dsn, ':')) !== false) {
+            if (($pos = strpos((string)$this->dsn, ':')) !== false) {
                 $this->_driverName = strtolower(substr($this->dsn, 0, $pos));
             } else {
                 $this->_driverName = strtolower($this->getSlavePdo()->getAttribute(PDO::ATTR_DRIVER_NAME));
@@ -1040,7 +1043,7 @@ public function getServerVersion()
      * When [[enableSlaves]] is true, one of the slaves will be used for read queries, and its PDO instance
      * will be returned by this method.
      * @param bool $fallbackToMaster whether to return a master PDO in case none of the slave connections is available.
-     * @return PDO the PDO instance for the currently active slave connection. `null` is returned if no slave connection
+     * @return PDO|null the PDO instance for the currently active slave connection. `null` is returned if no slave connection
      * is available and `$fallbackToMaster` is false.
      */
     public function getSlavePdo($fallbackToMaster = true)
@@ -1068,7 +1071,7 @@ public function getMasterPdo()
      * Returns the currently active slave connection.
      * If this method is called for the first time, it will try to open a slave connection when [[enableSlaves]] is true.
      * @param bool $fallbackToMaster whether to return a master connection in case there is no slave connection available.
-     * @return Connection the currently active slave connection. `null` is returned if there is no slave available and
+     * @return Connection|null the currently active slave connection. `null` is returned if there is no slave available and
      * `$fallbackToMaster` is false.
      */
     public function getSlave($fallbackToMaster = true)
@@ -1087,7 +1090,7 @@ public function getSlave($fallbackToMaster = true)
     /**
      * Returns the currently active master connection.
      * If this method is called for the first time, it will try to open a master connection.
-     * @return Connection the currently active master connection. `null` is returned if there is no master available.
+     * @return Connection|null the currently active master connection. `null` is returned if there is no master available.
      * @since 2.0.11
      */
     public function getMaster()
@@ -1116,7 +1119,7 @@ public function getMaster()
      * @param callable $callback a PHP callable to be executed by this method. Its signature is
      * `function (Connection $db)`. Its return value will be returned by this method.
      * @return mixed the return value of the callback
-     * @throws \Exception if there is any exception thrown from the callback
+     * @throws \Throwable if there is any exception thrown from the callback
      */
     public function useMaster(callable $callback)
     {
@@ -1149,7 +1152,7 @@ public function useMaster(callable $callback)
      *
      * @param array $pool the list of connection configurations in the server pool
      * @param array $sharedConfig the configuration common to those given in `$pool`.
-     * @return Connection the opened DB connection, or `null` if no server is available
+     * @return Connection|null the opened DB connection, or `null` if no server is available
      * @throws InvalidConfigException if a configuration does not specify "dsn"
      * @see openFromPoolSequentially
      */
@@ -1176,7 +1179,7 @@ protected function openFromPool(array $pool, array $sharedConfig)
      *
      * @param array $pool the list of connection configurations in the server pool
      * @param array $sharedConfig the configuration common to those given in `$pool`.
-     * @return Connection the opened DB connection, or `null` if no server is available
+     * @return Connection|null the opened DB connection, or `null` if no server is available
      * @throws InvalidConfigException if a configuration does not specify "dsn"
      * @since 2.0.11
      * @see openFromPool
diff --git a/framework/db/Constraint.php b/framework/db/Constraint.php
index 88a4c28e4d4..6f210969694 100644
--- a/src/db/Constraint.php
+++ b/src/db/Constraint.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ConstraintFinderInterface.php b/framework/db/ConstraintFinderInterface.php
index a22c3ba25cb..a75c01d6fcc 100644
--- a/src/db/ConstraintFinderInterface.php
+++ b/src/db/ConstraintFinderInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ConstraintFinderTrait.php b/framework/db/ConstraintFinderTrait.php
index 609572a323c..5aa28fb4700 100644
--- a/src/db/ConstraintFinderTrait.php
+++ b/src/db/ConstraintFinderTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/DataReader.php b/framework/db/DataReader.php
index a8c875606d1..c705023f15e 100644
--- a/src/db/DataReader.php
+++ b/src/db/DataReader.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -40,10 +40,10 @@
  * [[fetchMode]]. See the [PHP manual](https://www.php.net/manual/en/function.PDOStatement-setFetchMode.php)
  * for more details about possible fetch mode.
  *
- * @property-read int $columnCount The number of columns in the result set. This property is read-only.
- * @property-write int $fetchMode Fetch mode. This property is write-only.
- * @property-read bool $isClosed Whether the reader is closed or not. This property is read-only.
- * @property-read int $rowCount Number of rows contained in the result. This property is read-only.
+ * @property-read int $columnCount The number of columns in the result set.
+ * @property-write int $fetchMode Fetch mode.
+ * @property-read bool $isClosed Whether the reader is closed or not.
+ * @property-read int $rowCount Number of rows contained in the result.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -79,7 +79,7 @@ public function __construct(Command $command, $config = [])
      * in the result set. If using the column name, be aware that the name
      * should match the case of the column, as returned by the driver.
      * @param mixed $value Name of the PHP variable to which the column will be bound.
-     * @param int $dataType Data type of the parameter
+     * @param int|null $dataType Data type of the parameter
      * @see https://www.php.net/manual/en/function.PDOStatement-bindColumn.php
      */
     public function bindColumn($column, &$value, $dataType = null)
@@ -196,6 +196,7 @@ public function getRowCount()
      * In this case, use "SELECT COUNT(*) FROM tableName" to obtain the number of rows.
      * @return int number of rows contained in the result.
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         return $this->getRowCount();
@@ -216,6 +217,7 @@ public function getColumnCount()
      * This method is required by the interface [[\Iterator]].
      * @throws InvalidCallException if this method is invoked twice
      */
+    #[\ReturnTypeWillChange]
     public function rewind()
     {
         if ($this->_index < 0) {
@@ -231,6 +233,7 @@ public function rewind()
      * This method is required by the interface [[\Iterator]].
      * @return int the index of the current row.
      */
+    #[\ReturnTypeWillChange]
     public function key()
     {
         return $this->_index;
@@ -241,6 +244,7 @@ public function key()
      * This method is required by the interface [[\Iterator]].
      * @return mixed the current row.
      */
+    #[\ReturnTypeWillChange]
     public function current()
     {
         return $this->_row;
@@ -250,6 +254,7 @@ public function current()
      * Moves the internal pointer to the next row.
      * This method is required by the interface [[\Iterator]].
      */
+    #[\ReturnTypeWillChange]
     public function next()
     {
         $this->_row = $this->_statement->fetch();
@@ -261,6 +266,7 @@ public function next()
      * This method is required by the interface [[\Iterator]].
      * @return bool whether there is a row of data at current position.
      */
+    #[\ReturnTypeWillChange]
     public function valid()
     {
         return $this->_row !== false;
diff --git a/framework/db/DefaultValueConstraint.php b/framework/db/DefaultValueConstraint.php
index d4602747307..e0285a41234 100644
--- a/src/db/DefaultValueConstraint.php
+++ b/src/db/DefaultValueConstraint.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/Exception.php b/framework/db/Exception.php
index 1fb68df43da..46ae67d1bbe 100644
--- a/src/db/Exception.php
+++ b/src/db/Exception.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -27,7 +27,7 @@ class Exception extends \yii\base\Exception
      * @param string $message PDO error message
      * @param array $errorInfo PDO error info
      * @param string $code PDO error code
-     * @param \Throwable|\Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
     public function __construct($message, $errorInfo = [], $code = '', $previous = null)
     {
diff --git a/framework/db/Expression.php b/framework/db/Expression.php
index 351e5c923ce..f9aec92ff40 100644
--- a/src/db/Expression.php
+++ b/src/db/Expression.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ExpressionBuilder.php b/framework/db/ExpressionBuilder.php
index 32637a77c8f..d1836ede8dc 100644
--- a/src/db/ExpressionBuilder.php
+++ b/src/db/ExpressionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ExpressionBuilderInterface.php b/framework/db/ExpressionBuilderInterface.php
index 7e65c67d033..8ae4591ed35 100644
--- a/src/db/ExpressionBuilderInterface.php
+++ b/src/db/ExpressionBuilderInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ExpressionBuilderTrait.php b/framework/db/ExpressionBuilderTrait.php
index f2a1ce75f30..010b2d3e75b 100644
--- a/src/db/ExpressionBuilderTrait.php
+++ b/src/db/ExpressionBuilderTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ExpressionInterface.php b/framework/db/ExpressionInterface.php
index 73f8888000f..7173d1643f6 100644
--- a/src/db/ExpressionInterface.php
+++ b/src/db/ExpressionInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/ForeignKeyConstraint.php b/framework/db/ForeignKeyConstraint.php
index 6ceadeec55d..b522e718565 100644
--- a/src/db/ForeignKeyConstraint.php
+++ b/src/db/ForeignKeyConstraint.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/IndexConstraint.php b/framework/db/IndexConstraint.php
index f0c08ba8ad5..7b12e65fbb0 100644
--- a/src/db/IndexConstraint.php
+++ b/src/db/IndexConstraint.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/IntegrityException.php b/framework/db/IntegrityException.php
index 84899260e29..026af42a909 100644
--- a/src/db/IntegrityException.php
+++ b/src/db/IntegrityException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/JsonExpression.php b/framework/db/JsonExpression.php
index 36b46030ae5..601c279004b 100644
--- a/src/db/JsonExpression.php
+++ b/src/db/JsonExpression.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -69,7 +69,7 @@ public function getValue()
     }
 
     /**
-     * @return null|string the type of JSON
+     * @return string|null the type of JSON
      * @see type
      */
     public function getType()
@@ -86,6 +86,7 @@ public function getType()
      * @since 2.0.14.2
      * @throws InvalidConfigException when JsonExpression contains QueryInterface object
      */
+    #[\ReturnTypeWillChange]
     public function jsonSerialize()
     {
         $value = $this->getValue();
diff --git a/framework/db/Migration.php b/framework/db/Migration.php
index a8e2264f2c7..be61749514e 100644
--- a/src/db/Migration.php
+++ b/src/db/Migration.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -28,7 +28,7 @@
  * the whole migration can be reverted in a whole.
  *
  * Note that some DB queries in some DBMS cannot be put into a transaction. For some examples,
- * please refer to [implicit commit](http://dev.mysql.com/doc/refman/5.7/en/implicit-commit.html). If this is the case,
+ * please refer to [implicit commit](https://dev.mysql.com/doc/refman/5.7/en/implicit-commit.html). If this is the case,
  * you should still implement `up()` and `down()`, instead.
  *
  * Migration provides a set of convenient methods for manipulating database data and schema.
@@ -159,7 +159,7 @@ public function down()
     }
 
     /**
-     * @param \Throwable|\Exception $e
+     * @param \Throwable $e
      */
     private function printException($e)
     {
@@ -175,7 +175,7 @@ private function printException($e)
      * needs to be within a transaction.
      *
      * Note: Not all DBMS support transactions. And some DB queries cannot be put into a transaction. For some examples,
-     * please refer to [implicit commit](http://dev.mysql.com/doc/refman/5.7/en/implicit-commit.html).
+     * please refer to [implicit commit](https://dev.mysql.com/doc/refman/5.7/en/implicit-commit.html).
      *
      * @return false|void|mixed return a false value to indicate the migration fails
      * and should not proceed further. All other return values mean the migration succeeds.
@@ -192,7 +192,7 @@ public function safeUp()
      * needs to be within a transaction.
      *
      * Note: Not all DBMS support transactions. And some DB queries cannot be put into a transaction. For some examples,
-     * please refer to [implicit commit](http://dev.mysql.com/doc/refman/5.7/en/implicit-commit.html).
+     * please refer to [implicit commit](https://dev.mysql.com/doc/refman/5.7/en/implicit-commit.html).
      *
      * @return false|void|mixed return a false value to indicate the migration fails
      * and should not proceed further. All other return values mean the migration succeeds.
@@ -261,7 +261,6 @@ public function batchInsert($table, $columns, $rows)
      * If `true` is passed, the column data will be updated to match the insert column data.
      * If `false` is passed, no update will be performed if the column data already exists.
      * @param array $params the parameters to be bound to the command.
-     * @return $this the command object itself.
      * @since 2.0.14
      */
     public function upsert($table, $insertColumns, $updateColumns = true, $params = [])
@@ -315,7 +314,7 @@ public function delete($table, $condition = '', $params = [])
      *
      * @param string $table the name of the table to be created. The name will be properly quoted by the method.
      * @param array $columns the columns (name => definition) in the new table.
-     * @param string $options additional SQL fragment that will be appended to the generated SQL.
+     * @param string|null $options additional SQL fragment that will be appended to the generated SQL.
      */
     public function createTable($table, $columns, $options = null)
     {
@@ -458,8 +457,8 @@ public function dropPrimaryKey($name, $table)
      * @param string|array $columns the name of the column to that the constraint will be added on. If there are multiple columns, separate them with commas or use an array.
      * @param string $refTable the table that the foreign key references to.
      * @param string|array $refColumns the name of the column that the foreign key references to. If there are multiple columns, separate them with commas or use an array.
-     * @param string $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
-     * @param string $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
      */
     public function addForeignKey($name, $table, $columns, $refTable, $refColumns, $delete = null, $update = null)
     {
diff --git a/framework/db/MigrationInterface.php b/framework/db/MigrationInterface.php
index e86c79b8f38..220264e5876 100644
--- a/src/db/MigrationInterface.php
+++ b/src/db/MigrationInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/PdoValue.php b/framework/db/PdoValue.php
index 3a0ce6f689c..b5b80ebb80a 100644
--- a/src/db/PdoValue.php
+++ b/src/db/PdoValue.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/PdoValueBuilder.php b/framework/db/PdoValueBuilder.php
index 6e9d5720228..6bec24c94bd 100644
--- a/src/db/PdoValueBuilder.php
+++ b/src/db/PdoValueBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/Query.php b/framework/db/Query.php
index d23893b3bc7..f0b215859dc 100644
--- a/src/db/Query.php
+++ b/src/db/Query.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -42,7 +42,7 @@
  *
  * A more detailed usage guide on how to work with Query can be found in the [guide article on Query Builder](guide:db-query-builder).
  *
- * @property-read string[] $tablesUsedInFrom Table names indexed by aliases. This property is read-only.
+ * @property-read string[] $tablesUsedInFrom Table names indexed by aliases.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Carsten Brandt <mail@cebe.cc>
@@ -53,13 +53,13 @@ class Query extends Component implements QueryInterface, ExpressionInterface
     use QueryTrait;
 
     /**
-     * @var array the columns being selected. For example, `['id', 'name']`.
+     * @var array|null the columns being selected. For example, `['id', 'name']`.
      * This is used to construct the SELECT clause in a SQL statement. If not set, it means selecting all columns.
      * @see select()
      */
     public $select;
     /**
-     * @var string additional option that should be appended to the 'SELECT' keyword. For example,
+     * @var string|null additional option that should be appended to the 'SELECT' keyword. For example,
      * in MySQL, the option 'SQL_CALC_FOUND_ROWS' can be used.
      */
     public $selectOption;
@@ -67,20 +67,20 @@ class Query extends Component implements QueryInterface, ExpressionInterface
      * @var bool whether to select distinct rows of data only. If this is set true,
      * the SELECT clause would be changed to SELECT DISTINCT.
      */
-    public $distinct;
+    public $distinct = false;
     /**
-     * @var array the table(s) to be selected from. For example, `['user', 'post']`.
+     * @var array|null the table(s) to be selected from. For example, `['user', 'post']`.
      * This is used to construct the FROM clause in a SQL statement.
      * @see from()
      */
     public $from;
     /**
-     * @var array how to group the query results. For example, `['company', 'department']`.
+     * @var array|null how to group the query results. For example, `['company', 'department']`.
      * This is used to construct the GROUP BY clause in a SQL statement.
      */
     public $groupBy;
     /**
-     * @var array how to join with other tables. Each array element represents the specification
+     * @var array|null how to join with other tables. Each array element represents the specification
      * of one join which has the following structure:
      *
      * ```php
@@ -98,12 +98,12 @@ class Query extends Component implements QueryInterface, ExpressionInterface
      */
     public $join;
     /**
-     * @var string|array|ExpressionInterface the condition to be applied in the GROUP BY clause.
+     * @var string|array|ExpressionInterface|null the condition to be applied in the GROUP BY clause.
      * It can be either a string or an array. Please refer to [[where()]] on how to specify the condition.
      */
     public $having;
     /**
-     * @var array this is used to construct the UNION clause(s) in a SQL statement.
+     * @var array|null this is used to construct the UNION clause(s) in a SQL statement.
      * Each array element is an array of the following structure:
      *
      * - `query`: either a string or a [[Query]] object representing a query
@@ -111,7 +111,7 @@ class Query extends Component implements QueryInterface, ExpressionInterface
      */
     public $union;
     /**
-     * @var array this is used to construct the WITH section in a SQL query.
+     * @var array|null this is used to construct the WITH section in a SQL query.
      * Each array element is an array of the following structure:
      *
      * - `query`: either a string or a [[Query]] object representing a query
@@ -122,12 +122,12 @@ class Query extends Component implements QueryInterface, ExpressionInterface
      */
     public $withQueries;
     /**
-     * @var array list of query parameter values indexed by parameter placeholders.
+     * @var array|null list of query parameter values indexed by parameter placeholders.
      * For example, `[':name' => 'Dan', ':age' => 31]`.
      */
     public $params = [];
     /**
-     * @var int|true the default number of seconds that query results can remain valid in cache.
+     * @var int|bool|null the default number of seconds that query results can remain valid in cache.
      * Use 0 to indicate that the cached data will never expire.
      * Use a negative number to indicate that query cache should not be used.
      * Use boolean `true` to indicate that [[Connection::queryCacheDuration]] should be used.
@@ -136,7 +136,7 @@ class Query extends Component implements QueryInterface, ExpressionInterface
      */
     public $queryCacheDuration;
     /**
-     * @var \yii\caching\Dependency the dependency to be associated with the cached query result for this query
+     * @var \yii\caching\Dependency|null the dependency to be associated with the cached query result for this query
      * @see cache()
      * @since 2.0.14
      */
@@ -191,7 +191,7 @@ public function prepare($builder)
      * ```
      *
      * @param int $batchSize the number of records to be fetched in each batch.
-     * @param Connection $db the database connection. If not set, the "db" application component will be used.
+     * @param Connection|null $db the database connection. If not set, the "db" application component will be used.
      * @return BatchQueryResult the batch query result. It implements the [[\Iterator]] interface
      * and can be traversed to retrieve the data in batches.
      */
@@ -219,7 +219,7 @@ public function batch($batchSize = 100, $db = null)
      * ```
      *
      * @param int $batchSize the number of records to be fetched in each batch.
-     * @param Connection $db the database connection. If not set, the "db" application component will be used.
+     * @param Connection|null $db the database connection. If not set, the "db" application component will be used.
      * @return BatchQueryResult the batch query result. It implements the [[\Iterator]] interface
      * and can be traversed to retrieve the data in batches.
      */
@@ -290,7 +290,7 @@ public function one($db = null)
     /**
      * Returns the query result as a scalar value.
      * The value returned will be the first column in the first row of the query results.
-     * @param Connection $db the database connection used to generate the SQL statement.
+     * @param Connection|null $db the database connection used to generate the SQL statement.
      * If this parameter is not given, the `db` application component will be used.
      * @return string|int|null|false the value of the first column in the first row of the query result.
      * False is returned if the query result is empty.
@@ -372,7 +372,7 @@ public function count($q = '*', $db = null)
      * Returns the sum of the specified column values.
      * @param string $q the column name or expression.
      * Make sure you properly [quote](guide:db-dao#quoting-table-and-column-names) column names in the expression.
-     * @param Connection $db the database connection used to generate the SQL statement.
+     * @param Connection|null $db the database connection used to generate the SQL statement.
      * If this parameter is not given, the `db` application component will be used.
      * @return mixed the sum of the specified column values.
      */
@@ -389,7 +389,7 @@ public function sum($q, $db = null)
      * Returns the average of the specified column values.
      * @param string $q the column name or expression.
      * Make sure you properly [quote](guide:db-dao#quoting-table-and-column-names) column names in the expression.
-     * @param Connection $db the database connection used to generate the SQL statement.
+     * @param Connection|null $db the database connection used to generate the SQL statement.
      * If this parameter is not given, the `db` application component will be used.
      * @return mixed the average of the specified column values.
      */
@@ -452,7 +452,7 @@ public function exists($db = null)
      * @param string|ExpressionInterface $selectExpression
      * @param Connection|null $db the database connection used to execute the query.
      * @return bool|string|null
-     * @throws \Exception if can't create command
+     * @throws \Throwable if can't create command
      */
     protected function queryScalar($selectExpression, $db)
     {
@@ -633,7 +633,7 @@ private function ensureNameQuoted($name)
      * Starting from version 2.0.1, you may also select sub-queries as columns by specifying each such column
      * as a `Query` instance representing the sub-query.
      *
-     * @param string $option additional option that should be appended to the 'SELECT' keyword. For example,
+     * @param string|null $option additional option that should be appended to the 'SELECT' keyword. For example,
      * in MySQL, the option 'SQL_CALC_FOUND_ROWS' can be used.
      * @return $this the query object itself
      */
@@ -684,7 +684,7 @@ protected function normalizeSelect($columns)
         if ($columns instanceof ExpressionInterface) {
             $columns = [$columns];
         } elseif (!is_array($columns)) {
-            $columns = preg_split('/\s*,\s*/', trim($columns), -1, PREG_SPLIT_NO_EMPTY);
+            $columns = preg_split('/\s*,\s*/', trim((string)$columns), -1, PREG_SPLIT_NO_EMPTY);
         }
         $select = [];
         foreach ($columns as $columnAlias => $columnDefinition) {
@@ -921,7 +921,7 @@ public function orWhere($condition, $params = [])
      */
     public function andFilterCompare($name, $value, $defaultOperator = '=')
     {
-        if (preg_match('/^(<>|>=|>|<=|<|=)/', $value, $matches)) {
+        if (preg_match('/^(<>|>=|>|<=|<|=)/', (string)$value, $matches)) {
             $operator = $matches[1];
             $value = substr($value, strlen($operator));
         } else {
@@ -1324,7 +1324,7 @@ public function addParams($params)
      * Use a negative number to indicate that query cache should not be used.
      * Use boolean `true` to indicate that [[Connection::queryCacheDuration]] should be used.
      * Defaults to `true`.
-     * @param \yii\caching\Dependency $dependency the cache dependency associated with the cached result.
+     * @param \yii\caching\Dependency|null $dependency the cache dependency associated with the cached result.
      * @return $this the Query object itself
      * @since 2.0.14
      */
diff --git a/framework/db/QueryBuilder.php b/framework/db/QueryBuilder.php
index bb032d78830..b96ffe28eff 100644
--- a/src/db/QueryBuilder.php
+++ b/src/db/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -23,9 +23,9 @@
  * For more details and usage information on QueryBuilder, see the [guide article on query builders](guide:db-query-builder).
  *
  * @property-write string[] $conditionClasses Map of condition aliases to condition classes. For example:
- * ```php ['LIKE' => yii\db\condition\LikeCondition::class] ``` . This property is write-only.
+ * ```php ['LIKE' => yii\db\condition\LikeCondition::class] ``` .
  * @property-write string[] $expressionBuilders Array of builders that should be merged with the pre-defined
- * ones in [[expressionBuilders]] property. This property is write-only.
+ * ones in [[expressionBuilders]] property.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -506,7 +506,7 @@ public function batchInsert($table, $columns, $rows, &$params = [])
      * ```php
      * $sql = $queryBuilder->upsert('pages', [
      *     'name' => 'Front page',
-     *     'url' => 'http://example.com/', // url is unique
+     *     'url' => 'https://example.com/', // url is unique
      *     'visits' => 0,
      * ], [
      *     'visits' => new \yii\db\Expression('visits + 1'),
@@ -710,7 +710,7 @@ public function delete($table, $condition, &$params)
      *
      * @param string $table the name of the table to be created. The name will be properly quoted by the method.
      * @param array $columns the columns (name => definition) in the new table.
-     * @param string $options additional SQL fragment that will be appended to the generated SQL.
+     * @param string|null $options additional SQL fragment that will be appended to the generated SQL.
      * @return string the SQL statement for creating a new DB table.
      */
     public function createTable($table, $columns, $options = null)
@@ -863,8 +863,8 @@ public function alterColumn($table, $column, $type)
      * @param string $refTable the table that the foreign key references to.
      * @param string|array $refColumns the name of the column that the foreign key references to.
      * If there are multiple columns, separate them with commas or use an array to represent them.
-     * @param string $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
-     * @param string $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
      * @return string the SQL statement for adding a foreign key constraint to an existing table.
      */
     public function addForeignKey($name, $table, $columns, $refTable, $refColumns, $delete = null, $update = null)
@@ -1035,7 +1035,7 @@ public function dropDefaultValue($name, $table)
      * The sequence will be reset such that the primary key of the next new row inserted
      * will have the specified value or the maximum existing value +1.
      * @param string $table the name of the table whose primary key sequence will be reset
-     * @param array|string $value the value for the primary key of the next new row inserted. If this is not set,
+     * @param array|string|null $value the value for the primary key of the next new row inserted. If this is not set,
      * the next new row's primary key will have the maximum existing value +1.
      * @return string the SQL statement for resetting sequence
      * @throws NotSupportedException if this is not supported by the underlying DBMS
@@ -1051,7 +1051,7 @@ public function resetSequence($table, $value = null)
      * The sequence is reset such that the primary key of the next new row inserted
      * will have the specified value or the maximum existing value +1.
      * @param string $table the name of the table whose primary key sequence is reset
-     * @param array|string $value the value for the primary key of the next new row inserted. If this is not set,
+     * @param array|string|null $value the value for the primary key of the next new row inserted. If this is not set,
      * the next new row's primary key will have the maximum existing value +1.
      * @throws NotSupportedException if this is not supported by the underlying DBMS
      * @since 2.0.16
@@ -1228,7 +1228,7 @@ public function getColumnType($type)
      * @param array $columns
      * @param array $params the binding parameters to be populated
      * @param bool $distinct
-     * @param string $selectOption
+     * @param string|null $selectOption
      * @return string the SELECT clause built from [[Query::$select]].
      */
     public function buildSelect($columns, &$params, $distinct = false, $selectOption = null)
diff --git a/framework/db/QueryExpressionBuilder.php b/framework/db/QueryExpressionBuilder.php
index 3186d2b91cf..e811c053c99 100644
--- a/src/db/QueryExpressionBuilder.php
+++ b/src/db/QueryExpressionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/QueryInterface.php b/framework/db/QueryInterface.php
index 4f266f490a9..0f08d67c4ce 100644
--- a/src/db/QueryInterface.php
+++ b/src/db/QueryInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -24,7 +24,7 @@ interface QueryInterface
 {
     /**
      * Executes the query and returns all results as an array.
-     * @param Connection $db the database connection used to execute the query.
+     * @param Connection|null $db the database connection used to execute the query.
      * If this parameter is not given, the `db` application component will be used.
      * @return array the query results. If the query results in nothing, an empty array will be returned.
      */
@@ -32,7 +32,7 @@ public function all($db = null);
 
     /**
      * Executes the query and returns a single row of result.
-     * @param Connection $db the database connection used to execute the query.
+     * @param Connection|null $db the database connection used to execute the query.
      * If this parameter is not given, the `db` application component will be used.
      * @return array|bool the first row (in terms of an array) of the query result. False is returned if the query
      * results in nothing.
diff --git a/framework/db/QueryTrait.php b/framework/db/QueryTrait.php
index 9f6b06434b2..990520d4e5b 100644
--- a/src/db/QueryTrait.php
+++ b/src/db/QueryTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/Schema.php b/framework/db/Schema.php
index 71a6ea57759..002a68e2bf8 100644
--- a/src/db/Schema.php
+++ b/src/db/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -22,19 +22,17 @@
  * Schema represents the database schema information that is DBMS specific.
  *
  * @property-read string $lastInsertID The row ID of the last row inserted, or the last value retrieved from
- * the sequence object. This property is read-only.
- * @property-read QueryBuilder $queryBuilder The query builder for this connection. This property is
- * read-only.
- * @property-read string[] $schemaNames All schema names in the database, except system schemas. This property
- * is read-only.
- * @property-read string $serverVersion Server version as a string. This property is read-only.
- * @property-read string[] $tableNames All table names in the database. This property is read-only.
+ * the sequence object.
+ * @property-read QueryBuilder $queryBuilder The query builder for this connection.
+ * @property-read string[] $schemaNames All schema names in the database, except system schemas.
+ * @property-read string $serverVersion Server version as a string.
+ * @property-read string[] $tableNames All table names in the database.
  * @property-read TableSchema[] $tableSchemas The metadata for all tables in the database. Each array element
- * is an instance of [[TableSchema]] or its child class. This property is read-only.
+ * is an instance of [[TableSchema]] or its child class.
  * @property-write string $transactionIsolationLevel The transaction isolation level to use for this
  * transaction. This can be one of [[Transaction::READ_UNCOMMITTED]], [[Transaction::READ_COMMITTED]],
  * [[Transaction::REPEATABLE_READ]] and [[Transaction::SERIALIZABLE]] but also a string containing DBMS specific
- * syntax to be used after `SET TRANSACTION ISOLATION LEVEL`. This property is write-only.
+ * syntax to be used after `SET TRANSACTION ISOLATION LEVEL`.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Sergey Makinen <sergey@makinen.ru>
@@ -324,7 +322,7 @@ public function createQueryBuilder()
      * This method may be overridden by child classes to create a DBMS-specific column schema builder.
      *
      * @param string $type type of the column. See [[ColumnSchemaBuilder::$type]].
-     * @param int|string|array $length length or precision of the column. See [[ColumnSchemaBuilder::$length]].
+     * @param int|string|array|null $length length or precision of the column. See [[ColumnSchemaBuilder::$length]].
      * @return ColumnSchemaBuilder column schema builder instance
      * @since 2.0.6
      */
@@ -373,7 +371,7 @@ public function getLastInsertID($sequenceName = '')
     }
 
     /**
-     * @return bool whether this DBMS supports [savepoint](http://en.wikipedia.org/wiki/Savepoint).
+     * @return bool whether this DBMS supports [savepoint](https://en.wikipedia.org/wiki/Savepoint).
      */
     public function supportsSavepoint()
     {
@@ -413,7 +411,7 @@ public function rollBackSavepoint($name)
      * This can be one of [[Transaction::READ_UNCOMMITTED]], [[Transaction::READ_COMMITTED]], [[Transaction::REPEATABLE_READ]]
      * and [[Transaction::SERIALIZABLE]] but also a string containing DBMS specific syntax to be used
      * after `SET TRANSACTION ISOLATION LEVEL`.
-     * @see http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * @see https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      */
     public function setTransactionIsolationLevel($level)
     {
diff --git a/framework/db/SchemaBuilderTrait.php b/framework/db/SchemaBuilderTrait.php
index e57c4b0b78f..371a48ff977 100644
--- a/src/db/SchemaBuilderTrait.php
+++ b/src/db/SchemaBuilderTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -41,7 +41,7 @@ abstract protected function getDb();
 
     /**
      * Creates a primary key column.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -53,7 +53,7 @@ public function primaryKey($length = null)
 
     /**
      * Creates a big primary key column.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -65,7 +65,7 @@ public function bigPrimaryKey($length = null)
 
     /**
      * Creates a char column.
-     * @param int $length column size definition i.e. the maximum string length.
+     * @param int|null $length column size definition i.e. the maximum string length.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.8
@@ -77,7 +77,7 @@ public function char($length = null)
 
     /**
      * Creates a string column.
-     * @param int $length column size definition i.e. the maximum string length.
+     * @param int|null $length column size definition i.e. the maximum string length.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -99,7 +99,7 @@ public function text()
 
     /**
      * Creates a tinyint column. If tinyint is not supported by the DBMS, smallint will be used.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.14
@@ -111,7 +111,7 @@ public function tinyInteger($length = null)
 
     /**
      * Creates a smallint column.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -123,7 +123,7 @@ public function smallInteger($length = null)
 
     /**
      * Creates an integer column.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -135,7 +135,7 @@ public function integer($length = null)
 
     /**
      * Creates a bigint column.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -147,7 +147,7 @@ public function bigInteger($length = null)
 
     /**
      * Creates a float column.
-     * @param int $precision column value precision. First parameter passed to the column type, e.g. FLOAT(precision).
+     * @param int|null $precision column value precision. First parameter passed to the column type, e.g. FLOAT(precision).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -159,7 +159,7 @@ public function float($precision = null)
 
     /**
      * Creates a double column.
-     * @param int $precision column value precision. First parameter passed to the column type, e.g. DOUBLE(precision).
+     * @param int|null $precision column value precision. First parameter passed to the column type, e.g. DOUBLE(precision).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -171,10 +171,10 @@ public function double($precision = null)
 
     /**
      * Creates a decimal column.
-     * @param int $precision column value precision, which is usually the total number of digits.
+     * @param int|null $precision column value precision, which is usually the total number of digits.
      * First parameter passed to the column type, e.g. DECIMAL(precision, scale).
      * This parameter will be ignored if not supported by the DBMS.
-     * @param int $scale column value scale, which is usually the number of digits after the decimal point.
+     * @param int|null $scale column value scale, which is usually the number of digits after the decimal point.
      * Second parameter passed to the column type, e.g. DECIMAL(precision, scale).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
@@ -195,7 +195,7 @@ public function decimal($precision = null, $scale = null)
 
     /**
      * Creates a datetime column.
-     * @param int $precision column value precision. First parameter passed to the column type, e.g. DATETIME(precision).
+     * @param int|null $precision column value precision. First parameter passed to the column type, e.g. DATETIME(precision).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -207,7 +207,7 @@ public function dateTime($precision = null)
 
     /**
      * Creates a timestamp column.
-     * @param int $precision column value precision. First parameter passed to the column type, e.g. TIMESTAMP(precision).
+     * @param int|null $precision column value precision. First parameter passed to the column type, e.g. TIMESTAMP(precision).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -219,7 +219,7 @@ public function timestamp($precision = null)
 
     /**
      * Creates a time column.
-     * @param int $precision column value precision. First parameter passed to the column type, e.g. TIME(precision).
+     * @param int|null $precision column value precision. First parameter passed to the column type, e.g. TIME(precision).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -241,7 +241,7 @@ public function date()
 
     /**
      * Creates a binary column.
-     * @param int $length column size or precision definition.
+     * @param int|null $length column size or precision definition.
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
      * @since 2.0.6
@@ -263,10 +263,10 @@ public function boolean()
 
     /**
      * Creates a money column.
-     * @param int $precision column value precision, which is usually the total number of digits.
+     * @param int|null $precision column value precision, which is usually the total number of digits.
      * First parameter passed to the column type, e.g. DECIMAL(precision, scale).
      * This parameter will be ignored if not supported by the DBMS.
-     * @param int $scale column value scale, which is usually the number of digits after the decimal point.
+     * @param int|null $scale column value scale, which is usually the number of digits after the decimal point.
      * Second parameter passed to the column type, e.g. DECIMAL(precision, scale).
      * This parameter will be ignored if not supported by the DBMS.
      * @return ColumnSchemaBuilder the column instance which can be further customized.
diff --git a/framework/db/SqlToken.php b/framework/db/SqlToken.php
index fa570689cc3..ad9169ccff6 100644
--- a/src/db/SqlToken.php
+++ b/src/db/SqlToken.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -13,10 +13,9 @@
  * SqlToken represents SQL tokens produced by [[SqlTokenizer]] or its child classes.
  *
  * @property SqlToken[] $children Child tokens.
- * @property-read bool $hasChildren Whether the token has children. This property is read-only.
- * @property-read bool $isCollection Whether the token represents a collection of tokens. This property is
- * read-only.
- * @property-read string $sql SQL code. This property is read-only.
+ * @property-read bool $hasChildren Whether the token has children.
+ * @property-read bool $isCollection Whether the token represents a collection of tokens.
+ * @property-read string $sql SQL code.
  *
  * @author Sergey Makinen <sergey@makinen.ru>
  * @since 2.0.13
@@ -84,6 +83,7 @@ public function __toString()
      * @param int $offset child token offset.
      * @return bool whether the token exists.
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return isset($this->_children[$this->calculateOffset($offset)]);
@@ -96,6 +96,7 @@ public function offsetExists($offset)
      * @param int $offset child token offset.
      * @return SqlToken|null the child token at the specified offset, `null` if there's no token.
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         $offset = $this->calculateOffset($offset);
@@ -109,6 +110,7 @@ public function offsetGet($offset)
      * @param int|null $offset child token offset.
      * @param SqlToken $token token to be added.
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $token)
     {
         $token->parent = $this;
@@ -126,6 +128,7 @@ public function offsetSet($offset, $token)
      * It is implicitly called when you use something like `unset($token[$offset])`.
      * @param int $offset child token offset.
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         $offset = $this->calculateOffset($offset);
diff --git a/framework/db/SqlTokenizer.php b/framework/db/SqlTokenizer.php
index ea826ac74f2..175ed9d0edc 100644
--- a/src/db/SqlTokenizer.php
+++ b/src/db/SqlTokenizer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/StaleObjectException.php b/framework/db/StaleObjectException.php
index 386dbcf7de7..bd9be5845a4 100644
--- a/src/db/StaleObjectException.php
+++ b/src/db/StaleObjectException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/TableSchema.php b/framework/db/TableSchema.php
index 71a2350baec..1e7ccf084c4 100644
--- a/src/db/TableSchema.php
+++ b/src/db/TableSchema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -13,7 +13,7 @@
 /**
  * TableSchema represents the metadata of a database table.
  *
- * @property-read array $columnNames List of column names. This property is read-only.
+ * @property-read array $columnNames List of column names.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -39,7 +39,7 @@ class TableSchema extends BaseObject
      */
     public $primaryKey = [];
     /**
-     * @var string sequence name for the primary key. Null if no sequence.
+     * @var string|null sequence name for the primary key. Null if no sequence.
      */
     public $sequenceName;
     /**
diff --git a/framework/db/Transaction.php b/framework/db/Transaction.php
index 87e72dd18d1..55f56cf7eee 100644
--- a/src/db/Transaction.php
+++ b/src/db/Transaction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
@@ -40,12 +40,11 @@
  * > since PHP 7.0, so you can skip the part with `\Exception` if your app uses only PHP 7.0 and higher.
  *
  * @property-read bool $isActive Whether this transaction is active. Only an active transaction can
- * [[commit()]] or [[rollBack()]]. This property is read-only.
+ * [[commit()]] or [[rollBack()]].
  * @property-write string $isolationLevel The transaction isolation level to use for this transaction. This
  * can be one of [[READ_UNCOMMITTED]], [[READ_COMMITTED]], [[REPEATABLE_READ]] and [[SERIALIZABLE]] but also a
- * string containing DBMS specific syntax to be used after `SET TRANSACTION ISOLATION LEVEL`. This property is
- * write-only.
- * @property-read int $level The current nesting level of the transaction. This property is read-only.
+ * string containing DBMS specific syntax to be used after `SET TRANSACTION ISOLATION LEVEL`.
+ * @property-read int $level The current nesting level of the transaction.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -54,22 +53,22 @@ class Transaction extends \yii\base\BaseObject
 {
     /**
      * A constant representing the transaction isolation level `READ UNCOMMITTED`.
-     * @see http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * @see https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      */
     const READ_UNCOMMITTED = 'READ UNCOMMITTED';
     /**
      * A constant representing the transaction isolation level `READ COMMITTED`.
-     * @see http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * @see https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      */
     const READ_COMMITTED = 'READ COMMITTED';
     /**
      * A constant representing the transaction isolation level `REPEATABLE READ`.
-     * @see http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * @see https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      */
     const REPEATABLE_READ = 'REPEATABLE READ';
     /**
      * A constant representing the transaction isolation level `SERIALIZABLE`.
-     * @see http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * @see https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      */
     const SERIALIZABLE = 'SERIALIZABLE';
 
@@ -109,7 +108,7 @@ public function getIsActive()
      * you may need to set the isolation level for all transactions explicitly to avoid conflicting settings.
      * At the time of this writing affected DBMS are MSSQL and SQLite.
      *
-     * [isolation level]: http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * [isolation level]: https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      *
      * Starting from version 2.0.16, this method throws exception when beginning nested transaction and underlying DBMS
      * does not support savepoints.
@@ -228,7 +227,7 @@ public function rollBack()
      * This can be one of [[READ_UNCOMMITTED]], [[READ_COMMITTED]], [[REPEATABLE_READ]] and [[SERIALIZABLE]] but
      * also a string containing DBMS specific syntax to be used after `SET TRANSACTION ISOLATION LEVEL`.
      * @throws Exception if the transaction is not active
-     * @see http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
+     * @see https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Isolation_levels
      */
     public function setIsolationLevel($level)
     {
diff --git a/framework/db/ViewFinderTrait.php b/framework/db/ViewFinderTrait.php
index 566d0fc2e12..d259a8f678a 100644
--- a/src/db/ViewFinderTrait.php
+++ b/src/db/ViewFinderTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db;
diff --git a/framework/db/conditions/AndCondition.php b/framework/db/conditions/AndCondition.php
index 32382ed31ac..8a2dc7a87d9 100644
--- a/src/db/conditions/AndCondition.php
+++ b/src/db/conditions/AndCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/BetweenColumnsCondition.php b/framework/db/conditions/BetweenColumnsCondition.php
index 647c0af9093..93a61d1d110 100644
--- a/src/db/conditions/BetweenColumnsCondition.php
+++ b/src/db/conditions/BetweenColumnsCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/BetweenColumnsConditionBuilder.php b/framework/db/conditions/BetweenColumnsConditionBuilder.php
index 8a55bf4a3a6..0795d0f2f85 100644
--- a/src/db/conditions/BetweenColumnsConditionBuilder.php
+++ b/src/db/conditions/BetweenColumnsConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/BetweenCondition.php b/framework/db/conditions/BetweenCondition.php
index 159b1a6e046..ae12c43b9a4 100644
--- a/src/db/conditions/BetweenCondition.php
+++ b/src/db/conditions/BetweenCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/BetweenConditionBuilder.php b/framework/db/conditions/BetweenConditionBuilder.php
index 5247319033f..2af0a29fe7c 100644
--- a/src/db/conditions/BetweenConditionBuilder.php
+++ b/src/db/conditions/BetweenConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/ConditionInterface.php b/framework/db/conditions/ConditionInterface.php
index c3bbc2aed0b..fc8146940cf 100644
--- a/src/db/conditions/ConditionInterface.php
+++ b/src/db/conditions/ConditionInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/ConjunctionCondition.php b/framework/db/conditions/ConjunctionCondition.php
index 985b8fcd7ac..a35c23e83d6 100644
--- a/src/db/conditions/ConjunctionCondition.php
+++ b/src/db/conditions/ConjunctionCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/ConjunctionConditionBuilder.php b/framework/db/conditions/ConjunctionConditionBuilder.php
index 00a9bcebfc0..b026e4fc20e 100644
--- a/src/db/conditions/ConjunctionConditionBuilder.php
+++ b/src/db/conditions/ConjunctionConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/ExistsCondition.php b/framework/db/conditions/ExistsCondition.php
index 607db5fdcaf..344bf0f9604 100644
--- a/src/db/conditions/ExistsCondition.php
+++ b/src/db/conditions/ExistsCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/ExistsConditionBuilder.php b/framework/db/conditions/ExistsConditionBuilder.php
index e3ef3ea24d0..c7997d974cc 100644
--- a/src/db/conditions/ExistsConditionBuilder.php
+++ b/src/db/conditions/ExistsConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/HashCondition.php b/framework/db/conditions/HashCondition.php
index 7c25a5b1954..55747c048a4 100644
--- a/src/db/conditions/HashCondition.php
+++ b/src/db/conditions/HashCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/HashConditionBuilder.php b/framework/db/conditions/HashConditionBuilder.php
index 57928417c5a..9e0b5a48002 100644
--- a/src/db/conditions/HashConditionBuilder.php
+++ b/src/db/conditions/HashConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/InCondition.php b/framework/db/conditions/InCondition.php
index de30d372d07..78598c4e481 100644
--- a/src/db/conditions/InCondition.php
+++ b/src/db/conditions/InCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/InConditionBuilder.php b/framework/db/conditions/InConditionBuilder.php
index dd238b7a7ce..3717c226b1f 100644
--- a/src/db/conditions/InConditionBuilder.php
+++ b/src/db/conditions/InConditionBuilder.php
@@ -1,12 +1,13 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
 
+use yii\db\Expression;
 use yii\db\ExpressionBuilderInterface;
 use yii\db\ExpressionBuilderTrait;
 use yii\db\ExpressionInterface;
@@ -66,6 +67,10 @@ public function build(ExpressionInterface $expression, array &$params = [])
             $column = $column->current();
         }
 
+        if ($column instanceof Expression) {
+            $column = $column->expression;
+        }
+
         if (is_array($values)) {
             $rawValues = $values;
         } elseif ($values instanceof \Traversable) {
@@ -124,6 +129,10 @@ protected function buildValues(ConditionInterface $condition, $values, &$params)
             $column = $column->current();
         }
 
+        if ($column instanceof Expression) {
+            $column = $column->expression;
+        }
+
         foreach ($values as $i => $value) {
             if (is_array($value) || $value instanceof \ArrayAccess) {
                 $value = isset($value[$column]) ? $value[$column] : null;
@@ -155,6 +164,9 @@ protected function buildSubqueryInCondition($operator, $columns, $values, &$para
 
         if (is_array($columns)) {
             foreach ($columns as $i => $col) {
+                if ($col instanceof Expression) {
+                    $col = $col->expression;
+                }
                 if (strpos($col, '(') === false) {
                     $columns[$i] = $this->queryBuilder->db->quoteColumnName($col);
                 }
@@ -163,6 +175,9 @@ protected function buildSubqueryInCondition($operator, $columns, $values, &$para
             return '(' . implode(', ', $columns) . ") $operator $sql";
         }
 
+        if ($columns instanceof Expression) {
+            $columns = $columns->expression;
+        }
         if (strpos($columns, '(') === false) {
             $columns = $this->queryBuilder->db->quoteColumnName($columns);
         }
@@ -185,6 +200,9 @@ protected function buildCompositeInCondition($operator, $columns, $values, &$par
         foreach ($values as $value) {
             $vs = [];
             foreach ($columns as $column) {
+                if ($column instanceof Expression) {
+                    $column = $column->expression;
+                }
                 if (isset($value[$column])) {
                     $vs[] = $this->queryBuilder->bindParam($value[$column], $params);
                 } else {
@@ -200,6 +218,9 @@ protected function buildCompositeInCondition($operator, $columns, $values, &$par
 
         $sqlColumns = [];
         foreach ($columns as $i => $column) {
+            if ($column instanceof Expression) {
+                $column = $column->expression;
+            }
             $sqlColumns[] = strpos($column, '(') === false ? $this->queryBuilder->db->quoteColumnName($column) : $column;
         }
 
diff --git a/framework/db/conditions/LikeCondition.php b/framework/db/conditions/LikeCondition.php
index 3586adfff27..f4684d3f54f 100644
--- a/src/db/conditions/LikeCondition.php
+++ b/src/db/conditions/LikeCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
@@ -18,7 +18,7 @@
 class LikeCondition extends SimpleCondition
 {
     /**
-     * @var array|false map of chars to their replacements, false if characters should not be escaped
+     * @var array|null|false map of chars to their replacements, false if characters should not be escaped
      * or either null or empty array if escaping is condition builder responsibility.
      * By default it's set to `null`.
      */
diff --git a/framework/db/conditions/LikeConditionBuilder.php b/framework/db/conditions/LikeConditionBuilder.php
index 140e3e6a227..049be5b92ec 100644
--- a/src/db/conditions/LikeConditionBuilder.php
+++ b/src/db/conditions/LikeConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/NotCondition.php b/framework/db/conditions/NotCondition.php
index f176620b8d9..c06530187af 100644
--- a/src/db/conditions/NotCondition.php
+++ b/src/db/conditions/NotCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/NotConditionBuilder.php b/framework/db/conditions/NotConditionBuilder.php
index 1023b7f62d4..23772621f97 100644
--- a/src/db/conditions/NotConditionBuilder.php
+++ b/src/db/conditions/NotConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/OrCondition.php b/framework/db/conditions/OrCondition.php
index f70d2da853e..44472056bb2 100644
--- a/src/db/conditions/OrCondition.php
+++ b/src/db/conditions/OrCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/SimpleCondition.php b/framework/db/conditions/SimpleCondition.php
index ba27d1555f3..f785d4f5ce9 100644
--- a/src/db/conditions/SimpleCondition.php
+++ b/src/db/conditions/SimpleCondition.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/conditions/SimpleConditionBuilder.php b/framework/db/conditions/SimpleConditionBuilder.php
index 17920972778..00a75115b8e 100644
--- a/src/db/conditions/SimpleConditionBuilder.php
+++ b/src/db/conditions/SimpleConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\conditions;
diff --git a/framework/db/cubrid/ColumnSchemaBuilder.php b/framework/db/cubrid/ColumnSchemaBuilder.php
index 1b077ec0615..e3f402b0374 100644
--- a/src/db/cubrid/ColumnSchemaBuilder.php
+++ b/src/db/cubrid/ColumnSchemaBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\cubrid;
diff --git a/framework/db/cubrid/QueryBuilder.php b/framework/db/cubrid/QueryBuilder.php
index 6ebbc5845c2..72ac4df6ef0 100644
--- a/src/db/cubrid/QueryBuilder.php
+++ b/src/db/cubrid/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\cubrid;
@@ -156,7 +156,7 @@ public function buildLimit($limit, $offset)
     {
         $sql = '';
         // limit is not optional in CUBRID
-        // http://www.cubrid.org/manual/90/en/LIMIT%20Clause
+        // https://www.cubrid.org/manual/en/9.3.0/sql/query/select.html#limit-clause
         // "You can specify a very big integer for row_count to display to the last row, starting from a specific row."
         if ($this->hasLimit($limit)) {
             $sql = 'LIMIT ' . $limit;
@@ -181,7 +181,7 @@ public function selectExists($rawSql)
 
     /**
      * {@inheritdoc}
-     * @see http://www.cubrid.org/manual/93/en/sql/schema/table.html#drop-index-clause
+     * @see https://www.cubrid.org/manual/en/9.3.0/sql/schema/table.html#drop-index-clause
      */
     public function dropIndex($name, $table)
     {
@@ -263,7 +263,7 @@ public function dropCommentFromTable($table)
      *
      * @param string $table table name
      * @param string $column column name
-     * @return null|string the column definition
+     * @return string|null the column definition
      * @throws Exception in case when table does not contain column
      * @since 2.0.8
      */
diff --git a/framework/db/cubrid/Schema.php b/framework/db/cubrid/Schema.php
index 73a06c4d130..f2e0e3643c8 100644
--- a/src/db/cubrid/Schema.php
+++ b/src/db/cubrid/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\cubrid;
@@ -30,7 +30,7 @@ class Schema extends \yii\db\Schema implements ConstraintFinderInterface
 
     /**
      * @var array mapping from physical column types (keys) to abstract column types (values)
-     * Please refer to [CUBRID manual](http://www.cubrid.org/manual/91/en/sql/datatype.html) for
+     * Please refer to [CUBRID manual](https://www.cubrid.org/manual/en/9.3.0/sql/datatype.html) for
      * details on data types.
      */
     public $typeMap = [
@@ -345,7 +345,7 @@ public function getPdoType($data)
 
     /**
      * {@inheritdoc}
-     * @see http://www.cubrid.org/manual/91/en/sql/transaction.html#database-concurrency
+     * @see https://www.cubrid.org/manual/en/9.3.0/sql/transaction.html#database-concurrency
      */
     public function setTransactionIsolationLevel($level)
     {
diff --git a/framework/db/cubrid/conditions/LikeConditionBuilder.php b/framework/db/cubrid/conditions/LikeConditionBuilder.php
index c6ea75ed774..80cd27173ea 100644
--- a/src/db/cubrid/conditions/LikeConditionBuilder.php
+++ b/src/db/cubrid/conditions/LikeConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\cubrid\conditions;
diff --git a/framework/db/mssql/ColumnSchema.php b/framework/db/mssql/ColumnSchema.php
index 78895d6031f..8d9f5fae860 100644
--- a/src/db/mssql/ColumnSchema.php
+++ b/src/db/mssql/ColumnSchema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
diff --git a/framework/db/mssql/ColumnSchemaBuilder.php b/framework/db/mssql/ColumnSchemaBuilder.php
index f95d9dd98eb..4523f332475 100644
--- a/src/db/mssql/ColumnSchemaBuilder.php
+++ b/src/db/mssql/ColumnSchemaBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
@@ -13,9 +13,8 @@
 /**
  * ColumnSchemaBuilder is the schema builder for MSSQL databases.
  *
- * @property-read string|null $checkValue The `CHECK` constraint for the column. This property is read-only.
- * @property-read string|Expression|null $defaultValue Default value of the column. This property is
- * read-only.
+ * @property-read string|null $checkValue The `CHECK` constraint for the column.
+ * @property-read string|Expression|null $defaultValue Default value of the column.
  *
  * @author Valerii Gorbachev <darkdef@gmail.com>
  * @since 2.0.42
diff --git a/framework/db/mssql/DBLibPDO.php b/framework/db/mssql/DBLibPDO.php
index 1500131f633..6c2fbc97ea5 100644
--- a/src/db/mssql/DBLibPDO.php
+++ b/src/db/mssql/DBLibPDO.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
@@ -21,6 +21,7 @@ class DBLibPDO extends \PDO
      * @param string|null $name the sequence name. Defaults to null.
      * @return int last inserted ID value.
      */
+    #[\ReturnTypeWillChange]
     public function lastInsertId($name = null)
     {
         return $this->query('SELECT CAST(COALESCE(SCOPE_IDENTITY(), @@IDENTITY) AS bigint)')->fetchColumn();
@@ -35,6 +36,7 @@ public function lastInsertId($name = null)
      * @return mixed A successful call returns the value of the requested PDO attribute.
      * An unsuccessful call returns null.
      */
+    #[\ReturnTypeWillChange]
     public function getAttribute($attribute)
     {
         try {
diff --git a/framework/db/mssql/PDO.php b/framework/db/mssql/PDO.php
index 005774c45cc..acbc9cc8b4e 100644
--- a/src/db/mssql/PDO.php
+++ b/src/db/mssql/PDO.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
@@ -21,6 +21,7 @@ class PDO extends \PDO
      * @param string|null $sequence the sequence name. Defaults to null.
      * @return int last inserted ID value.
      */
+    #[\ReturnTypeWillChange]
     public function lastInsertId($sequence = null)
     {
         return $this->query('SELECT CAST(COALESCE(SCOPE_IDENTITY(), @@IDENTITY) AS bigint)')->fetchColumn();
@@ -31,6 +32,7 @@ public function lastInsertId($sequence = null)
      * natively support transactions.
      * @return bool the result of a transaction start.
      */
+    #[\ReturnTypeWillChange]
     public function beginTransaction()
     {
         $this->exec('BEGIN TRANSACTION');
@@ -43,6 +45,7 @@ public function beginTransaction()
      * natively support transactions.
      * @return bool the result of a transaction commit.
      */
+    #[\ReturnTypeWillChange]
     public function commit()
     {
         $this->exec('COMMIT TRANSACTION');
@@ -55,6 +58,7 @@ public function commit()
      * natively support transactions.
      * @return bool the result of a transaction roll back.
      */
+    #[\ReturnTypeWillChange]
     public function rollBack()
     {
         $this->exec('ROLLBACK TRANSACTION');
@@ -71,6 +75,7 @@ public function rollBack()
      * @return mixed A successful call returns the value of the requested PDO attribute.
      * An unsuccessful call returns null.
      */
+    #[\ReturnTypeWillChange]
     public function getAttribute($attribute)
     {
         try {
diff --git a/framework/db/mssql/QueryBuilder.php b/framework/db/mssql/QueryBuilder.php
index 79c5d3d180f..8094f1dd3c8 100644
--- a/src/db/mssql/QueryBuilder.php
+++ b/src/db/mssql/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
@@ -293,7 +293,7 @@ public function checkIntegrity($check = true, $schema = '', $table = '')
       * @param string $comment the text of the comment to be added. The comment will be properly quoted by the method.
       * @param string $table the table to be commented or whose column is to be commented. The table name will be
       * properly quoted by the method.
-      * @param string $column optional. The name of the column to be commented. If empty, the command will add the
+      * @param string|null $column optional. The name of the column to be commented. If empty, the command will add the
       * comment to the table instead. The column name will be properly quoted by the method.
       * @return string the SQL statement for adding a comment.
       * @throws InvalidArgumentException if the table does not exist.
@@ -359,7 +359,7 @@ public function addCommentOnTable($table, $comment)
      *
      * @param string $table the table that will have the comment removed or whose column will have the comment removed.
      * The table name will be properly quoted by the method.
-     * @param string $column optional. The name of the column whose comment will be removed. If empty, the command
+     * @param string|null $column optional. The name of the column whose comment will be removed. If empty, the command
      * will remove the comment from the table instead. The column name will be properly quoted by the method.
      * @return string the SQL statement for removing the comment.
      * @throws InvalidArgumentException if the table does not exist.
@@ -415,7 +415,7 @@ public function dropCommentFromTable($table)
     /**
      * Returns an array of column names given model name.
      *
-     * @param string $modelClass name of the model class
+     * @param string|null $modelClass name of the model class
      * @return array|null array of column names
      */
     protected function getAllColumnNames($modelClass = null)
@@ -519,7 +519,7 @@ public function insert($table, $columns, &$params)
     /**
      * {@inheritdoc}
      * @see https://docs.microsoft.com/en-us/sql/t-sql/statements/merge-transact-sql
-     * @see http://weblogs.sqlteam.com/dang/archive/2009/01/31/UPSERT-Race-Condition-With-MERGE.aspx
+     * @see https://weblogs.sqlteam.com/dang/2009/01/31/upsert-race-condition-with-merge/
      */
     public function upsert($table, $insertColumns, $updateColumns, &$params)
     {
diff --git a/framework/db/mssql/Schema.php b/framework/db/mssql/Schema.php
index cb451e68d12..640b6ad093a 100644
--- a/src/db/mssql/Schema.php
+++ b/src/db/mssql/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
diff --git a/framework/db/mssql/SqlsrvPDO.php b/framework/db/mssql/SqlsrvPDO.php
index e248b1cc6ca..4285e220df0 100644
--- a/src/db/mssql/SqlsrvPDO.php
+++ b/src/db/mssql/SqlsrvPDO.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
@@ -26,6 +26,7 @@ class SqlsrvPDO extends \PDO
      * @param string|null $sequence the sequence name. Defaults to null.
      * @return int last inserted ID value.
      */
+    #[\ReturnTypeWillChange]
     public function lastInsertId($sequence = null)
     {
         return !$sequence ? parent::lastInsertId() : parent::lastInsertId($sequence);
diff --git a/framework/db/mssql/TableSchema.php b/framework/db/mssql/TableSchema.php
index 05268ea31fa..85c31a2f9f0 100644
--- a/src/db/mssql/TableSchema.php
+++ b/src/db/mssql/TableSchema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql;
@@ -16,7 +16,7 @@
 class TableSchema extends \yii\db\TableSchema
 {
     /**
-     * @var string name of the catalog (database) that this table belongs to.
+     * @var string|null name of the catalog (database) that this table belongs to.
      * Defaults to null, meaning no catalog (or the current database).
      */
     public $catalogName;
diff --git a/framework/db/mssql/conditions/InConditionBuilder.php b/framework/db/mssql/conditions/InConditionBuilder.php
index 7892b545569..fcfaf2e43ae 100644
--- a/src/db/mssql/conditions/InConditionBuilder.php
+++ b/src/db/mssql/conditions/InConditionBuilder.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql\conditions;
 
 use yii\base\NotSupportedException;
+use yii\db\Expression;
 
 /**
  * {@inheritdoc}
@@ -37,12 +38,18 @@ protected function buildCompositeInCondition($operator, $columns, $values, &$par
     {
         $quotedColumns = [];
         foreach ($columns as $i => $column) {
+            if ($column instanceof Expression) {
+                $column = $column->expression;
+            }
             $quotedColumns[$i] = strpos($column, '(') === false ? $this->queryBuilder->db->quoteColumnName($column) : $column;
         }
         $vss = [];
         foreach ($values as $value) {
             $vs = [];
             foreach ($columns as $i => $column) {
+                if ($column instanceof Expression) {
+                    $column = $column->expression;
+                }
                 if (isset($value[$column])) {
                     $phName = $this->queryBuilder->bindParam($value[$column], $params);
                     $vs[] = $quotedColumns[$i] . ($operator === 'IN' ? ' = ' : ' != ') . $phName;
diff --git a/framework/db/mssql/conditions/LikeConditionBuilder.php b/framework/db/mssql/conditions/LikeConditionBuilder.php
index f96cd2aadb2..a089f99935c 100644
--- a/src/db/mssql/conditions/LikeConditionBuilder.php
+++ b/src/db/mssql/conditions/LikeConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mssql\conditions;
diff --git a/framework/db/mysql/ColumnSchema.php b/framework/db/mysql/ColumnSchema.php
index 7645b1f0c4e..ca9c48703b3 100644
--- a/src/db/mysql/ColumnSchema.php
+++ b/src/db/mysql/ColumnSchema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mysql;
diff --git a/framework/db/mysql/ColumnSchemaBuilder.php b/framework/db/mysql/ColumnSchemaBuilder.php
index de5740dc642..dbf507e0f89 100644
--- a/src/db/mysql/ColumnSchemaBuilder.php
+++ b/src/db/mysql/ColumnSchemaBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mysql;
diff --git a/framework/db/mysql/JsonExpressionBuilder.php b/framework/db/mysql/JsonExpressionBuilder.php
index 18fa82474bb..99924ced06a 100644
--- a/src/db/mysql/JsonExpressionBuilder.php
+++ b/src/db/mysql/JsonExpressionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mysql;
diff --git a/framework/db/mysql/QueryBuilder.php b/framework/db/mysql/QueryBuilder.php
index 6ef2f30dbfe..ac3420c3972 100644
--- a/src/db/mysql/QueryBuilder.php
+++ b/src/db/mysql/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mysql;
@@ -223,8 +223,8 @@ public function buildLimit($limit, $offset)
             }
         } elseif ($this->hasOffset($offset)) {
             // limit is not optional in MySQL
-            // http://stackoverflow.com/a/271650/1106908
-            // http://dev.mysql.com/doc/refman/5.0/en/select.html#idm47619502796240
+            // https://stackoverflow.com/questions/255517/mysql-offset-infinite-rows/271650#271650
+            // https://dev.mysql.com/doc/refman/5.7/en/select.html#idm46193796386608
             $sql = "LIMIT $offset, 18446744073709551615"; // 2^64-1
         }
 
@@ -357,7 +357,7 @@ public function dropCommentFromTable($table)
      *
      * @param string $table table name
      * @param string $column column name
-     * @return null|string the column definition
+     * @return string|null the column definition
      * @throws Exception in case when table does not contain column
      */
     private function getColumnDefinition($table, $column)
diff --git a/framework/db/mysql/Schema.php b/framework/db/mysql/Schema.php
index 90ecd314290..aec698d9d97 100644
--- a/src/db/mysql/Schema.php
+++ b/src/db/mysql/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\mysql;
@@ -294,10 +294,11 @@ protected function loadColumnSchema($info)
              * See details here: https://mariadb.com/kb/en/library/now/#description
              */
             if (($column->type === 'timestamp' || $column->type === 'datetime')
+                && isset($info['default'])
                 && preg_match('/^current_timestamp(?:\(([0-9]*)\))?$/i', $info['default'], $matches)) {
                 $column->defaultValue = new Expression('CURRENT_TIMESTAMP' . (!empty($matches[1]) ? '(' . $matches[1] . ')' : ''));
             } elseif (isset($type) && $type === 'bit') {
-                $column->defaultValue = bindec(trim($info['default'], 'b\''));
+                $column->defaultValue = bindec(trim(isset($info['default']) ? $info['default'] : '', 'b\''));
             } else {
                 $column->defaultValue = $column->phpTypecast($info['default']);
             }
diff --git a/framework/db/oci/ColumnSchemaBuilder.php b/framework/db/oci/ColumnSchemaBuilder.php
index 545d34606ca..dcb5ff21ef8 100644
--- a/src/db/oci/ColumnSchemaBuilder.php
+++ b/src/db/oci/ColumnSchemaBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\oci;
diff --git a/framework/db/oci/Command.php b/framework/db/oci/Command.php
index 8f7edc6d3e3..f336d30cc4e 100644
--- a/src/db/oci/Command.php
+++ b/src/db/oci/Command.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\oci;
diff --git a/framework/db/oci/QueryBuilder.php b/framework/db/oci/QueryBuilder.php
index f4e6b3db706..170d118c17d 100644
--- a/src/db/oci/QueryBuilder.php
+++ b/src/db/oci/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\oci;
diff --git a/framework/db/oci/Schema.php b/framework/db/oci/Schema.php
index cba0b206a76..5e581441892 100644
--- a/src/db/oci/Schema.php
+++ b/src/db/oci/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\oci;
@@ -25,7 +25,7 @@
  * Schema is the class for retrieving metadata from an Oracle database.
  *
  * @property-read string $lastInsertID The row ID of the last row inserted, or the last value retrieved from
- * the sequence object. This property is read-only.
+ * the sequence object.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -411,10 +411,10 @@ protected function createColumn($column)
         $c->phpType = $this->getColumnPhpType($c);
 
         if (!$c->isPrimaryKey) {
-            if (stripos($column['DATA_DEFAULT'], 'timestamp') !== false) {
+            if (stripos((string) $column['DATA_DEFAULT'], 'timestamp') !== false) {
                 $c->defaultValue = null;
             } else {
-                $defaultValue = $column['DATA_DEFAULT'];
+                $defaultValue = (string) $column['DATA_DEFAULT'];
                 if ($c->type === 'timestamp' && $defaultValue === 'CURRENT_TIMESTAMP') {
                     $c->defaultValue = new Expression('CURRENT_TIMESTAMP');
                 } else {
@@ -594,9 +594,9 @@ protected function extractColumnType($column, $dbType, $precision, $scale, $leng
      */
     protected function extractColumnSize($column, $dbType, $precision, $scale, $length)
     {
-        $column->size = trim($length) === '' ? null : (int) $length;
-        $column->precision = trim($precision) === '' ? null : (int) $precision;
-        $column->scale = trim($scale) === '' ? null : (int) $scale;
+        $column->size = trim((string) $length) === '' ? null : (int) $length;
+        $column->precision = trim((string) $precision) === '' ? null : (int) $precision;
+        $column->scale = trim((string) $scale) === '' ? null : (int) $scale;
     }
 
     /**
diff --git a/framework/db/oci/conditions/InConditionBuilder.php b/framework/db/oci/conditions/InConditionBuilder.php
index 2a947759e94..bb6b2bf0709 100644
--- a/src/db/oci/conditions/InConditionBuilder.php
+++ b/src/db/oci/conditions/InConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\oci\conditions;
@@ -39,7 +39,7 @@ public function build(ExpressionInterface $expression, array &$params = [])
      *
      * @param ExpressionInterface|InCondition $condition the expression to be built.
      * @param array $params the binding parameters.
-     * @return null|string null when split is not required. Otherwise - built SQL condition.
+     * @return string|null null when split is not required. Otherwise - built SQL condition.
      */
     protected function splitCondition(InCondition $condition, &$params)
     {
diff --git a/framework/db/oci/conditions/LikeConditionBuilder.php b/framework/db/oci/conditions/LikeConditionBuilder.php
index a8c0c2ab920..e20c91e3953 100644
--- a/src/db/oci/conditions/LikeConditionBuilder.php
+++ b/src/db/oci/conditions/LikeConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\oci\conditions;
diff --git a/framework/db/pgsql/ArrayExpressionBuilder.php b/framework/db/pgsql/ArrayExpressionBuilder.php
index 6eb86eb1f61..76972542d9e 100644
--- a/src/db/pgsql/ArrayExpressionBuilder.php
+++ b/src/db/pgsql/ArrayExpressionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\pgsql;
diff --git a/framework/db/pgsql/ArrayParser.php b/framework/db/pgsql/ArrayParser.php
index 8ce08b24f5a..50a204e3c5d 100644
--- a/src/db/pgsql/ArrayParser.php
+++ b/src/db/pgsql/ArrayParser.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\pgsql;
@@ -80,7 +80,7 @@ private function parseArray($value, &$i = 0)
      *
      * @param string $value
      * @param int $i parse starting position
-     * @return null|string
+     * @return string|null
      */
     private function parseString($value, &$i)
     {
diff --git a/framework/db/pgsql/ColumnSchema.php b/framework/db/pgsql/ColumnSchema.php
index b93ad3c145c..33d97bbdf55 100644
--- a/src/db/pgsql/ColumnSchema.php
+++ b/src/db/pgsql/ColumnSchema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\pgsql;
diff --git a/framework/db/pgsql/JsonExpressionBuilder.php b/framework/db/pgsql/JsonExpressionBuilder.php
index e8ea47452d6..ab99f34fbd4 100644
--- a/src/db/pgsql/JsonExpressionBuilder.php
+++ b/src/db/pgsql/JsonExpressionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\pgsql;
diff --git a/framework/db/pgsql/QueryBuilder.php b/framework/db/pgsql/QueryBuilder.php
index fa546c6d986..be990dc0065 100644
--- a/src/db/pgsql/QueryBuilder.php
+++ b/src/db/pgsql/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\pgsql;
@@ -113,7 +113,7 @@ protected function defaultExpressionBuilders()
      * a unique index, `false` to make a non-unique index using the default index type, or one of the following constants to specify
      * the index method to use: [[INDEX_B_TREE]], [[INDEX_HASH]], [[INDEX_GIST]], [[INDEX_GIN]].
      * @return string the SQL statement for creating a new index.
-     * @see http://www.postgresql.org/docs/8.2/static/sql-createindex.html
+     * @see https://www.postgresql.org/docs/8.2/sql-createindex.html
      */
     public function createIndex($name, $table, $columns, $unique = false)
     {
@@ -181,7 +181,7 @@ public function resetSequence($tableName, $value = null)
     {
         $table = $this->db->getTableSchema($tableName);
         if ($table !== null && $table->sequenceName !== null) {
-            // c.f. http://www.postgresql.org/docs/8.1/static/functions-sequence.html
+            // c.f. https://www.postgresql.org/docs/8.1/functions-sequence.html
             $sequence = $this->db->quoteTableName($table->sequenceName);
             $tableName = $this->db->quoteTableName($tableName);
             if ($value === null) {
@@ -253,7 +253,7 @@ public function alterColumn($table, $column, $type)
         $tableName = $this->db->quoteTableName($table);
 
         // https://github.com/yiisoft/yii2/issues/4492
-        // http://www.postgresql.org/docs/9.1/static/sql-altertable.html
+        // https://www.postgresql.org/docs/9.1/sql-altertable.html
         if (preg_match('/^(DROP|SET|RESET)\s+/i', $type)) {
             return "ALTER TABLE {$tableName} ALTER COLUMN {$columnName} {$type}";
         }
@@ -463,7 +463,7 @@ public function update($table, $columns, $condition, &$params)
      * @param array|Query $columns the column data (name => value) to be saved into the table or instance
      * of [[yii\db\Query|Query]] to perform INSERT INTO ... SELECT SQL statement.
      * Passing of [[yii\db\Query|Query]] is available since version 2.0.11.
-     * @return array normalized columns
+     * @return array|Query normalized columns
      * @since 2.0.9
      */
     private function normalizeTableRowData($table, $columns)
diff --git a/framework/db/pgsql/Schema.php b/framework/db/pgsql/Schema.php
index 7f6b9d018cc..8fb5943b92b 100644
--- a/src/db/pgsql/Schema.php
+++ b/src/db/pgsql/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\pgsql;
@@ -44,7 +44,7 @@ class Schema extends \yii\db\Schema implements ConstraintFinderInterface
     /**
      * @var array mapping from physical column types (keys) to abstract
      * column types (values)
-     * @see http://www.postgresql.org/docs/current/static/datatype.html#DATATYPE-TABLE
+     * @see https://www.postgresql.org/docs/current/datatype.html#DATATYPE-TABLE
      */
     public $typeMap = [
         'bit' => self::TYPE_INTEGER,
@@ -339,7 +339,7 @@ protected function findConstraints($table)
         $tableSchema = $this->quoteValue($table->schemaName);
 
         //We need to extract the constraints de hard way since:
-        //http://www.postgresql.org/message-id/26677.1086673982@sss.pgh.pa.us
+        //https://www.postgresql.org/message-id/26677.1086673982@sss.pgh.pa.us
 
         $sql = <<<SQL
 select
diff --git a/framework/db/sqlite/ColumnSchemaBuilder.php b/framework/db/sqlite/ColumnSchemaBuilder.php
index 763552cf0a7..d9853b08ab3 100644
--- a/src/db/sqlite/ColumnSchemaBuilder.php
+++ b/src/db/sqlite/ColumnSchemaBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite;
diff --git a/framework/db/sqlite/Command.php b/framework/db/sqlite/Command.php
index 58066fd3657..36b2b731241 100644
--- a/src/db/sqlite/Command.php
+++ b/src/db/sqlite/Command.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite;
diff --git a/framework/db/sqlite/QueryBuilder.php b/framework/db/sqlite/QueryBuilder.php
index dcf3dfc267f..18abffa8ebd 100644
--- a/src/db/sqlite/QueryBuilder.php
+++ b/src/db/sqlite/QueryBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite;
@@ -140,7 +140,7 @@ public function batchInsert($table, $columns, $rows, &$params = [])
         }
 
         // SQLite supports batch insert natively since 3.7.11
-        // http://www.sqlite.org/releaselog/3_7_11.html
+        // https://www.sqlite.org/releaselog/3_7_11.html
         $this->db->open(); // ensure pdo is not null
         if (version_compare($this->db->getServerVersion(), '3.7.11', '>=')) {
             return parent::batchInsert($table, $columns, $rows, $params);
@@ -290,8 +290,8 @@ public function renameColumn($table, $oldName, $newName)
      * @param string $refTable the table that the foreign key references to.
      * @param string|array $refColumns the name of the column that the foreign key references to.
      * If there are multiple columns, separate them with commas or use an array to represent them.
-     * @param string $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
-     * @param string $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $delete the ON DELETE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
+     * @param string|null $update the ON UPDATE option. Most DBMS support these options: RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL
      * @return string the SQL statement for adding a foreign key constraint to an existing table.
      * @throws NotSupportedException this is not supported by SQLite
      */
@@ -472,7 +472,7 @@ public function buildLimit($limit, $offset)
             }
         } elseif ($this->hasOffset($offset)) {
             // limit is not optional in SQLite
-            // http://www.sqlite.org/syntaxdiagrams.html#select-stmt
+            // https://www.sqlite.org/syntaxdiagrams.html#select-stmt
             $sql = "LIMIT 9223372036854775807 OFFSET $offset"; // 2^63-1
         }
 
diff --git a/framework/db/sqlite/Schema.php b/framework/db/sqlite/Schema.php
index 0b5a0cc8ec9..2ccd2be1ba1 100644
--- a/src/db/sqlite/Schema.php
+++ b/src/db/sqlite/Schema.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite;
@@ -25,8 +25,7 @@
  * Schema is the class for retrieving metadata from a SQLite (2/3) database.
  *
  * @property-write string $transactionIsolationLevel The transaction isolation level to use for this
- * transaction. This can be either [[Transaction::READ_UNCOMMITTED]] or [[Transaction::SERIALIZABLE]]. This
- * property is write-only.
+ * transaction. This can be either [[Transaction::READ_UNCOMMITTED]] or [[Transaction::SERIALIZABLE]].
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -363,7 +362,7 @@ protected function loadColumnSchema($info)
      * This can be either [[Transaction::READ_UNCOMMITTED]] or [[Transaction::SERIALIZABLE]].
      * @throws NotSupportedException when unsupported isolation levels are used.
      * SQLite only supports SERIALIZABLE and READ UNCOMMITTED.
-     * @see http://www.sqlite.org/pragma.html#pragma_read_uncommitted
+     * @see https://www.sqlite.org/pragma.html#pragma_read_uncommitted
      */
     public function setTransactionIsolationLevel($level)
     {
diff --git a/framework/db/sqlite/SqlTokenizer.php b/framework/db/sqlite/SqlTokenizer.php
index 7a8aecb6ab8..fe92680dc75 100644
--- a/src/db/sqlite/SqlTokenizer.php
+++ b/src/db/sqlite/SqlTokenizer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite;
@@ -11,7 +11,7 @@
  * SqlTokenizer splits SQLite query into individual SQL tokens.
  * It's used to obtain a `CHECK` constraint information from a `CREATE TABLE` SQL code.
  *
- * @see http://www.sqlite.org/draft/tokenreq.html
+ * @see https://www.sqlite.org/draft/tokenreq.html
  * @see https://sqlite.org/lang.html
  * @author Sergey Makinen <sergey@makinen.ru>
  * @since 2.0.13
diff --git a/framework/db/sqlite/conditions/InConditionBuilder.php b/framework/db/sqlite/conditions/InConditionBuilder.php
index 9ad84558c50..7c381b9164d 100644
--- a/src/db/sqlite/conditions/InConditionBuilder.php
+++ b/src/db/sqlite/conditions/InConditionBuilder.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite\conditions;
 
 use yii\base\NotSupportedException;
+use yii\db\Expression;
 
 /**
  * {@inheritdoc}
@@ -37,12 +38,18 @@ protected function buildCompositeInCondition($operator, $columns, $values, &$par
     {
         $quotedColumns = [];
         foreach ($columns as $i => $column) {
+            if ($column instanceof Expression) {
+                $column = $column->expression;
+            }
             $quotedColumns[$i] = strpos($column, '(') === false ? $this->queryBuilder->db->quoteColumnName($column) : $column;
         }
         $vss = [];
         foreach ($values as $value) {
             $vs = [];
             foreach ($columns as $i => $column) {
+                if ($column instanceof Expression) {
+                    $column = $column->expression;
+                }
                 if (isset($value[$column])) {
                     $phName = $this->queryBuilder->bindParam($value[$column], $params);
                     $vs[] = $quotedColumns[$i] . ($operator === 'IN' ? ' = ' : ' != ') . $phName;
diff --git a/framework/db/sqlite/conditions/LikeConditionBuilder.php b/framework/db/sqlite/conditions/LikeConditionBuilder.php
index 0aa7d919c01..45042dddb76 100644
--- a/src/db/sqlite/conditions/LikeConditionBuilder.php
+++ b/src/db/sqlite/conditions/LikeConditionBuilder.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\db\sqlite\conditions;
diff --git a/framework/di/Container.php b/framework/di/Container.php
index 8917754016b..ed80f7c54b3 100644
--- a/src/di/Container.php
+++ b/src/di/Container.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\di;
@@ -17,11 +17,11 @@
 use yii\helpers\ArrayHelper;
 
 /**
- * Container implements a [dependency injection](http://en.wikipedia.org/wiki/Dependency_injection) container.
+ * Container implements a [dependency injection](https://en.wikipedia.org/wiki/Dependency_injection) container.
  *
  * A dependency injection (DI) container is an object that knows how to instantiate and configure objects and
  * all their dependent objects. For more information about DI, please refer to
- * [Martin Fowler's article](http://martinfowler.com/articles/injection.html).
+ * [Martin Fowler's article](https://martinfowler.com/articles/injection.html).
  *
  * Container supports constructor injection as well as property injection.
  *
@@ -95,9 +95,8 @@
  * For more details and usage information on Container, see the [guide article on di-containers](guide:concept-di-container).
  *
  * @property-read array $definitions The list of the object definitions or the loaded shared objects (type or
- * ID => definition or instance). This property is read-only.
- * @property-write bool $resolveArrays Whether to attempt to resolve elements in array dependencies. This
- * property is write-only.
+ * ID => definition or instance).
+ * @property-write bool $resolveArrays Whether to attempt to resolve elements in array dependencies.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -580,7 +579,7 @@ private function isNulledParam($param)
     /**
      * Resolves dependencies by replacing them with the actual object instances.
      * @param array $dependencies the dependencies
-     * @param ReflectionClass $reflection the class reflection associated with the dependencies
+     * @param ReflectionClass|null $reflection the class reflection associated with the dependencies
      * @return array the resolved dependencies
      * @throws InvalidConfigException if a dependency cannot be resolved or if a dependency cannot be fulfilled.
      */
@@ -666,7 +665,19 @@ public function resolveCallableDependencies(callable $callback, $params = [])
 
             if (PHP_VERSION_ID >= 80000) {
                 $class = $param->getType();
-                $isClass = $class !== null && !$param->getType()->isBuiltin();
+                if ($class instanceof \ReflectionUnionType || (PHP_VERSION_ID >= 80100 && $class instanceof \ReflectionIntersectionType)) {
+                    $isClass = false;
+                    foreach ($class->getTypes() as $type) {
+                        if (!$type->isBuiltin()) {
+                            $class = $type;
+                            $isClass = true;
+                            break;
+                        }
+                    }
+                } else {
+                    $isClass = $class !== null && !$class->isBuiltin();
+                }
+
             } else {
                 $class = $param->getClass();
                 $isClass = $class !== null;
diff --git a/framework/di/Instance.php b/framework/di/Instance.php
index 62fb50e1d2e..39bd801b354 100644
--- a/src/di/Instance.php
+++ b/src/di/Instance.php
@@ -1,13 +1,12 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\di;
 
-use Exception;
 use Yii;
 use yii\base\InvalidConfigException;
 
@@ -111,8 +110,8 @@ public static function of($id, $optional = false)
      * You may specify a reference in terms of a component ID or an Instance object.
      * Starting from version 2.0.2, you may also pass in a configuration array for creating the object.
      * If the "class" value is not specified in the configuration array, it will use the value of `$type`.
-     * @param string $type the class/interface name to be checked. If null, type check will not be performed.
-     * @param ServiceLocator|Container $container the container. This will be passed to [[get()]].
+     * @param string|null $type the class/interface name to be checked. If null, type check will not be performed.
+     * @param ServiceLocator|Container|null $container the container. This will be passed to [[get()]].
      * @return object the object referenced by the Instance, or `$reference` itself if it is an object.
      * @throws InvalidConfigException if the reference is invalid
      */
@@ -159,7 +158,7 @@ public static function ensure($reference, $type = null, $container = null)
 
     /**
      * Returns the actual object referenced by this Instance object.
-     * @param ServiceLocator|Container $container the container used to locate the referenced object.
+     * @param ServiceLocator|Container|null $container the container used to locate the referenced object.
      * If null, the method will first try `Yii::$app` then `Yii::$container`.
      * @return object the actual object referenced by this Instance object.
      */
@@ -174,7 +173,12 @@ public function get($container = null)
             }
 
             return Yii::$container->get($this->id);
-        } catch (Exception $e) {
+        } catch (\Exception $e) {
+            if ($this->optional) {
+                return null;
+            }
+            throw $e;
+        } catch (\Throwable $e) {
             if ($this->optional) {
                 return null;
             }
diff --git a/framework/di/NotInstantiableException.php b/framework/di/NotInstantiableException.php
index c80332ae08c..6da3e33d271 100644
--- a/src/di/NotInstantiableException.php
+++ b/src/di/NotInstantiableException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\di;
@@ -21,7 +21,7 @@ class NotInstantiableException extends InvalidConfigException
     /**
      * {@inheritdoc}
      */
-    public function __construct($class, $message = null, $code = 0, \Exception $previous = null)
+    public function __construct($class, $message = null, $code = 0, $previous = null)
     {
         if ($message === null) {
             $message = "Can not instantiate $class.";
diff --git a/framework/di/ServiceLocator.php b/framework/di/ServiceLocator.php
index ab8b6a45907..ab6ef253a11 100644
--- a/src/di/ServiceLocator.php
+++ b/src/di/ServiceLocator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\di;
@@ -13,7 +13,7 @@
 use yii\base\InvalidConfigException;
 
 /**
- * ServiceLocator implements a [service locator](http://en.wikipedia.org/wiki/Service_locator_pattern).
+ * ServiceLocator implements a [service locator](https://en.wikipedia.org/wiki/Service_locator_pattern).
  *
  * To use ServiceLocator, you first need to register component IDs with the corresponding component
  * definitions with the locator by calling [[set()]] or [[setComponents()]].
diff --git a/framework/filters/AccessControl.php b/framework/filters/AccessControl.php
index 3e91b80a22e..7ec2c5e553a 100644
--- a/src/filters/AccessControl.php
+++ b/src/filters/AccessControl.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -63,7 +63,7 @@ class AccessControl extends ActionFilter
      */
     public $user = 'user';
     /**
-     * @var callable a callback that will be called if the access should be denied
+     * @var callable|null a callback that will be called if the access should be denied
      * to the current user. This is the case when either no rule matches, or a rule with
      * [[AccessRule::$allow|$allow]] set to `false` matches.
      * If not set, [[denyAccess()]] will be called.
diff --git a/framework/filters/AccessRule.php b/framework/filters/AccessRule.php
index 8cb4fca24b7..decb4365a86 100644
--- a/src/filters/AccessRule.php
+++ b/src/filters/AccessRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -28,14 +28,14 @@ class AccessRule extends Component
     /**
      * @var bool whether this is an 'allow' rule or 'deny' rule.
      */
-    public $allow;
+    public $allow = false;
     /**
-     * @var array list of action IDs that this rule applies to. The comparison is case-sensitive.
+     * @var array|null list of action IDs that this rule applies to. The comparison is case-sensitive.
      * If not set or empty, it means this rule applies to all actions.
      */
     public $actions;
     /**
-     * @var array list of the controller IDs that this rule applies to.
+     * @var array|null list of the controller IDs that this rule applies to.
      *
      * The comparison uses [[\yii\base\Controller::uniqueId]], so each controller ID is prefixed
      * with the module ID (if any). For a `product` controller in the application, you would specify
@@ -50,7 +50,7 @@ class AccessRule extends Component
      */
     public $controllers;
     /**
-     * @var array list of roles that this rule applies to (requires properly configured User component).
+     * @var array|null list of roles that this rule applies to (requires properly configured User component).
      * Two special roles are recognized, and they are checked via [[User::isGuest]]:
      *
      * - `?`: matches a guest user (not authenticated yet)
@@ -67,7 +67,7 @@ class AccessRule extends Component
      */
     public $roles;
     /**
-     * @var array list of RBAC (Role-Based Access Control) permissions that this rules applies to.
+     * @var array|null list of RBAC (Role-Based Access Control) permissions that this rules applies to.
      * [[User::can()]] will be called to check access.
      *
      * If this property is not set or empty, it means this rule applies regardless of permissions.
@@ -111,7 +111,7 @@ class AccessRule extends Component
      */
     public $roleParams = [];
     /**
-     * @var array list of user IP addresses that this rule applies to. An IP address
+     * @var array|null list of user IP addresses that this rule applies to. An IP address
      * can contain the wildcard `*` at the end so that it matches IP addresses with the same prefix.
      * For example, '192.168.*' matches all IP addresses in the segment '192.168.'.
      * It may also contain a pattern/mask like '172.16.0.0/12' which would match all IPs from the
@@ -122,7 +122,7 @@ class AccessRule extends Component
      */
     public $ips;
     /**
-     * @var array list of request methods (e.g. `GET`, `POST`) that this rule applies to.
+     * @var array|null list of request methods (e.g. `GET`, `POST`) that this rule applies to.
      * If not set or empty, it means this rule applies to all request methods.
      * @see \yii\web\Request::method
      */
@@ -140,7 +140,7 @@ class AccessRule extends Component
      */
     public $matchCallback;
     /**
-     * @var callable a callback that will be called if this rule determines the access to
+     * @var callable|null a callback that will be called if this rule determines the access to
      * the current action should be denied. This is the case when this rule matches
      * and [[$allow]] is set to `false`.
      *
diff --git a/framework/filters/AjaxFilter.php b/framework/filters/AjaxFilter.php
index 265f01a5705..02b3d7ebf0e 100644
--- a/src/filters/AjaxFilter.php
+++ b/src/filters/AjaxFilter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -37,7 +37,7 @@ class AjaxFilter extends ActionFilter
      */
     public $errorMessage = 'Request must be XMLHttpRequest.';
     /**
-     * @var Request the current request. If not set, the `request` application component will be used.
+     * @var Request|null the current request. If not set, the `request` application component will be used.
      */
     public $request;
 
diff --git a/framework/filters/ContentNegotiator.php b/framework/filters/ContentNegotiator.php
index 760c4a0fab2..72c3e865d79 100644
--- a/src/filters/ContentNegotiator.php
+++ b/src/filters/ContentNegotiator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -102,7 +102,7 @@ class ContentNegotiator extends ActionFilter implements BootstrapInterface
      */
     public $languageParam = '_lang';
     /**
-     * @var array list of supported response formats. The keys are MIME types (e.g. `application/json`)
+     * @var array|null list of supported response formats. The keys are MIME types (e.g. `application/json`)
      * while the values are the corresponding formats (e.g. `html`, `json`) which must be supported
      * as declared in [[\yii\web\Response::$formatters]].
      *
@@ -110,7 +110,7 @@ class ContentNegotiator extends ActionFilter implements BootstrapInterface
      */
     public $formats;
     /**
-     * @var array a list of supported languages. The array keys are the supported language variants (e.g. `en-GB`, `en-US`),
+     * @var array|null a list of supported languages. The array keys are the supported language variants (e.g. `en-GB`, `en-US`),
      * while the array values are the corresponding language codes (e.g. `en`, `de`) recognized by the application.
      *
      * Array keys are not always required. When an array value does not have a key, the matching of the requested language
@@ -124,7 +124,7 @@ class ContentNegotiator extends ActionFilter implements BootstrapInterface
      */
     public $request;
     /**
-     * @var Response the response to be sent. If not set, the `response` application component will be used.
+     * @var Response|null the response to be sent. If not set, the `response` application component will be used.
      */
     public $response;
 
diff --git a/framework/filters/Cors.php b/framework/filters/Cors.php
index 356053f514b..b6b99a79bfc 100644
--- a/src/filters/Cors.php
+++ b/src/filters/Cors.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -14,7 +14,7 @@
 use yii\web\Response;
 
 /**
- * Cors filter implements [Cross Origin Resource Sharing](http://en.wikipedia.org/wiki/Cross-origin_resource_sharing).
+ * Cors filter implements [Cross Origin Resource Sharing](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing).
  *
  * Make sure to read carefully what CORS does and does not. CORS do not secure your API,
  * but allow the developer to grant access to third party code (ajax calls from external domain).
@@ -70,11 +70,11 @@
 class Cors extends ActionFilter
 {
     /**
-     * @var Request the current request. If not set, the `request` application component will be used.
+     * @var Request|null the current request. If not set, the `request` application component will be used.
      */
     public $request;
     /**
-     * @var Response the response to be sent. If not set, the `response` application component will be used.
+     * @var Response|null the response to be sent. If not set, the `response` application component will be used.
      */
     public $response;
     /**
diff --git a/framework/filters/HostControl.php b/framework/filters/HostControl.php
index 51aa5bee24a..42ca30c44d2 100644
--- a/src/filters/HostControl.php
+++ b/src/filters/HostControl.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -91,7 +91,7 @@ class HostControl extends ActionFilter
      */
     public $allowedHosts;
     /**
-     * @var callable a callback that will be called if the current host does not match [[allowedHosts]].
+     * @var callable|null a callback that will be called if the current host does not match [[allowedHosts]].
      * If not set, [[denyAccess()]] will be called.
      *
      * The signature of the callback should be as follows:
@@ -107,7 +107,7 @@ class HostControl extends ActionFilter
      */
     public $denyCallback;
     /**
-     * @var string|null fallback host info (e.g. `http://www.yiiframework.com`) used when [[\yii\web\Request::$hostInfo|Request::$hostInfo]] is invalid.
+     * @var string|null fallback host info (e.g. `https://www.yiiframework.com`) used when [[\yii\web\Request::$hostInfo|Request::$hostInfo]] is invalid.
      * This value will replace [[\yii\web\Request::$hostInfo|Request::$hostInfo]] before [[$denyCallback]] is called to make sure that
      * an invalid host will not be used for further processing. You can set it to `null` to leave [[\yii\web\Request::$hostInfo|Request::$hostInfo]] untouched.
      * Default value is empty string (this will result creating relative URLs instead of absolute).
diff --git a/framework/filters/HttpCache.php b/framework/filters/HttpCache.php
index 2a6f6e32a4c..d05011407ec 100644
--- a/src/filters/HttpCache.php
+++ b/src/filters/HttpCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -56,7 +56,7 @@ class HttpCache extends ActionFilter
      * where `$action` is the [[Action]] object that this filter is currently handling;
      * `$params` takes the value of [[params]]. The callback should return a UNIX timestamp.
      *
-     * @see http://tools.ietf.org/html/rfc7232#section-2.2
+     * @see https://datatracker.ietf.org/doc/html/rfc7232#section-2.2
      */
     public $lastModified;
     /**
@@ -78,7 +78,7 @@ class HttpCache extends ActionFilter
      * Weak ETags should be used if the content should be considered semantically equivalent, but not byte-equal.
      *
      * @since 2.0.8
-     * @see http://tools.ietf.org/html/rfc7232#section-2.3
+     * @see https://datatracker.ietf.org/doc/html/rfc7232#section-2.3
      */
     public $weakEtag = false;
     /**
@@ -86,12 +86,12 @@ class HttpCache extends ActionFilter
      */
     public $params;
     /**
-     * @var string the value of the `Cache-Control` HTTP header. If null, the header will not be sent.
-     * @see http://tools.ietf.org/html/rfc2616#section-14.9
+     * @var string|null the value of the `Cache-Control` HTTP header. If null, the header will not be sent.
+     * @see https://datatracker.ietf.org/doc/html/rfc2616#section-14.9
      */
     public $cacheControlHeader = 'public, max-age=3600';
     /**
-     * @var string the name of the cache limiter to be set when [session_cache_limiter()](https://www.php.net/manual/en/function.session-cache-limiter.php)
+     * @var string|null the name of the cache limiter to be set when [session_cache_limiter()](https://www.php.net/manual/en/function.session-cache-limiter.php)
      * is called. The default value is an empty string, meaning turning off automatic sending of cache headers entirely.
      * You may set this property to be `public`, `private`, `private_no_expire`, and `nocache`.
      * Please refer to [session_cache_limiter()](https://www.php.net/manual/en/function.session-cache-limiter.php)
@@ -158,16 +158,16 @@ public function beforeAction($action)
     /**
      * Validates if the HTTP cache contains valid content.
      * If both Last-Modified and ETag are null, returns false.
-     * @param int $lastModified the calculated Last-Modified value in terms of a UNIX timestamp.
+     * @param int|null $lastModified the calculated Last-Modified value in terms of a UNIX timestamp.
      * If null, the Last-Modified header will not be validated.
-     * @param string $etag the calculated ETag value. If null, the ETag header will not be validated.
+     * @param string|null $etag the calculated ETag value. If null, the ETag header will not be validated.
      * @return bool whether the HTTP cache is still valid.
      */
     protected function validateCache($lastModified, $etag)
     {
         if (Yii::$app->request->headers->has('If-None-Match')) {
             // HTTP_IF_NONE_MATCH takes precedence over HTTP_IF_MODIFIED_SINCE
-            // http://tools.ietf.org/html/rfc7232#section-3.3
+            // https://datatracker.ietf.org/doc/html/rfc7232#section-3.3
             return $etag !== null && in_array($etag, Yii::$app->request->getETags(), true);
         } elseif (Yii::$app->request->headers->has('If-Modified-Since')) {
             return $lastModified !== null && @strtotime(Yii::$app->request->headers->get('If-Modified-Since')) >= $lastModified;
diff --git a/framework/filters/PageCache.php b/framework/filters/PageCache.php
index 1930aa0873f..c10dcabe4f6 100644
--- a/src/filters/PageCache.php
+++ b/src/filters/PageCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -116,7 +116,7 @@ class PageCache extends ActionFilter implements DynamicContentAwareInterface
      */
     public $enabled = true;
     /**
-     * @var \yii\base\View the view component to use for caching. If not set, the default application view component
+     * @var \yii\base\View|null the view component to use for caching. If not set, the default application view component
      * [[\yii\web\Application::view]] will be used.
      */
     public $view;
@@ -129,7 +129,7 @@ class PageCache extends ActionFilter implements DynamicContentAwareInterface
     public $cacheCookies = false;
     /**
      * @var bool|array a boolean value indicating whether to cache all HTTP headers, or an array of
-     * HTTP header names (case-insensitive) indicating which HTTP headers can be cached.
+     * HTTP header names (case-sensitive) indicating which HTTP headers can be cached.
      * Note if your HTTP headers contain sensitive information, you should white-list which headers can be cached.
      * @since 2.0.4
      */
@@ -253,40 +253,59 @@ public function cacheResponse()
         foreach (['format', 'version', 'statusCode', 'statusText'] as $name) {
             $data[$name] = $response->{$name};
         }
-        $this->insertResponseCollectionIntoData($response, 'headers', $data);
-        $this->insertResponseCollectionIntoData($response, 'cookies', $data);
+        $this->insertResponseHeaderCollectionIntoData($response, $data);
+        $this->insertResponseCookieCollectionIntoData($response, $data);
         $this->cache->set($this->calculateCacheKey(), $data, $this->duration, $this->dependency);
         $data['content'] = $this->updateDynamicContent($data['content'], $this->getDynamicPlaceholders());
         echo $data['content'];
     }
 
     /**
-     * Inserts (or filters/ignores according to config) response headers/cookies into a cache data array.
+     * Inserts (or filters/ignores according to config) response cookies into a cache data array.
      * @param Response $response the response.
-     * @param string $collectionName currently it's `headers` or `cookies`.
      * @param array $data the cache data.
      */
-    private function insertResponseCollectionIntoData(Response $response, $collectionName, array &$data)
+    private function insertResponseCookieCollectionIntoData(Response $response, array &$data)
     {
-        $property = 'cache' . ucfirst($collectionName);
-        if ($this->{$property} === false) {
+        if ($this->cacheCookies === false) {
             return;
         }
 
-        $all = $response->{$collectionName}->toArray();
-        if (is_array($this->{$property})) {
+        $all = $response->cookies->toArray();
+        if (is_array($this->cacheCookies)) {
             $filtered = [];
-            foreach ($this->{$property} as $name) {
-                if ($collectionName === 'headers') {
-                    $name = strtolower($name);
+            foreach ($this->cacheCookies as $name) {
+                if (isset($all[$name])) {
+                    $filtered[$name] = $all[$name];
                 }
+            }
+            $all = $filtered;
+        }
+        $data['cookies'] = $all;
+    }
+
+    /**
+     * Inserts (or filters/ignores according to config) response headers into a cache data array.
+     * @param Response $response the response.
+     * @param array $data the cache data.
+     */
+    private function insertResponseHeaderCollectionIntoData(Response $response, array &$data)
+    {
+        if ($this->cacheHeaders === false) {
+            return;
+        }
+
+        $all = $response->headers->toOriginalArray();
+        if (is_array($this->cacheHeaders)) {
+            $filtered = [];
+            foreach ($this->cacheHeaders as $name) {
                 if (isset($all[$name])) {
                     $filtered[$name] = $all[$name];
                 }
             }
             $all = $filtered;
         }
-        $data[$collectionName] = $all;
+        $data['headers'] = $all;
     }
 
     /**
diff --git a/framework/filters/RateLimitInterface.php b/framework/filters/RateLimitInterface.php
index 7a3ee3f73f2..23dc295ce01 100644
--- a/src/filters/RateLimitInterface.php
+++ b/src/filters/RateLimitInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
diff --git a/framework/filters/RateLimiter.php b/framework/filters/RateLimiter.php
index 5ffc1a69ff2..62d1aab3a40 100644
--- a/src/filters/RateLimiter.php
+++ b/src/filters/RateLimiter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
@@ -15,7 +15,7 @@
 use yii\web\TooManyRequestsHttpException;
 
 /**
- * RateLimiter implements a rate limiting algorithm based on the [leaky bucket algorithm](http://en.wikipedia.org/wiki/Leaky_bucket).
+ * RateLimiter implements a rate limiting algorithm based on the [leaky bucket algorithm](https://en.wikipedia.org/wiki/Leaky_bucket).
  *
  * You may use RateLimiter by attaching it as a behavior to a controller or module, like the following,
  *
@@ -49,7 +49,7 @@ class RateLimiter extends ActionFilter
      */
     public $errorMessage = 'Rate limit exceeded.';
     /**
-     * @var RateLimitInterface|Closure the user object that implements the RateLimitInterface. If not set, it will take the value of `Yii::$app->user->getIdentity(false)`.
+     * @var RateLimitInterface|Closure|null the user object that implements the RateLimitInterface. If not set, it will take the value of `Yii::$app->user->getIdentity(false)`.
      * {@since 2.0.38} It's possible to provide a closure function in order to assign the user identity on runtime. Using a closure to assign the user identity is recommend
      * when you are **not** using the standard `Yii::$app->user` component. See the example below:
      * ```php
@@ -60,11 +60,11 @@ class RateLimiter extends ActionFilter
      */
     public $user;
     /**
-     * @var Request the current request. If not set, the `request` application component will be used.
+     * @var Request|null the current request. If not set, the `request` application component will be used.
      */
     public $request;
     /**
-     * @var Response the response to be sent. If not set, the `response` application component will be used.
+     * @var Response|null the response to be sent. If not set, the `response` application component will be used.
      */
     public $response;
 
diff --git a/framework/filters/VerbFilter.php b/framework/filters/VerbFilter.php
index 76b6d9e4fe0..ed573a2450b 100644
--- a/src/filters/VerbFilter.php
+++ b/src/filters/VerbFilter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters;
diff --git a/framework/filters/auth/AuthInterface.php b/framework/filters/auth/AuthInterface.php
index 492d314ca3a..76b13057fa6 100644
--- a/src/filters/auth/AuthInterface.php
+++ b/src/filters/auth/AuthInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
@@ -26,7 +26,7 @@ interface AuthInterface
      * @param User $user
      * @param Request $request
      * @param Response $response
-     * @return IdentityInterface the authenticated user identity. If authentication information is not provided, null will be returned.
+     * @return IdentityInterface|null the authenticated user identity. If authentication information is not provided, null will be returned.
      * @throws UnauthorizedHttpException if authentication information is provided but is invalid.
      */
     public function authenticate($user, $request, $response);
diff --git a/framework/filters/auth/AuthMethod.php b/framework/filters/auth/AuthMethod.php
index 9dcba078c30..786edba98e1 100644
--- a/src/filters/auth/AuthMethod.php
+++ b/src/filters/auth/AuthMethod.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
@@ -25,15 +25,15 @@
 abstract class AuthMethod extends ActionFilter implements AuthInterface
 {
     /**
-     * @var User the user object representing the user authentication status. If not set, the `user` application component will be used.
+     * @var User|null the user object representing the user authentication status. If not set, the `user` application component will be used.
      */
     public $user;
     /**
-     * @var Request the current request. If not set, the `request` application component will be used.
+     * @var Request|null the current request. If not set, the `request` application component will be used.
      */
     public $request;
     /**
-     * @var Response the response to be sent. If not set, the `response` application component will be used.
+     * @var Response|null the response to be sent. If not set, the `response` application component will be used.
      */
     public $response;
     /**
diff --git a/framework/filters/auth/CompositeAuth.php b/framework/filters/auth/CompositeAuth.php
index 37043d4235d..ee58276cf1c 100644
--- a/src/filters/auth/CompositeAuth.php
+++ b/src/filters/auth/CompositeAuth.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
@@ -70,9 +70,11 @@ public function authenticate($user, $request, $response)
                 }
             }
 
-            $identity = $auth->authenticate($user, $request, $response);
-            if ($identity !== null) {
-                return $identity;
+            if (isset($this->owner->action) && $auth->isActive($this->owner->action)) {
+                $identity = $auth->authenticate($user, $request, $response);
+                if ($identity !== null) {
+                    return $identity;
+                }
             }
         }
 
diff --git a/framework/filters/auth/HttpBasicAuth.php b/framework/filters/auth/HttpBasicAuth.php
index 546d0e628e6..d7969a696a9 100644
--- a/src/filters/auth/HttpBasicAuth.php
+++ b/src/filters/auth/HttpBasicAuth.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
@@ -64,7 +64,7 @@ class HttpBasicAuth extends AuthMethod
      */
     public $realm = 'api';
     /**
-     * @var callable a PHP callable that will authenticate the user with the HTTP basic auth information.
+     * @var callable|null a PHP callable that will authenticate the user with the HTTP basic auth information.
      * The callable receives a username and a password as its parameters. It should return an identity object
      * that matches the username and password. Null should be returned if there is no such identity.
      * The callable will be called only if current user is not authenticated.
diff --git a/framework/filters/auth/HttpBearerAuth.php b/framework/filters/auth/HttpBearerAuth.php
index f5fb80a97df..d2ce749c0b4 100644
--- a/src/filters/auth/HttpBearerAuth.php
+++ b/src/filters/auth/HttpBearerAuth.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
diff --git a/framework/filters/auth/HttpHeaderAuth.php b/framework/filters/auth/HttpHeaderAuth.php
index 1b0dbbff152..404b8e1a92f 100644
--- a/src/filters/auth/HttpHeaderAuth.php
+++ b/src/filters/auth/HttpHeaderAuth.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
diff --git a/framework/filters/auth/QueryParamAuth.php b/framework/filters/auth/QueryParamAuth.php
index 7bf5afdc26f..e193893339d 100644
--- a/src/filters/auth/QueryParamAuth.php
+++ b/src/filters/auth/QueryParamAuth.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\filters\auth;
diff --git a/framework/grid/ActionColumn.php b/framework/grid/ActionColumn.php
index d945e1ea1a0..f943a687241 100644
--- a/src/grid/ActionColumn.php
+++ b/src/grid/ActionColumn.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
@@ -38,7 +38,7 @@ class ActionColumn extends Column
      */
     public $headerOptions = ['class' => 'action-column'];
     /**
-     * @var string the ID of the controller that should handle the actions specified here.
+     * @var string|null the ID of the controller that should handle the actions specified here.
      * If not set, it will use the currently active controller. This property is mainly used by
      * [[urlCreator]] to create URLs for different actions. The value of this property will be prefixed
      * to each action name to form the route of the action.
@@ -125,7 +125,7 @@ class ActionColumn extends Column
      */
     public $visibleButtons = [];
     /**
-     * @var callable a callback that creates a button URL using the specified model information.
+     * @var callable|null a callback that creates a button URL using the specified model information.
      * The signature of the callback should be the same as that of [[createUrl()]]
      * Since 2.0.10 it can accept additional parameter, which refers to the column instance itself:
      *
diff --git a/framework/grid/CheckboxColumn.php b/framework/grid/CheckboxColumn.php
index 0ea6edca564..2e0a890093a 100644
--- a/src/grid/CheckboxColumn.php
+++ b/src/grid/CheckboxColumn.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
diff --git a/framework/grid/Column.php b/framework/grid/Column.php
index 465a8551044..f716525d97e 100644
--- a/src/grid/Column.php
+++ b/src/grid/Column.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
@@ -26,7 +26,7 @@ class Column extends BaseObject
      */
     public $grid;
     /**
-     * @var string the header cell content. Note that it will not be HTML-encoded.
+     * @var string|null the header cell content. Note that it will not be HTML-encoded.
      */
     public $header;
     /**
@@ -127,7 +127,7 @@ public function renderFilterCell()
      */
     protected function renderHeaderCellContent()
     {
-        return trim($this->header) !== '' ? $this->header : $this->getHeaderCellLabel();
+        return $this->header !== null && trim($this->header) !== '' ? $this->header : $this->getHeaderCellLabel();
     }
 
     /**
@@ -149,7 +149,7 @@ protected function getHeaderCellLabel()
      */
     protected function renderFooterCellContent()
     {
-        return trim($this->footer) !== '' ? $this->footer : $this->grid->emptyCell;
+        return $this->footer !== null && trim($this->footer) !== '' ? $this->footer : $this->grid->emptyCell;
     }
 
     /**
diff --git a/framework/grid/DataColumn.php b/framework/grid/DataColumn.php
index 8760104aba6..d3bf3086dde 100644
--- a/src/grid/DataColumn.php
+++ b/src/grid/DataColumn.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
@@ -46,7 +46,7 @@ class DataColumn extends Column
      */
     public $attribute;
     /**
-     * @var string label to be displayed in the [[header|header cell]] and also to be used as the sorting
+     * @var string|null label to be displayed in the [[header|header cell]] and also to be used as the sorting
      * link label when sorting is enabled for this column.
      * If it is not set and the models provided by the GridViews data provider are instances
      * of [[\yii\db\ActiveRecord]], the label will be determined using [[\yii\db\ActiveRecord::getAttributeLabel()]].
@@ -60,7 +60,7 @@ class DataColumn extends Column
      */
     public $encodeLabel = true;
     /**
-     * @var string|Closure an anonymous function or a string that is used to determine the value to display in the current column.
+     * @var string|Closure|null an anonymous function or a string that is used to determine the value to display in the current column.
      *
      * If this is an anonymous function, it will be called for each row and the return value will be used as the value to
      * display for every data model. The signature of this function should be: `function ($model, $key, $index, $column)`.
@@ -118,7 +118,7 @@ class DataColumn extends Column
      */
     public $filterInputOptions = ['class' => 'form-control', 'id' => null];
     /**
-     * @var string the attribute name of the [[GridView::filterModel]] associated with this column. If not set,
+     * @var string|null the attribute name of the [[GridView::filterModel]] associated with this column. If not set,
      * will have the same value as [[attribute]].
      * @since 2.0.41
      */
@@ -167,7 +167,9 @@ protected function getHeaderCellLabel()
         $provider = $this->grid->dataProvider;
 
         if ($this->label === null) {
-            if ($provider instanceof ActiveDataProvider && $provider->query instanceof ActiveQueryInterface) {
+            if ($this->attribute === null) {
+                $label = '';
+            } elseif ($provider instanceof ActiveDataProvider && $provider->query instanceof ActiveQueryInterface) {
                 /* @var $modelClass Model */
                 $modelClass = $provider->query->modelClass;
                 $model = $modelClass::instance();
diff --git a/framework/grid/GridView.php b/framework/grid/GridView.php
index 1fa783f9adb..7ee0e06bbc0 100644
--- a/src/grid/GridView.php
+++ b/src/grid/GridView.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
@@ -137,7 +137,7 @@ class GridView extends BaseListView
      */
     public $showOnEmpty = true;
     /**
-     * @var array|Formatter the formatter used to format model attribute values into displayable texts.
+     * @var array|Formatter|null the formatter used to format model attribute values into displayable texts.
      * This can be either an instance of [[Formatter]] or an configuration array for creating the [[Formatter]]
      * instance. If this property is not set, the "formatter" application component will be used.
      */
@@ -202,7 +202,7 @@ class GridView extends BaseListView
      */
     public $emptyCell = '&nbsp;';
     /**
-     * @var \yii\base\Model the model that keeps the user-entered filter data. When this property is set,
+     * @var \yii\base\Model|null the model that keeps the user-entered filter data. When this property is set,
      * the grid view will enable column-based filtering. Each data column by default will display a text field
      * at the top that users can fill in to filter the data.
      *
@@ -214,7 +214,7 @@ class GridView extends BaseListView
      */
     public $filterModel;
     /**
-     * @var string|array the URL for returning the filtering result. [[Url::to()]] will be called to
+     * @var string|array|null the URL for returning the filtering result. [[Url::to()]] will be called to
      * normalize the URL. If not set, the current controller action will be used.
      * When the user makes change to any filter input, the current filtering inputs will be appended
      * as GET parameters to this URL.
diff --git a/framework/grid/GridViewAsset.php b/framework/grid/GridViewAsset.php
index 0403e9f5b76..56908d5e788 100644
--- a/src/grid/GridViewAsset.php
+++ b/src/grid/GridViewAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
diff --git a/framework/grid/RadioButtonColumn.php b/framework/grid/RadioButtonColumn.php
index 898831ecc6e..7a7cef18056 100644
--- a/src/grid/RadioButtonColumn.php
+++ b/src/grid/RadioButtonColumn.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
diff --git a/framework/grid/SerialColumn.php b/framework/grid/SerialColumn.php
index 69e27faacc0..28d23549cdf 100644
--- a/src/grid/SerialColumn.php
+++ b/src/grid/SerialColumn.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\grid;
diff --git a/framework/helpers/ArrayHelper.php b/framework/helpers/ArrayHelper.php
index a34cb9b15b3..3e3636bf51b 100644
--- a/src/helpers/ArrayHelper.php
+++ b/src/helpers/ArrayHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/BaseArrayHelper.php b/framework/helpers/BaseArrayHelper.php
index dcd28657c9e..8d4ea3375c2 100644
--- a/src/helpers/BaseArrayHelper.php
+++ b/src/helpers/BaseArrayHelper.php
@@ -1,15 +1,15 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
 
+use Yii;
 use ArrayAccess;
 use Traversable;
-use Yii;
 use yii\base\Arrayable;
 use yii\base\InvalidArgumentException;
 
@@ -351,7 +351,7 @@ public static function remove(&$array, $key, $default = null)
      * ```
      *
      * @param array $array the array where to look the value from
-     * @param string $value the value to remove from the array
+     * @param mixed $value the value to remove from the array
      * @return array the items that were removed from the array
      * @since 2.0.11
      */
@@ -585,7 +585,7 @@ public static function getColumn($array, $name, $keepKeys = true)
      * @param array $array
      * @param string|\Closure $from
      * @param string|\Closure $to
-     * @param string|\Closure $group
+     * @param string|\Closure|null $group
      * @return array
      */
     public static function map($array, $from, $to, $group = null)
@@ -697,7 +697,7 @@ public static function multisort(&$array, $key, $direction = SORT_ASC, $sortFlag
      * @param array $data data to be encoded
      * @param bool $valuesOnly whether to encode array values only. If false,
      * both the array keys and array values will be encoded.
-     * @param string $charset the charset that the data is using. If not set,
+     * @param string|null $charset the charset that the data is using. If not set,
      * [[\yii\base\Application::charset]] will be used.
      * @return array the encoded data
      * @see https://www.php.net/manual/en/function.htmlspecialchars.php
@@ -726,12 +726,14 @@ public static function htmlEncode($data, $valuesOnly = true, $charset = null)
 
     /**
      * Decodes HTML entities into the corresponding characters in an array of strings.
+     *
      * Only array values will be decoded by default.
      * If a value is an array, this method will also decode it recursively.
      * Only string values will be decoded.
+     *
      * @param array $data data to be decoded
-     * @param bool $valuesOnly whether to decode array values only. If false,
-     * both the array keys and array values will be decoded.
+     * @param bool $valuesOnly whether to decode array values only. If `false`,
+     * then both the array keys and array values will be decoded.
      * @return array the decoded data
      * @see https://www.php.net/manual/en/function.htmlspecialchars-decode.php
      */
@@ -740,12 +742,12 @@ public static function htmlDecode($data, $valuesOnly = true)
         $d = [];
         foreach ($data as $key => $value) {
             if (!$valuesOnly && is_string($key)) {
-                $key = htmlspecialchars_decode($key, ENT_QUOTES);
+                $key = htmlspecialchars_decode($key, ENT_QUOTES | ENT_SUBSTITUTE);
             }
             if (is_string($value)) {
-                $d[$key] = htmlspecialchars_decode($value, ENT_QUOTES);
+                $d[$key] = htmlspecialchars_decode($value, ENT_QUOTES | ENT_SUBSTITUTE);
             } elseif (is_array($value)) {
-                $d[$key] = static::htmlDecode($value);
+                $d[$key] = static::htmlDecode($value, $valuesOnly);
             } else {
                 $d[$key] = $value;
             }
@@ -769,7 +771,7 @@ public static function htmlDecode($data, $valuesOnly = true)
      */
     public static function isAssociative($array, $allStrings = true)
     {
-        if (!is_array($array) || empty($array)) {
+        if (empty($array) || !is_array($array)) {
             return false;
         }
 
@@ -815,11 +817,13 @@ public static function isIndexed($array, $consecutive = false)
             return true;
         }
 
+        $keys = array_keys($array);
+
         if ($consecutive) {
-            return array_keys($array) === range(0, count($array) - 1);
+            return $keys === array_keys($keys);
         }
 
-        foreach ($array as $key => $value) {
+        foreach ($keys as $key) {
             if (!is_int($key)) {
                 return false;
             }
@@ -833,8 +837,9 @@ public static function isIndexed($array, $consecutive = false)
      *
      * This method does the same as the PHP function [in_array()](https://www.php.net/manual/en/function.in-array.php)
      * but additionally works for objects that implement the [[Traversable]] interface.
+     *
      * @param mixed $needle The value to look for.
-     * @param array|Traversable $haystack The set of values to search.
+     * @param iterable $haystack The set of values to search.
      * @param bool $strict Whether to enable strict (`===`) comparison.
      * @return bool `true` if `$needle` was found in `$haystack`, `false` otherwise.
      * @throws InvalidArgumentException if `$haystack` is neither traversable nor an array.
@@ -843,18 +848,20 @@ public static function isIndexed($array, $consecutive = false)
      */
     public static function isIn($needle, $haystack, $strict = false)
     {
-        if ($haystack instanceof Traversable) {
-            foreach ($haystack as $value) {
-                if ($needle == $value && (!$strict || $needle === $value)) {
-                    return true;
-                }
-            }
-        } elseif (is_array($haystack)) {
-            return in_array($needle, $haystack, $strict);
-        } else {
+        if (!static::isTraversable($haystack)) {
             throw new InvalidArgumentException('Argument $haystack must be an array or implement Traversable');
         }
 
+        if (is_array($haystack)) {
+            return in_array($needle, $haystack, $strict);
+        }
+
+        foreach ($haystack as $value) {
+            if ($strict ? $needle === $value : $needle == $value) {
+                return true;
+            }
+        }
+
         return false;
     }
 
@@ -878,26 +885,27 @@ public static function isTraversable($var)
      *
      * This method will return `true`, if all elements of `$needles` are contained in
      * `$haystack`. If at least one element is missing, `false` will be returned.
-     * @param array|Traversable $needles The values that must **all** be in `$haystack`.
-     * @param array|Traversable $haystack The set of value to search.
+     *
+     * @param iterable $needles The values that must **all** be in `$haystack`.
+     * @param iterable $haystack The set of value to search.
      * @param bool $strict Whether to enable strict (`===`) comparison.
-     * @throws InvalidArgumentException if `$haystack` or `$needles` is neither traversable nor an array.
      * @return bool `true` if `$needles` is a subset of `$haystack`, `false` otherwise.
+     * @throws InvalidArgumentException if `$haystack` or `$needles` is neither traversable nor an array.
      * @since 2.0.7
      */
     public static function isSubset($needles, $haystack, $strict = false)
     {
-        if (is_array($needles) || $needles instanceof Traversable) {
-            foreach ($needles as $needle) {
-                if (!static::isIn($needle, $haystack, $strict)) {
-                    return false;
-                }
-            }
+        if (!static::isTraversable($needles)) {
+            throw new InvalidArgumentException('Argument $needles must be an array or implement Traversable');
+        }
 
-            return true;
+        foreach ($needles as $needle) {
+            if (!static::isIn($needle, $haystack, $strict)) {
+                return false;
+            }
         }
 
-        throw new InvalidArgumentException('Argument $needles must be an array or implement Traversable');
+        return true;
     }
 
     /**
@@ -936,7 +944,7 @@ public static function isSubset($needles, $haystack, $strict = false)
      * ```
      *
      * @param array $array Source array
-     * @param array $filters Rules that define array keys which should be left or removed from results.
+     * @param iterable $filters Rules that define array keys which should be left or removed from results.
      * Each rule is:
      * - `var` - `$array['var']` will be left in result.
      * - `var.key` = only `$array['var']['key'] will be left in result.
@@ -999,4 +1007,29 @@ public static function filter($array, $filters)
 
         return $result;
     }
+
+    /**
+     * Sorts array recursively.
+     *
+     * @param array $array An array passing by reference.
+     * @param callable|null $sorter The array sorter. If omitted, sort index array by values, sort assoc array by keys.
+     * @return array
+     */
+    public static function recursiveSort(array &$array, $sorter = null)
+    {
+        foreach ($array as &$value) {
+            if (is_array($value)) {
+                static::recursiveSort($value, $sorter);
+            }
+        }
+        unset($value);
+
+        if ($sorter === null) {
+            $sorter = static::isIndexed($array) ? 'sort' : 'ksort';
+        }
+
+        call_user_func_array($sorter, [&$array]);
+
+        return $array;
+    }
 }
diff --git a/framework/helpers/BaseConsole.php b/framework/helpers/BaseConsole.php
index 285276238cf..abb838c9c47 100644
--- a/src/helpers/BaseConsole.php
+++ b/src/helpers/BaseConsole.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -301,7 +301,7 @@ public static function ansiFormat($string, $format = [])
      *
      * @param int $colorCode xterm color code
      * @return string
-     * @see http://en.wikipedia.org/wiki/Talk:ANSI_escape_code#xterm-256colors
+     * @see https://en.wikipedia.org/wiki/Talk:ANSI_escape_code#xterm-256colors
      */
     public static function xtermFgColor($colorCode)
     {
@@ -316,7 +316,7 @@ public static function xtermFgColor($colorCode)
      *
      * @param int $colorCode xterm color code
      * @return string
-     * @see http://en.wikipedia.org/wiki/Talk:ANSI_escape_code#xterm-256colors
+     * @see https://en.wikipedia.org/wiki/Talk:ANSI_escape_code#xterm-256colors
      */
     public static function xtermBgColor($colorCode)
     {
@@ -331,7 +331,7 @@ public static function xtermBgColor($colorCode)
      */
     public static function stripAnsiFormat($string)
     {
-        return preg_replace(self::ansiCodesPattern(), '', $string);
+        return preg_replace(self::ansiCodesPattern(), '', (string)$string);
     }
 
     /**
@@ -370,9 +370,9 @@ public static function ansiColorizedSubstr($string, $start, $length)
             return '';
         }
 
-        $textItems = preg_split(self::ansiCodesPattern(), $string);
+        $textItems = preg_split(self::ansiCodesPattern(), (string)$string);
 
-        preg_match_all(self::ansiCodesPattern(), $string, $colors);
+        preg_match_all(self::ansiCodesPattern(), (string)$string, $colors);
         $colors = count($colors) ? $colors[0] : [];
         array_unshift($colors, '');
 
@@ -432,14 +432,14 @@ private static function ansiCodesPattern()
     public static function ansiToHtml($string, $styleMap = [])
     {
         $styleMap = [
-            // http://www.w3.org/TR/CSS2/syndata.html#value-def-color
+            // https://www.w3.org/TR/CSS2/syndata.html#value-def-color
             self::FG_BLACK => ['color' => 'black'],
             self::FG_BLUE => ['color' => 'blue'],
             self::FG_CYAN => ['color' => 'aqua'],
             self::FG_GREEN => ['color' => 'lime'],
             self::FG_GREY => ['color' => 'silver'],
-            // http://meyerweb.com/eric/thoughts/2014/06/19/rebeccapurple/
-            // http://dev.w3.org/csswg/css-color/#valuedef-rebeccapurple
+            // https://meyerweb.com/eric/thoughts/2014/06/19/rebeccapurple/
+            // https://drafts.csswg.org/css-color/#valuedef-rebeccapurple
             self::FG_PURPLE => ['color' => 'rebeccapurple'],
             self::FG_RED => ['color' => 'red'],
             self::FG_YELLOW => ['color' => 'yellow'],
@@ -688,10 +688,19 @@ public static function isRunningOnWindows()
     public static function getScreenSize($refresh = false)
     {
         static $size;
-        if ($size !== null && !$refresh) {
+        static $execDisabled;
+
+        if ($size !== null && ($execDisabled || !$refresh)) {
             return $size;
         }
 
+        if ($execDisabled === null) {
+            $execDisabled = !function_exists('ini_get') || preg_match('/(\bexec\b)/i', ini_get('disable_functions'));
+            if ($execDisabled) {
+                return $size = false;
+            }
+        }
+
         if (static::isRunningOnWindows()) {
             $output = [];
             exec('mode con', $output);
@@ -807,7 +816,7 @@ public static function stderr($string)
      * Asks the user for input. Ends when the user types a carriage return (PHP_EOL). Optionally, It also provides a
      * prompt.
      *
-     * @param string $prompt the prompt to display before waiting for input (optional)
+     * @param string|null $prompt the prompt to display before waiting for input (optional)
      * @return string the user's input
      */
     public static function input($prompt = null)
@@ -822,7 +831,7 @@ public static function input($prompt = null)
     /**
      * Prints text to STDOUT appended with a carriage return (PHP_EOL).
      *
-     * @param string $string the text to print
+     * @param string|null $string the text to print
      * @return int|bool number of bytes printed or false on error.
      */
     public static function output($string = null)
@@ -833,7 +842,7 @@ public static function output($string = null)
     /**
      * Prints text to STDERR appended with a carriage return (PHP_EOL).
      *
-     * @param string $string the text to print
+     * @param string|null $string the text to print
      * @return int|bool number of bytes printed or false on error.
      */
     public static function error($string = null)
@@ -998,7 +1007,7 @@ public static function select($prompt, $options = [])
      * @param int $total the total value of items that are to be done.
      * @param string $prefix an optional string to display before the progress bar.
      * Default to empty string which results in no prefix to be displayed.
-     * @param int|bool $width optional width of the progressbar. This can be an integer representing
+     * @param int|float|bool|null $width optional width of the progressbar. This can be an integer representing
      * the number of characters to display for the progress bar or a float between 0 and 1 representing the
      * percentage of screen with the progress bar may take. It can also be set to false to disable the
      * bar and only show progress information like percent, number of items and ETA.
@@ -1024,7 +1033,7 @@ public static function startProgress($done, $total, $prefix = '', $width = null)
      *
      * @param int $done the number of items that are completed.
      * @param int $total the total value of items that are to be done.
-     * @param string $prefix an optional string to display before the progress bar.
+     * @param string|null $prefix an optional string to display before the progress bar.
      * Defaults to null meaning the prefix specified by [[startProgress()]] will be used.
      * If prefix is specified it will update the prefix that will be used by later calls.
      * @see startProgress
diff --git a/framework/helpers/BaseFileHelper.php b/framework/helpers/BaseFileHelper.php
index 8dd20649e76..35deec5ef49 100644
--- a/src/helpers/BaseFileHelper.php
+++ b/src/helpers/BaseFileHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -161,6 +161,7 @@ public static function getMimeType($file, $magicFile = null, $checkExtension = t
 
             throw new InvalidConfigException('The fileinfo PHP extension is not installed.');
         }
+
         $info = finfo_open(FILEINFO_MIME_TYPE, $magicFile);
 
         if ($info) {
@@ -220,7 +221,7 @@ public static function getExtensionsByMimeType($mimeType, $magicFile = null)
 
     /**
      * Loads MIME types from the specified file.
-     * @param string $magicFile the path (or alias) of the file that contains all available MIME type information.
+     * @param string|null $magicFile the path (or alias) of the file that contains all available MIME type information.
      * If this is not set, the file specified by [[mimeMagicFile]] will be used.
      * @return array the mapping from file extensions to MIME types
      */
@@ -241,7 +242,7 @@ protected static function loadMimeTypes($magicFile)
 
     /**
      * Loads MIME aliases from the specified file.
-     * @param string $aliasesFile the path (or alias) of the file that contains MIME type aliases.
+     * @param string|null $aliasesFile the path (or alias) of the file that contains MIME type aliases.
      * If this is not set, the file specified by [[mimeAliasesFile]] will be used.
      * @return array the mapping from file extensions to MIME types
      * @since 2.0.14
@@ -509,7 +510,7 @@ public static function findFiles($dir, $options = [])
      *   * `false`: the directory will NOT be returned
      *
      * - `recursive`: boolean, whether the files under the subdirectories should also be looked for. Defaults to `true`.
-     * See [[findFiles()]] for more options.
+     *   See [[findFiles()]] for more options.
      * @return array directories found under the directory, in no particular order. Ordering depends on the files system used.
      * @throws InvalidArgumentException if the dir is invalid.
      * @since 2.0.14
@@ -900,8 +901,8 @@ protected static function normalizeOptions(array $options)
      */
     public static function changeOwnership($path, $ownership, $mode = null)
     {
-        if (!file_exists($path)) {
-            throw new InvalidArgumentException('Unable to change ownerhip, "' . $path . '" is not a file or directory.');
+        if (!file_exists((string)$path)) {
+            throw new InvalidArgumentException('Unable to change ownership, "' . $path . '" is not a file or directory.');
         }
 
         if (empty($ownership) && $ownership !== 0 && $mode === null) {
diff --git a/framework/helpers/BaseFormatConverter.php b/framework/helpers/BaseFormatConverter.php
index 84417bfee04..601169d2363 100644
--- a/src/helpers/BaseFormatConverter.php
+++ b/src/helpers/BaseFormatConverter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -92,11 +92,11 @@ class BaseFormatConverter
      * Pattern constructs that are not supported by the PHP format will be removed.
      *
      * [php date() function format]: https://www.php.net/manual/en/function.date.php
-     * [ICU format]: http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax
+     * [ICU format]: https://unicode-org.github.io/icu/userguide/format_parse/datetime/#datetime-format-syntax
      *
      * @param string $pattern date format pattern in ICU format.
      * @param string $type 'date', 'time', or 'datetime'.
-     * @param string $locale the locale to use for converting ICU short patterns `short`, `medium`, `long` and `full`.
+     * @param string|null $locale the locale to use for converting ICU short patterns `short`, `medium`, `long` and `full`.
      * If not given, `Yii::$app->language` will be used.
      * @return string The converted date format pattern.
      */
@@ -119,7 +119,7 @@ public static function convertDateIcuToPhp($pattern, $type = 'date', $locale = n
                 return static::$phpFallbackDatePatterns[$pattern][$type];
             }
         }
-        // http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax
+        // https://unicode-org.github.io/icu/userguide/format_parse/datetime/#datetime-format-syntax
         // escaped text
         $escaped = [];
         if (preg_match_all('/(?<!\')\'(.*?[^\'])\'(?!\')/', $pattern, $matches, PREG_SET_ORDER)) {
@@ -239,7 +239,7 @@ public static function convertDateIcuToPhp($pattern, $type = 'date', $locale = n
      * Pattern constructs that are not supported by the ICU format will be removed.
      *
      * [php date() function format]: https://www.php.net/manual/en/function.date.php
-     * [ICU format]: http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax
+     * [ICU format]: https://unicode-org.github.io/icu/userguide/format_parse/datetime/#datetime-format-syntax
      *
      * Since 2.0.13 it handles escaped characters correctly.
      *
@@ -348,12 +348,12 @@ public static function convertDatePhpToIcu($pattern)
      *
      * Pattern constructs that are not supported by the jQuery UI format will be removed.
      *
-     * [jQuery UI date format]: http://api.jqueryui.com/datepicker/#utility-formatDate
-     * [ICU format]: http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax
+     * [jQuery UI date format]: https://api.jqueryui.com/datepicker/#utility-formatDate
+     * [ICU format]: https://unicode-org.github.io/icu/userguide/format_parse/datetime/#datetime-format-syntax
      *
      * @param string $pattern date format pattern in ICU format.
      * @param string $type 'date', 'time', or 'datetime'.
-     * @param string $locale the locale to use for converting ICU short patterns `short`, `medium`, `long` and `full`.
+     * @param string|null $locale the locale to use for converting ICU short patterns `short`, `medium`, `long` and `full`.
      * If not given, `Yii::$app->language` will be used.
      * @return string The converted date format pattern.
      */
@@ -376,7 +376,7 @@ public static function convertDateIcuToJui($pattern, $type = 'date', $locale = n
                 return static::$juiFallbackDatePatterns[$pattern][$type];
             }
         }
-        // http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax
+        // https://unicode-org.github.io/icu/userguide/format_parse/datetime/#datetime-format-syntax
         // escaped text
         $escaped = [];
         if (preg_match_all('/(?<!\')\'.*?[^\']\'(?!\')/', $pattern, $matches)) {
@@ -498,7 +498,7 @@ public static function convertDateIcuToJui($pattern, $type = 'date', $locale = n
      * Pattern constructs that are not supported by the jQuery UI format will be removed.
      *
      * [php date() function format]: https://www.php.net/manual/en/function.date.php
-     * [jQuery UI date format]: http://api.jqueryui.com/datepicker/#utility-formatDate
+     * [jQuery UI date format]: https://api.jqueryui.com/datepicker/#utility-formatDate
      *
      * @param string $pattern date format pattern in php date()-function format.
      * @return string The converted date format pattern.
diff --git a/framework/helpers/BaseHtml.php b/framework/helpers/BaseHtml.php
index 5d89314971f..bd7f1d6fdd5 100644
--- a/src/helpers/BaseHtml.php
+++ b/src/helpers/BaseHtml.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -31,7 +31,7 @@ class BaseHtml
     public static $attributeRegex = '/(^|.*\])([\w\.\+]+)(\[.*|$)/u';
     /**
      * @var array list of void elements (element name => 1)
-     * @see http://www.w3.org/TR/html-markup/syntax.html#void-element
+     * @see https://html.spec.whatwg.org/multipage/syntax.html#void-element
      */
     public static $voidElements = [
         'area' => 1,
@@ -94,6 +94,13 @@ class BaseHtml
      * @since 2.0.3
      */
     public static $dataAttributes = ['aria', 'data', 'data-ng', 'ng'];
+    /**
+     * @var bool whether to removes duplicate class names in tag attribute `class`
+     * @see mergeCssClasses()
+     * @see renderTagAttributes()
+     * @since 2.0.44
+     */
+    public static $normalizeClassAttribute = false;
 
 
     /**
@@ -108,7 +115,7 @@ class BaseHtml
      */
     public static function encode($content, $doubleEncode = true)
     {
-        return htmlspecialchars($content, ENT_QUOTES | ENT_SUBSTITUTE, Yii::$app ? Yii::$app->charset : 'UTF-8', $doubleEncode);
+        return htmlspecialchars((string)$content, ENT_QUOTES | ENT_SUBSTITUTE, Yii::$app ? Yii::$app->charset : 'UTF-8', $doubleEncode);
     }
 
     /**
@@ -565,7 +572,7 @@ public static function input($type, $name = null, $value = null, $options = [])
 
     /**
      * Generates an input button.
-     * @param string $label the value attribute. If it is null, the value attribute will not be generated.
+     * @param string|null $label the value attribute. If it is null, the value attribute will not be generated.
      * @param array $options the tag options in terms of name-value pairs. These will be rendered as
      * the attributes of the resulting tag. The values will be HTML-encoded using [[encode()]].
      * If a value is null, the corresponding attribute will not be rendered.
@@ -585,7 +592,7 @@ public static function buttonInput($label = 'Button', $options = [])
      * Be careful when naming form elements such as submit buttons. According to the [jQuery documentation](https://api.jquery.com/submit/) there
      * are some reserved names that can cause conflicts, e.g. `submit`, `length`, or `method`.
      *
-     * @param string $label the value attribute. If it is null, the value attribute will not be generated.
+     * @param string|null $label the value attribute. If it is null, the value attribute will not be generated.
      * @param array $options the tag options in terms of name-value pairs. These will be rendered as
      * the attributes of the resulting tag. The values will be HTML-encoded using [[encode()]].
      * If a value is null, the corresponding attribute will not be rendered.
@@ -601,7 +608,7 @@ public static function submitInput($label = 'Submit', $options = [])
 
     /**
      * Generates a reset input button.
-     * @param string $label the value attribute. If it is null, the value attribute will not be generated.
+     * @param string|null $label the value attribute. If it is null, the value attribute will not be generated.
      * @param array $options the attributes of the button tag. The values will be HTML-encoded using [[encode()]].
      * Attributes whose value is null will be ignored and not put in the tag returned.
      * See [[renderTagAttributes()]] for details on how attributes are being rendered.
@@ -1907,7 +1914,7 @@ public static function renderSelectOptions($selection, $items, &$tagOptions = []
                 $attrs['value'] = (string) $key;
                 if (!array_key_exists('selected', $attrs)) {
                     $attrs['selected'] = $selection !== null &&
-                        (!ArrayHelper::isTraversable($selection) && !strcmp($key, $selection)
+                        (!ArrayHelper::isTraversable($selection) && ($strict ? !strcmp($key, $selection) : $selection == $key)
                         || ArrayHelper::isTraversable($selection) && ArrayHelper::isIn((string)$key, $selection, $strict));
                 }
                 $text = $encode ? static::encode($value) : $value;
@@ -1925,7 +1932,7 @@ public static function renderSelectOptions($selection, $items, &$tagOptions = []
      * Renders the HTML tag attributes.
      *
      * Attributes whose values are of boolean type will be treated as
-     * [boolean attributes](http://www.w3.org/TR/html5/infrastructure.html#boolean-attributes).
+     * [boolean attributes](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attributes).
      *
      * Attributes whose values are null will not be rendered.
      *
@@ -1981,6 +1988,11 @@ public static function renderTagAttributes($attributes)
                     if (empty($value)) {
                         continue;
                     }
+                    if (static::$normalizeClassAttribute === true && count($value) > 1) {
+                        // removes duplicate classes
+                        $value = explode(' ', implode(' ', $value));
+                        $value = array_unique($value);
+                    }
                     $html .= " $name=\"" . static::encode(implode(' ', $value)) . '"';
                 } elseif ($name === 'style') {
                     if (empty($value)) {
@@ -2047,7 +2059,7 @@ private static function mergeCssClasses(array $existingClasses, array $additiona
             }
         }
 
-        return array_unique($existingClasses);
+        return static::$normalizeClassAttribute ? array_unique($existingClasses) : $existingClasses;
     }
 
     /**
diff --git a/framework/helpers/BaseHtmlPurifier.php b/framework/helpers/BaseHtmlPurifier.php
index 3c748a09b94..2397bff57ad 100644
--- a/src/helpers/BaseHtmlPurifier.php
+++ b/src/helpers/BaseHtmlPurifier.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/BaseInflector.php b/framework/helpers/BaseInflector.php
index 4cad3f92279..2f32ee80432 100644
--- a/src/helpers/BaseInflector.php
+++ b/src/helpers/BaseInflector.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -246,8 +246,8 @@ class BaseInflector
      * `huò qǔ dào dochira Ukraí̈nsʹka: g̀,ê, Srpska: đ, n̂, d̂! ¿Español?`.
      *
      * Used in [[transliterate()]].
-     * For detailed information see [unicode normalization forms](http://unicode.org/reports/tr15/#Normalization_Forms_Table)
-     * @see http://unicode.org/reports/tr15/#Normalization_Forms_Table
+     * For detailed information see [unicode normalization forms](https://unicode.org/reports/tr15/#Normalization_Forms_Table)
+     * @see https://unicode.org/reports/tr15/#Normalization_Forms_Table
      * @see transliterate()
      * @since 2.0.7
      */
@@ -261,8 +261,8 @@ class BaseInflector
      * `huo qu dao dochira Ukrainsʹka: g,e, Srpska: d, n, d! ¿Espanol?`.
      *
      * Used in [[transliterate()]].
-     * For detailed information see [unicode normalization forms](http://unicode.org/reports/tr15/#Normalization_Forms_Table)
-     * @see http://unicode.org/reports/tr15/#Normalization_Forms_Table
+     * For detailed information see [unicode normalization forms](https://unicode.org/reports/tr15/#Normalization_Forms_Table)
+     * @see https://unicode.org/reports/tr15/#Normalization_Forms_Table
      * @see transliterate()
      * @since 2.0.7
      */
@@ -277,8 +277,8 @@ class BaseInflector
      * `huo qu dao dochira Ukrainska: g,e, Srpska: d, n, d! Espanol?`.
      *
      * Used in [[transliterate()]].
-     * For detailed information see [unicode normalization forms](http://unicode.org/reports/tr15/#Normalization_Forms_Table)
-     * @see http://unicode.org/reports/tr15/#Normalization_Forms_Table
+     * For detailed information see [unicode normalization forms](https://unicode.org/reports/tr15/#Normalization_Forms_Table)
+     * @see https://unicode.org/reports/tr15/#Normalization_Forms_Table
      * @see transliterate()
      * @since 2.0.7
      */
@@ -301,6 +301,9 @@ class BaseInflector
      */
     public static function pluralize($word)
     {
+        if (empty($word)) {
+            return (string) $word;
+        }
         if (isset(static::$specials[$word])) {
             return static::$specials[$word];
         }
@@ -320,6 +323,9 @@ public static function pluralize($word)
      */
     public static function singularize($word)
     {
+        if (empty($word)) {
+            return (string) $word;
+        }
         $result = array_search($word, static::$specials, true);
         if ($result !== false) {
             return $result;
@@ -342,6 +348,9 @@ public static function singularize($word)
      */
     public static function titleize($words, $ucAll = false)
     {
+        if (empty($words)) {
+            return (string) $words;
+        }
         $words = static::humanize(static::underscore($words), $ucAll);
 
         return $ucAll ? StringHelper::mb_ucwords($words, self::encoding()) : StringHelper::mb_ucfirst($words, self::encoding());
@@ -359,6 +368,9 @@ public static function titleize($words, $ucAll = false)
      */
     public static function camelize($word)
     {
+        if (empty($word)) {
+            return (string) $word;
+        }
         return str_replace(' ', '', StringHelper::mb_ucwords(preg_replace('/[^\pL\pN]+/u', ' ', $word), self::encoding()));
     }
 
@@ -371,6 +383,9 @@ public static function camelize($word)
      */
     public static function camel2words($name, $ucwords = true)
     {
+        if (empty($name)) {
+            return (string) $name;
+        }
         // Add a space before any uppercase letter preceded by a lowercase letter (xY => x Y)
         // and any uppercase letter preceded by an uppercase letter and followed by a lowercase letter (XYz => X Yz)
         $label = preg_replace('/(?<=\p{Ll})\p{Lu}|(?<=\p{L})\p{Lu}(?=\p{Ll})/u', ' \0', $name);
@@ -391,6 +406,9 @@ public static function camel2words($name, $ucwords = true)
      */
     public static function camel2id($name, $separator = '-', $strict = false)
     {
+        if (empty($name)) {
+            return (string) $name;
+        }
         $regex = $strict ? '/\p{Lu}/u' : '/(?<!\p{Lu})\p{Lu}/u';
         if ($separator === '_') {
             return mb_strtolower(trim(preg_replace($regex, '_\0', $name), '_'), self::encoding());
@@ -409,6 +427,9 @@ public static function camel2id($name, $separator = '-', $strict = false)
      */
     public static function id2camel($id, $separator = '-')
     {
+        if (empty($id)) {
+            return (string) $id;
+        }
         return str_replace(' ', '', StringHelper::mb_ucwords(str_replace($separator, ' ', $id), self::encoding()));
     }
 
@@ -419,6 +440,9 @@ public static function id2camel($id, $separator = '-')
      */
     public static function underscore($words)
     {
+        if (empty($words)) {
+            return (string) $words;
+        }
         return mb_strtolower(preg_replace('/(?<=\\pL)(\\p{Lu})/u', '_\\1', $words), self::encoding());
     }
 
@@ -430,6 +454,9 @@ public static function underscore($words)
      */
     public static function humanize($word, $ucAll = false)
     {
+        if (empty($word)) {
+            return (string) $word;
+        }
         $word = str_replace('_', ' ', preg_replace('/_id$/', '', $word));
         $encoding = self::encoding();
 
@@ -447,6 +474,9 @@ public static function humanize($word, $ucAll = false)
      */
     public static function variablize($word)
     {
+        if (empty($word)) {
+            return (string) $word;
+        }
         $word = static::camelize($word);
 
         return mb_strtolower(mb_substr($word, 0, 1, self::encoding())) . mb_substr($word, 1, null, self::encoding());
@@ -461,6 +491,9 @@ public static function variablize($word)
      */
     public static function tableize($className)
     {
+        if (empty($className)) {
+            return (string) $className;
+        }
         return static::pluralize(static::underscore($className));
     }
 
@@ -479,6 +512,9 @@ public static function tableize($className)
      */
     public static function slug($string, $replacement = '-', $lowercase = true)
     {
+        if (empty($string)) {
+            return (string) $string;
+        }
         if ((string)$replacement !== '') {
             $parts = explode($replacement, static::transliterate($string));
         } else {
@@ -506,13 +542,16 @@ public static function slug($string, $replacement = '-', $lowercase = true)
      * of the helper.
      *
      * @param string $string input string
-     * @param string|\Transliterator $transliterator either a [[\Transliterator]] or a string
+     * @param string|\Transliterator|null $transliterator either a [[\Transliterator]] or a string
      * from which a [[\Transliterator]] can be built.
      * @return string
      * @since 2.0.7 this method is public.
      */
     public static function transliterate($string, $transliterator = null)
     {
+        if (empty($string)) {
+            return (string) $string;
+        }
         if (static::hasIntl()) {
             if ($transliterator === null) {
                 $transliterator = static::$transliterator;
@@ -541,6 +580,9 @@ protected static function hasIntl()
      */
     public static function classify($tableName)
     {
+        if (empty($tableName)) {
+            return (string) $tableName;
+        }
         return static::camelize(static::singularize($tableName));
     }
 
@@ -586,8 +628,8 @@ public static function ordinalize($number)
      * ```
      *
      * @param array $words the words to be converted into an string
-     * @param string $twoWordsConnector the string connecting words when there are only two
-     * @param string $lastWordConnector the string connecting the last two words. If this is null, it will
+     * @param string|null $twoWordsConnector the string connecting words when there are only two
+     * @param string|null $lastWordConnector the string connecting the last two words. If this is null, it will
      * take the value of `$twoWordsConnector`.
      * @param string $connector the string connecting words other than those connected by
      * $lastWordConnector and $twoWordsConnector
diff --git a/framework/helpers/BaseIpHelper.php b/framework/helpers/BaseIpHelper.php
index 57f7a4dfeb9..5ab73a63106 100644
--- a/src/helpers/BaseIpHelper.php
+++ b/src/helpers/BaseIpHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/BaseJson.php b/framework/helpers/BaseJson.php
index ad41de7f714..eaaee0fbd05 100644
--- a/src/helpers/BaseJson.php
+++ b/src/helpers/BaseJson.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -30,7 +30,6 @@ class BaseJson
      * @since 2.0.43
      */
     public static $prettyPrint;
-
     /**
      * @var bool Avoids objects with zero-indexed keys to be encoded as array
      * `Json::encode((object)['test'])` will be encoded as an object not as an array. This matches the behaviour of `json_encode()`.
@@ -40,7 +39,6 @@ class BaseJson
      * @since 2.0.44
      */
     public static $keepObjectType = false;
-
     /**
      * @var array List of JSON Error messages assigned to constant names for better handling of PHP <= 5.5.
      * @since 2.0.7
diff --git a/framework/helpers/BaseMarkdown.php b/framework/helpers/BaseMarkdown.php
index 9b88c725018..b0c7117330f 100644
--- a/src/helpers/BaseMarkdown.php
+++ b/src/helpers/BaseMarkdown.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -54,7 +54,7 @@ class BaseMarkdown
      * Converts markdown into HTML.
      *
      * @param string $markdown the markdown text to parse
-     * @param string $flavor the markdown flavor to use. See [[$flavors]] for available values.
+     * @param string|null $flavor the markdown flavor to use. See [[$flavors]] for available values.
      * Defaults to [[$defaultFlavor]], if not set.
      * @return string the parsed HTML output
      * @throws InvalidArgumentException when an undefined flavor is given.
@@ -72,7 +72,7 @@ public static function process($markdown, $flavor = null)
      * This can be useful for parsing small comments or description lines.
      *
      * @param string $markdown the markdown text to parse
-     * @param string $flavor the markdown flavor to use. See [[$flavors]] for available values.
+     * @param string|null $flavor the markdown flavor to use. See [[$flavors]] for available values.
      * Defaults to [[$defaultFlavor]], if not set.
      * @return string the parsed HTML output
      * @throws InvalidArgumentException when an undefined flavor is given.
@@ -85,7 +85,7 @@ public static function processParagraph($markdown, $flavor = null)
     }
 
     /**
-     * @param string $flavor the markdown flavor to use. See [[$flavors]] for available values.
+     * @param string|null $flavor the markdown flavor to use. See [[$flavors]] for available values.
      * Defaults to [[$defaultFlavor]], if not set.
      * @return \cebe\markdown\Parser
      * @throws InvalidArgumentException when an undefined flavor is given.
diff --git a/framework/helpers/BaseStringHelper.php b/framework/helpers/BaseStringHelper.php
index 738147ea4c9..ba0975fa7ea 100644
--- a/src/helpers/BaseStringHelper.php
+++ b/src/helpers/BaseStringHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -29,7 +29,7 @@ class BaseStringHelper
      */
     public static function byteLength($string)
     {
-        return mb_strlen($string, '8bit');
+        return mb_strlen((string)$string, '8bit');
     }
 
     /**
@@ -38,7 +38,7 @@ public static function byteLength($string)
      *
      * @param string $string the input string. Must be one character or longer.
      * @param int $start the starting position
-     * @param int $length the desired portion length. If not specified or `null`, there will be
+     * @param int|null $length the desired portion length. If not specified or `null`, there will be
      * no limit on length i.e. the output will be until the end of the string.
      * @return string the extracted part of string, or FALSE on failure or an empty string.
      * @see https://www.php.net/manual/en/function.substr.php
@@ -108,10 +108,14 @@ public static function dirname($path)
     /**
      * Truncates a string to the number of characters specified.
      *
+     * In order to truncate for an exact length, the $suffix char length must be counted towards the $length. For example
+     * to have a string which is exactly 255 long with $suffix `...` of 3 chars, then `StringHelper::truncate($string, 252, '...')`
+     * must be used to ensure you have 255 long string afterwards.
+     *
      * @param string $string The string to truncate.
      * @param int $length How many characters from original string to include into truncated string.
      * @param string $suffix String to append to the end of truncated string.
-     * @param string $encoding The charset to use, defaults to charset currently used by application.
+     * @param string|null $encoding The charset to use, defaults to charset currently used by application.
      * @param bool $asHtml Whether to treat the string being truncated as HTML and preserve proper HTML tags.
      * This parameter is available since version 2.0.1.
      * @return string the truncated string.
@@ -148,7 +152,7 @@ public static function truncateWords($string, $count, $suffix = '...', $asHtml =
             return static::truncateHtml($string, $count, $suffix);
         }
 
-        $words = preg_split('/(\s+)/u', trim($string), null, PREG_SPLIT_DELIM_CAPTURE);
+        $words = preg_split('/(\s+)/u', trim($string), 0, PREG_SPLIT_DELIM_CAPTURE);
         if (count($words) / 2 > $count) {
             return implode('', array_slice($words, 0, ($count * 2) - 1)) . $suffix;
         }
@@ -316,7 +320,7 @@ public static function explode($string, $delimiter = ',', $trim = true, $skipEmp
      */
     public static function countWords($string)
     {
-        return count(preg_split('/\s+/u', $string, null, PREG_SPLIT_NO_EMPTY));
+        return count(preg_split('/\s+/u', $string, 0, PREG_SPLIT_NO_EMPTY));
     }
 
     /**
@@ -436,7 +440,7 @@ public static function matchWildcard($pattern, $string, $options = [])
             $pattern .= 'i';
         }
 
-        return preg_match($pattern, $string) === 1;
+        return preg_match($pattern, (string)$string) === 1;
     }
 
     /**
@@ -450,8 +454,8 @@ public static function matchWildcard($pattern, $string, $options = [])
      */
     public static function mb_ucfirst($string, $encoding = 'UTF-8')
     {
-        $firstChar = mb_substr($string, 0, 1, $encoding);
-        $rest = mb_substr($string, 1, null, $encoding);
+        $firstChar = mb_substr((string)$string, 0, 1, $encoding);
+        $rest = mb_substr((string)$string, 1, null, $encoding);
 
         return mb_strtoupper($firstChar, $encoding) . $rest;
     }
diff --git a/framework/helpers/BaseUrl.php b/framework/helpers/BaseUrl.php
index fdf4f53d3d6..a671123c7cd 100644
--- a/src/helpers/BaseUrl.php
+++ b/src/helpers/BaseUrl.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
@@ -71,7 +71,7 @@ class BaseUrl
      * // /index.php?r=site%2Findex&src=ref1#name
      * echo Url::toRoute(['site/index', 'src' => 'ref1', '#' => 'name']);
      *
-     * // http://www.example.com/index.php?r=site%2Findex
+     * // https://www.example.com/index.php?r=site%2Findex
      * echo Url::toRoute('site/index', true);
      *
      * // https://www.example.com/index.php?r=site%2Findex
@@ -186,7 +186,7 @@ protected static function normalizeRoute($route)
      * // images/logo.gif
      * echo Url::to('images/logo.gif');
      *
-     * // http://www.example.com/images/logo.gif
+     * // https://www.example.com/images/logo.gif
      * echo Url::to('@web/images/logo.gif', true);
      *
      * // https://www.example.com/images/logo.gif
@@ -290,7 +290,7 @@ public static function base($scheme = false)
      *
      * @param string|array $url the URL to remember. Please refer to [[to()]] for acceptable formats.
      * If this parameter is not specified, the currently requested URL will be used.
-     * @param string $name the name associated with the URL to be remembered. This can be used
+     * @param string|null $name the name associated with the URL to be remembered. This can be used
      * later by [[previous()]]. If not set, [[\yii\web\User::setReturnUrl()]] will be used with passed URL.
      * @see previous()
      * @see \yii\web\User::setReturnUrl()
@@ -309,7 +309,7 @@ public static function remember($url = '', $name = null)
     /**
      * Returns the URL previously [[remember()|remembered]].
      *
-     * @param string $name the named associated with the URL that was remembered previously.
+     * @param string|null $name the named associated with the URL that was remembered previously.
      * If not set, [[\yii\web\User::getReturnUrl()]] will be used to obtain remembered URL.
      * @return string|null the URL previously remembered. Null is returned if no URL was remembered with the given name
      * and `$name` is not specified.
diff --git a/framework/helpers/BaseVarDumper.php b/framework/helpers/BaseVarDumper.php
index 5cb57ce2ec5..070a42278df 100644
--- a/src/helpers/BaseVarDumper.php
+++ b/src/helpers/BaseVarDumper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/Console.php b/framework/helpers/Console.php
index a34dc968742..fe8336f8084 100644
--- a/src/helpers/Console.php
+++ b/src/helpers/Console.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/FileHelper.php b/framework/helpers/FileHelper.php
index 9322661d82f..7ed3c413bc1 100644
--- a/src/helpers/FileHelper.php
+++ b/src/helpers/FileHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/FormatConverter.php b/framework/helpers/FormatConverter.php
index 4b75325f522..bfc4dcaef5f 100644
--- a/src/helpers/FormatConverter.php
+++ b/src/helpers/FormatConverter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/Html.php b/framework/helpers/Html.php
index 94c78c8aed1..9a980e5b429 100644
--- a/src/helpers/Html.php
+++ b/src/helpers/Html.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/HtmlPurifier.php b/framework/helpers/HtmlPurifier.php
index 71b229b381f..6157c43983d 100644
--- a/src/helpers/HtmlPurifier.php
+++ b/src/helpers/HtmlPurifier.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/Inflector.php b/framework/helpers/Inflector.php
index ab4713ea577..f2530022be9 100644
--- a/src/helpers/Inflector.php
+++ b/src/helpers/Inflector.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/IpHelper.php b/framework/helpers/IpHelper.php
index 1831659df75..aa0b8c915b1 100644
--- a/src/helpers/IpHelper.php
+++ b/src/helpers/IpHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/Json.php b/framework/helpers/Json.php
index 8ca436a32b7..cb67c11d601 100644
--- a/src/helpers/Json.php
+++ b/src/helpers/Json.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/Markdown.php b/framework/helpers/Markdown.php
index c86e5e47664..4cc8848dac5 100644
--- a/src/helpers/Markdown.php
+++ b/src/helpers/Markdown.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/ReplaceArrayValue.php b/framework/helpers/ReplaceArrayValue.php
index 3ce281cd2e3..3ed6208f26f 100644
--- a/src/helpers/ReplaceArrayValue.php
+++ b/src/helpers/ReplaceArrayValue.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/StringHelper.php b/framework/helpers/StringHelper.php
index 73960a35db8..27ff061ebe8 100644
--- a/src/helpers/StringHelper.php
+++ b/src/helpers/StringHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/UnsetArrayValue.php b/framework/helpers/UnsetArrayValue.php
index 331b0619a43..25e67bbc0d4 100644
--- a/src/helpers/UnsetArrayValue.php
+++ b/src/helpers/UnsetArrayValue.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/Url.php b/framework/helpers/Url.php
index 7c52e09d633..d9c6a3db9de 100644
--- a/src/helpers/Url.php
+++ b/src/helpers/Url.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/VarDumper.php b/framework/helpers/VarDumper.php
index fcffecb478a..d75521fb7a7 100644
--- a/src/helpers/VarDumper.php
+++ b/src/helpers/VarDumper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\helpers;
diff --git a/framework/helpers/mimeAliases.php b/framework/helpers/mimeAliases.php
index 97abc324fd1..4cd89888a77 100644
--- a/src/helpers/mimeAliases.php
+++ b/src/helpers/mimeAliases.php
@@ -5,6 +5,7 @@
  * This file contains aliases for MIME types.
  */
 return [
+    'text/rtf' => 'application/rtf',
     'text/xml' => 'application/xml',
     'image/svg' => 'image/svg+xml',
     'image/x-bmp' => 'image/bmp',
diff --git a/framework/helpers/mimeTypes.php b/framework/helpers/mimeTypes.php
index 3056874fd6c..944633aa5d2 100644
--- a/src/helpers/mimeTypes.php
+++ b/src/helpers/mimeTypes.php
@@ -5,10 +5,10 @@
  * This file contains most commonly used MIME types
  * according to file extension names.
  * Its content is generated from the apache http mime.types file.
- * http://svn.apache.org/viewvc/httpd/httpd/trunk/docs/conf/mime.types?view=markup
+ * https://svn.apache.org/viewvc/httpd/httpd/trunk/docs/conf/mime.types?view=markup
  * This file has been placed in the public domain for unlimited redistribution.
  */
-return [
+$mimeTypes = [
     '3dml' => 'text/vnd.in3d.3dml',
     '3ds' => 'image/x-3ds',
     '3g2' => 'video/3gpp2',
@@ -355,6 +355,7 @@
     'jam' => 'application/vnd.jam',
     'jar' => 'application/java-archive',
     'java' => 'text/x-java-source',
+    'jfif' => 'image/jpeg',
     'jisp' => 'application/vnd.jisp',
     'jlt' => 'application/vnd.hp-jlyt',
     'jnlp' => 'application/x-java-jnlp-file',
@@ -400,6 +401,7 @@
     'log' => 'text/plain',
     'lostxml' => 'application/lost+xml',
     'lrf' => 'application/octet-stream',
+    0 => 'application/vnd.lotus-1-2-3',
     'lrm' => 'application/vnd.ms-lrm',
     'ltf' => 'application/vnd.frogans.ltf',
     'lvp' => 'audio/vnd.lucent.voice',
@@ -491,7 +493,6 @@
     'mseed' => 'application/vnd.fdsn.mseed',
     'mseq' => 'application/vnd.mseq',
     'msf' => 'application/vnd.epson.msf',
-    0 => 'application/vnd.lotus-1-2-3',
     'msh' => 'model/mesh',
     'msi' => 'application/x-msdownload',
     'msl' => 'application/vnd.mobius.msl',
@@ -995,3 +996,9 @@
     'zirz' => 'application/vnd.zul',
     'zmm' => 'application/vnd.handheld-entertainment+xml',
 ];
+
+if (PHP_VERSION_ID >= 80100) {
+    $mimeTypes = array_replace($mimeTypes, array('xz' => 'application/octet-stream'));
+}
+
+return $mimeTypes;
diff --git a/framework/i18n/DbMessageSource.php b/framework/i18n/DbMessageSource.php
index e2048c20354..0686291d2a7 100644
--- a/src/i18n/DbMessageSource.php
+++ b/src/i18n/DbMessageSource.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
diff --git a/framework/i18n/Formatter.php b/framework/i18n/Formatter.php
index cf67ddfa0f0..3236a433beb 100644
--- a/src/i18n/Formatter.php
+++ b/src/i18n/Formatter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -79,7 +79,7 @@ class Formatter extends Component
     const UNIT_WEIGHT = 'mass';
 
     /**
-     * @var string the text to be displayed when formatting a `null` value.
+     * @var string|null the text to be displayed when formatting a `null` value.
      * Defaults to `'<span class="not-set">(not set)</span>'`, where `(not set)`
      * will be translated according to [[locale]].
      */
@@ -92,21 +92,21 @@ class Formatter extends Component
      */
     public $booleanFormat;
     /**
-     * @var string the locale ID that is used to localize the date and number formatting.
+     * @var string|null the locale ID that is used to localize the date and number formatting.
      * For number and date formatting this is only effective when the
      * [PHP intl extension](https://www.php.net/manual/en/book.intl.php) is installed.
      * If not set, [[\yii\base\Application::language]] will be used.
      */
     public $locale;
     /**
-     * @var string the language code (e.g. `en-US`, `en`) that is used to translate internal messages.
+     * @var string|null the language code (e.g. `en-US`, `en`) that is used to translate internal messages.
      * If not set, [[locale]] will be used (without the `@calendar` param, if included).
      *
      * @since 2.0.28
      */
     public $language;
     /**
-     * @var string the time zone to use for formatting time and date values.
+     * @var string|null the time zone to use for formatting time and date values.
      *
      * This can be any value that may be passed to [date_default_timezone_set()](https://www.php.net/manual/en/function.date-default-timezone-set.php)
      * e.g. `UTC`, `Europe/Berlin` or `America/Chicago`.
@@ -135,7 +135,7 @@ class Formatter extends Component
      * @var string the default format string to be used to format a [[asDate()|date]].
      * This can be "short", "medium", "long", or "full", which represents a preset format of different lengths.
      *
-     * It can also be a custom format as specified in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax).
+     * It can also be a custom format as specified in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/).
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the
      * PHP [date()](https://www.php.net/manual/en/function.date.php)-function.
      *
@@ -151,7 +151,7 @@ class Formatter extends Component
      * @var string the default format string to be used to format a [[asTime()|time]].
      * This can be "short", "medium", "long", or "full", which represents a preset format of different lengths.
      *
-     * It can also be a custom format as specified in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax).
+     * It can also be a custom format as specified in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/).
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the
      * PHP [date()](https://www.php.net/manual/en/function.date.php)-function.
      *
@@ -167,10 +167,10 @@ class Formatter extends Component
      * @var string the default format string to be used to format a [[asDatetime()|date and time]].
      * This can be "short", "medium", "long", or "full", which represents a preset format of different lengths.
      *
-     * It can also be a custom format as specified in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax).
+     * It can also be a custom format as specified in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/).
      *
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the
-     * PHP [date()](https://www.php.net/manual/en/function.date.php)-function.
+     * PHP [date()](https://www.php.net/manual/en/function.date.php) function.
      *
      * For example:
      *
@@ -198,7 +198,7 @@ class Formatter extends Component
      * ],
      * ```
      *
-     * Available calendar names can be found in the [ICU manual](http://userguide.icu-project.org/datetime/calendar).
+     * Available calendar names can be found in the [ICU manual](https://unicode-org.github.io/icu/userguide/datetime/calendar/).
      *
      * Since PHP 5.5 you may also use an instance of the [[\IntlCalendar]] class.
      * Check the [PHP manual](https://www.php.net/manual/en/intldateformatter.create.php) for more details.
@@ -218,7 +218,7 @@ class Formatter extends Component
      */
     public $decimalSeparator;
     /**
-     * @var string the character displayed as the decimal point when formatting a currency.
+     * @var string|null the character displayed as the decimal point when formatting a currency.
      * If not set, the currency decimal separator corresponding to [[locale]] will be used.
      * If [PHP intl extension](https://www.php.net/manual/en/book.intl.php) is not available, setting this property will have no effect.
      * @since 2.0.35
@@ -276,7 +276,7 @@ class Formatter extends Component
      * Please refer to the [PHP manual](https://www.php.net/manual/en/class.numberformatter.php#intl.numberformatter-constants.unumberformatsymbol)
      * for the possible options.
      *
-     * For example to choose a custom currency symbol, e.g. [U+20BD](http://unicode-table.com/en/20BD/) instead of `руб.` for Russian Ruble:
+     * For example to choose a custom currency symbol, e.g. [U+20BD](https://unicode-table.com/en/20BD/) instead of `руб.` for Russian Ruble:
      *
      * ```php
      * [
@@ -622,7 +622,7 @@ public function asBoolean($value)
 
     /**
      * Formats the value as a date.
-     * @param int|string|DateTime|DateTimeInterface $value the value to be formatted. The following
+     * @param int|string|DateTime|DateTimeInterface|null $value the value to be formatted. The following
      * types of value are supported:
      *
      * - an integer representing a UNIX timestamp. A UNIX timestamp is always in UTC by its definition.
@@ -639,7 +639,7 @@ public function asBoolean($value)
      * If null, [[dateFormat]] will be used.
      *
      * This can be "short", "medium", "long", or "full", which represents a preset format of different lengths.
-     * It can also be a custom format as specified in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime).
+     * It can also be a custom format as specified in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/).
      *
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the
      * PHP [date()](https://www.php.net/manual/en/function.date.php)-function.
@@ -660,7 +660,7 @@ public function asDate($value, $format = null)
 
     /**
      * Formats the value as a time.
-     * @param int|string|DateTime|DateTimeInterface $value the value to be formatted. The following
+     * @param int|string|DateTime|DateTimeInterface|null $value the value to be formatted. The following
      * types of value are supported:
      *
      * - an integer representing a UNIX timestamp. A UNIX timestamp is always in UTC by its definition.
@@ -676,7 +676,7 @@ public function asDate($value, $format = null)
      * If null, [[timeFormat]] will be used.
      *
      * This can be "short", "medium", "long", or "full", which represents a preset format of different lengths.
-     * It can also be a custom format as specified in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime).
+     * It can also be a custom format as specified in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/).
      *
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the
      * PHP [date()](https://www.php.net/manual/en/function.date.php)-function.
@@ -697,7 +697,7 @@ public function asTime($value, $format = null)
 
     /**
      * Formats the value as a datetime.
-     * @param int|string|DateTime|DateTimeInterface $value the value to be formatted. The following
+     * @param int|string|DateTime|DateTimeInterface|null $value the value to be formatted. The following
      * types of value are supported:
      *
      * - an integer representing a UNIX timestamp. A UNIX timestamp is always in UTC by its definition.
@@ -713,7 +713,7 @@ public function asTime($value, $format = null)
      * If null, [[datetimeFormat]] will be used.
      *
      * This can be "short", "medium", "long", or "full", which represents a preset format of different lengths.
-     * It can also be a custom format as specified in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime).
+     * It can also be a custom format as specified in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/).
      *
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the
      * PHP [date()](https://www.php.net/manual/en/function.date.php)-function.
@@ -944,7 +944,7 @@ public function asTimestamp($value)
      * 2. Using a timestamp that is relative to the `$referenceTime`.
      * 3. Using a `DateInterval` object.
      *
-     * @param int|string|DateTime|DateTimeInterface|DateInterval $value the value to be formatted. The following
+     * @param int|string|DateTime|DateTimeInterface|DateInterval|null $value the value to be formatted. The following
      * types of value are supported:
      *
      * - an integer representing a UNIX timestamp
@@ -1403,7 +1403,7 @@ public function asOrdinal($value)
      *
      * This is the short form of [[asSize]].
      *
-     * If [[sizeFormatBase]] is 1024, [binary prefixes](http://en.wikipedia.org/wiki/Binary_prefix) (e.g. kibibyte/KiB, mebibyte/MiB, ...)
+     * If [[sizeFormatBase]] is 1024, [binary prefixes](https://en.wikipedia.org/wiki/Binary_prefix) (e.g. kibibyte/KiB, mebibyte/MiB, ...)
      * are used in the formatting result.
      *
      * @param string|int|float|null $value value in bytes to be formatted.
@@ -1459,7 +1459,7 @@ public function asShortSize($value, $decimals = null, $options = [], $textOption
     /**
      * Formats the value in bytes as a size in human readable form, for example `12 kilobytes`.
      *
-     * If [[sizeFormatBase]] is 1024, [binary prefixes](http://en.wikipedia.org/wiki/Binary_prefix) (e.g. kibibyte/KiB, mebibyte/MiB, ...)
+     * If [[sizeFormatBase]] is 1024, [binary prefixes](https://en.wikipedia.org/wiki/Binary_prefix) (e.g. kibibyte/KiB, mebibyte/MiB, ...)
      * are used in the formatting result.
      *
      * @param string|int|float|null $value value in bytes to be formatted.
@@ -1636,15 +1636,15 @@ private function formatUnit($unitType, $unitFormat, $value, $decimals, $options,
     /**
      * @param string $unitType one of [[UNIT_WEIGHT]], [[UNIT_LENGTH]]
      * @param string $unitFormat one of [[FORMAT_WIDTH_SHORT]], [[FORMAT_WIDTH_LONG]]
-     * @param string $system either [[UNIT_SYSTEM_METRIC]] or [[UNIT_SYSTEM_IMPERIAL]]. When `null`, property [[systemOfUnits]] will be used.
+     * @param string|null $system either [[UNIT_SYSTEM_METRIC]] or [[UNIT_SYSTEM_IMPERIAL]]. When `null`, property [[systemOfUnits]] will be used.
      * @param int $position internal position of size unit
      * @return string
      * @throws InvalidConfigException when INTL is not installed or does not contain required information
      */
     private function getUnitMessage($unitType, $unitFormat, $system, $position)
     {
-        if (isset($this->_unitMessages[$unitType][$system][$position])) {
-            return $this->_unitMessages[$unitType][$system][$position];
+        if (isset($this->_unitMessages[$unitType][$unitFormat][$system][$position])) {
+            return $this->_unitMessages[$unitType][$unitFormat][$system][$position];
         }
         if (!$this->_intlLoaded) {
             throw new InvalidConfigException('Format of ' . $unitType . ' is only supported when PHP intl extension is installed.');
@@ -1676,7 +1676,7 @@ private function getUnitMessage($unitType, $unitFormat, $system, $position)
             $message[] = "$key{{$value}}";
         }
 
-        return $this->_unitMessages[$unitType][$system][$position] = '{n, plural, ' . implode(' ', $message) . '}';
+        return $this->_unitMessages[$unitType][$unitFormat][$system][$position] = '{n, plural, ' . implode(' ', $message) . '}';
     }
 
     /**
@@ -1738,7 +1738,7 @@ protected function formatNumber($value, $decimals, $maxPosition, $formatBase, $o
         $params = [
             // this is the unformatted number used for the plural rule
             // abs() to make sure the plural rules work correctly on negative numbers, intl does not cover this
-            // http://english.stackexchange.com/questions/9735/is-1-singular-or-plural
+            // https://english.stackexchange.com/questions/9735/is-1-followed-by-a-singular-or-plural-noun
             'n' => abs($value),
             // this is the formatted number used for display
             'nFormatted' => $this->asDecimal($value, $decimals, $options, $textOptions),
diff --git a/framework/i18n/GettextFile.php b/framework/i18n/GettextFile.php
index 57f2e90f642..6e320348c31 100644
--- a/src/i18n/GettextFile.php
+++ b/src/i18n/GettextFile.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
diff --git a/framework/i18n/GettextMessageSource.php b/framework/i18n/GettextMessageSource.php
index b3190ba4c63..b3cb6acd207 100644
--- a/src/i18n/GettextMessageSource.php
+++ b/src/i18n/GettextMessageSource.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -131,7 +131,7 @@ protected function loadFallbackMessages($category, $fallbackLanguage, $messages,
     protected function getMessageFilePath($language)
     {
         $language = (string) $language;
-        if ($language !== '' && !preg_match('/^[a-z_-]+$/i', $language)) {
+        if ($language !== '' && !preg_match('/^[a-z0-9_-]+$/i', $language)) {
             throw new InvalidArgumentException(sprintf('Invalid language code: "%s".', $language));
         }
         $messageFile = Yii::getAlias($this->basePath) . '/' . $language . '/' . $this->catalog;
diff --git a/framework/i18n/GettextMoFile.php b/framework/i18n/GettextMoFile.php
index 43b5afaf1f6..a2d82ec906d 100644
--- a/src/i18n/GettextMoFile.php
+++ b/src/i18n/GettextMoFile.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -106,7 +106,7 @@ public function load($filePath, $context)
         $messages = [];
         for ($i = 0; $i < $count; ++$i) {
             $id = $this->readString($fileHandle, $sourceLengths[$i], $sourceOffsets[$i]);
-            $separatorPosition = strpos($id, chr(4));
+            $separatorPosition = strpos((string)$id, chr(4));
 
 
             if ((!$context && $separatorPosition === false) || ($context && $separatorPosition !== false && strncmp($id, $context, $separatorPosition) === 0)) {
@@ -250,7 +250,7 @@ protected function writeInteger($fileHandle, $integer)
      * Reads a string.
      * @param resource $fileHandle file handle
      * @param int $length of the string
-     * @param int $offset of the string in the file. If null, it reads from the current position.
+     * @param int|null $offset of the string in the file. If null, it reads from the current position.
      * @return string the result
      */
     protected function readString($fileHandle, $length, $offset = null)
diff --git a/framework/i18n/GettextPoFile.php b/framework/i18n/GettextPoFile.php
index d3473e252cc..0469b324b03 100644
--- a/src/i18n/GettextPoFile.php
+++ b/src/i18n/GettextPoFile.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
diff --git a/framework/i18n/I18N.php b/framework/i18n/I18N.php
index 49cf93bd459..d853d754b01 100644
--- a/src/i18n/I18N.php
+++ b/src/i18n/I18N.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
diff --git a/framework/i18n/Locale.php b/framework/i18n/Locale.php
index a0e1a1b48cf..5acf2dc14bf 100644
--- a/src/i18n/Locale.php
+++ b/src/i18n/Locale.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -16,14 +16,14 @@
  *
  * The class requires [PHP intl extension](https://www.php.net/manual/en/book.intl.php) to be installed.
  *
- * @property-read string $currencySymbol This property is read-only.
+ * @property-read string $currencySymbol
  *
  * @since 2.0.14
  */
 class Locale extends Component
 {
     /**
-     * @var string the locale ID.
+     * @var string|null the locale ID.
      * If not set, [[\yii\base\Application::language]] will be used.
      */
     public $locale;
@@ -46,7 +46,7 @@ public function init()
     /**
      * Returns a currency symbol
      *
-     * @param string $currencyCode the 3-letter ISO 4217 currency code to get symbol for. If null,
+     * @param string|null $currencyCode the 3-letter ISO 4217 currency code to get symbol for. If null,
      * method will attempt using currency code from [[locale]].
      * @return string
      */
diff --git a/framework/i18n/MessageFormatter.php b/framework/i18n/MessageFormatter.php
index 47e4246fd21..e9d18fb50c1 100644
--- a/src/i18n/MessageFormatter.php
+++ b/src/i18n/MessageFormatter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -12,7 +12,7 @@
 use yii\base\NotSupportedException;
 
 /**
- * MessageFormatter allows formatting messages via [ICU message format](http://userguide.icu-project.org/formatparse/messages).
+ * MessageFormatter allows formatting messages via [ICU message format](https://unicode-org.github.io/icu/userguide/format_parse/messages/).
  *
  * This class enhances the message formatter class provided by the PHP intl extension.
  *
@@ -36,8 +36,8 @@
  *   Also messages that are working with the fallback implementation are not necessarily compatible with the
  *   PHP intl MessageFormatter so do not rely on the fallback if you are able to install intl extension somehow.
  *
- * @property-read string $errorCode Code of the last error. This property is read-only.
- * @property-read string $errorMessage Description of the last error. This property is read-only.
+ * @property-read string $errorCode Code of the last error.
+ * @property-read string $errorMessage Description of the last error.
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
  * @author Carsten Brandt <mail@cebe.cc>
@@ -70,7 +70,7 @@ public function getErrorMessage()
     }
 
     /**
-     * Formats a message via [ICU message format](http://userguide.icu-project.org/formatparse/messages).
+     * Formats a message via [ICU message format](https://unicode-org.github.io/icu/userguide/format_parse/messages/).
      *
      * It uses the PHP intl extension's [MessageFormatter](https://www.php.net/manual/en/class.messageformatter.php)
      * and works around some issues.
@@ -132,7 +132,7 @@ public function format($pattern, $params, $language)
     }
 
     /**
-     * Parses an input string according to an [ICU message format](http://userguide.icu-project.org/formatparse/messages) pattern.
+     * Parses an input string according to an [ICU message format](https://unicode-org.github.io/icu/userguide/format_parse/messages/) pattern.
      *
      * It uses the PHP intl extension's [MessageFormatter::parse()](https://www.php.net/manual/en/messageformatter.parsemessage.php)
      * and adds support for named arguments.
@@ -341,7 +341,7 @@ private static function tokenizePattern($pattern)
     private function parseToken($token, $args, $locale)
     {
         // parsing pattern based on ICU grammar:
-        // http://icu-project.org/apiref/icu4c/classMessageFormat.html#details
+        // https://unicode-org.github.io/icu-docs/#/icu4c/classMessageFormat.html
         $charset = Yii::$app ? Yii::$app->charset : 'UTF-8';
         $param = trim($token[0]);
         if (isset($args[$param])) {
@@ -374,7 +374,7 @@ private function parseToken($token, $args, $locale)
             case 'none':
                 return $arg;
             case 'select':
-                /* http://icu-project.org/apiref/icu4c/classicu_1_1SelectFormat.html
+                /* https://unicode-org.github.io/icu-docs/#/icu4c/classicu_1_1SelectFormat.html
                 selectStyle = (selector '{' message '}')+
                 */
                 if (!isset($token[2])) {
@@ -397,7 +397,7 @@ private function parseToken($token, $args, $locale)
                 }
                 break;
             case 'plural':
-                /* http://icu-project.org/apiref/icu4c/classicu_1_1PluralFormat.html
+                /* https://unicode-org.github.io/icu-docs/#/icu4c/classicu_1_1PluralFormat.html
                 pluralStyle = [offsetValue] (selector '{' message '}')+
                 offsetValue = "offset:" number
                 selector = explicitValue | keyword
diff --git a/framework/i18n/MessageSource.php b/framework/i18n/MessageSource.php
index 24a4a74cd9d..9725158636f 100644
--- a/src/i18n/MessageSource.php
+++ b/src/i18n/MessageSource.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -33,7 +33,7 @@ class MessageSource extends Component
      */
     public $forceTranslation = false;
     /**
-     * @var string the language that the original messages are in. If not set, it will use the value of
+     * @var string|null the language that the original messages are in. If not set, it will use the value of
      * [[\yii\base\Application::sourceLanguage]].
      */
     public $sourceLanguage;
diff --git a/framework/i18n/MissingTranslationEvent.php b/framework/i18n/MissingTranslationEvent.php
index cfed6093415..67aee4579d8 100644
--- a/src/i18n/MissingTranslationEvent.php
+++ b/src/i18n/MissingTranslationEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -23,7 +23,7 @@ class MissingTranslationEvent extends Event
      */
     public $message;
     /**
-     * @var string the translated message. An event handler may overwrite this property
+     * @var string|null the translated message. An event handler may overwrite this property
      * with a translated version of [[message]] if possible. If not set (null), it means the message is not translated.
      */
     public $translatedMessage;
diff --git a/framework/i18n/PhpMessageSource.php b/framework/i18n/PhpMessageSource.php
index 4dd860a5ced..90183f2e3a5 100644
--- a/src/i18n/PhpMessageSource.php
+++ b/src/i18n/PhpMessageSource.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\i18n;
@@ -72,7 +72,7 @@ protected function loadMessages($category, $language)
         $messageFile = $this->getMessageFilePath($category, $language);
         $messages = $this->loadMessagesFromFile($messageFile);
 
-        $fallbackLanguage = substr($language, 0, 2);
+        $fallbackLanguage = substr((string)$language, 0, 2);
         $fallbackSourceLanguage = substr($this->sourceLanguage, 0, 2);
 
         if ($fallbackLanguage !== '' && $language !== $fallbackLanguage) {
@@ -134,7 +134,7 @@ protected function loadFallbackMessages($category, $fallbackLanguage, $messages,
     protected function getMessageFilePath($category, $language)
     {
         $language = (string) $language;
-        if ($language !== '' && !preg_match('/^[a-z_-]+$/i', $language)) {
+        if ($language !== '' && !preg_match('/^[a-z0-9_-]+$/i', $language)) {
             throw new InvalidArgumentException(sprintf('Invalid language code: "%s".', $language));
         }
         $messageFile = Yii::getAlias($this->basePath) . "/$language/";
diff --git a/framework/i18n/migrations/m150207_210500_i18n_init.php b/framework/i18n/migrations/m150207_210500_i18n_init.php
index fe2aedd55dd..58015294823 100644
--- a/src/i18n/migrations/m150207_210500_i18n_init.php
+++ b/src/i18n/migrations/m150207_210500_i18n_init.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\db\Migration;
@@ -21,7 +21,7 @@ public function up()
     {
         $tableOptions = null;
         if ($this->db->driverName === 'mysql') {
-            // http://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
+            // https://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
             $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
         }
 
diff --git a/framework/i18n/migrations/schema-mssql.sql b/framework/i18n/migrations/schema-mssql.sql
index 261f807cf78..5b79c8e137a 100644
--- a/src/i18n/migrations/schema-mssql.sql
+++ b/src/i18n/migrations/schema-mssql.sql
@@ -2,9 +2,9 @@
  * Database schema required by \yii\i18n\DbMessageSource.
  *
  * @author Dmitry Naumenko <d.naumenko.a@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/i18n/migrations/schema-mysql.sql b/framework/i18n/migrations/schema-mysql.sql
index dec180c7f0f..c6b706357ed 100644
--- a/src/i18n/migrations/schema-mysql.sql
+++ b/src/i18n/migrations/schema-mysql.sql
@@ -2,9 +2,9 @@
  * Database schema required by \yii\i18n\DbMessageSource.
  *
  * @author Dmitry Naumenko <d.naumenko.a@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/i18n/migrations/schema-oci.sql b/framework/i18n/migrations/schema-oci.sql
index edd9c0f0867..bd01b96a846 100644
--- a/src/i18n/migrations/schema-oci.sql
+++ b/src/i18n/migrations/schema-oci.sql
@@ -2,9 +2,9 @@
  * Database schema required by \yii\i18n\DbMessageSource.
  *
  * @author Dmitry Naumenko <d.naumenko.a@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
@@ -30,4 +30,4 @@ CREATE TABLE "message"
 );
 
 CREATE INDEX idx_message_language ON "message"("language");
-CREATE INDEX idx_source_message_category ON "source_message"("category");
\ No newline at end of file
+CREATE INDEX idx_source_message_category ON "source_message"("category");
diff --git a/framework/i18n/migrations/schema-pgsql.sql b/framework/i18n/migrations/schema-pgsql.sql
index 4e447d31c50..5513c86bc03 100644
--- a/src/i18n/migrations/schema-pgsql.sql
+++ b/src/i18n/migrations/schema-pgsql.sql
@@ -2,9 +2,9 @@
  * Database schema required by \yii\i18n\DbMessageSource.
  *
  * @author Dmitry Naumenko <d.naumenko.a@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/i18n/migrations/schema-sqlite.sql b/framework/i18n/migrations/schema-sqlite.sql
index 24db67acabe..aba511932a2 100644
--- a/src/i18n/migrations/schema-sqlite.sql
+++ b/src/i18n/migrations/schema-sqlite.sql
@@ -2,9 +2,9 @@
  * Database schema required by \yii\i18n\DbMessageSource.
  *
  * @author Dmitry Naumenko <d.naumenko.a@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.7
  */
 
diff --git a/framework/log/DbTarget.php b/framework/log/DbTarget.php
index bef9c50c771..c2c3d6a6245 100644
--- a/src/log/DbTarget.php
+++ b/src/log/DbTarget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
diff --git a/framework/log/Dispatcher.php b/framework/log/Dispatcher.php
index 9b4136c04f3..11b6b0016a9 100644
--- a/src/log/Dispatcher.php
+++ b/src/log/Dispatcher.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
@@ -52,7 +52,7 @@
  *
  * @property int $flushInterval How many messages should be logged before they are sent to targets. This
  * method returns the value of [[Logger::flushInterval]].
- * @property Logger $logger The logger. If not set, [[\Yii::getLogger()]] will be used. Note that the type of
+ * @property Logger $logger The logger. If not set, [[Yii::getLogger()]] will be used. Note that the type of
  * this property differs in getter and setter. See [[getLogger()]] and [[setLogger()]] for details.
  * @property int $traceLevel How many application call stacks should be logged together with each message.
  * This method returns the value of [[Logger::traceLevel]]. Defaults to 0.
@@ -69,7 +69,7 @@ class Dispatcher extends Component
     public $targets = [];
 
     /**
-     * @var Logger the logger.
+     * @var Logger|null the logger.
      */
     private $_logger;
 
@@ -123,7 +123,7 @@ public function getLogger()
      * Sets the connected logger.
      * @param Logger|string|array $value the logger to be used. This can either be a logger instance
      * or a configuration that will be used to create one using [[Yii::createObject()]].
-     * If you are providing custom logger configuration and would like it to be used for the whole application 
+     * If you are providing custom logger configuration and would like it to be used for the whole application
      * and not just for the dispatcher you should use [[Yii::setLogger()]] instead.
      */
     public function setLogger($value)
@@ -210,7 +210,7 @@ public function dispatch($messages, $final)
      * Generate target error message
      *
      * @param Target $target log target object
-     * @param \Throwable|\Exception $throwable catched exception
+     * @param \Throwable $throwable catched exception
      * @param string $method full method path
      * @return array generated error message data
      * @since 2.0.32
diff --git a/framework/log/EmailTarget.php b/framework/log/EmailTarget.php
index c64ede0010d..6029e67db82 100644
--- a/src/log/EmailTarget.php
+++ b/src/log/EmailTarget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
diff --git a/framework/log/FileTarget.php b/framework/log/FileTarget.php
index 157c0db50ed..05ad09430af 100644
--- a/src/log/FileTarget.php
+++ b/src/log/FileTarget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
@@ -20,13 +20,16 @@
  * files are moved backwards by one place, i.e., '.2' to '.3', '.1' to '.2', and so on.
  * The property [[maxLogFiles]] specifies how many history files to keep.
  *
+ * Since 2.0.46 rotation of the files is done only by copy and the
+ * `rotateByCopy` property is deprecated.
+ *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
 class FileTarget extends Target
 {
     /**
-     * @var string log file path or [path alias](guide:concept-aliases). If not set, it will use the "@runtime/logs/app.log" file.
+     * @var string|null log file path or [path alias](guide:concept-aliases). If not set, it will use the "@runtime/logs/app.log" file.
      * The directory containing the log files will be automatically created if not existing.
      */
     public $logFile;
@@ -46,7 +49,7 @@ class FileTarget extends Target
      */
     public $maxLogFiles = 5;
     /**
-     * @var int the permission to be set for newly created log files.
+     * @var int|null the permission to be set for newly created log files.
      * This value will be used by PHP chmod() function. No umask will be applied.
      * If not set, the permission will be determined by the current environment.
      */
@@ -60,7 +63,7 @@ class FileTarget extends Target
     public $dirMode = 0775;
     /**
      * @var bool Whether to rotate log files by copy and truncate in contrast to rotation by
-     * renaming files. Defaults to `true` to be more compatible with log tailers and is windows
+     * renaming files. Defaults to `true` to be more compatible with log tailers and windows
      * systems which do not play well with rename on open files. Rotation by renaming however is
      * a bit faster.
      *
@@ -68,7 +71,9 @@ class FileTarget extends Target
      * function does not work with files that are opened by some process is described in a
      * [comment by Martin Pelletier](https://www.php.net/manual/en/function.rename.php#102274) in
      * the PHP documentation. By setting rotateByCopy to `true` you can work
-     * around this problem.
+     * around this.
+     * @deprecated since 2.0.46 and setting it to false has no effect anymore
+     * since rotating is now always done by copy.
      */
     public $rotateByCopy = true;
 
@@ -117,31 +122,21 @@ public function export()
             clearstatcache();
         }
         if ($this->enableRotation && @filesize($this->logFile) > $this->maxFileSize * 1024) {
-            @flock($fp, LOCK_UN);
-            @fclose($fp);
             $this->rotateFiles();
-            $writeResult = @file_put_contents($this->logFile, $text, FILE_APPEND | LOCK_EX);
-            if ($writeResult === false) {
-                $error = error_get_last();
-                throw new LogRuntimeException("Unable to export log through file ({$this->logFile})!: {$error['message']}");
-            }
-            $textSize = strlen($text);
-            if ($writeResult < $textSize) {
-                throw new LogRuntimeException("Unable to export whole log through file ({$this->logFile})! Wrote $writeResult out of $textSize bytes.");
-            }
-        } else {
-            $writeResult = @fwrite($fp, $text);
-            if ($writeResult === false) {
-                $error = error_get_last();
-                throw new LogRuntimeException("Unable to export log through file ({$this->logFile})!: {$error['message']}");
-            }
-            $textSize = strlen($text);
-            if ($writeResult < $textSize) {
-                throw new LogRuntimeException("Unable to export whole log through file ({$this->logFile})! Wrote $writeResult out of $textSize bytes.");
-            }
-            @flock($fp, LOCK_UN);
-            @fclose($fp);
         }
+        $writeResult = @fwrite($fp, $text);
+        if ($writeResult === false) {
+            $error = error_get_last();
+            throw new LogRuntimeException("Unable to export log through file ({$this->logFile})!: {$error['message']}");
+        }
+        $textSize = strlen($text);
+        if ($writeResult < $textSize) {
+            throw new LogRuntimeException("Unable to export whole log through file ({$this->logFile})! Wrote $writeResult out of $textSize bytes.");
+        }
+        @fflush($fp);
+        @flock($fp, LOCK_UN);
+        @fclose($fp);
+
         if ($this->fileMode !== null) {
             @chmod($this->logFile, $this->fileMode);
         }
@@ -163,7 +158,7 @@ protected function rotateFiles()
                     continue;
                 }
                 $newFile = $this->logFile . '.' . ($i + 1);
-                $this->rotateByCopy ? $this->rotateByCopy($rotateFile, $newFile) : $this->rotateByRename($rotateFile, $newFile);
+                $this->rotateByCopy($rotateFile, $newFile);
                 if ($i === 0) {
                     $this->clearLogFile($rotateFile);
                 }
@@ -195,14 +190,4 @@ private function rotateByCopy($rotateFile, $newFile)
             @chmod($newFile, $this->fileMode);
         }
     }
-
-    /**
-     * Renames rotated file into new file
-     * @param string $rotateFile
-     * @param string $newFile
-     */
-    private function rotateByRename($rotateFile, $newFile)
-    {
-        @rename($rotateFile, $newFile);
-    }
 }
diff --git a/framework/log/LogRuntimeException.php b/framework/log/LogRuntimeException.php
index 888e2f50414..609f3cde478 100644
--- a/src/log/LogRuntimeException.php
+++ b/src/log/LogRuntimeException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
diff --git a/framework/log/Logger.php b/framework/log/Logger.php
index a4f21dd4aa7..6be7eaf2a92 100644
--- a/src/log/Logger.php
+++ b/src/log/Logger.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
@@ -31,12 +31,11 @@
  * or [[DbTarget|database]], with the help of the [[dispatcher]].
  *
  * @property-read array $dbProfiling The first element indicates the number of SQL statements executed, and
- * the second element the total time spent in SQL execution. This property is read-only.
- * @property-read float $elapsedTime The total elapsed time in seconds for current request. This property is
- * read-only.
+ * the second element the total time spent in SQL execution.
+ * @property-read float $elapsedTime The total elapsed time in seconds for current request.
  * @property-read array $profiling The profiling results. Each element is an array consisting of these
  * elements: `info`, `category`, `timestamp`, `trace`, `level`, `duration`, `memory`, `memoryDiff`. The `memory`
- * and `memoryDiff` values are available since version 2.0.11. This property is read-only.
+ * and `memoryDiff` values are available since version 2.0.11.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
diff --git a/framework/log/SyslogTarget.php b/framework/log/SyslogTarget.php
index 84bde8941f5..8a190d4fb5a 100644
--- a/src/log/SyslogTarget.php
+++ b/src/log/SyslogTarget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
@@ -27,7 +27,7 @@ class SyslogTarget extends Target
      */
     public $facility = LOG_USER;
     /**
-     * @var int openlog options. This is a bitfield passed as the `$option` parameter to [openlog()](https://www.php.net/openlog).
+     * @var int|null openlog options. This is a bitfield passed as the `$option` parameter to [openlog()](https://www.php.net/openlog).
      * Defaults to `null` which means to use the default options `LOG_ODELAY | LOG_PID`.
      * @see https://www.php.net/openlog for available options.
      * @since 2.0.11
diff --git a/framework/log/Target.php b/framework/log/Target.php
index d57c2614ec9..b2335949dc8 100644
--- a/src/log/Target.php
+++ b/src/log/Target.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log;
@@ -99,7 +99,7 @@ abstract class Target extends Component
         '_SERVER.PHP_AUTH_PW',
     ];
     /**
-     * @var callable a PHP callable that returns a string to be prefixed to every exported message.
+     * @var callable|null a PHP callable that returns a string to be prefixed to every exported message.
      *
      * If not set, [[getMessagePrefix()]] will be used, which prefixes the message with context information
      * such as user IP, user ID and session ID.
diff --git a/framework/log/migrations/m141106_185632_log_init.php b/framework/log/migrations/m141106_185632_log_init.php
index 4a8b5b54c13..3e5746b10fb 100644
--- a/src/log/migrations/m141106_185632_log_init.php
+++ b/src/log/migrations/m141106_185632_log_init.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\base\InvalidConfigException;
@@ -65,7 +65,7 @@ public function up()
 
             $tableOptions = null;
             if ($this->db->driverName === 'mysql') {
-                // http://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
+                // https://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
                 $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
             }
 
diff --git a/framework/log/migrations/schema-mssql.sql b/framework/log/migrations/schema-mssql.sql
index 28358e32164..7bbcf90af74 100644
--- a/src/log/migrations/schema-mssql.sql
+++ b/src/log/migrations/schema-mssql.sql
@@ -6,9 +6,9 @@
  * want to create additional indexes (e.g. index on `log_time`).
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.1
  */
 
diff --git a/framework/log/migrations/schema-mysql.sql b/framework/log/migrations/schema-mysql.sql
index e1d70dd6e65..79140784c88 100644
--- a/src/log/migrations/schema-mysql.sql
+++ b/src/log/migrations/schema-mysql.sql
@@ -6,9 +6,9 @@
  * want to create additional indexes (e.g. index on `log_time`).
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.1
  */
 
diff --git a/framework/log/migrations/schema-oci.sql b/framework/log/migrations/schema-oci.sql
index a49c489f11e..8ac0e2a5dc0 100644
--- a/src/log/migrations/schema-oci.sql
+++ b/src/log/migrations/schema-oci.sql
@@ -6,9 +6,9 @@
  * want to create additional indexes (e.g. index on `log_time`).
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.1
  */
 
diff --git a/framework/log/migrations/schema-pgsql.sql b/framework/log/migrations/schema-pgsql.sql
index ba77ca13dff..bcfe70a6709 100644
--- a/src/log/migrations/schema-pgsql.sql
+++ b/src/log/migrations/schema-pgsql.sql
@@ -6,9 +6,9 @@
  * want to create additional indexes (e.g. index on `log_time`).
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.1
  */
 
@@ -25,4 +25,4 @@ create table "log"
 );
 
 create index "idx_log_level" on "log" ("level");
-create index "idx_log_category" on "log" ("category");
\ No newline at end of file
+create index "idx_log_category" on "log" ("category");
diff --git a/framework/log/migrations/schema-sqlite.sql b/framework/log/migrations/schema-sqlite.sql
index 0ca66cf7f32..302df02fbb1 100644
--- a/src/log/migrations/schema-sqlite.sql
+++ b/src/log/migrations/schema-sqlite.sql
@@ -6,9 +6,9 @@
  * want to create additional indexes (e.g. index on `log_time`).
  *
  * @author Alexander Makarov <sam@rmcreative.ru>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.1
  */
 
@@ -25,4 +25,4 @@ create table "log"
 );
 
 create index "idx_log_level" on "log" ("level");
-create index "idx_log_category" on "log" ("category");
\ No newline at end of file
+create index "idx_log_category" on "log" ("category");
diff --git a/framework/mail/BaseMailer.php b/framework/mail/BaseMailer.php
index 63b6904ee52..c5f76fb7538 100644
--- a/src/mail/BaseMailer.php
+++ b/src/mail/BaseMailer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mail;
@@ -87,7 +87,7 @@ abstract class BaseMailer extends Component implements MailerInterface, ViewCont
      */
     public $fileTransportPath = '@runtime/mail';
     /**
-     * @var callable a PHP callback that will be called by [[send()]] when [[useFileTransport]] is true.
+     * @var callable|null a PHP callback that will be called by [[send()]] when [[useFileTransport]] is true.
      * The callback should return a file name which will be used to save the email message.
      * If not set, the file name will be generated based on the current timestamp.
      *
@@ -342,8 +342,9 @@ protected function saveMessage($message)
     public function generateMessageFileName()
     {
         $time = microtime(true);
+        $timeInt = (int) $time;
 
-        return date('Ymd-His-', $time) . sprintf('%04d', (int) (($time - (int) $time) * 10000)) . '-' . sprintf('%04d', random_int(0, 10000)) . '.eml';
+        return date('Ymd-His-', $timeInt) . sprintf('%04d', (int) (($time - $timeInt) * 10000)) . '-' . sprintf('%04d', random_int(0, 10000)) . '.eml';
     }
 
     /**
diff --git a/framework/mail/BaseMessage.php b/framework/mail/BaseMessage.php
index ec04d82f756..66b4488832f 100644
--- a/src/mail/BaseMessage.php
+++ b/src/mail/BaseMessage.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mail;
@@ -25,7 +25,7 @@
 abstract class BaseMessage extends BaseObject implements MessageInterface
 {
     /**
-     * @var MailerInterface the mailer instance that created this message.
+     * @var MailerInterface|null the mailer instance that created this message.
      * For independently created messages this is `null`.
      */
     public $mailer;
@@ -33,7 +33,7 @@ abstract class BaseMessage extends BaseObject implements MessageInterface
 
     /**
      * Sends this email message.
-     * @param MailerInterface $mailer the mailer that should be used to send this message.
+     * @param MailerInterface|null $mailer the mailer that should be used to send this message.
      * If no mailer is given it will first check if [[mailer]] is set and if not,
      * the "mailer" application component will be used instead.
      * @return bool whether this message is sent successfully.
diff --git a/framework/mail/MailEvent.php b/framework/mail/MailEvent.php
index 5562d8bcaf7..641f71ae10e 100644
--- a/src/mail/MailEvent.php
+++ b/src/mail/MailEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mail;
diff --git a/framework/mail/MailerInterface.php b/framework/mail/MailerInterface.php
index d6c2cd71e66..c6f3aa94eb1 100644
--- a/src/mail/MailerInterface.php
+++ b/src/mail/MailerInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mail;
diff --git a/framework/mail/MessageInterface.php b/framework/mail/MessageInterface.php
index 414d3b778b3..74795c7ecef 100644
--- a/src/mail/MessageInterface.php
+++ b/src/mail/MessageInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mail;
@@ -204,7 +204,7 @@ public function embedContent($content, array $options = []);
 
     /**
      * Sends this email message.
-     * @param MailerInterface $mailer the mailer that should be used to send this message.
+     * @param MailerInterface|null $mailer the mailer that should be used to send this message.
      * If null, the "mailer" application component will be used instead.
      * @return bool whether this message is sent successfully.
      */
diff --git a/framework/messages/af/yii.php b/framework/messages/af/yii.php
index 557e952e822..b4a10bdf664 100644
--- a/src/messages/af/yii.php
+++ b/src/messages/af/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ar/yii.php b/framework/messages/ar/yii.php
index b5144bdc07b..f300954a31c 100644
--- a/src/messages/ar/yii.php
+++ b/src/messages/ar/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/az/yii.php b/framework/messages/az/yii.php
index 8af3b7fd0d9..797dc804327 100644
--- a/src/messages/az/yii.php
+++ b/src/messages/az/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/be/yii.php b/framework/messages/be/yii.php
index 4d17ee704d1..f2ed384a925 100644
--- a/src/messages/be/yii.php
+++ b/src/messages/be/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/bg/yii.php b/framework/messages/bg/yii.php
index bb738174771..eb87f3bf120 100644
--- a/src/messages/bg/yii.php
+++ b/src/messages/bg/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/bs/yii.php b/framework/messages/bs/yii.php
index 6d3ad8ba184..968d93aa442 100644
--- a/src/messages/bs/yii.php
+++ b/src/messages/bs/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ca/yii.php b/framework/messages/ca/yii.php
index 43aa50d0808..f404ab6411d 100644
--- a/src/messages/ca/yii.php
+++ b/src/messages/ca/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/config.php b/framework/messages/config.php
index 7f8db2d41c1..93845f2e0a9 100644
--- a/src/messages/config.php
+++ b/src/messages/config.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return [
@@ -12,12 +12,17 @@
     'messagePath' => __DIR__,
     // array, required, list of language codes that the extracted messages
     // should be translated to. For example, ['zh-CN', 'de'].
-    'languages' => ['af', 'ar', 'az', 'be', 'bg', 'bs', 'ca', 'cs', 'da', 'de', 'el', 'es', 'et', 'fa', 'fi', 'fr', 'he', 'hi', 'hr', 'hu', 'hy', 'id', 'it', 'ja', 'ka', 'kk', 'ko', 'kz', 'lt', 'lv', 'ms', 'nb-NO', 'nl', 'pl', 'pt', 'pt-BR', 'ro', 'ru', 'sk', 'sl', 'sr', 'sr-Latn', 'sv', 'tg', 'th', 'tr', 'uk', 'uz', 'vi', 'zh-CN', 'zh-TW'],
+    'languages' => [
+        'af', 'ar', 'az', 'be', 'bg', 'bs', 'ca', 'cs', 'da', 'de', 'el', 'es', 'et', 'fa', 'fi', 'fr', 'he', 'hi',
+        'pt-BR', 'ro', 'hr', 'hu', 'hy', 'id', 'it', 'ja', 'ka', 'kk', 'ko', 'kz', 'lt', 'lv', 'ms', 'nb-NO', 'nl',
+        'pl', 'pt', 'ru', 'sk', 'sl', 'sr', 'sr-Latn', 'sv', 'tg', 'th', 'tr', 'uk', 'uz', 'uz-Cy', 'vi', 'zh-CN',
+        'zh-TW'
+    ],
     // string, the name of the function for translating messages.
     // Defaults to 'Yii::t'. This is used as a mark to find the messages to be
     // translated. You may use a string for single function name or an array for
     // multiple function names.
-    'translator' => 'Yii::t',
+    'translator' => ['\Yii::t', 'Yii::t'],
     // boolean, whether to sort messages by keys when merging new messages
     // with the existing ones. Defaults to false, which means the new (untranslated)
     // messages will be separated from the old (translated) ones.
@@ -39,13 +44,13 @@
     // Note, the '/' characters in a pattern matches both '/' and '\'.
     // See helpers/FileHelper::findFiles() description for more details on pattern matching rules.
     'except' => [
-        '.svn',
-        '.git',
-        '.gitignore',
-        '.gitkeep',
-        '.hgignore',
-        '.hgkeep',
+        '.*',
+        '/.*',
         '/messages',
+        '/tests',
+        '/runtime',
+        '/vendor',
+        '/BaseYii.php',
     ],
     // array, list of patterns that specify which files (not directories) should be processed.
     // If empty or not set, all files will be processed.
@@ -53,9 +58,9 @@
     // If a file/directory matches both a pattern in "only" and "except", it will NOT be processed.
     'only' => ['*.php'],
     'phpFileHeader' => '/**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 ',
diff --git a/framework/messages/cs/yii.php b/framework/messages/cs/yii.php
index 06eb020cd1b..d5c8232f1ba 100644
--- a/src/messages/cs/yii.php
+++ b/src/messages/cs/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/da/yii.php b/framework/messages/da/yii.php
index a26abc7833e..d7e27d265e3 100644
--- a/src/messages/da/yii.php
+++ b/src/messages/da/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/de/yii.php b/framework/messages/de/yii.php
index 823f85354f7..51ede9951a1 100644
--- a/src/messages/de/yii.php
+++ b/src/messages/de/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/el/yii.php b/framework/messages/el/yii.php
index ed579516535..a1cfdd3f6eb 100644
--- a/src/messages/el/yii.php
+++ b/src/messages/el/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/es/yii.php b/framework/messages/es/yii.php
index 8c4802aa148..6d65a3233c8 100644
--- a/src/messages/es/yii.php
+++ b/src/messages/es/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/et/yii.php b/framework/messages/et/yii.php
index 4ae31877020..337d7fc1506 100644
--- a/src/messages/et/yii.php
+++ b/src/messages/et/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/fa/yii.php b/framework/messages/fa/yii.php
index 084a44a23d1..ec97c548788 100644
--- a/src/messages/fa/yii.php
+++ b/src/messages/fa/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/fi/yii.php b/framework/messages/fi/yii.php
index 64bee1e119d..938fd62d97c 100644
--- a/src/messages/fi/yii.php
+++ b/src/messages/fi/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/fr/yii.php b/framework/messages/fr/yii.php
index 0d2920adee9..458d7e738e7 100644
--- a/src/messages/fr/yii.php
+++ b/src/messages/fr/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/he/yii.php b/framework/messages/he/yii.php
index 7e49173ce54..4613b419139 100644
--- a/src/messages/he/yii.php
+++ b/src/messages/he/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/hi/yii.php b/framework/messages/hi/yii.php
index e43b4bff7ee..6c79f0c2620 100644
--- a/src/messages/hi/yii.php
+++ b/src/messages/hi/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/hr/yii.php b/framework/messages/hr/yii.php
index 772ef9493e4..ac445e0908c 100644
--- a/src/messages/hr/yii.php
+++ b/src/messages/hr/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/hu/yii.php b/framework/messages/hu/yii.php
index 5500ec02066..88575242bd3 100644
--- a/src/messages/hu/yii.php
+++ b/src/messages/hu/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/hy/yii.php b/framework/messages/hy/yii.php
index 63739dd7d52..8e2cb584548 100644
--- a/src/messages/hy/yii.php
+++ b/src/messages/hy/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/id/yii.php b/framework/messages/id/yii.php
index c0661f8ad1b..b8a08f73f52 100644
--- a/src/messages/id/yii.php
+++ b/src/messages/id/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/it/yii.php b/framework/messages/it/yii.php
index 249f1edce81..c16a9c18912 100644
--- a/src/messages/it/yii.php
+++ b/src/messages/it/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ka/yii.php b/framework/messages/ka/yii.php
index f71563ff806..96eaaeb621d 100644
--- a/src/messages/ka/yii.php
+++ b/src/messages/ka/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/kk/yii.php b/framework/messages/kk/yii.php
index 8d77b9422d7..b33338dbab8 100644
--- a/src/messages/kk/yii.php
+++ b/src/messages/kk/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ko/yii.php b/framework/messages/ko/yii.php
index cfc91dbd4bf..4fe82311fe8 100644
--- a/src/messages/ko/yii.php
+++ b/src/messages/ko/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/lt/yii.php b/framework/messages/lt/yii.php
index bc6fa54b84a..fce59c5471b 100644
--- a/src/messages/lt/yii.php
+++ b/src/messages/lt/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/lv/yii.php b/framework/messages/lv/yii.php
index b94c28c594e..e49ca559500 100644
--- a/src/messages/lv/yii.php
+++ b/src/messages/lv/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ms/yii.php b/framework/messages/ms/yii.php
index 562ed357a7f..72212cbb3ed 100644
--- a/src/messages/ms/yii.php
+++ b/src/messages/ms/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/nb-NO/yii.php b/framework/messages/nb-NO/yii.php
index af345e3c273..9f9870c5e0a 100644
--- a/src/messages/nb-NO/yii.php
+++ b/src/messages/nb-NO/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/nl/yii.php b/framework/messages/nl/yii.php
index 3a4b0ae1090..24261d0520b 100644
--- a/src/messages/nl/yii.php
+++ b/src/messages/nl/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/pl/yii.php b/framework/messages/pl/yii.php
index e42445ee38e..35dae0b7611 100644
--- a/src/messages/pl/yii.php
+++ b/src/messages/pl/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/pt-BR/yii.php b/framework/messages/pt-BR/yii.php
index b82a6595c0a..c626562c9c8 100644
--- a/src/messages/pt-BR/yii.php
+++ b/src/messages/pt-BR/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/pt/yii.php b/framework/messages/pt/yii.php
index 93aebcbe090..f6bdfe5f62c 100644
--- a/src/messages/pt/yii.php
+++ b/src/messages/pt/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ro/yii.php b/framework/messages/ro/yii.php
index c34064c0d32..6042d0bd695 100644
--- a/src/messages/ro/yii.php
+++ b/src/messages/ro/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/ru/yii.php b/framework/messages/ru/yii.php
index 4cbcf38f98a..31b27234323 100644
--- a/src/messages/ru/yii.php
+++ b/src/messages/ru/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/sk/yii.php b/framework/messages/sk/yii.php
index 3ca97ad6342..28aaaa78de1 100644
--- a/src/messages/sk/yii.php
+++ b/src/messages/sk/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/sl/yii.php b/framework/messages/sl/yii.php
index 53031adb582..7fa542489bb 100644
--- a/src/messages/sl/yii.php
+++ b/src/messages/sl/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/sr-Latn/yii.php b/framework/messages/sr-Latn/yii.php
index 5a5e047c4e0..e4467b9a679 100644
--- a/src/messages/sr-Latn/yii.php
+++ b/src/messages/sr-Latn/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/sr/yii.php b/framework/messages/sr/yii.php
index 2edf790189b..6e7ba378329 100644
--- a/src/messages/sr/yii.php
+++ b/src/messages/sr/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/sv/yii.php b/framework/messages/sv/yii.php
index d416aa7d25c..b3777626b02 100644
--- a/src/messages/sv/yii.php
+++ b/src/messages/sv/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/tg/yii.php b/framework/messages/tg/yii.php
index bd7894a6faa..76429c5874e 100644
--- a/src/messages/tg/yii.php
+++ b/src/messages/tg/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/th/yii.php b/framework/messages/th/yii.php
index a9859e299a4..0b2c056ed9f 100644
--- a/src/messages/th/yii.php
+++ b/src/messages/th/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/tr/yii.php b/framework/messages/tr/yii.php
index e1ecb7e6414..b846f17d1e0 100644
--- a/src/messages/tr/yii.php
+++ b/src/messages/tr/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/uk/yii.php b/framework/messages/uk/yii.php
index 927b8a7479c..fb6fed9c46a 100644
--- a/src/messages/uk/yii.php
+++ b/src/messages/uk/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/uz-Cy/yii.php b/framework/messages/uz-Cy/yii.php
new file mode 100644
index 00000000000..f9d59f1c927
--- /dev/null
+++ b/src/messages/uz-Cy/yii.php
@@ -0,0 +1,125 @@
+<?php
+    /**
+     * @link https://www.yiiframework.com/
+     * @copyright Copyright (c) 2008 Yii Software LLC
+     * @license https://www.yiiframework.com/license/
+     */
+
+    /**
+     * Message translations.
+     *
+     * This file is automatically generated by 'yii message/extract' command.
+     * It contains the localizable messages extracted from source code.
+     * You may modify this file by translating the extracted messages.
+     *
+     * Each array element represents the translation (value) of a message (key).
+     * If the value is empty, the message is considered as not translated.
+     * Messages that no longer need translation will have their translations
+     * enclosed between a pair of '@@' marks.
+     *
+     * Message string can be used with plural forms format. Check i18n section
+     * of the guide for details.
+     *
+     * NOTE: this file must be saved in UTF-8 encoding.
+     */
+    return [
+        '{nFormatted} B' => '{nFormatted} Б',
+        '{nFormatted} GB' => '{nFormatted} ГБ',
+        '{nFormatted} GiB' => '{nFormatted} ГиБ',
+        '{nFormatted} KB' => '{nFormatted} КБ',
+        '{nFormatted} KiB' => '{nFormatted} КиБ',
+        '{nFormatted} MB' => '{nFormatted} МБ',
+        '{nFormatted} MiB' => '{nFormatted} МиБ',
+        '{nFormatted} PB' => '{nFormatted} ПБ',
+        '{nFormatted} PiB' => '{nFormatted} ПиБ',
+        '{nFormatted} TB' => '{nFormatted} ТБ',
+        '{nFormatted} TiB' => '{nFormatted} ТиБ',
+        '{nFormatted} {n, plural, =1{byte} other{bytes}}' => '{nFormatted} {n, plural, one{байт} few{байт} many{байтлар} other{байт}}',
+        '{nFormatted} {n, plural, =1{gibibyte} other{gibibytes}}' => '{nFormatted} {n, plural, one{гибибайт} few{гибибайт} many{гибибайт} other{гибибайт}}',
+        '{nFormatted} {n, plural, =1{gigabyte} other{gigabytes}}' => '{nFormatted} {n, plural, one{гигабайт} few{гигабайт} many{гигабайт} other{гигабайт}}',
+        '{nFormatted} {n, plural, =1{kibibyte} other{kibibytes}}' => '{nFormatted} {n, plural, one{кибибайт} few{кибибайт} many{кибибайт} other{кибибайт}}',
+        '{nFormatted} {n, plural, =1{kilobyte} other{kilobytes}}' => '{nFormatted} {n, plural, one{килобайт} few{килобайт} many{килобайт} other{килобайт}}',
+        '{nFormatted} {n, plural, =1{mebibyte} other{mebibytes}}' => '{nFormatted} {n, plural, one{мебибайт} few{мебибайт} many{мебибайт} other{мебибайт}}',
+        '{nFormatted} {n, plural, =1{megabyte} other{megabytes}}' => '{nFormatted} {n, plural, one{мегабайт} few{мегабайт} many{мегабайт} other{мегабайт}}',
+        '{nFormatted} {n, plural, =1{pebibyte} other{pebibytes}}' => '{nFormatted} {n, plural, one{пебибайт} few{пебибайт} many{пебибайт} other{пебибайт}}',
+        '{nFormatted} {n, plural, =1{petabyte} other{petabytes}}' => '{nFormatted} {n, plural, one{петабайт} few{петабайт} many{петабайт} other{петабайт}}',
+        '{nFormatted} {n, plural, =1{tebibyte} other{tebibytes}}' => '{nFormatted} {n, plural, one{тебибайт} few{тебибайт} many{тебибайт} other{тебибайт}}',
+        '{nFormatted} {n, plural, =1{terabyte} other{terabytes}}' => '{nFormatted} {n, plural, one{терабайт} few{терабайт} many{терабайт} other{терабайт}}',
+        '(not set)' => '(қийматланмаган)',
+        'An internal server error occurred.' => 'Сервернинг ички хатолиги юз берди.',
+        'Are you sure you want to delete this item?' => 'Сиз ростдан ҳам ушбу элементни ўчирмоқчимисиз?',
+        'Delete' => 'Ўчириш',
+        'Error' => 'Хато',
+        'File upload failed.' => 'Файлни юклаб бўлмади.',
+        'Home' => 'Асосий',
+        'Invalid data received for parameter "{param}".' => '"{param}" параметр қиймати нотўғри.',
+        'Login Required' => 'Кириш талаб қилинади.',
+        'Missing required arguments: {params}' => 'Қуйидаги зарур аргументлар мавжуд эмас: {params}',
+        'Missing required parameters: {params}' => 'Қуйидаги зарур параметрлар мавжуд эмас: {params}',
+        'No' => 'Йўқ',
+        'No help for unknown command "{command}".' => '"{command}" ноаниқ команда учун маълумотнома мавжуд эмас.',
+        'No help for unknown sub-command "{command}".' => '"{command}" ноаниқ қисм команда учун маълумотнома мавжуд эмас.',
+        'No results found.' => 'Хеч нима топилмади.',
+        'Only files with these MIME types are allowed: {mimeTypes}.' => 'Фақат MIME-туридаги файлларни юклашга рухсат берилган: {mimeTypes}.',
+        'Only files with these extensions are allowed: {extensions}.' => 'Фақат қуйидаги кенгайтмали файлларни юклашга рухсат берилган: {extensions}.',
+        'Page not found.' => 'Саҳифа топилмади.',
+        'Please fix the following errors:' => 'Қуйидаги хатоликларни тўғриланг:',
+        'Please upload a file.' => 'Файлни юкланг.',
+        'Showing <b>{begin, number}-{end, number}</b> of <b>{totalCount, number}</b> {totalCount, plural, one{item} other{items}}.' => 'Намойиш этиляпти <b>{begin, number}-{end, number}</b> маълумот, жами: <b>{totalCount, number}</b> та',
+        'The file "{file}" is not an image.' => '«{file}» расм файл эмас.',
+        'The file "{file}" is too big. Its size cannot exceed {formattedLimit}.' => '«{file}» файл жуда катта. Ўлчам {formattedLimit} ошиши керак эмас.',
+        'The file "{file}" is too small. Its size cannot be smaller than {formattedLimit}.' => '«{file}» файл жуда кичкина. Ўлчам {formattedLimit} кам бўлмаслиги керак.',
+        'The format of {attribute} is invalid.' => '«{attribute}» қийматнинг формати нотўғри.',
+        'The image "{file}" is too large. The height cannot be larger than {limit, number} {limit, plural, one{pixel} other{pixels}}.' => '«{file}» файл жуда катта. Баландлик {limit, number} {limit, plural, one{пикселдан} few{пикселдан} many{пикселдан} other{пикселдан}} ошмаслиги керак.',
+        'The image "{file}" is too large. The width cannot be larger than {limit, number} {limit, plural, one{pixel} other{pixels}}.' => '«{file}» файл жуда катта. Эни {limit, number} {limit, plural, one{пикселдан} few{пикселдан} many{пикселдан} other{пикселдан}} ошмаслиги керак.',
+        'The image "{file}" is too small. The height cannot be smaller than {limit, number} {limit, plural, one{pixel} other{pixels}}.' => '«{file}» файл жуда кичкина. Баландлик {limit, number} {limit, plural, one{пикселдан} few{пикселдан} many{пикселдан} other{пикселдан}} кам бўлмаслиги керак.',
+        'The image "{file}" is too small. The width cannot be smaller than {limit, number} {limit, plural, one{pixel} other{pixels}}.' => '«{file}» файл жуда кичкина. Эни {limit, number} {limit, plural, one{пикселдан} few{пикселдан} many{пикселдан} other{пикселдан}} кам бўлмаслиги керак.',
+        'The requested view "{name}" was not found.' => 'Сўралаётган "{name}" файли топилмади.',
+        'The verification code is incorrect.' => 'Текширув коди нотўғри.',
+        'Total <b>{count, number}</b> {count, plural, one{item} other{items}}.' => 'Жами <b>{count, number}</b> {count, plural, one{ёзув} few{ёзув} many{ёзув} other{ёзув}}.',
+        'Unable to verify your data submission.' => 'Юборилган маълумотларни текшириб бўлмади.',
+        'Unknown command "{command}".' => '"{command}" ноаниқ бўйриқ.',
+        'Unknown option: --{name}' => 'Ноаниқ танлов: --{name}',
+        'Update' => 'Таҳририлаш',
+        'View' => 'Кўриш',
+        'Yes' => 'Ҳа',
+        'You are not allowed to perform this action.' => 'Сизга ушбу амални бажаришга руҳсат берилмаган.',
+        'You can upload at most {limit, number} {limit, plural, one{file} other{files}}.' => 'Сиз {limit, number} {limit, plural, one{файлдан} few{файллардан} many{файллардан} other{файллардан}} кўпини юклаб ололмайсиз.',
+        'in {delta, plural, =1{a day} other{# days}}' => '{delta, plural, =1{кундан} one{# кундан} few{# кундан} many{# кунлардан} other{# кундан}} кейин',
+        'in {delta, plural, =1{a minute} other{# minutes}}' => '{delta, plural, =1{минутдан} one{# минутдан} few{# минутлардан} many{# минутдан} other{# минутлардан}} кейин',
+        'in {delta, plural, =1{a month} other{# months}}' => '{delta, plural, =1{ойдан} one{# ойдан} few{# ойдан} many{# ойлардан} other{# ойлардан}} кейин',
+        'in {delta, plural, =1{a second} other{# seconds}}' => '{delta, plural, =1{секунддан} one{# секунддан} few{# секундлардан} many{# секунддан} other{# секундлардан}} кейин',
+        'in {delta, plural, =1{a year} other{# years}}' => '{delta, plural, =1{йилдан} one{# йилдан} few{# йиллардан} many{# йиллардан} other{# йиллардан}} кейин',
+        'in {delta, plural, =1{an hour} other{# hours}}' => '{delta, plural, =1{соатдан} one{# соатдан} few{# соатлардан} many{# соатлардан} other{# соатлардан}} кейин',
+        'just now' => 'ҳозироқ',
+        'the input value' => 'киритилган қиймат',
+        '{attribute} "{value}" has already been taken.' => '{attribute} «{value}» аввалроқ банд қилинган.',
+        '{attribute} cannot be blank.' => '«{attribute}» тўлдириш шарт.',
+        '{attribute} is invalid.' => '«{attribute}» қиймати нотўғри',
+        '{attribute} is not a valid URL.' => '«{attribute}» тўғри URL эмас.',
+        '{attribute} is not a valid email address.' => '«{attribute}» тўғри электрон манзил эмас.',
+        '{attribute} must be "{requiredValue}".' => '«{attribute}» қиймати «{requiredValue}» га тенг бўлиши керак.',
+        '{attribute} must be a number.' => '«{attribute}» қиймати сон бўлиши керак.',
+        '{attribute} must be a string.' => '«{attribute}» қиймати матн бўлиши керак.',
+        '{attribute} must be an integer.' => '«{attribute}» қиймати бутун сон бўлиши керак.',
+        '{attribute} must be either "{true}" or "{false}".' => '«{attribute}» қиймати «{true}» ёки «{false}» бўлиши керак.',
+        '{attribute} must be greater than "{compareValue}".' => '«{attribute}» қиймати «{compareValue}» дан катта бўлиши керак.',
+        '{attribute} must be greater than or equal to "{compareValue}".' => '«{attribute}» қиймати «{compareValue}» дан катта ёки тенг бўлиши керак.',
+        '{attribute} must be less than "{compareValue}".' => '«{attribute}» қиймати «{compareValue}» дан кичкина бўлиши керак.',
+        '{attribute} must be less than or equal to "{compareValue}".' => '«{attribute}» қиймати «{compareValue}» дан кичик ёки тенг бўлиши керак.',
+        '{attribute} must be no greater than {max}.' => '«{attribute}» қиймати {max} дан ошмаслиги керак.',
+        '{attribute} must be no less than {min}.' => '«{attribute}» қиймати {min} дан кичкина бўлиши керак.',
+        '{attribute} must be repeated exactly.' => '«{attribute}» қиймати бир хил тарзда такрорланиши керак.',
+        '{attribute} must not be equal to "{compareValue}".' => '«{attribute}» қиймати «{compareValue}» га тенг бўлмаслиги керак.',
+        '{attribute} must not be equal to "{compareValueOrAttribute}".' => '«{attribute}» қиймати «{compareValueOrAttribute}» қийматига тенг бўлмаслиги лозим.',
+        '{attribute} should contain at least {min, number} {min, plural, one{character} other{characters}}.' => '«{attribute}» қиймати минимум {min, number} {min, plural, one{белгидан} few{белгидан} many{белгидан} other{белгидан}} ташкил топиши керак.',
+        '{attribute} should contain at most {max, number} {max, plural, one{character} other{characters}}.' => '«{attribute}» қиймати максимум {max, number} {max, plural, one{белгидан} few{белгидан} many{белгидан} other{белгидан}} ошмаслиги керак.',
+        '{attribute} should contain {length, number} {length, plural, one{character} other{characters}}.' => '«{attribute}» қиймати {length, number} {length, plural, one{белгидан} few{белгидан} many{белгидан} other{белгидан}} ташкил топиши керак.',
+        '{delta, plural, =1{a day} other{# days}} ago' => '{delta, plural, =1{кун} one{кун} few{# кун} many{# кун} other{# кун}} аввал',
+        '{delta, plural, =1{a minute} other{# minutes}} ago' => '{delta, plural, =1{дақиқа} one{# дақиқа} few{# дақиқа} many{# дақиқа} other{# дақиқа}} аввал',
+        '{delta, plural, =1{a month} other{# months}} ago' => '{delta, plural, =1{ой} one{# ой} few{# ой} many{# ой} other{# ой}} аввал',
+        '{delta, plural, =1{a second} other{# seconds}} ago' => '{delta, plural, =1{сония} one{# сония} few{# сония} many{# сония} other{# сония}} аввал',
+        '{delta, plural, =1{a year} other{# years}} ago' => '{delta, plural, =1{йил} one{# йил} few{# йил} many{# йил} other{# йил}} аввал',
+        '{delta, plural, =1{an hour} other{# hours}} ago' => '{delta, plural, =1{соат} one{# соат} few{# соат} many{# соат} other{# соат}} аввал',
+    ];
+
diff --git a/framework/messages/uz/yii.php b/framework/messages/uz/yii.php
index 1d3a94d8a81..306de73abcc 100644
--- a/src/messages/uz/yii.php
+++ b/src/messages/uz/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/vi/yii.php b/framework/messages/vi/yii.php
index d56cf296a78..4bbc9f4896b 100644
--- a/src/messages/vi/yii.php
+++ b/src/messages/vi/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/zh-CN/yii.php b/framework/messages/zh-CN/yii.php
index 00be4349e40..9d5447b89d7 100644
--- a/src/messages/zh-CN/yii.php
+++ b/src/messages/zh-CN/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/messages/zh-TW/yii.php b/framework/messages/zh-TW/yii.php
index a4b500bfb96..866b25d0f9b 100644
--- a/src/messages/zh-TW/yii.php
+++ b/src/messages/zh-TW/yii.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/framework/mutex/DbMutex.php b/framework/mutex/DbMutex.php
index b47188f8a55..593cff4e08a 100644
--- a/src/mutex/DbMutex.php
+++ b/src/mutex/DbMutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
diff --git a/framework/mutex/FileMutex.php b/framework/mutex/FileMutex.php
index 5dc71a088cb..241f3fce0df 100644
--- a/src/mutex/FileMutex.php
+++ b/src/mutex/FileMutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
@@ -49,7 +49,7 @@ class FileMutex extends Mutex
      */
     public $mutexPath = '@runtime/mutex';
     /**
-     * @var int the permission to be set for newly created mutex files.
+     * @var int|null the permission to be set for newly created mutex files.
      * This value will be used by PHP chmod() function. No umask will be applied.
      * If not set, the permission will be determined by the current environment.
      */
@@ -62,7 +62,7 @@ class FileMutex extends Mutex
      */
     public $dirMode = 0775;
     /**
-     * @var bool whether file handling should assume a Windows file system.
+     * @var bool|null whether file handling should assume a Windows file system.
      * This value will determine how [[releaseLock()]] goes about deleting the lock file.
      * If not set, it will be determined by checking the DIRECTORY_SEPARATOR constant.
      * @since 2.0.16
diff --git a/framework/mutex/Mutex.php b/framework/mutex/Mutex.php
index 4df573a9354..3654ce30297 100644
--- a/src/mutex/Mutex.php
+++ b/src/mutex/Mutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
diff --git a/framework/mutex/MysqlMutex.php b/framework/mutex/MysqlMutex.php
index c89345fe7da..dd1730c63ad 100644
--- a/src/mutex/MysqlMutex.php
+++ b/src/mutex/MysqlMutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
@@ -52,7 +52,7 @@ public function init()
      * @param string $name of the lock to be acquired.
      * @param int $timeout time (in seconds) to wait for lock to become released.
      * @return bool acquiring result.
-     * @see http://dev.mysql.com/doc/refman/5.0/en/miscellaneous-functions.html#function_get-lock
+     * @see https://dev.mysql.com/doc/refman/8.0/en/miscellaneous-functions.html#function_get-lock
      */
     protected function acquireLock($name, $timeout = 0)
     {
@@ -69,7 +69,7 @@ protected function acquireLock($name, $timeout = 0)
      * Releases lock by given name.
      * @param string $name of the lock to be released.
      * @return bool release result.
-     * @see http://dev.mysql.com/doc/refman/5.0/en/miscellaneous-functions.html#function_release-lock
+     * @see https://dev.mysql.com/doc/refman/8.0/en/miscellaneous-functions.html#function_release-lock
      */
     protected function releaseLock($name)
     {
diff --git a/framework/mutex/OracleMutex.php b/framework/mutex/OracleMutex.php
index 6edfdee758c..1e15876edd8 100644
--- a/src/mutex/OracleMutex.php
+++ b/src/mutex/OracleMutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
@@ -33,7 +33,7 @@
  * ]
  * ```
  *
- * @see http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm
+ * @see https://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm#ARPLS021
  * @see Mutex
  *
  * @author Alexander Zlakomanov <zlakomanoff@gmail.com>
@@ -51,7 +51,7 @@ class OracleMutex extends DbMutex
 
     /**
      * @var string lock mode to be used.
-     * @see http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm#CHDBCFDI
+     * @see https://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm#ARPLS021#CHDBCFDI
      */
     public $lockMode = self::MODE_X;
     /**
@@ -74,7 +74,7 @@ public function init()
 
     /**
      * Acquires lock by given name.
-     * @see http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm
+     * @see https://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm#ARPLS021
      * @param string $name of the lock to be acquired.
      * @param int $timeout time (in seconds) to wait for lock to become released.
      * @return bool acquiring result.
@@ -110,7 +110,7 @@ protected function acquireLock($name, $timeout = 0)
      * Releases lock by given name.
      * @param string $name of the lock to be released.
      * @return bool release result.
-     * @see http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm
+     * @see https://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_lock.htm#ARPLS021
      */
     protected function releaseLock($name)
     {
diff --git a/framework/mutex/PgsqlMutex.php b/framework/mutex/PgsqlMutex.php
index 900ac5ff391..3f1c045a1a9 100644
--- a/src/mutex/PgsqlMutex.php
+++ b/src/mutex/PgsqlMutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
@@ -65,7 +65,7 @@ private function getKeysFromName($name)
      * @param string $name of the lock to be acquired.
      * @param int $timeout time (in seconds) to wait for lock to become released.
      * @return bool acquiring result.
-     * @see http://www.postgresql.org/docs/9.0/static/functions-admin.html
+     * @see https://www.postgresql.org/docs/9.0/functions-admin.html
      */
     protected function acquireLock($name, $timeout = 0)
     {
@@ -86,7 +86,7 @@ protected function acquireLock($name, $timeout = 0)
      * Releases lock by given name.
      * @param string $name of the lock to be released.
      * @return bool release result.
-     * @see http://www.postgresql.org/docs/9.0/static/functions-admin.html
+     * @see https://www.postgresql.org/docs/9.0/functions-admin.html
      */
     protected function releaseLock($name)
     {
diff --git a/framework/mutex/RetryAcquireTrait.php b/framework/mutex/RetryAcquireTrait.php
index 7f41fd744dd..52528b630fd 100644
--- a/src/mutex/RetryAcquireTrait.php
+++ b/src/mutex/RetryAcquireTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\mutex;
diff --git a/framework/rbac/Assignment.php b/framework/rbac/Assignment.php
index b0bf837038d..21e2ad03bcd 100644
--- a/src/rbac/Assignment.php
+++ b/src/rbac/Assignment.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/framework/rbac/BaseManager.php b/framework/rbac/BaseManager.php
index 48d7b3f3182..36daef1c6aa 100644
--- a/src/rbac/BaseManager.php
+++ b/src/rbac/BaseManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
@@ -17,8 +17,7 @@
  *
  * For more details and usage information on DbManager, see the [guide article on security authorization](guide:security-authorization).
  *
- * @property-read Role[] $defaultRoleInstances Default roles. The array is indexed by the role names. This
- * property is read-only.
+ * @property-read Role[] $defaultRoleInstances Default roles. The array is indexed by the role names.
  * @property string[] $defaultRoles Default roles. Note that the type of this property differs in getter and
  * setter. See [[getDefaultRoles()]] and [[setDefaultRoles()]] for details.
  *
diff --git a/framework/rbac/CheckAccessInterface.php b/framework/rbac/CheckAccessInterface.php
index 9a2a5985662..38d86ee7a06 100644
--- a/src/rbac/CheckAccessInterface.php
+++ b/src/rbac/CheckAccessInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/framework/rbac/DbManager.php b/framework/rbac/DbManager.php
index 9aa29ae9453..eb7a86e8cfd 100644
--- a/src/rbac/DbManager.php
+++ b/src/rbac/DbManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
@@ -62,7 +62,7 @@ class DbManager extends BaseManager
      */
     public $ruleTable = '{{%auth_rule}}';
     /**
-     * @var CacheInterface|array|string the cache used to improve RBAC performance. This can be one of the following:
+     * @var CacheInterface|array|string|null the cache used to improve RBAC performance. This can be one of the following:
      *
      * - an application component ID (e.g. `cache`)
      * - a configuration array
diff --git a/framework/rbac/Item.php b/framework/rbac/Item.php
index 5149b38daed..69738026d98 100644
--- a/src/rbac/Item.php
+++ b/src/rbac/Item.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/framework/rbac/ManagerInterface.php b/framework/rbac/ManagerInterface.php
index 4d53d30712e..e4d2c7029e7 100644
--- a/src/rbac/ManagerInterface.php
+++ b/src/rbac/ManagerInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
@@ -60,7 +60,7 @@ public function update($name, $object);
     /**
      * Returns the named role.
      * @param string $name the role name.
-     * @return null|Role the role corresponding to the specified name. Null is returned if no such role.
+     * @return Role|null the role corresponding to the specified name. Null is returned if no such role.
      */
     public function getRole($name);
 
@@ -91,7 +91,7 @@ public function getChildRoles($roleName);
     /**
      * Returns the named permission.
      * @param string $name the permission name.
-     * @return null|Permission the permission corresponding to the specified name. Null is returned if no such permission.
+     * @return Permission|null the permission corresponding to the specified name. Null is returned if no such permission.
      */
     public function getPermission($name);
 
@@ -118,7 +118,7 @@ public function getPermissionsByUser($userId);
     /**
      * Returns the rule of the specified name.
      * @param string $name the rule name
-     * @return null|Rule the rule object, or null if the specified name does not correspond to a rule.
+     * @return Rule|null the rule object, or null if the specified name does not correspond to a rule.
      */
     public function getRule($name);
 
@@ -208,7 +208,7 @@ public function revokeAll($userId);
      * Returns the assignment information regarding a role and a user.
      * @param string $roleName the role name
      * @param string|int $userId the user ID (see [[\yii\web\User::id]])
-     * @return null|Assignment the assignment information. Null is returned if
+     * @return Assignment|null the assignment information. Null is returned if
      * the role is not assigned to the user.
      */
     public function getAssignment($roleName, $userId);
diff --git a/framework/rbac/Permission.php b/framework/rbac/Permission.php
index 9471079ce17..9ae9a339383 100644
--- a/src/rbac/Permission.php
+++ b/src/rbac/Permission.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/framework/rbac/PhpManager.php b/framework/rbac/PhpManager.php
index 9a15990d3ea..291d72976ba 100644
--- a/src/rbac/PhpManager.php
+++ b/src/rbac/PhpManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
@@ -23,7 +23,7 @@
  * (for example, the authorization data for a personal blog system).
  * Use [[DbManager]] for more complex authorization data.
  *
- * Note that PhpManager is not compatible with facebooks [HHVM](http://hhvm.com/) because
+ * Note that PhpManager is not compatible with facebooks [HHVM](https://hhvm.com/) because
  * it relies on writing php files and including them afterwards which is not supported by HHVM.
  *
  * For more details and usage information on PhpManager, see the [guide article on security authorization](guide:security-authorization).
diff --git a/framework/rbac/Role.php b/framework/rbac/Role.php
index a7b3216554b..cab181dc0ea 100644
--- a/src/rbac/Role.php
+++ b/src/rbac/Role.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/framework/rbac/Rule.php b/framework/rbac/Rule.php
index 5e1bbdb4f8d..d91163ffbe4 100644
--- a/src/rbac/Rule.php
+++ b/src/rbac/Rule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/framework/rbac/migrations/m140506_102106_rbac_init.php b/framework/rbac/migrations/m140506_102106_rbac_init.php
index 1429486a3b9..5ce63824d10 100644
--- a/src/rbac/migrations/m140506_102106_rbac_init.php
+++ b/src/rbac/migrations/m140506_102106_rbac_init.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\base\InvalidConfigException;
@@ -40,7 +40,7 @@ protected function isMSSQL()
 
     protected function isOracle()
     {
-        return $this->db->driverName === 'oci';
+        return $this->db->driverName === 'oci' || $this->db->driverName === 'oci8';
     }
 
     /**
@@ -54,7 +54,7 @@ public function up()
 
         $tableOptions = null;
         if ($this->db->driverName === 'mysql') {
-            // http://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
+            // https://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
             $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
         }
 
diff --git a/framework/rbac/migrations/m170907_052038_rbac_add_index_on_auth_assignment_user_id.php b/framework/rbac/migrations/m170907_052038_rbac_add_index_on_auth_assignment_user_id.php
index 061da00f8cc..4fee2611bce 100644
--- a/src/rbac/migrations/m170907_052038_rbac_add_index_on_auth_assignment_user_id.php
+++ b/src/rbac/migrations/m170907_052038_rbac_add_index_on_auth_assignment_user_id.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\base\InvalidConfigException;
diff --git a/framework/rbac/migrations/m180523_151638_rbac_updates_indexes_without_prefix.php b/framework/rbac/migrations/m180523_151638_rbac_updates_indexes_without_prefix.php
index ca85f46f1ed..b7278be7628 100644
--- a/src/rbac/migrations/m180523_151638_rbac_updates_indexes_without_prefix.php
+++ b/src/rbac/migrations/m180523_151638_rbac_updates_indexes_without_prefix.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\base\InvalidConfigException;
diff --git a/framework/rbac/migrations/m200409_110543_rbac_update_mssql_trigger.php b/framework/rbac/migrations/m200409_110543_rbac_update_mssql_trigger.php
index 94445829f6b..9b808682134 100644
--- a/src/rbac/migrations/m200409_110543_rbac_update_mssql_trigger.php
+++ b/src/rbac/migrations/m200409_110543_rbac_update_mssql_trigger.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\base\InvalidConfigException;
diff --git a/framework/rbac/migrations/schema-mssql.sql b/framework/rbac/migrations/schema-mssql.sql
index f10843b57f6..afe74bdea6b 100644
--- a/src/rbac/migrations/schema-mssql.sql
+++ b/src/rbac/migrations/schema-mssql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Alexander Kochetov <creocoder@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0
  */
 
diff --git a/framework/rbac/migrations/schema-mysql.sql b/framework/rbac/migrations/schema-mysql.sql
index 42ff6c35213..a96d7195bac 100644
--- a/src/rbac/migrations/schema-mysql.sql
+++ b/src/rbac/migrations/schema-mysql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Alexander Kochetov <creocoder@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0
  */
 
diff --git a/framework/rbac/migrations/schema-oci.sql b/framework/rbac/migrations/schema-oci.sql
index 252c2194220..2753629703f 100644
--- a/src/rbac/migrations/schema-oci.sql
+++ b/src/rbac/migrations/schema-oci.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Alexander Kochetov <creocoder@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0
  */
 
diff --git a/framework/rbac/migrations/schema-pgsql.sql b/framework/rbac/migrations/schema-pgsql.sql
index 11aee39d38a..bf441c6b2dd 100644
--- a/src/rbac/migrations/schema-pgsql.sql
+++ b/src/rbac/migrations/schema-pgsql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Alexander Kochetov <creocoder@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0
  */
 
diff --git a/framework/rbac/migrations/schema-sqlite.sql b/framework/rbac/migrations/schema-sqlite.sql
index 15f4a59972d..eb7e7b43db4 100644
--- a/src/rbac/migrations/schema-sqlite.sql
+++ b/src/rbac/migrations/schema-sqlite.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Alexander Kochetov <creocoder@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0
  */
 
diff --git a/framework/requirements/YiiRequirementChecker.php b/framework/requirements/YiiRequirementChecker.php
index bc214aa4ec8..c3c707876fb 100644
--- a/src/requirements/YiiRequirementChecker.php
+++ b/src/requirements/YiiRequirementChecker.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 if (version_compare(PHP_VERSION, '4.3', '<')) {
@@ -295,9 +295,9 @@ function checkUploadMaxFileSize($min = null, $max = null)
      * This method includes the view file as a PHP script
      * and captures the display result if required.
      * @param string $_viewFile_ view file
-     * @param array $_data_ data to be extracted and made available to the view file
+     * @param array|null $_data_ data to be extracted and made available to the view file
      * @param bool $_return_ whether the rendering result should be returned as a string
-     * @return string the rendering result. Null if the rendering result is not required.
+     * @return string|null the rendering result. Null if the rendering result is not required.
      */
     function renderViewFile($_viewFile_, $_data_ = null, $_return_ = false)
     {
diff --git a/framework/requirements/requirements.php b/framework/requirements/requirements.php
index b6e3d80965c..55593061518 100644
--- a/src/requirements/requirements.php
+++ b/src/requirements/requirements.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /* @var $this YiiRequirementChecker */
@@ -16,32 +16,32 @@
         'name' => 'PHP version',
         'mandatory' => true,
         'condition' => version_compare(PHP_VERSION, '5.4.0', '>='),
-        'by' => '<a href="http://www.yiiframework.com">Yii Framework</a>',
+        'by' => '<a href="https://www.yiiframework.com">Yii Framework</a>',
         'memo' => 'PHP 5.4.0 or higher is required.',
     ),
     array(
         'name' => 'Reflection extension',
         'mandatory' => true,
         'condition' => class_exists('Reflection', false),
-        'by' => '<a href="http://www.yiiframework.com">Yii Framework</a>',
+        'by' => '<a href="https://www.yiiframework.com">Yii Framework</a>',
     ),
     array(
         'name' => 'PCRE extension',
         'mandatory' => true,
         'condition' => extension_loaded('pcre'),
-        'by' => '<a href="http://www.yiiframework.com">Yii Framework</a>',
+        'by' => '<a href="https://www.yiiframework.com">Yii Framework</a>',
     ),
     array(
         'name' => 'SPL extension',
         'mandatory' => true,
         'condition' => extension_loaded('SPL'),
-        'by' => '<a href="http://www.yiiframework.com">Yii Framework</a>',
+        'by' => '<a href="https://www.yiiframework.com">Yii Framework</a>',
     ),
     array(
         'name' => 'Ctype extension',
         'mandatory' => true,
         'condition' => extension_loaded('ctype'),
-        'by' => '<a href="http://www.yiiframework.com">Yii Framework</a>'
+        'by' => '<a href="https://www.yiiframework.com">Yii Framework</a>'
     ),
     array(
         'name' => 'MBString extension',
@@ -54,7 +54,7 @@
         'name' => 'OpenSSL extension',
         'mandatory' => false,
         'condition' => extension_loaded('openssl'),
-        'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-base-security.html">Security Component</a>',
+        'by' => '<a href="https://www.yiiframework.com/doc-2.0/yii-base-security.html">Security Component</a>',
         'memo' => 'Required by encrypt and decrypt methods.'
     ),
     array(
@@ -74,7 +74,7 @@
         'by' => '<a href="https://www.php.net/manual/en/book.intl.php">Internationalization</a> support',
         'memo' => 'ICU 49.0 or higher is required when you want to use <code>#</code> placeholder in plural rules
         (for example, plural in
-        <a href=\"http://www.yiiframework.com/doc-2.0/yii-i18n-formatter.html#asRelativeTime%28%29-detail\">
+        <a href=\"https://www.yiiframework.com/doc-2.0/yii-i18n-formatter.html#asRelativeTime%28%29-detail\">
         Formatter::asRelativeTime()</a>) in the <code>yii\i18n\Formatter</code> class. Your current ICU version is ' .
         (defined('INTL_ICU_VERSION') ? INTL_ICU_VERSION : '(ICU is missing)') . '.'
     ),
@@ -85,7 +85,7 @@
         'by' => '<a href="https://www.php.net/manual/en/book.intl.php">Internationalization</a> support',
         'memo' => 'ICU Data 49.1 or higher is required when you want to use <code>#</code> placeholder in plural rules
         (for example, plural in
-        <a href=\"http://www.yiiframework.com/doc-2.0/yii-i18n-formatter.html#asRelativeTime%28%29-detail\">
+        <a href=\"https://www.yiiframework.com/doc-2.0/yii-i18n-formatter.html#asRelativeTime%28%29-detail\">
         Formatter::asRelativeTime()</a>) in the <code>yii\i18n\Formatter</code> class. Your current ICU Data version is ' .
         (defined('INTL_ICU_DATA_VERSION') ? INTL_ICU_DATA_VERSION : '(ICU Data is missing)') . '.'
     ),
@@ -107,8 +107,8 @@
         'name' => 'IPv6 support',
         'mandatory' => false,
         'condition' => strlen(@inet_pton('2001:db8::1')) === 16,
-        'by' => 'IPv6 expansion in <a href="http://www.yiiframework.com/doc-2.0/yii-validators-ipvalidator.html">IpValidator</a>',
-        'memo' => 'When <a href="http://www.yiiframework.com/doc-2.0/yii-validators-ipvalidator.html#$expandIPv6-detail">IpValidator::expandIPv6</a>
+        'by' => 'IPv6 expansion in <a href="https://www.yiiframework.com/doc-2.0/yii-validators-ipvalidator.html">IpValidator</a>',
+        'memo' => 'When <a href="https://www.yiiframework.com/doc-2.0/yii-validators-ipvalidator.html#$expandIPv6-detail">IpValidator::expandIPv6</a>
         property is set to <code>true</code>, PHP must support IPv6 protocol stack. Currently PHP constant <code>AF_INET6</code> is not defined
         and IPv6 is probably unsupported.'
     )
diff --git a/framework/requirements/views/console/index.php b/framework/requirements/views/console/index.php
index 68c4cb543e1..acf912698a9 100644
--- a/src/requirements/views/console/index.php
+++ b/src/requirements/views/console/index.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /* @var $this YiiRequirementChecker */
diff --git a/framework/requirements/views/web/index.php b/framework/requirements/views/web/index.php
index 08d15798bbf..15b2233d537 100644
--- a/src/requirements/views/web/index.php
+++ b/src/requirements/views/web/index.php
@@ -70,7 +70,7 @@ functionality may be not available in this case.
     <hr>
     <footer>
         <p>Server: <?php echo $this->getServerInfo() . ' ' . $this->getNowDate() ?></p>
-        <p>Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></p>
+        <p>Powered by <a href="https://www.yiiframework.com/" rel="external">Yii Framework</a></p>
     </footer>
 </div>
 </body>
diff --git a/framework/rest/Action.php b/framework/rest/Action.php
index 466acfc2f31..c700d665c8f 100644
--- a/src/rest/Action.php
+++ b/src/rest/Action.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
@@ -29,7 +29,7 @@ class Action extends \yii\base\Action
      */
     public $modelClass;
     /**
-     * @var callable a PHP callable that will be called to return the model corresponding
+     * @var callable|null a PHP callable that will be called to return the model corresponding
      * to the specified primary key value. If not set, [[findModel()]] will be used instead.
      * The signature of the callable should be:
      *
@@ -45,7 +45,7 @@ class Action extends \yii\base\Action
      */
     public $findModel;
     /**
-     * @var callable a PHP callable that will be called when running an action to determine
+     * @var callable|null a PHP callable that will be called when running an action to determine
      * if the current user has the permission to execute the action. If not set, the access
      * check will not be performed. The signature of the callable should be as follows,
      *
diff --git a/framework/rest/ActiveController.php b/framework/rest/ActiveController.php
index 5e7df58fbe8..ae14947ac2b 100644
--- a/src/rest/ActiveController.php
+++ b/src/rest/ActiveController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
@@ -127,7 +127,7 @@ protected function verbs()
      * If the user does not have access, a [[ForbiddenHttpException]] should be thrown.
      *
      * @param string $action the ID of the action to be executed
-     * @param object $model the model to be accessed. If null, it means no specific model is being accessed.
+     * @param object|null $model the model to be accessed. If null, it means no specific model is being accessed.
      * @param array $params additional parameters
      * @throws ForbiddenHttpException if the user does not have access
      */
diff --git a/framework/rest/Controller.php b/framework/rest/Controller.php
index e473bdb4a7d..9512ee75e19 100644
--- a/src/rest/Controller.php
+++ b/src/rest/Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
diff --git a/framework/rest/CreateAction.php b/framework/rest/CreateAction.php
index 82537a56ca8..be6e3e35527 100644
--- a/src/rest/CreateAction.php
+++ b/src/rest/CreateAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
diff --git a/framework/rest/DeleteAction.php b/framework/rest/DeleteAction.php
index 4326a6104dc..43ad64bcc78 100644
--- a/src/rest/DeleteAction.php
+++ b/src/rest/DeleteAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
diff --git a/framework/rest/IndexAction.php b/framework/rest/IndexAction.php
index b1df395c359..81b19cab784 100644
--- a/src/rest/IndexAction.php
+++ b/src/rest/IndexAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
@@ -10,6 +10,9 @@
 use Yii;
 use yii\data\ActiveDataProvider;
 use yii\data\DataFilter;
+use yii\data\Pagination;
+use yii\data\Sort;
+use yii\helpers\ArrayHelper;
 
 /**
  * IndexAction implements the API endpoint for listing multiple models.
@@ -22,7 +25,7 @@
 class IndexAction extends Action
 {
     /**
-     * @var callable a PHP callable that will be called to prepare a data provider that
+     * @var callable|null a PHP callable that will be called to prepare a data provider that
      * should return a collection of the models. If not set, [[prepareDataProvider()]] will be used instead.
      * The signature of the callable should be:
      *
@@ -46,8 +49,8 @@ class IndexAction extends Action
      */
     public $prepareDataProvider;
     /**
-     * @var callable a PHP callable that will be called to prepare query in prepareDataProvider
-     * Should return $query
+     * @var callable a PHP callable that will be called to prepare query in prepareDataProvider.
+     * Should return $query.
      * For example:
      *
      * ```php
@@ -63,7 +66,7 @@ class IndexAction extends Action
     public $prepareSearchQuery;
     /**
      * @var DataFilter|null data filter to be used for the search filter composition.
-     * You must setup this field explicitly in order to enable filter processing.
+     * You must set up this field explicitly in order to enable filter processing.
      * For example:
      *
      * ```php
@@ -84,6 +87,22 @@ class IndexAction extends Action
      * @since 2.0.13
      */
     public $dataFilter;
+    /**
+     * @var array|Pagination|false The pagination to be used by [[prepareDataProvider()]].
+     * If this is `false`, it means pagination is disabled.
+     * Note: if a Pagination object is passed, it's `params` will be set to the request parameters.
+     * @see Pagination
+     * @since 2.0.45
+     */
+    public $pagination = [];
+    /**
+     * @var array|Sort|false The sorting to be used by [[prepareDataProvider()]].
+     * If this is `false`, it means sorting is disabled.
+     * Note: if a Sort object is passed, it's `params` will be set to the request parameters.
+     * @see Sort
+     * @since 2.0.45
+     */
+    public $sort = [];
 
 
     /**
@@ -135,15 +154,39 @@ protected function prepareDataProvider()
             $query = call_user_func($this->prepareSearchQuery, $query, $requestParams);
         }
 
+        if (is_array($this->pagination)) {
+            $pagination = ArrayHelper::merge(
+                [
+                    'params' => $requestParams,
+                ],
+                $this->pagination
+            );
+        } else {
+            $pagination = $this->pagination;
+            if ($this->pagination instanceof Pagination) {
+                $pagination->params = $requestParams;
+            }
+        }
+
+        if (is_array($this->sort)) {
+            $sort = ArrayHelper::merge(
+                [
+                    'params' => $requestParams,
+                ],
+                $this->sort
+            );
+        } else {
+            $sort = $this->sort;
+            if ($this->sort instanceof Sort) {
+                $sort->params = $requestParams;
+            }
+        }
+
         return Yii::createObject([
             'class' => ActiveDataProvider::className(),
             'query' => $query,
-            'pagination' => [
-                'params' => $requestParams,
-            ],
-            'sort' => [
-                'params' => $requestParams,
-            ],
+            'pagination' => $pagination,
+            'sort' => $sort,
         ]);
     }
 }
diff --git a/framework/rest/OptionsAction.php b/framework/rest/OptionsAction.php
index 2200bee2640..a4fdd3f611b 100644
--- a/src/rest/OptionsAction.php
+++ b/src/rest/OptionsAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
@@ -31,7 +31,7 @@ class OptionsAction extends \yii\base\Action
 
     /**
      * Responds to the OPTIONS request.
-     * @param string $id
+     * @param string|null $id
      */
     public function run($id = null)
     {
diff --git a/framework/rest/Serializer.php b/framework/rest/Serializer.php
index 2a47511e7f0..a4d16b195f2 100644
--- a/src/rest/Serializer.php
+++ b/src/rest/Serializer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
@@ -64,7 +64,7 @@ class Serializer extends Component
      */
     public $perPageHeader = 'X-Pagination-Per-Page';
     /**
-     * @var string the name of the envelope (e.g. `items`) for returning the resource objects in a collection.
+     * @var string|null the name of the envelope (e.g. `items`) for returning the resource objects in a collection.
      * This is used when serving a resource collection. When this is set and pagination is enabled, the serializer
      * will return a collection in the following format:
      *
@@ -102,11 +102,11 @@ class Serializer extends Component
      */
     public $metaEnvelope = '_meta';
     /**
-     * @var Request the current request. If not set, the `request` application component will be used.
+     * @var Request|null the current request. If not set, the `request` application component will be used.
      */
     public $request;
     /**
-     * @var Response the response to be sent. If not set, the `response` application component will be used.
+     * @var Response|null the response to be sent. If not set, the `response` application component will be used.
      */
     public $response;
     /**
diff --git a/framework/rest/UpdateAction.php b/framework/rest/UpdateAction.php
index a299679cddc..c307144231f 100644
--- a/src/rest/UpdateAction.php
+++ b/src/rest/UpdateAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
diff --git a/framework/rest/UrlRule.php b/framework/rest/UrlRule.php
index d90ccf5372e..48b1bbe7995 100644
--- a/src/rest/UrlRule.php
+++ b/src/rest/UrlRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
@@ -62,7 +62,7 @@
 class UrlRule extends CompositeUrlRule
 {
     /**
-     * @var string the common prefix string shared by all patterns.
+     * @var string|null the common prefix string shared by all patterns.
      */
     public $prefix;
     /**
@@ -158,7 +158,7 @@ public function init()
         }
         $this->controller = $controllers;
 
-        $this->prefix = trim($this->prefix, '/');
+        $this->prefix = trim((string)$this->prefix, '/');
 
         parent::init();
     }
diff --git a/framework/rest/ViewAction.php b/framework/rest/ViewAction.php
index 3cd11f4ad58..dbe9bb2ac92 100644
--- a/src/rest/ViewAction.php
+++ b/src/rest/ViewAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rest;
diff --git a/framework/test/ActiveFixture.php b/framework/test/ActiveFixture.php
index 7021fc9509f..7517430e7a8 100644
--- a/src/test/ActiveFixture.php
+++ b/src/test/ActiveFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
@@ -26,7 +26,7 @@
  * For more details and usage information on ActiveFixture, see the [guide article on fixtures](guide:test-fixtures).
  *
  * @property-read TableSchema $tableSchema The schema information of the database table associated with this
- * fixture. This property is read-only.
+ * fixture.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -34,13 +34,13 @@
 class ActiveFixture extends BaseActiveFixture
 {
     /**
-     * @var string the name of the database table that this fixture is about. If this property is not set,
+     * @var string|null the name of the database table that this fixture is about. If this property is not set,
      * the table name will be determined via [[modelClass]].
      * @see modelClass
      */
     public $tableName;
     /**
-     * @var string|bool the file path or [path alias](guide:concept-aliases) of the data file that contains the fixture data
+     * @var string|bool|null the file path or [path alias](guide:concept-aliases) of the data file that contains the fixture data
      * to be returned by [[getData()]]. If this is not set, it will default to `FixturePath/data/TableName.php`,
      * where `FixturePath` stands for the directory containing this fixture class, and `TableName` stands for the
      * name of the table associated with this fixture. You can set this property to be false to prevent loading any data.
diff --git a/framework/test/ArrayFixture.php b/framework/test/ArrayFixture.php
index ea0c000ee84..c146ab34e33 100644
--- a/src/test/ArrayFixture.php
+++ b/src/test/ArrayFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
diff --git a/framework/test/BaseActiveFixture.php b/framework/test/BaseActiveFixture.php
index 54c30c99384..f953f918039 100644
--- a/src/test/BaseActiveFixture.php
+++ b/src/test/BaseActiveFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
@@ -42,7 +42,7 @@ abstract class BaseActiveFixture extends DbFixture implements \IteratorAggregate
      * Returns the AR model by the specified model name.
      * A model name is the key of the corresponding data row in [[data]].
      * @param string $name the model name.
-     * @return null|\yii\db\ActiveRecord the AR model, or null if the model cannot be found in the database
+     * @return \yii\db\ActiveRecord|null the AR model, or null if the model cannot be found in the database
      * @throws \yii\base\InvalidConfigException if [[modelClass]] is not set.
      */
     public function getModel($name)
diff --git a/framework/test/DbFixture.php b/framework/test/DbFixture.php
index 098219e166d..d5a6322f9c2 100644
--- a/src/test/DbFixture.php
+++ b/src/test/DbFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
diff --git a/framework/test/FileFixtureTrait.php b/framework/test/FileFixtureTrait.php
index 562e705d372..15c23948751 100644
--- a/src/test/FileFixtureTrait.php
+++ b/src/test/FileFixtureTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
@@ -53,7 +53,7 @@ protected function loadData($file, $throwException = true)
         if (is_file($file)) {
             return require $file;
         }
-        
+
         if ($throwException) {
             throw new InvalidConfigException("Fixture data file does not exist: {$file}");
         }
diff --git a/framework/test/Fixture.php b/framework/test/Fixture.php
index f64a167afd7..22ff440a26f 100644
--- a/src/test/Fixture.php
+++ b/src/test/Fixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
diff --git a/framework/test/FixtureTrait.php b/framework/test/FixtureTrait.php
index 7a72610da55..cd4bd14310a 100644
--- a/src/test/FixtureTrait.php
+++ b/src/test/FixtureTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
@@ -79,7 +79,7 @@ public function globalFixtures()
     /**
      * Loads the specified fixtures.
      * This method will call [[Fixture::load()]] for every fixture object.
-     * @param Fixture[] $fixtures the fixtures to be loaded. If this parameter is not specified,
+     * @param Fixture[]|null $fixtures the fixtures to be loaded. If this parameter is not specified,
      * the return value of [[getFixtures()]] will be used.
      */
     public function loadFixtures($fixtures = null)
@@ -103,7 +103,7 @@ public function loadFixtures($fixtures = null)
     /**
      * Unloads the specified fixtures.
      * This method will call [[Fixture::unload()]] for every fixture object.
-     * @param Fixture[] $fixtures the fixtures to be loaded. If this parameter is not specified,
+     * @param Fixture[]|null $fixtures the fixtures to be loaded. If this parameter is not specified,
      * the return value of [[getFixtures()]] will be used.
      */
     public function unloadFixtures($fixtures = null)
@@ -151,7 +151,7 @@ public function getFixtures()
     /**
      * Returns the named fixture.
      * @param string $name the fixture name. This can be either the fixture alias name, or the class name if the alias is not used.
-     * @return Fixture the fixture object, or null if the named fixture does not exist.
+     * @return Fixture|null the fixture object, or null if the named fixture does not exist.
      */
     public function getFixture($name)
     {
diff --git a/framework/test/InitDbFixture.php b/framework/test/InitDbFixture.php
index 39b73985ba4..f18bd16b97a 100644
--- a/src/test/InitDbFixture.php
+++ b/src/test/InitDbFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\test;
diff --git a/framework/validators/BooleanValidator.php b/framework/validators/BooleanValidator.php
index ac8e334ea6a..ab29b755d9f 100644
--- a/src/validators/BooleanValidator.php
+++ b/src/validators/BooleanValidator.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
 
 use Yii;
+use yii\helpers\Json;
 
 /**
  * BooleanValidator checks if the attribute value is a boolean value.
@@ -76,7 +77,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'yii.validation.boolean(value, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ');';
+        return 'yii.validation.boolean(value, messages, ' . Json::htmlEncode($options) . ');';
     }
 
     /**
diff --git a/framework/validators/CompareValidator.php b/framework/validators/CompareValidator.php
index fbe4d2cbe2b..c9dcb15da4f 100644
--- a/src/validators/CompareValidator.php
+++ b/src/validators/CompareValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -10,6 +10,7 @@
 use Yii;
 use yii\base\InvalidConfigException;
 use yii\helpers\Html;
+use yii\helpers\Json;
 
 /**
  * CompareValidator compares the specified attribute value with another value.
@@ -234,7 +235,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'yii.validation.compare(value, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ', $form);';
+        return 'yii.validation.compare(value, messages, ' . Json::htmlEncode($options) . ', $form);';
     }
 
     /**
diff --git a/framework/validators/DateValidator.php b/framework/validators/DateValidator.php
index 7d920108ab7..740011846de 100644
--- a/src/validators/DateValidator.php
+++ b/src/validators/DateValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -72,8 +72,8 @@ class DateValidator extends Validator
      */
     public $type = self::TYPE_DATE;
     /**
-     * @var string the date format that the value being validated should follow.
-     * This can be a date time pattern as described in the [ICU manual](http://userguide.icu-project.org/formatparse/datetime#TOC-Date-Time-Format-Syntax).
+     * @var string|null the date format that the value being validated should follow.
+     * This can be a date time pattern as described in the [ICU manual](https://unicode-org.github.io/icu/userguide/format_parse/datetime/#datetime-format-syntax).
      *
      * Alternatively this can be a string prefixed with `php:` representing a format that can be recognized by the PHP Datetime class.
      * Please refer to <https://www.php.net/manual/en/datetime.createfromformat.php> on supported formats.
@@ -104,14 +104,14 @@ class DateValidator extends Validator
      */
     public $format;
     /**
-     * @var string the locale ID that is used to localize the date parsing.
+     * @var string|null the locale ID that is used to localize the date parsing.
      * This is only effective when the [PHP intl extension](https://www.php.net/manual/en/book.intl.php) is installed.
      * If not set, the locale of the [[\yii\base\Application::formatter|formatter]] will be used.
      * See also [[\yii\i18n\Formatter::locale]].
      */
     public $locale;
     /**
-     * @var string the timezone to use for parsing date and time values.
+     * @var string|null the timezone to use for parsing date and time values.
      * This can be any value that may be passed to [date_default_timezone_set()](https://www.php.net/manual/en/function.date-default-timezone-set.php)
      * e.g. `UTC`, `Europe/Berlin` or `America/Chicago`.
      * Refer to the [php manual](https://www.php.net/manual/en/timezones.php) for available timezones.
@@ -119,7 +119,7 @@ class DateValidator extends Validator
      */
     public $timeZone;
     /**
-     * @var string the name of the attribute to receive the parsing result.
+     * @var string|null the name of the attribute to receive the parsing result.
      * When this property is not null and the validation is successful, the named attribute will
      * receive the parsing result.
      *
@@ -137,7 +137,7 @@ class DateValidator extends Validator
      */
     public $timestampAttribute;
     /**
-     * @var string the format to use when populating the [[timestampAttribute]].
+     * @var string|null the format to use when populating the [[timestampAttribute]].
      * The format can be specified in the same way as for [[format]].
      *
      * If not set, [[timestampAttribute]] will receive a UNIX timestamp.
@@ -160,7 +160,7 @@ class DateValidator extends Validator
      */
     public $timestampAttributeTimeZone = 'UTC';
     /**
-     * @var int|string upper limit of the date. Defaults to null, meaning no upper limit.
+     * @var int|string|null upper limit of the date. Defaults to null, meaning no upper limit.
      * This can be a unix timestamp or a string representing a date time value.
      * If this property is a string, [[format]] will be used to parse it.
      * @see tooBig for the customized message used when the date is too big.
@@ -168,7 +168,7 @@ class DateValidator extends Validator
      */
     public $max;
     /**
-     * @var int|string lower limit of the date. Defaults to null, meaning no lower limit.
+     * @var int|string|null lower limit of the date. Defaults to null, meaning no lower limit.
      * This can be a unix timestamp or a string representing a date time value.
      * If this property is a string, [[format]] will be used to parse it.
      * @see tooSmall for the customized message used when the date is too small.
@@ -186,13 +186,13 @@ class DateValidator extends Validator
      */
     public $tooSmall;
     /**
-     * @var string user friendly value of upper limit to display in the error message.
+     * @var string|null user friendly value of upper limit to display in the error message.
      * If this property is null, the value of [[max]] will be used (before parsing).
      * @since 2.0.4
      */
     public $maxString;
     /**
-     * @var string user friendly value of lower limit to display in the error message.
+     * @var string|null user friendly value of lower limit to display in the error message.
      * If this property is null, the value of [[min]] will be used (before parsing).
      * @since 2.0.4
      */
diff --git a/framework/validators/DefaultValueValidator.php b/framework/validators/DefaultValueValidator.php
index 098754d27bf..862acd22951 100644
--- a/src/validators/DefaultValueValidator.php
+++ b/src/validators/DefaultValueValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
diff --git a/framework/validators/EachValidator.php b/framework/validators/EachValidator.php
index 504738d86ea..56c7dd3bd3a 100644
--- a/src/validators/EachValidator.php
+++ b/src/validators/EachValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
diff --git a/framework/validators/EmailValidator.php b/framework/validators/EmailValidator.php
index 984d00d4510..3c56c58f2f4 100644
--- a/src/validators/EmailValidator.php
+++ b/src/validators/EmailValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -23,7 +23,7 @@ class EmailValidator extends Validator
 {
     /**
      * @var string the regular expression used to validate the attribute value.
-     * @see http://www.regular-expressions.info/email.html
+     * @see https://www.regular-expressions.info/email.html
      */
     public $pattern = '/^[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/';
     /**
@@ -34,7 +34,7 @@ class EmailValidator extends Validator
     public $fullPattern = '/^[^@]*<[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?>$/';
     /**
      * @var string the regular expression used to validate the part before the @ symbol, used if ASCII conversion fails to validate the address.
-     * @see http://www.regular-expressions.info/email.html
+     * @see https://www.regular-expressions.info/email.html
      * @since 2.0.42
      */
     public $patternASCII = '/^[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*$/';
@@ -105,7 +105,7 @@ protected function validateValue($value)
 
             if (strlen($matches['local']) > 64) {
                 // The maximum total length of a user name or other local-part is 64 octets. RFC 5322 section 4.5.3.1.1
-                // http://tools.ietf.org/html/rfc5321#section-4.5.3.1.1
+                // https://datatracker.ietf.org/doc/html/rfc5321#section-4.5.3.1.1
                 $valid = false;
             } elseif (strlen($matches['local'] . '@' . $matches['domain']) > 254) {
                 // There is a restriction in RFC 2821 on the length of an address in MAIL and RCPT commands
@@ -113,7 +113,7 @@ protected function validateValue($value)
                 // upper limit on address lengths should normally be considered to be 254.
                 //
                 // Dominic Sayers, RFC 3696 erratum 1690
-                // http://www.rfc-editor.org/errata_search.php?eid=1690
+                // https://www.rfc-editor.org/errata_search.php?eid=1690
                 $valid = false;
             } else {
                 $valid = preg_match($this->pattern, $value) || ($this->allowName && preg_match($this->fullPattern, $value));
diff --git a/framework/validators/ExistValidator.php b/framework/validators/ExistValidator.php
index 4b7d94f3861..be02f1a4197 100644
--- a/src/validators/ExistValidator.php
+++ b/src/validators/ExistValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -49,13 +49,13 @@
 class ExistValidator extends Validator
 {
     /**
-     * @var string the name of the ActiveRecord class that should be used to validate the existence
+     * @var string|null the name of the ActiveRecord class that should be used to validate the existence
      * of the current attribute value. If not set, it will use the ActiveRecord class of the attribute being validated.
      * @see targetAttribute
      */
     public $targetClass;
     /**
-     * @var string|array the name of the ActiveRecord attribute that should be used to
+     * @var string|array|null the name of the ActiveRecord attribute that should be used to
      * validate the existence of the current attribute value. If not set, it will use the name
      * of the attribute currently being validated. You may use an array to validate the existence
      * of multiple columns at the same time. The array key is the name of the attribute with the value to validate,
@@ -153,6 +153,14 @@ private function checkTargetRelationExistence($model, $attribute)
     private function checkTargetAttributeExistence($model, $attribute)
     {
         $targetAttribute = $this->targetAttribute === null ? $attribute : $this->targetAttribute;
+        if ($this->skipOnError) {
+            foreach ((array)$targetAttribute as $k => $v) {
+                if ($model->hasErrors(is_int($k) ? $v : $k)) {
+                    return;
+                }
+            }
+        }
+
         $params = $this->prepareConditions($targetAttribute, $model, $attribute);
         $conditions = [$this->targetAttributeJunction == 'or' ? 'or' : 'and'];
 
@@ -181,7 +189,7 @@ private function checkTargetAttributeExistence($model, $attribute)
      * Processes attributes' relations described in $targetAttribute parameter into conditions, compatible with
      * [[\yii\db\Query::where()|Query::where()]] key-value format.
      *
-     * @param $targetAttribute array|string $attribute the name of the ActiveRecord attribute that should be used to
+     * @param $targetAttribute array|string|null $attribute the name of the ActiveRecord attribute that should be used to
      * validate the existence of the current attribute value. If not set, it will use the name
      * of the attribute currently being validated. You may use an array to validate the existence
      * of multiple columns at the same time. The array key is the name of the attribute with the value to validate,
@@ -308,7 +316,7 @@ protected function createQuery($targetClass, $condition)
      * Returns conditions with alias.
      * @param ActiveQuery $query
      * @param array $conditions array of condition, keys to be modified
-     * @param null|string $alias set empty string for no apply alias. Set null for apply primary table alias
+     * @param string|null $alias set empty string for no apply alias. Set null for apply primary table alias
      * @return array
      */
     private function applyTableAlias($query, $conditions, $alias = null)
diff --git a/framework/validators/FileValidator.php b/framework/validators/FileValidator.php
index 7a7f5c5c42b..28d97f9c972 100644
--- a/src/validators/FileValidator.php
+++ b/src/validators/FileValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -20,7 +20,7 @@
  *
  * Note that you should enable `fileinfo` PHP extension.
  *
- * @property-read int $sizeLimit The size limit for uploaded files. This property is read-only.
+ * @property-read int $sizeLimit The size limit for uploaded files.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -28,7 +28,7 @@
 class FileValidator extends Validator
 {
     /**
-     * @var array|string a list of file name extensions that are allowed to be uploaded.
+     * @var array|string|null a list of file name extensions that are allowed to be uploaded.
      * This can be either an array or a string consisting of file extension names
      * separated by space or comma (e.g. "gif, jpg").
      * Extension names are case-insensitive. Defaults to null, meaning all file name
@@ -42,7 +42,7 @@ class FileValidator extends Validator
      */
     public $checkExtensionByMimeType = true;
     /**
-     * @var array|string a list of file MIME types that are allowed to be uploaded.
+     * @var array|string|null a list of file MIME types that are allowed to be uploaded.
      * This can be either an array or a string consisting of file MIME types
      * separated by space or comma (e.g. "text/plain, image/png").
      * The mask with the special character `*` can be used to match groups of mime types.
@@ -52,13 +52,13 @@ class FileValidator extends Validator
      */
     public $mimeTypes;
     /**
-     * @var int the minimum number of bytes required for the uploaded file.
+     * @var int|null the minimum number of bytes required for the uploaded file.
      * Defaults to null, meaning no limit.
      * @see tooSmall for the customized message for a file that is too small.
      */
     public $minSize;
     /**
-     * @var int the maximum number of bytes required for the uploaded file.
+     * @var int|null the maximum number of bytes required for the uploaded file.
      * Defaults to null, meaning no limit.
      * Note, the size limit is also affected by `upload_max_filesize` and `post_max_size` INI setting
      * and the 'MAX_FILE_SIZE' hidden field value. See [[getSizeLimit()]] for details.
@@ -188,7 +188,7 @@ public function init()
             $this->tooSmall = Yii::t('yii', 'The file "{file}" is too small. Its size cannot be smaller than {formattedLimit}.');
         }
         if (!is_array($this->extensions)) {
-            $this->extensions = preg_split('/[\s,]+/', strtolower($this->extensions), -1, PREG_SPLIT_NO_EMPTY);
+            $this->extensions = preg_split('/[\s,]+/', strtolower((string)$this->extensions), -1, PREG_SPLIT_NO_EMPTY);
         } else {
             $this->extensions = array_map('strtolower', $this->extensions);
         }
@@ -196,7 +196,7 @@ public function init()
             $this->wrongMimeType = Yii::t('yii', 'Only files with these MIME types are allowed: {mimeTypes}.');
         }
         if (!is_array($this->mimeTypes)) {
-            $this->mimeTypes = preg_split('/[\s,]+/', strtolower($this->mimeTypes), -1, PREG_SPLIT_NO_EMPTY);
+            $this->mimeTypes = preg_split('/[\s,]+/', strtolower((string)$this->mimeTypes), -1, PREG_SPLIT_NO_EMPTY);
         } else {
             $this->mimeTypes = array_map('strtolower', $this->mimeTypes);
         }
@@ -432,7 +432,7 @@ public function clientValidateAttribute($model, $attribute, $view)
     {
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
-        return 'yii.validation.file(attribute, messages, ' . Json::encode($options) . ');';
+        return 'yii.validation.file(attribute, messages, ' . Json::htmlEncode($options) . ');';
     }
 
     /**
@@ -530,6 +530,9 @@ private function buildMimeTypeRegexp($mask)
     protected function validateMimeType($file)
     {
         $fileMimeType = $this->getMimeTypeByFile($file->tempName);
+        if ($fileMimeType === null) {
+            return false;
+        }
 
         foreach ($this->mimeTypes as $mimeType) {
             if (strcasecmp($mimeType, $fileMimeType) === 0) {
@@ -548,11 +551,12 @@ protected function validateMimeType($file)
      * Get MIME type by file path
      *
      * @param string $filePath
-     * @return string
+     * @return string|null
      * @throws \yii\base\InvalidConfigException
      * @since 2.0.26
      */
-    protected function getMimeTypeByFile($filePath) {
+    protected function getMimeTypeByFile($filePath)
+    {
         return FileHelper::getMimeType($filePath);
     }
 }
diff --git a/framework/validators/FilterValidator.php b/framework/validators/FilterValidator.php
index 873e1b197e7..a08b0b51d29 100644
--- a/src/validators/FilterValidator.php
+++ b/src/validators/FilterValidator.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
 
 use yii\base\InvalidConfigException;
+use yii\helpers\Json;
 
 /**
  * FilterValidator converts the attribute value according to a filter.
@@ -25,6 +26,8 @@
  * ```
  *
  * Many PHP functions qualify this signature (e.g. `trim()`).
+ * If the callback function requires non-null argument (important since PHP 8.1)
+ * remember to set [[skipOnEmpty]] to `true` otherwise you may trigger an error.
  *
  * To specify the filter, set [[filter]] property to be the callback.
  *
@@ -91,7 +94,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'value = yii.validation.trim($form, attribute, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ', value);';
+        return 'value = yii.validation.trim($form, attribute, ' . Json::htmlEncode($options) . ', value);';
     }
 
     /**
diff --git a/framework/validators/ImageValidator.php b/framework/validators/ImageValidator.php
index 6edfb97dbb7..fbac2516a73 100644
--- a/src/validators/ImageValidator.php
+++ b/src/validators/ImageValidator.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
 
 use Yii;
+use yii\helpers\Json;
 use yii\web\UploadedFile;
 
 /**
@@ -27,25 +28,25 @@ class ImageValidator extends FileValidator
      */
     public $notImage;
     /**
-     * @var int the minimum width in pixels.
+     * @var int|null the minimum width in pixels.
      * Defaults to null, meaning no limit.
      * @see underWidth for the customized message used when image width is too small.
      */
     public $minWidth;
     /**
-     * @var int the maximum width in pixels.
+     * @var int|null the maximum width in pixels.
      * Defaults to null, meaning no limit.
      * @see overWidth for the customized message used when image width is too big.
      */
     public $maxWidth;
     /**
-     * @var int the minimum height in pixels.
+     * @var int|null the minimum height in pixels.
      * Defaults to null, meaning no limit.
      * @see underHeight for the customized message used when image height is too small.
      */
     public $minHeight;
     /**
-     * @var int the maximum width in pixels.
+     * @var int|null the maximum width in pixels.
      * Defaults to null, meaning no limit.
      * @see overHeight for the customized message used when image height is too big.
      */
@@ -166,7 +167,7 @@ public function clientValidateAttribute($model, $attribute, $view)
     {
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
-        return 'yii.validation.image(attribute, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ', deferred);';
+        return 'yii.validation.image(attribute, messages, ' . Json::htmlEncode($options) . ', deferred);';
     }
 
     /**
diff --git a/framework/validators/InlineValidator.php b/framework/validators/InlineValidator.php
index a8dcd0040d4..595f3731c0f 100644
--- a/src/validators/InlineValidator.php
+++ b/src/validators/InlineValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -10,15 +10,6 @@
 /**
  * InlineValidator represents a validator which is defined as a method in the object being validated.
  *
- * The validation method must have the following signature:
- *
- * ```php
- * function foo($attribute, $params, $validator)
- * ```
- *
- * where `$attribute` refers to the name of the attribute being validated, while `$params` is an array representing the
- * additional parameters supplied in the validation rule. Parameter `$validator` refers to the related
- * [[InlineValidator]] object and is available since version 2.0.11.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -26,16 +17,18 @@
 class InlineValidator extends Validator
 {
     /**
-     * @var string|\Closure an anonymous function or the name of a model class method that will be
+     * @var string|callable an anonymous function or the name of a model class method that will be
      * called to perform the actual validation. The signature of the method should be like the following:
      *
      * ```php
-     * function foo($attribute, $params, $validator)
+     * function (string $attribute, mixed $params, InlineValidator $validator, mixed $current): bool {
+     * }
      * ```
      *
-     * - `$attribute` is the name of the attribute to be validated;
-     * - `$params` contains the value of [[params]] that you specify when declaring the inline validation rule;
-     * - `$validator` is a reference to related [[InlineValidator]] object. This parameter is available since version 2.0.11.
+     * - `$attribute` is the name of the attribute to be validated
+     * - `$params` contains the value of [[params]] that you specify when declaring the inline validation rule
+     * - `$validator` is a reference to related [[InlineValidator]] object. This parameter is available since version 2.0.11
+     * - `$current` is the attribute value. This parameter is available since version 2.0.36
      */
     public $method;
     /**
@@ -47,15 +40,16 @@ class InlineValidator extends Validator
      * The signature of the method should be like the following:
      *
      * ```php
-     * function foo($attribute, $params, $validator)
+     * function (string $attribute, mixed $params, InlineValidator $validator, mixed $current, View $view): string
      * {
-     *     return "javascript";
+     *     // $view->registerJs('JS validation function');
+     *     // or \app\assets\ValidationAsset::register($view);
+     *     return "calling JS validation function";
      * }
      * ```
      *
-     * where `$attribute` refers to the attribute name to be validated.
-     *
-     * Please refer to [[clientValidateAttribute()]] for details on how to return client validation code.
+     * Please refer to [[clientValidateAttribute()]] and [guide](guide:input-validation#client-side-validation) for details on how
+     * to return client validation code.
      */
     public $clientValidate;
     /**
@@ -100,7 +94,7 @@ public function clientValidateAttribute($model, $attribute, $view)
             if ($current === null) {
                 $current = $model->$attribute;
             }
-            return $method($attribute, $this->params, $this, $current);
+            return $method($attribute, $this->params, $this, $current, $view);
         }
 
         return null;
diff --git a/framework/validators/IpValidator.php b/framework/validators/IpValidator.php
index ea1e87718e3..63c42fe7769 100644
--- a/src/validators/IpValidator.php
+++ b/src/validators/IpValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -86,7 +86,7 @@ class IpValidator extends Validator
      */
     public $ipv4 = true;
     /**
-     * @var bool whether the address can be an IP with CIDR subnet, like `192.168.10.0/24`.
+     * @var bool|null whether the address can be an IP with CIDR subnet, like `192.168.10.0/24`.
      * The following values are possible:
      *
      * - `false` - the address must not have a subnet (default).
@@ -163,7 +163,7 @@ class IpValidator extends Validator
      */
     public $wrongCidr;
     /**
-     * @var string user-defined error message is used when validation fails due to subnet [[subnet]] set to 'only',
+     * @var string|null user-defined error message is used when validation fails due to subnet [[subnet]] set to 'only',
      * but the CIDR prefix is not set.
      *
      * You may use the following placeholders in the message:
@@ -246,9 +246,7 @@ public function init()
      * - Recursively substitutes aliases (described in [[networks]]) with their values.
      * - Removes duplicates
      *
-     * @property array the IPv4 or IPv6 ranges that are allowed or forbidden.
-     * See [[setRanges()]] for detailed description.
-     * @param array|string $ranges the IPv4 or IPv6 ranges that are allowed or forbidden.
+     * @param array|string|null $ranges the IPv4 or IPv6 ranges that are allowed or forbidden.
      *
      * When the array is empty, or the option not set, all IP addresses are allowed.
      *
diff --git a/framework/validators/NumberValidator.php b/framework/validators/NumberValidator.php
index 56c9d1403e9..714288a27f6 100644
--- a/src/validators/NumberValidator.php
+++ b/src/validators/NumberValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -34,12 +34,12 @@ class NumberValidator extends Validator
      */
     public $integerOnly = false;
     /**
-     * @var int|float upper limit of the number. Defaults to null, meaning no upper limit.
+     * @var int|float|null upper limit of the number. Defaults to null, meaning no upper limit.
      * @see tooBig for the customized message used when the number is too big.
      */
     public $max;
     /**
-     * @var int|float lower limit of the number. Defaults to null, meaning no lower limit.
+     * @var int|float|null lower limit of the number. Defaults to null, meaning no lower limit.
      * @see tooSmall for the customized message used when the number is too small.
      */
     public $min;
diff --git a/framework/validators/PunycodeAsset.php b/framework/validators/PunycodeAsset.php
index 1f65b8d6400..8d928838ce9 100644
--- a/src/validators/PunycodeAsset.php
+++ b/src/validators/PunycodeAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
diff --git a/framework/validators/RangeValidator.php b/framework/validators/RangeValidator.php
index bcde4a1309d..8265d0511ba 100644
--- a/src/validators/RangeValidator.php
+++ b/src/validators/RangeValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -10,6 +10,7 @@
 use Yii;
 use yii\base\InvalidConfigException;
 use yii\helpers\ArrayHelper;
+use yii\helpers\Json;
 
 /**
  * RangeValidator validates that the attribute value is among a list of values.
@@ -111,7 +112,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'yii.validation.range(value, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ');';
+        return 'yii.validation.range(value, messages, ' . Json::htmlEncode($options) . ');';
     }
 
     /**
diff --git a/framework/validators/RegularExpressionValidator.php b/framework/validators/RegularExpressionValidator.php
index bdc54ed9dac..747c4d2a9ee 100644
--- a/src/validators/RegularExpressionValidator.php
+++ b/src/validators/RegularExpressionValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
diff --git a/framework/validators/RequiredValidator.php b/framework/validators/RequiredValidator.php
index 646357ace35..7cb7a7a44cd 100644
--- a/src/validators/RequiredValidator.php
+++ b/src/validators/RequiredValidator.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
 
 use Yii;
+use yii\helpers\Json;
 
 /**
  * RequiredValidator validates that the specified attribute does not have null or empty value.
@@ -93,7 +94,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'yii.validation.required(value, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ');';
+        return 'yii.validation.required(value, messages, ' . Json::htmlEncode($options) . ');';
     }
 
     /**
diff --git a/framework/validators/SafeValidator.php b/framework/validators/SafeValidator.php
index 2b0a3c5dd7f..f2944076766 100644
--- a/src/validators/SafeValidator.php
+++ b/src/validators/SafeValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
diff --git a/framework/validators/StringValidator.php b/framework/validators/StringValidator.php
index f06dbfc2208..463cc5cb0a2 100644
--- a/src/validators/StringValidator.php
+++ b/src/validators/StringValidator.php
@@ -1,13 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
 
 use Yii;
+use yii\helpers\Json;
 
 /**
  * StringValidator validates that the attribute value is of certain length.
@@ -34,12 +35,12 @@ class StringValidator extends Validator
      */
     public $length;
     /**
-     * @var int maximum length. If not set, it means no maximum length limit.
+     * @var int|null maximum length. If not set, it means no maximum length limit.
      * @see tooLong for the customized message for a too long string.
      */
     public $max;
     /**
-     * @var int minimum length. If not set, it means no minimum length limit.
+     * @var int|null minimum length. If not set, it means no minimum length limit.
      * @see tooShort for the customized message for a too short string.
      */
     public $min;
@@ -60,7 +61,7 @@ class StringValidator extends Validator
      */
     public $notEqual;
     /**
-     * @var string the encoding of the string value to be validated (e.g. 'UTF-8').
+     * @var string|null the encoding of the string value to be validated (e.g. 'UTF-8').
      * If this property is not set, [[\yii\base\Application::charset]] will be used.
      */
     public $encoding;
@@ -168,7 +169,7 @@ public function clientValidateAttribute($model, $attribute, $view)
         ValidationAsset::register($view);
         $options = $this->getClientOptions($model, $attribute);
 
-        return 'yii.validation.string(value, messages, ' . json_encode($options, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE) . ');';
+        return 'yii.validation.string(value, messages, ' . Json::htmlEncode($options) . ');';
     }
 
     /**
diff --git a/framework/validators/TrimValidator.php b/framework/validators/TrimValidator.php
new file mode 100644
index 00000000000..89a2eb86b97
--- /dev/null
+++ b/src/validators/TrimValidator.php
@@ -0,0 +1,84 @@
+<?php
+/**
+ * @link https://www.yiiframework.com/
+ * @copyright Copyright (c) 2008 Yii Software LLC
+ * @license https://www.yiiframework.com/license/
+ */
+
+namespace yii\validators;
+
+use yii\helpers\Json;
+
+/**
+ * This class converts the attribute value(s) to string(s) and strip characters.
+ *
+ * @since 2.0.46
+ */
+class TrimValidator extends Validator
+{
+    /**
+     * @var string The list of characters to strip, with `..` can specify a range of characters.
+     * For example, set '\/ ' to normalize path or namespace.
+     */
+    public $chars;
+    /**
+     * @var bool Whether the filter should be skipped if an array input is given.
+     * If true and an array input is given, the filter will not be applied.
+     */
+    public $skipOnArray = false;
+    /**
+     * @inheritDoc
+     */
+    public $skipOnEmpty = false;
+
+    /**
+     * @inheritDoc
+     */
+    public function validateAttribute($model, $attribute)
+    {
+        $value = $model->$attribute;
+        if (!$this->skipOnArray || !is_array($value)) {
+            $model->$attribute = is_array($value)
+                ? array_map([$this, 'trimValue'], $value)
+                : $this->trimValue($value);
+        }
+    }
+
+    /**
+     * Converts given value to string and strips declared characters.
+     *
+     * @param mixed $value the value to strip
+     * @return string
+     */
+    protected function trimValue($value)
+    {
+        return $this->isEmpty($value) ? '' : trim((string) $value, $this->chars ?: " \n\r\t\v\x00");
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function clientValidateAttribute($model, $attribute, $view)
+    {
+        if ($this->skipOnArray && is_array($model->$attribute)) {
+            return null;
+        }
+
+        ValidationAsset::register($view);
+        $options = $this->getClientOptions($model, $attribute);
+
+        return 'value = yii.validation.trim($form, attribute, ' . Json::htmlEncode($options) . ', value);';
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getClientOptions($model, $attribute)
+    {
+        return [
+            'skipOnArray' => (bool) $this->skipOnArray,
+            'skipOnEmpty' => (bool) $this->skipOnEmpty,
+            'chars' => $this->chars ?: false,
+        ];
+    }
+}
diff --git a/framework/validators/UniqueValidator.php b/framework/validators/UniqueValidator.php
index f383ec9afc3..56bb0fe4841 100644
--- a/src/validators/UniqueValidator.php
+++ b/src/validators/UniqueValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -42,13 +42,13 @@
 class UniqueValidator extends Validator
 {
     /**
-     * @var string the name of the ActiveRecord class that should be used to validate the uniqueness
+     * @var string|null the name of the ActiveRecord class that should be used to validate the uniqueness
      * of the current attribute value. If not set, it will use the ActiveRecord class of the attribute being validated.
      * @see targetAttribute
      */
     public $targetClass;
     /**
-     * @var string|array the name of the [[\yii\db\ActiveRecord|ActiveRecord]] attribute that should be used to
+     * @var string|array|null the name of the [[\yii\db\ActiveRecord|ActiveRecord]] attribute that should be used to
      * validate the uniqueness of the current attribute value. If not set, it will use the name
      * of the attribute currently being validated. You may use an array to validate the uniqueness
      * of multiple columns at the same time. The array values are the attributes that will be
@@ -122,9 +122,15 @@ public function init()
      */
     public function validateAttribute($model, $attribute)
     {
-        /* @var $targetClass ActiveRecordInterface */
-        $targetClass = $this->getTargetClass($model);
         $targetAttribute = $this->targetAttribute === null ? $attribute : $this->targetAttribute;
+        if ($this->skipOnError) {
+            foreach ((array)$targetAttribute as $k => $v) {
+                if ($model->hasErrors(is_int($k) ? $v : $k)) {
+                    return;
+                }
+            }
+        }
+
         $rawConditions = $this->prepareConditions($targetAttribute, $model, $attribute);
         $conditions = [$this->targetAttributeJunction === 'or' ? 'or' : 'and'];
 
@@ -136,6 +142,8 @@ public function validateAttribute($model, $attribute)
             $conditions[] = [$key => $value];
         }
 
+        /* @var $targetClass ActiveRecordInterface */
+        $targetClass = $this->getTargetClass($model);
         $db = $targetClass::getDb();
 
         $modelExists = false;
@@ -309,7 +317,7 @@ private function addComboNotUniqueError($model, $attribute)
      * Returns conditions with alias.
      * @param ActiveQuery $query
      * @param array $conditions array of condition, keys to be modified
-     * @param null|string $alias set empty string for no apply alias. Set null for apply primary table alias
+     * @param string|null $alias set empty string for no apply alias. Set null for apply primary table alias
      * @return array
      */
     private function applyTableAlias($query, $conditions, $alias = null)
diff --git a/framework/validators/UrlValidator.php b/framework/validators/UrlValidator.php
index 812a218b506..463e01f4f65 100644
--- a/src/validators/UrlValidator.php
+++ b/src/validators/UrlValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -35,7 +35,7 @@ class UrlValidator extends Validator
      */
     public $validSchemes = ['http', 'https'];
     /**
-     * @var string the default URI scheme. If the input doesn't contain the scheme part, the default
+     * @var string|null the default URI scheme. If the input doesn't contain the scheme part, the default
      * scheme will be prepended to it (thus changing the input). Defaults to null, meaning a URL must
      * contain the scheme part.
      */
diff --git a/framework/validators/ValidationAsset.php b/framework/validators/ValidationAsset.php
index a25acffd625..7d22d48f63f 100644
--- a/src/validators/ValidationAsset.php
+++ b/src/validators/ValidationAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
diff --git a/framework/validators/Validator.php b/framework/validators/Validator.php
index 5b808acd271..a0677df9271 100644
--- a/src/validators/Validator.php
+++ b/src/validators/Validator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\validators;
@@ -41,15 +41,15 @@
  * - `required`: [[RequiredValidator]]
  * - `safe`: [[SafeValidator]]
  * - `string`: [[StringValidator]]
- * - `trim`: [[FilterValidator]]
+ * - `trim`: [[TrimValidator]]
  * - `unique`: [[UniqueValidator]]
  * - `url`: [[UrlValidator]]
  * - `ip`: [[IpValidator]]
  *
  * For more details and usage information on Validator, see the [guide article on validators](guide:input-validation).
  *
- * @property-read array $attributeNames Attribute names. This property is read-only.
- * @property-read array $validationAttributes List of attribute names. This property is read-only.
+ * @property-read array $attributeNames Attribute names.
+ * @property-read array $validationAttributes List of attribute names.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -91,8 +91,7 @@ class Validator extends Component
         'safe' => 'yii\validators\SafeValidator',
         'string' => 'yii\validators\StringValidator',
         'trim' => [
-            'class' => 'yii\validators\FilterValidator',
-            'filter' => 'trim',
+            'class' => 'yii\validators\TrimValidator',
             'skipOnArray' => true,
         ],
         'unique' => 'yii\validators\UniqueValidator',
@@ -105,7 +104,7 @@ class Validator extends Component
      */
     public $attributes = [];
     /**
-     * @var string the user-defined error message. It may contain the following placeholders which
+     * @var string|null the user-defined error message. It may contain the following placeholders which
      * will be replaced accordingly by the validator:
      *
      * - `{attribute}`: the label of the attribute being validated
@@ -145,14 +144,14 @@ class Validator extends Component
      */
     public $enableClientValidation = true;
     /**
-     * @var callable a PHP callable that replaces the default implementation of [[isEmpty()]].
+     * @var callable|null a PHP callable that replaces the default implementation of [[isEmpty()]].
      * If not set, [[isEmpty()]] will be used to check if a value is empty. The signature
      * of the callable should be `function ($value)` which returns a boolean indicating
      * whether the value is empty.
      */
     public $isEmpty;
     /**
-     * @var callable a PHP callable whose return value determines whether this validator should be applied.
+     * @var callable|null a PHP callable whose return value determines whether this validator should be applied.
      * The signature of the callable should be `function ($model, $attribute)`, where `$model` and `$attribute`
      * refer to the model and the attribute currently being validated. The callable should return a boolean value.
      *
@@ -171,7 +170,7 @@ class Validator extends Component
      */
     public $when;
     /**
-     * @var string a JavaScript function name whose return value determines whether this validator should be applied
+     * @var string|null a JavaScript function name whose return value determines whether this validator should be applied
      * on the client-side. The signature of the function should be `function (attribute, value)`, where
      * `attribute` is an object describing the attribute being validated (see [[clientValidateAttribute()]])
      * and `value` the current value of the attribute.
@@ -272,7 +271,7 @@ public function validateAttributes($model, $attributes = null)
      * - If this is a string or an array, the intersection of [[getAttributeNames()]]
      *   and the specified attributes will be returned.
      *
-     * @return array list of attribute names.
+     * @return array|null list of attribute names.
      * @since 2.0.16
      */
     public function getValidationAttributes($attributes = null)
@@ -314,7 +313,7 @@ public function validateAttribute($model, $attribute)
      * Validates a given value.
      * You may use this method to validate a value out of the context of a data model.
      * @param mixed $value the data value to be validated.
-     * @param string $error the error message to be returned, if the validation fails.
+     * @param string|null $error the error message to be returned, if the validation fails.
      * @return bool whether the data is valid.
      */
     public function validate($value, &$error = null)
diff --git a/framework/views/errorHandler/error.php b/framework/views/errorHandler/error.php
index 9ef6dc7f13d..630bbec034f 100644
--- a/src/views/errorHandler/error.php
+++ b/src/views/errorHandler/error.php
@@ -1,5 +1,5 @@
 <?php
-/* @var $exception \yii\web\HttpException|\Exception */
+/* @var $exception \Throwable */
 /* @var $handler \yii\web\ErrorHandler */
 if ($exception instanceof \yii\web\HttpException) {
     $code = $exception->statusCode;
diff --git a/framework/views/errorHandler/exception.php b/framework/views/errorHandler/exception.php
index d097a1c92fd..4601e7c42bd 100644
--- a/src/views/errorHandler/exception.php
+++ b/src/views/errorHandler/exception.php
@@ -1,6 +1,6 @@
 <?php
 /* @var $this \yii\web\View */
-/* @var $exception \Exception */
+/* @var $exception \Throwable */
 /* @var $handler \yii\web\ErrorHandler */
 ?>
 <?php if (method_exists($this, 'beginPage')): ?>
diff --git a/framework/views/messageConfig.php b/framework/views/messageConfig.php
index 2495aed76ad..dc041d2a41a 100644
--- a/src/views/messageConfig.php
+++ b/src/views/messageConfig.php
@@ -5,12 +5,17 @@
     'sourcePath' => __DIR__ . DIRECTORY_SEPARATOR . '..',
     // array, required, list of language codes that the extracted messages
     // should be translated to. For example, ['zh-CN', 'de'].
-    'languages' => ['de'],
+    'languages' => [
+        'af', 'ar', 'az', 'be', 'bg', 'bs', 'ca', 'cs', 'da', 'de', 'el', 'es', 'et', 'fa', 'fi', 'fr', 'he', 'hi',
+        'pt-BR', 'ro', 'hr', 'hu', 'hy', 'id', 'it', 'ja', 'ka', 'kk', 'ko', 'kz', 'lt', 'lv', 'ms', 'nb-NO', 'nl',
+        'pl', 'pt', 'ru', 'sk', 'sl', 'sr', 'sr-Latn', 'sv', 'tg', 'th', 'tr', 'uk', 'uz', 'uz-Cy', 'vi', 'zh-CN',
+        'zh-TW'
+    ],
     // string, the name of the function for translating messages.
     // Defaults to 'Yii::t'. This is used as a mark to find the messages to be
     // translated. You may use a string for single function name or an array for
     // multiple function names.
-    'translator' => 'Yii::t',
+    'translator' => ['\Yii::t', 'Yii::t'],
     // boolean, whether to sort messages by keys when merging new messages
     // with the existing ones. Defaults to false, which means the new (untranslated)
     // messages will be separated from the old (translated) ones.
@@ -31,15 +36,14 @@
     // See helpers/FileHelper::findFiles() for pattern matching rules.
     // If a file/directory matches both a pattern in "only" and "except", it will NOT be processed.
     'except' => [
-        '.svn',
-        '.git',
-        '.gitignore',
-        '.gitkeep',
-        '.hgignore',
-        '.hgkeep',
+        '.*',
+        '/.*',
         '/messages',
+        '/tests',
+        '/runtime',
+        '/vendor',
+        '/BaseYii.php',
     ],
-
     // 'php' output format is for saving messages to php files.
     'format' => 'php',
     // Root directory containing message translations.
diff --git a/framework/web/Application.php b/framework/web/Application.php
index 6a052f19d3d..b05ac8b1e16 100644
--- a/src/web/Application.php
+++ b/src/web/Application.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -16,13 +16,12 @@
  *
  * For more details and usage information on Application, see the [guide article on applications](guide:structure-applications).
  *
- * @property-read ErrorHandler $errorHandler The error handler application component. This property is
- * read-only.
+ * @property-read ErrorHandler $errorHandler The error handler application component.
  * @property string $homeUrl The homepage URL.
- * @property-read Request $request The request component. This property is read-only.
- * @property-read Response $response The response component. This property is read-only.
- * @property-read Session $session The session component. This property is read-only.
- * @property-read User $user The user component. This property is read-only.
+ * @property-read Request $request The request component.
+ * @property-read Response $response The response component.
+ * @property-read Session $session The session component.
+ * @property-read User $user The user component.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -34,7 +33,7 @@ class Application extends \yii\base\Application
      */
     public $defaultRoute = 'site';
     /**
-     * @var array the configuration specifying a controller action which should handle
+     * @var array|null the configuration specifying a controller action which should handle
      * all user requests. This is mainly used when the application is in maintenance mode
      * and needs to handle all incoming requests via a single action.
      * The configuration is an array whose first element specifies the route of the action.
diff --git a/framework/web/AssetBundle.php b/framework/web/AssetBundle.php
index aca626cd4d9..65dab7942ba 100644
--- a/src/web/AssetBundle.php
+++ b/src/web/AssetBundle.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -30,7 +30,7 @@
 class AssetBundle extends BaseObject
 {
     /**
-     * @var string the directory that contains the source asset files for this asset bundle.
+     * @var string|null the directory that contains the source asset files for this asset bundle.
      * A source asset file is a file that is part of your source code repository of your Web application.
      *
      * You must set this property if the directory containing the source asset files is not Web accessible.
@@ -79,7 +79,7 @@ class AssetBundle extends BaseObject
      * specified in one of the following formats:
      *
      * - an absolute URL representing an external asset. For example,
-     *   `http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js` or
+     *   `https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js` or
      *   `//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js`.
      * - a relative path representing a local asset (e.g. `js/main.js`). The actual file path of a local
      *   asset can be determined by prefixing [[basePath]] to the relative path, and the actual URL
diff --git a/framework/web/AssetConverter.php b/framework/web/AssetConverter.php
index 0cfc0d86e52..64af54907e0 100644
--- a/src/web/AssetConverter.php
+++ b/src/web/AssetConverter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -12,7 +12,7 @@
 use yii\base\Exception;
 
 /**
- * AssetConverter supports conversion of several popular script formats into JS or CSS scripts.
+ * AssetConverter supports conversion of several popular formats into JS or CSS files.
  *
  * It is used by [[AssetManager]] to convert files after they have been published.
  *
@@ -26,6 +26,8 @@ class AssetConverter extends Component implements AssetConverterInterface
      * The keys are the asset file extension names, and the values are the corresponding
      * target script types (either "css" or "js") and the commands used for the conversion.
      *
+     * The command placeholders: `{from}` - source file, `{to}` - converted file.
+     *
      * You may also use a [path alias](guide:concept-aliases) to specify the location of the command:
      *
      * ```php
@@ -33,11 +35,15 @@ class AssetConverter extends Component implements AssetConverterInterface
      *     'styl' => ['css', '@app/node_modules/bin/stylus < {from} > {to}'],
      * ]
      * ```
+     *
+     * Note: `Yii::getAlias()` can replace alias at the begin of the command only.
+     *
+     * @see https://sass-lang.com/documentation/cli/ SASS/SCSS
      */
     public $commands = [
         'less' => ['css', 'lessc {from} {to} --no-color --source-map'],
-        'scss' => ['css', 'sass {from} {to} --sourcemap'],
-        'sass' => ['css', 'sass {from} {to} --sourcemap'],
+        'scss' => ['css', 'sass --style=compressed {from} {to}'],
+        'sass' => ['css', 'sass --style=compressed {from} {to}'],
         'styl' => ['css', 'stylus < {from} > {to}'],
         'coffee' => ['js', 'coffee -p {from} > {to}'],
         'ts' => ['js', 'tsc --out {to} {from}'],
diff --git a/framework/web/AssetConverterInterface.php b/framework/web/AssetConverterInterface.php
index e72e566de9b..bc269dd6b79 100644
--- a/src/web/AssetConverterInterface.php
+++ b/src/web/AssetConverterInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/AssetManager.php b/framework/web/AssetManager.php
index 2d28d9246ed..40b68096e44 100644
--- a/src/web/AssetManager.php
+++ b/src/web/AssetManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -42,7 +42,7 @@
 class AssetManager extends Component
 {
     /**
-     * @var array|bool list of asset bundle configurations. This property is provided to customize asset bundles.
+     * @var array|false list of asset bundle configurations. This property is provided to customize asset bundles.
      * When a bundle is being loaded by [[getBundle()]], if it has a corresponding configuration specified here,
      * the configuration will be applied to the bundle.
      *
@@ -74,7 +74,7 @@ class AssetManager extends Component
      */
     public $baseUrl = '@web/assets';
     /**
-     * @var array mapping from source asset files (keys) to target asset files (values).
+     * @var string[] mapping from source asset files (keys) to target asset files (values).
      *
      * This property is provided to support fixing incorrect asset file paths in some asset bundles.
      * When an asset bundle is registered with a view, each relative asset file in its [[AssetBundle::css|css]]
@@ -123,7 +123,7 @@ class AssetManager extends Component
      */
     public $linkAssets = false;
     /**
-     * @var int the permission to be set for newly published asset files.
+     * @var int|null the permission to be set for newly published asset files.
      * This value will be used by PHP chmod() function. No umask will be applied.
      * If not set, the permission will be determined by the current environment.
      */
@@ -136,7 +136,7 @@ class AssetManager extends Component
      */
     public $dirMode = 0775;
     /**
-     * @var callback a PHP callback that is called before copying each sub-directory or file.
+     * @var callable|null a PHP callback that is called before copying each sub-directory or file.
      * This option is used only when publishing a directory. If the callback returns false, the copy
      * operation for the sub-directory or file will be cancelled.
      *
@@ -147,7 +147,7 @@ class AssetManager extends Component
      */
     public $beforeCopy;
     /**
-     * @var callback a PHP callback that is called after a sub-directory or file is successfully copied.
+     * @var callable|null a PHP callback that is called after a sub-directory or file is successfully copied.
      * This option is used only when publishing a directory. The signature of the callback is the same as
      * for [[beforeCopy]].
      * This is passed as a parameter `afterCopy` to [[\yii\helpers\FileHelper::copyDirectory()]].
@@ -171,7 +171,7 @@ class AssetManager extends Component
      */
     public $appendTimestamp = false;
     /**
-     * @var callable a callback that will be called to produce hash for asset directory generation.
+     * @var callable|null a callback that will be called to produce hash for asset directory generation.
      * The signature of the callback should be as follows:
      *
      * ```
@@ -198,6 +198,9 @@ class AssetManager extends Component
      */
     public $hashCallback;
 
+    /**
+     * @var array
+     */
     private $_dummyBundles = [];
 
 
@@ -214,6 +217,9 @@ public function init()
         $this->baseUrl = rtrim(Yii::getAlias($this->baseUrl), '/');
     }
 
+    /**
+     * @var bool|null
+     */
     private $_isBasePathPermissionChecked;
 
     /**
@@ -354,7 +360,7 @@ public function getAssetPath($bundle, $asset)
     /**
      * @param AssetBundle $bundle
      * @param string $asset
-     * @return string|bool
+     * @return string|false
      */
     protected function resolveAsset($bundle, $asset)
     {
@@ -376,6 +382,9 @@ protected function resolveAsset($bundle, $asset)
         return false;
     }
 
+    /**
+     * @var AssetConverterInterface
+     */
     private $_converter;
 
     /**
@@ -434,7 +443,7 @@ public function setConverter($value)
      * that holds the published assets. This problem can be avoided altogether by 'requesting'
      * in advance all the resources that are supposed to trigger a 'publish()' call, and doing
      * that in the application deployment phase, before system goes live. See more in the following
-     * discussion: http://code.google.com/p/yii/issues/detail?id=2579
+     * discussion: https://code.google.com/archive/p/yii/issues/2579
      *
      * @param string $path the asset (file or directory) to be published
      * @param array $options the options to be applied when publishing a directory.
diff --git a/framework/web/BadRequestHttpException.php b/framework/web/BadRequestHttpException.php
index 08f73826808..d065405c521 100644
--- a/src/web/BadRequestHttpException.php
+++ b/src/web/BadRequestHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -23,11 +23,11 @@ class BadRequestHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(400, $message, $code, $previous);
     }
diff --git a/framework/web/CacheSession.php b/framework/web/CacheSession.php
index ecb14b782a1..860a91d5803 100644
--- a/src/web/CacheSession.php
+++ b/src/web/CacheSession.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -31,7 +31,7 @@
  * ]
  * ```
  *
- * @property-read bool $useCustomStorage Whether to use custom storage. This property is read-only.
+ * @property-read bool $useCustomStorage Whether to use custom storage.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
diff --git a/framework/web/CompositeUrlRule.php b/framework/web/CompositeUrlRule.php
index 550a6d7e738..39274e81434 100644
--- a/src/web/CompositeUrlRule.php
+++ b/src/web/CompositeUrlRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -14,7 +14,7 @@
  * CompositeUrlRule is the base class for URL rule classes that consist of multiple simpler rules.
  *
  * @property-read null|int $createUrlStatus Status of the URL creation after the last [[createUrl()]] call.
- * `null` if rule does not provide info about create status. This property is read-only.
+ * `null` if rule does not provide info about create status.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -130,7 +130,7 @@ protected function iterateRules($rules, $manager, $route, $params)
      * For multiple rules statuses will be combined by bitwise `or` operator
      * (e.g. `UrlRule::CREATE_STATUS_PARSING_ONLY | UrlRule::CREATE_STATUS_PARAMS_MISMATCH`).
      *
-     * @return null|int Status of the URL creation after the last [[createUrl()]] call. `null` if rule does not provide
+     * @return int|null Status of the URL creation after the last [[createUrl()]] call. `null` if rule does not provide
      * info about create status.
      * @see createStatus
      * @see https://www.php.net/manual/en/language.operators.bitwise.php
diff --git a/framework/web/ConflictHttpException.php b/framework/web/ConflictHttpException.php
index 2e5c99da140..9fc2626f877 100644
--- a/src/web/ConflictHttpException.php
+++ b/src/web/ConflictHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -18,11 +18,11 @@ class ConflictHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(409, $message, $code, $previous);
     }
diff --git a/framework/web/Controller.php b/framework/web/Controller.php
index 2913e1993e4..eba2ea678da 100644
--- a/src/web/Controller.php
+++ b/src/web/Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -242,7 +242,7 @@ public function beforeAction($action)
      *
      * @param string|array $url the URL to be redirected to. This can be in one of the following formats:
      *
-     * - a string representing a URL (e.g. "http://example.com")
+     * - a string representing a URL (e.g. "https://example.com")
      * - a string representing a URL alias (e.g. "@example.com")
      * - an array in the format of `[$route, ...name-value pairs...]` (e.g. `['site/index', 'ref' => 1]`)
      *   [[Url::to()]] will be used to convert the array into a URL.
@@ -290,7 +290,7 @@ public function goHome()
      *
      * For this function to work you have to [[User::setReturnUrl()|set the return URL]] in appropriate places before.
      *
-     * @param string|array $defaultUrl the default return URL in case it was not set previously.
+     * @param string|array|null $defaultUrl the default return URL in case it was not set previously.
      * If this is null and the return URL was not set previously, [[Application::homeUrl]] will be redirected to.
      * Please refer to [[User::setReturnUrl()]] on accepted format of the URL.
      * @return Response the current response object
diff --git a/framework/web/Cookie.php b/framework/web/Cookie.php
index 434e5cdf299..ac9a7233710 100644
--- a/src/web/Cookie.php
+++ b/src/web/Cookie.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/CookieCollection.php b/framework/web/CookieCollection.php
index aaedd9b8393..aa09b9ca455 100644
--- a/src/web/CookieCollection.php
+++ b/src/web/CookieCollection.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -17,9 +17,8 @@
  *
  * For more details and usage information on CookieCollection, see the [guide article on handling cookies](guide:runtime-sessions-cookies).
  *
- * @property-read int $count The number of cookies in the collection. This property is read-only.
- * @property-read ArrayIterator $iterator An iterator for traversing the cookies in the collection. This
- * property is read-only.
+ * @property-read int $count The number of cookies in the collection.
+ * @property-read ArrayIterator $iterator An iterator for traversing the cookies in the collection.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -55,6 +54,7 @@ public function __construct($cookies = [], $config = [])
      * It will be implicitly called when you use `foreach` to traverse the collection.
      * @return ArrayIterator an iterator for traversing the cookies in the collection.
      */
+    #[\ReturnTypeWillChange]
     public function getIterator()
     {
         return new ArrayIterator($this->_cookies);
@@ -66,6 +66,7 @@ public function getIterator()
      * It will be implicitly called when you use `count($collection)`.
      * @return int the number of cookies in the collection.
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         return $this->getCount();
@@ -105,7 +106,7 @@ public function getValue($name, $defaultValue = null)
 
     /**
      * Returns whether there is a cookie with the specified name.
-     * Note that if a cookie is marked for deletion from browser, this method will return false.
+     * Note that if a cookie is marked for deletion from browser or its value is an empty string, this method will return false.
      * @param string $name the cookie name
      * @return bool whether the named cookie exists
      * @see remove()
@@ -199,6 +200,7 @@ public function fromArray(array $array)
      * @param string $name the cookie name
      * @return bool whether the named cookie exists
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($name)
     {
         return $this->has($name);
@@ -210,8 +212,9 @@ public function offsetExists($name)
      * It is implicitly called when you use something like `$cookie = $collection[$name];`.
      * This is equivalent to [[get()]].
      * @param string $name the cookie name
-     * @return Cookie the cookie with the specified name, null if the named cookie does not exist.
+     * @return Cookie|null the cookie with the specified name, null if the named cookie does not exist.
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($name)
     {
         return $this->get($name);
@@ -225,6 +228,7 @@ public function offsetGet($name)
      * @param string $name the cookie name
      * @param Cookie $cookie the cookie to be added
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($name, $cookie)
     {
         $this->add($cookie);
@@ -237,6 +241,7 @@ public function offsetSet($name, $cookie)
      * This is equivalent to [[remove()]].
      * @param string $name the cookie name
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($name)
     {
         $this->remove($name);
diff --git a/framework/web/DbSession.php b/framework/web/DbSession.php
index d82484a4435..4d4e5030df2 100644
--- a/src/web/DbSession.php
+++ b/src/web/DbSession.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -140,7 +140,7 @@ public function regenerateID($deleteOldSession = false)
                ->queryOne();
         });
 
-        if ($row !== false) {
+        if ($row !== false && $this->getIsActive()) {
             if ($deleteOldSession) {
                 $this->db->createCommand()
                     ->update($this->sessionTable, ['id' => $newID], ['id' => $oldID])
@@ -151,11 +151,6 @@ public function regenerateID($deleteOldSession = false)
                     ->insert($this->sessionTable, $row)
                     ->execute();
             }
-        } else {
-            // shouldn't reach here normally
-            $this->db->createCommand()
-                ->insert($this->sessionTable, $this->composeFields($newID, ''))
-                ->execute();
         }
     }
 
diff --git a/framework/web/ErrorAction.php b/framework/web/ErrorAction.php
index 67bd8a6d413..e59f3ab2453 100644
--- a/src/web/ErrorAction.php
+++ b/src/web/ErrorAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -51,7 +51,7 @@
 class ErrorAction extends Action
 {
     /**
-     * @var string the view file to be rendered. If not set, it will take the value of [[id]].
+     * @var string|null the view file to be rendered. If not set, it will take the value of [[id]].
      * That means, if you name the action as "error" in "SiteController", then the view name
      * would be "error", and the corresponding view file would be "views/site/error.php".
      */
@@ -67,7 +67,7 @@ class ErrorAction extends Action
      */
     public $defaultMessage;
     /**
-     * @var string|false|null the name of the layout to be applied to this error action view.
+     * @var string|null|false the name of the layout to be applied to this error action view.
      * If not set, the layout configured in the controller will be used.
      * @see \yii\base\Controller::$layout
      * @since 2.0.14
@@ -75,7 +75,7 @@ class ErrorAction extends Action
     public $layout;
 
     /**
-     * @var \Exception the exception object, normally is filled on [[init()]] method call.
+     * @var \Throwable the exception object, normally is filled on [[init()]] method call.
      * @see findException() to know default way of obtaining exception.
      * @since 2.0.11
      */
@@ -157,7 +157,7 @@ protected function getViewRenderParams()
      * Gets exception from the [[yii\web\ErrorHandler|ErrorHandler]] component.
      * In case there is no exception in the component, treat as the action has been invoked
      * not from error handler, but by direct route, so '404 Not Found' error will be displayed.
-     * @return \Exception
+     * @return \Throwable
      * @since 2.0.11
      */
     protected function findException()
diff --git a/framework/web/ErrorHandler.php b/framework/web/ErrorHandler.php
index 5bb28dec3ee..3806c576ce9 100644
--- a/src/web/ErrorHandler.php
+++ b/src/web/ErrorHandler.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -39,7 +39,7 @@ class ErrorHandler extends \yii\base\ErrorHandler
      */
     public $maxTraceSourceLines = 13;
     /**
-     * @var string the route (e.g. `site/error`) to the controller action that will be used
+     * @var string|null the route (e.g. `site/error`) to the controller action that will be used
      * to display external errors. Inside the action, it can retrieve the error information
      * using `Yii::$app->errorHandler->exception`. This property defaults to null, meaning ErrorHandler
      * will handle the error display.
@@ -84,7 +84,7 @@ class ErrorHandler extends \yii\base\ErrorHandler
 
     /**
      * Renders the exception.
-     * @param \Exception|\Error $exception the exception to be rendered.
+     * @param \Throwable $exception the exception to be rendered.
      */
     protected function renderException($exception)
     {
@@ -138,7 +138,7 @@ protected function renderException($exception)
 
     /**
      * Converts an exception into an array.
-     * @param \Exception|\Error $exception the exception being converted
+     * @param \Throwable $exception the exception being converted
      * @return array the array representation of the exception.
      */
     protected function convertExceptionToArray($exception)
@@ -238,7 +238,7 @@ protected function getTypeUrl($class, $method)
         }
 
         $page = $this->htmlEncode(strtolower(str_replace('\\', '-', $class)));
-        $url = "http://www.yiiframework.com/doc-2.0/$page.html";
+        $url = "https://www.yiiframework.com/doc-2.0/$page.html";
         if ($method) {
             $url .= "#$method()-detail";
         }
@@ -272,7 +272,7 @@ public function renderFile($_file_, $_params_)
 
     /**
      * Renders the previous exception stack for a given Exception.
-     * @param \Exception $exception the exception whose precursors should be rendered.
+     * @param \Throwable $exception the exception whose precursors should be rendered.
      * @return string HTML content of the rendered previous exceptions.
      * Empty string if there are none.
      */
@@ -326,7 +326,7 @@ public function renderCallStackItem($file, $line, $class, $method, $args, $index
 
     /**
      * Renders call stack.
-     * @param \Exception|\ParseError $exception exception to get call stack from
+     * @param \Throwable $exception exception to get call stack from
      * @return string HTML content of the rendered call stack.
      * @since 2.0.12
      */
@@ -385,7 +385,7 @@ public function isCoreFile($file)
      */
     public function createHttpStatusLink($statusCode, $statusDescription)
     {
-        return '<a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#' . (int) $statusCode . '" target="_blank">HTTP ' . (int) $statusCode . ' &ndash; ' . $statusDescription . '</a>';
+        return '<a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#' . (int) $statusCode . '" target="_blank">HTTP ' . (int) $statusCode . ' &ndash; ' . $statusDescription . '</a>';
     }
 
     /**
@@ -396,11 +396,11 @@ public function createHttpStatusLink($statusCode, $statusDescription)
     public function createServerInformationLink()
     {
         $serverUrls = [
-            'http://httpd.apache.org/' => ['apache'],
-            'http://nginx.org/' => ['nginx'],
-            'http://lighttpd.net/' => ['lighttpd'],
+            'https://httpd.apache.org/' => ['apache'],
+            'https://nginx.org/' => ['nginx'],
+            'https://www.lighttpd.net/' => ['lighttpd'],
             'http://gwan.com/' => ['g-wan', 'gwan'],
-            'http://iis.net/' => ['iis', 'services'],
+            'https://www.iis.net/' => ['iis', 'services'],
             'https://www.php.net/manual/en/features.commandline.webserver.php' => ['development'],
         ];
         if (isset($_SERVER['SERVER_SOFTWARE'])) {
@@ -423,7 +423,7 @@ public function createServerInformationLink()
      */
     public function createFrameworkVersionLink()
     {
-        return '<a href="http://github.com/yiisoft/yii2/" target="_blank">' . $this->htmlEncode(Yii::getVersion()) . '</a>';
+        return '<a href="https://github.com/yiisoft/yii2/" target="_blank">' . $this->htmlEncode(Yii::getVersion()) . '</a>';
     }
 
     /**
@@ -482,7 +482,7 @@ public function argumentsToString($args)
 
     /**
      * Returns human-readable exception name.
-     * @param \Exception $exception
+     * @param \Throwable $exception
      * @return string|null human-readable exception name or null if it cannot be determined
      */
     public function getExceptionName($exception)
diff --git a/framework/web/ForbiddenHttpException.php b/framework/web/ForbiddenHttpException.php
index 51e0ff71aac..924f09e3259 100644
--- a/src/web/ForbiddenHttpException.php
+++ b/src/web/ForbiddenHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -23,11 +23,11 @@ class ForbiddenHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(403, $message, $code, $previous);
     }
diff --git a/framework/web/GoneHttpException.php b/framework/web/GoneHttpException.php
index ad736ac50ea..64cec04339c 100644
--- a/src/web/GoneHttpException.php
+++ b/src/web/GoneHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -23,11 +23,11 @@ class GoneHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(410, $message, $code, $previous);
     }
diff --git a/framework/web/GroupUrlRule.php b/framework/web/GroupUrlRule.php
index 4ce3b19a141..1b11721da25 100644
--- a/src/web/GroupUrlRule.php
+++ b/src/web/GroupUrlRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -60,7 +60,7 @@ class GroupUrlRule extends CompositeUrlRule
      */
     public $prefix;
     /**
-     * @var string the prefix for the route part of every rule declared in [[rules]].
+     * @var string|null the prefix for the route part of every rule declared in [[rules]].
      * The prefix and the route will be separated with a slash.
      * If this property is not set, it will take the value of [[prefix]].
      */
@@ -77,7 +77,7 @@ class GroupUrlRule extends CompositeUrlRule
      */
     public function init()
     {
-        $this->prefix = trim($this->prefix, '/');
+        $this->prefix = trim((string)$this->prefix, '/');
         $this->routePrefix = $this->routePrefix === null ? $this->prefix : trim($this->routePrefix, '/');
         parent::init();
     }
diff --git a/framework/web/HeaderCollection.php b/framework/web/HeaderCollection.php
index 0e03214511e..07d6502ef46 100644
--- a/src/web/HeaderCollection.php
+++ b/src/web/HeaderCollection.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -13,9 +13,8 @@
 /**
  * HeaderCollection is used by [[Response]] to maintain the currently registered HTTP headers.
  *
- * @property-read int $count The number of headers in the collection. This property is read-only.
- * @property-read \ArrayIterator $iterator An iterator for traversing the headers in the collection. This
- * property is read-only.
+ * @property-read int $count The number of headers in the collection.
+ * @property-read \ArrayIterator $iterator An iterator for traversing the headers in the collection.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -23,9 +22,13 @@
 class HeaderCollection extends BaseObject implements \IteratorAggregate, \ArrayAccess, \Countable
 {
     /**
-     * @var array the headers in this collection (indexed by the header names)
+     * @var array the headers in this collection (indexed by the normalized header names)
      */
     private $_headers = [];
+    /**
+     * @var array the original names of the headers (indexed by the normalized header names)
+     */
+    private $_originalHeaderNames = [];
 
 
     /**
@@ -34,6 +37,7 @@ class HeaderCollection extends BaseObject implements \IteratorAggregate, \ArrayA
      * It will be implicitly called when you use `foreach` to traverse the collection.
      * @return \ArrayIterator an iterator for traversing the headers in the collection.
      */
+    #[\ReturnTypeWillChange]
     public function getIterator()
     {
         return new \ArrayIterator($this->_headers);
@@ -45,6 +49,7 @@ public function getIterator()
      * It will be implicitly called when you use `count($collection)`.
      * @return int the number of headers in the collection.
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         return $this->getCount();
@@ -54,6 +59,7 @@ public function count()
      * Returns the number of headers in the collection.
      * @return int the number of headers in the collection.
      */
+    #[\ReturnTypeWillChange]
     public function getCount()
     {
         return count($this->_headers);
@@ -65,14 +71,14 @@ public function getCount()
      * @param mixed $default the value to return in case the named header does not exist
      * @param bool $first whether to only return the first header of the specified name.
      * If false, all headers of the specified name will be returned.
-     * @return string|array the named header(s). If `$first` is true, a string will be returned;
+     * @return string|array|null the named header(s). If `$first` is true, a string will be returned;
      * If `$first` is false, an array will be returned.
      */
     public function get($name, $default = null, $first = true)
     {
-        $name = strtolower($name);
-        if (isset($this->_headers[$name])) {
-            return $first ? reset($this->_headers[$name]) : $this->_headers[$name];
+        $normalizedName = strtolower($name);
+        if (isset($this->_headers[$normalizedName])) {
+            return $first ? reset($this->_headers[$normalizedName]) : $this->_headers[$normalizedName];
         }
 
         return $default;
@@ -87,8 +93,9 @@ public function get($name, $default = null, $first = true)
      */
     public function set($name, $value = '')
     {
-        $name = strtolower($name);
-        $this->_headers[$name] = (array) $value;
+        $normalizedName = strtolower($name);
+        $this->_headers[$normalizedName] = (array) $value;
+        $this->_originalHeaderNames[$normalizedName] = $name;
 
         return $this;
     }
@@ -103,8 +110,11 @@ public function set($name, $value = '')
      */
     public function add($name, $value)
     {
-        $name = strtolower($name);
-        $this->_headers[$name][] = $value;
+        $normalizedName = strtolower($name);
+        $this->_headers[$normalizedName][] = $value;
+        if (!\array_key_exists($normalizedName, $this->_originalHeaderNames)) {
+            $this->_originalHeaderNames[$normalizedName] = $name;
+        }
 
         return $this;
     }
@@ -118,9 +128,10 @@ public function add($name, $value)
      */
     public function setDefault($name, $value)
     {
-        $name = strtolower($name);
-        if (empty($this->_headers[$name])) {
-            $this->_headers[$name][] = $value;
+        $normalizedName = strtolower($name);
+        if (empty($this->_headers[$normalizedName])) {
+            $this->_headers[$normalizedName][] = $value;
+            $this->_originalHeaderNames[$normalizedName] = $name;
         }
 
         return $this;
@@ -133,9 +144,7 @@ public function setDefault($name, $value)
      */
     public function has($name)
     {
-        $name = strtolower($name);
-
-        return isset($this->_headers[$name]);
+        return isset($this->_headers[strtolower($name)]);
     }
 
     /**
@@ -145,10 +154,10 @@ public function has($name)
      */
     public function remove($name)
     {
-        $name = strtolower($name);
-        if (isset($this->_headers[$name])) {
-            $value = $this->_headers[$name];
-            unset($this->_headers[$name]);
+        $normalizedName = strtolower($name);
+        if (isset($this->_headers[$normalizedName])) {
+            $value = $this->_headers[$normalizedName];
+            unset($this->_headers[$normalizedName], $this->_originalHeaderNames[$normalizedName]);
             return $value;
         }
 
@@ -161,6 +170,7 @@ public function remove($name)
     public function removeAll()
     {
         $this->_headers = [];
+        $this->_originalHeaderNames = [];
     }
 
     /**
@@ -173,6 +183,19 @@ public function toArray()
         return $this->_headers;
     }
 
+    /**
+     * Returns the collection as a PHP array but instead of using normalized header names as keys (like [[toArray()]])
+     * it uses original header names (case-sensitive).
+     * @return array the array representation of the collection.
+     * @since 2.0.45
+     */
+    public function toOriginalArray()
+    {
+        return \array_map(function ($normalizedName) {
+            return $this->_headers[$normalizedName];
+        }, \array_flip($this->_originalHeaderNames));
+    }
+
     /**
      * Populates the header collection from an array.
      * @param array $array the headers to populate from
@@ -180,7 +203,9 @@ public function toArray()
      */
     public function fromArray(array $array)
     {
-        $this->_headers = array_change_key_case($array, CASE_LOWER);
+        foreach ($array as $name => $value) {
+            $this->set($name, $value);
+        }
     }
 
     /**
@@ -190,6 +215,7 @@ public function fromArray(array $array)
      * @param string $name the header name
      * @return bool whether the named header exists
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($name)
     {
         return $this->has($name);
@@ -201,8 +227,9 @@ public function offsetExists($name)
      * It is implicitly called when you use something like `$header = $collection[$name];`.
      * This is equivalent to [[get()]].
      * @param string $name the header name
-     * @return string the header value with the specified name, null if the named header does not exist.
+     * @return string|null the header value with the specified name, null if the named header does not exist.
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($name)
     {
         return $this->get($name);
@@ -216,6 +243,7 @@ public function offsetGet($name)
      * @param string $name the header name
      * @param string $value the header value to be added
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($name, $value)
     {
         $this->set($name, $value);
@@ -228,6 +256,7 @@ public function offsetSet($name, $value)
      * This is equivalent to [[remove()]].
      * @param string $name the header name
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($name)
     {
         $this->remove($name);
diff --git a/framework/web/HeadersAlreadySentException.php b/framework/web/HeadersAlreadySentException.php
index c57b5b88011..5aaac825927 100644
--- a/src/web/HeadersAlreadySentException.php
+++ b/src/web/HeadersAlreadySentException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/HtmlResponseFormatter.php b/framework/web/HtmlResponseFormatter.php
index 2b5ee81664d..f12170be017 100644
--- a/src/web/HtmlResponseFormatter.php
+++ b/src/web/HtmlResponseFormatter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/HttpException.php b/framework/web/HttpException.php
index f7f6ac5a1c3..78dc9bdef72 100644
--- a/src/web/HttpException.php
+++ b/src/web/HttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -38,14 +38,14 @@ class HttpException extends UserException
     /**
      * Constructor.
      * @param int $status HTTP status code, such as 404, 500, etc.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($status, $message = null, $code = 0, \Exception $previous = null)
+    public function __construct($status, $message = null, $code = 0, $previous = null)
     {
         $this->statusCode = $status;
-        parent::__construct($message, $code, $previous);
+        parent::__construct((string)$message, $code, $previous);
     }
 
     /**
diff --git a/framework/web/IdentityInterface.php b/framework/web/IdentityInterface.php
index 737a0242baa..655ceebacd4 100644
--- a/src/web/IdentityInterface.php
+++ b/src/web/IdentityInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/JqueryAsset.php b/framework/web/JqueryAsset.php
index 0ad585b706d..df365d7686b 100644
--- a/src/web/JqueryAsset.php
+++ b/src/web/JqueryAsset.php
@@ -1,14 +1,14 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
 
 /**
- * This asset bundle provides the [jQuery](http://jquery.com/) JavaScript library.
+ * This asset bundle provides the [jQuery](https://jquery.com/) JavaScript library.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
diff --git a/framework/web/JsExpression.php b/framework/web/JsExpression.php
index 83c76abf8f8..693c8c08210 100644
--- a/src/web/JsExpression.php
+++ b/src/web/JsExpression.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/JsonParser.php b/framework/web/JsonParser.php
index 94353fb5626..6d5c3e7552c 100644
--- a/src/web/JsonParser.php
+++ b/src/web/JsonParser.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/JsonResponseFormatter.php b/framework/web/JsonResponseFormatter.php
index 2218ca0d9ab..6c7afba9180 100644
--- a/src/web/JsonResponseFormatter.php
+++ b/src/web/JsonResponseFormatter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -82,7 +82,6 @@ class JsonResponseFormatter extends Component implements ResponseFormatterInterf
      * @since 2.0.7
      */
     public $prettyPrint = false;
-
     /**
      * @var bool Avoids objects with zero-indexed keys to be encoded as array
      * Json::encode((object)['test']) will be encoded as an object not array. This matches the behaviour of json_encode().
@@ -91,6 +90,7 @@ class JsonResponseFormatter extends Component implements ResponseFormatterInterf
      */
     public $keepObjectType;
 
+
     /**
      * Formats the specified response.
      * @param Response $response the response to be formatted.
diff --git a/framework/web/Link.php b/framework/web/Link.php
index 7a1cd3792f5..c64c34f81c5 100644
--- a/src/web/Link.php
+++ b/src/web/Link.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/Linkable.php b/framework/web/Linkable.php
index faa82cfacb2..1c7d1bdeb8f 100644
--- a/src/web/Linkable.php
+++ b/src/web/Linkable.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -27,10 +27,10 @@ interface Linkable
      *
      * ```php
      * [
-     *     'self' => 'http://example.com/users/1',
+     *     'self' => 'https://example.com/users/1',
      *     'friends' => [
-     *         'http://example.com/users/2',
-     *         'http://example.com/users/3',
+     *         'https://example.com/users/2',
+     *         'https://example.com/users/3',
      *     ],
      *     'manager' => $managerLink, // $managerLink is a Link object
      * ]
diff --git a/framework/web/MethodNotAllowedHttpException.php b/framework/web/MethodNotAllowedHttpException.php
index 4241e7618db..12d6c371d59 100644
--- a/src/web/MethodNotAllowedHttpException.php
+++ b/src/web/MethodNotAllowedHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -18,11 +18,11 @@ class MethodNotAllowedHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(405, $message, $code, $previous);
     }
diff --git a/framework/web/MultiFieldSession.php b/framework/web/MultiFieldSession.php
index 1b73e6d583e..012efcf79a5 100644
--- a/src/web/MultiFieldSession.php
+++ b/src/web/MultiFieldSession.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -22,7 +22,7 @@
  * While extending this class you should use [[composeFields()]] method - while writing the session data into the storage and
  * [[extractData()]] - while reading session data from the storage.
  *
- * @property-read bool $useCustomStorage Whether to use custom storage. This property is read-only.
+ * @property-read bool $useCustomStorage Whether to use custom storage.
  *
  * @author Paul Klimov <klimov.paul@gmail.com>
  * @since 2.0.6
@@ -89,8 +89,8 @@ public function getUseCustomStorage()
 
     /**
      * Composes storage field set for session writing.
-     * @param string $id Optional session id
-     * @param string $data Optional session data
+     * @param string|null $id Optional session id
+     * @param string|null $data Optional session data
      * @return array storage fields
      */
     protected function composeFields($id = null, $data = null)
diff --git a/framework/web/MultipartFormDataParser.php b/framework/web/MultipartFormDataParser.php
index 9cfac9b1996..f6bc9d7197d 100644
--- a/src/web/MultipartFormDataParser.php
+++ b/src/web/MultipartFormDataParser.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/NotAcceptableHttpException.php b/framework/web/NotAcceptableHttpException.php
index 65abdc42e93..6bca93f8bd4 100644
--- a/src/web/NotAcceptableHttpException.php
+++ b/src/web/NotAcceptableHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -22,11 +22,11 @@ class NotAcceptableHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(406, $message, $code, $previous);
     }
diff --git a/framework/web/NotFoundHttpException.php b/framework/web/NotFoundHttpException.php
index 03ce0266c96..d7ad0627c7d 100644
--- a/src/web/NotFoundHttpException.php
+++ b/src/web/NotFoundHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -18,11 +18,11 @@ class NotFoundHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(404, $message, $code, $previous);
     }
diff --git a/framework/web/RangeNotSatisfiableHttpException.php b/framework/web/RangeNotSatisfiableHttpException.php
index 18c1ebb5500..ef127a557fe 100644
--- a/src/web/RangeNotSatisfiableHttpException.php
+++ b/src/web/RangeNotSatisfiableHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -24,11 +24,11 @@ class RangeNotSatisfiableHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(416, $message, $code, $previous);
     }
diff --git a/framework/web/Request.php b/framework/web/Request.php
index bcaeb03af51..c42b6ad8651 100644
--- a/src/web/Request.php
+++ b/src/web/Request.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -23,7 +23,7 @@
  *
  * For more details and usage information on Request, see the [guide article on requests](guide:runtime-requests).
  *
- * @property-read string $absoluteUrl The currently requested absolute URL. This property is read-only.
+ * @property-read string $absoluteUrl The currently requested absolute URL.
  * @property array $acceptableContentTypes The content types ordered by the quality score. Types with the
  * highest scores will be returned first. The array keys are the content types, while the array values are the
  * corresponding quality score and other parameters as given in the header.
@@ -31,65 +31,59 @@
  * represents the most preferred language.
  * @property-read array $authCredentials That contains exactly two elements: - 0: the username sent via HTTP
  * authentication, `null` if the username is not given - 1: the password sent via HTTP authentication, `null` if
- * the password is not given. This property is read-only.
+ * the password is not given.
  * @property-read string|null $authPassword The password sent via HTTP authentication, `null` if the password
- * is not given. This property is read-only.
+ * is not given.
  * @property-read string|null $authUser The username sent via HTTP authentication, `null` if the username is
- * not given. This property is read-only.
+ * not given.
  * @property string $baseUrl The relative URL for the application.
- * @property array $bodyParams The request parameters given in the request body.
- * @property-read string $contentType Request content-type. Null is returned if this information is not
- * available. This property is read-only.
- * @property-read CookieCollection $cookies The cookie collection. This property is read-only.
- * @property-read string $csrfToken The token used to perform CSRF validation. This property is read-only.
+ * @property array|object $bodyParams The request parameters given in the request body. Note that the type of
+ * this property differs in getter and setter. See [[getBodyParams()]] and [[setBodyParams()]] for details.
+ * @property-read string $contentType Request content-type. Empty string is returned if this information is
+ * not available.
+ * @property-read CookieCollection $cookies The cookie collection.
+ * @property-read string $csrfToken The token used to perform CSRF validation.
  * @property-read string $csrfTokenFromHeader The CSRF token sent via [[CSRF_HEADER]] by browser. Null is
- * returned if no such header is sent. This property is read-only.
- * @property-read array $eTags The entity tags. This property is read-only.
- * @property-read HeaderCollection $headers The header collection. This property is read-only.
+ * returned if no such header is sent.
+ * @property-read array $eTags The entity tags.
+ * @property-read HeaderCollection $headers The header collection.
  * @property string|null $hostInfo Schema and hostname part (with port number if needed) of the request URL
- * (e.g. `http://www.yiiframework.com`), null if can't be obtained from `$_SERVER` and wasn't set. See
+ * (e.g. `https://www.yiiframework.com`), null if can't be obtained from `$_SERVER` and wasn't set. See
  * [[getHostInfo()]] for security related notes on this property.
- * @property-read string|null $hostName Hostname part of the request URL (e.g. `www.yiiframework.com`). This
- * property is read-only.
- * @property-read bool $isAjax Whether this is an AJAX (XMLHttpRequest) request. This property is read-only.
- * @property-read bool $isDelete Whether this is a DELETE request. This property is read-only.
- * @property-read bool $isFlash Whether this is an Adobe Flash or Adobe Flex request. This property is
- * read-only.
- * @property-read bool $isGet Whether this is a GET request. This property is read-only.
- * @property-read bool $isHead Whether this is a HEAD request. This property is read-only.
- * @property-read bool $isOptions Whether this is a OPTIONS request. This property is read-only.
- * @property-read bool $isPatch Whether this is a PATCH request. This property is read-only.
- * @property-read bool $isPjax Whether this is a PJAX request. This property is read-only.
- * @property-read bool $isPost Whether this is a POST request. This property is read-only.
- * @property-read bool $isPut Whether this is a PUT request. This property is read-only.
- * @property-read bool $isSecureConnection If the request is sent via secure channel (https). This property is
- * read-only.
+ * @property-read string|null $hostName Hostname part of the request URL (e.g. `www.yiiframework.com`).
+ * @property-read bool $isAjax Whether this is an AJAX (XMLHttpRequest) request.
+ * @property-read bool $isDelete Whether this is a DELETE request.
+ * @property-read bool $isFlash Whether this is an Adobe Flash or Adobe Flex request.
+ * @property-read bool $isGet Whether this is a GET request.
+ * @property-read bool $isHead Whether this is a HEAD request.
+ * @property-read bool $isOptions Whether this is a OPTIONS request.
+ * @property-read bool $isPatch Whether this is a PATCH request.
+ * @property-read bool $isPjax Whether this is a PJAX request.
+ * @property-read bool $isPost Whether this is a POST request.
+ * @property-read bool $isPut Whether this is a PUT request.
+ * @property-read bool $isSecureConnection If the request is sent via secure channel (https).
  * @property-read string $method Request method, such as GET, POST, HEAD, PUT, PATCH, DELETE. The value
- * returned is turned into upper case. This property is read-only.
- * @property-read string|null $origin URL origin of a CORS request, `null` if not available. This property is
- * read-only.
+ * returned is turned into upper case.
+ * @property-read string|null $origin URL origin of a CORS request, `null` if not available.
  * @property string $pathInfo Part of the request URL that is after the entry script and before the question
  * mark. Note, the returned path info is already URL-decoded.
  * @property int $port Port number for insecure requests.
  * @property array $queryParams The request GET parameter values.
- * @property-read string $queryString Part of the request URL that is after the question mark. This property
- * is read-only.
+ * @property-read string $queryString Part of the request URL that is after the question mark.
  * @property string $rawBody The request body.
- * @property-read string|null $referrer URL referrer, null if not available. This property is read-only.
- * @property-read string|null $remoteHost Remote host name, `null` if not available. This property is
- * read-only.
- * @property-read string|null $remoteIP Remote IP address, `null` if not available. This property is
- * read-only.
+ * @property-read string|null $referrer URL referrer, null if not available.
+ * @property-read string|null $remoteHost Remote host name, `null` if not available.
+ * @property-read string|null $remoteIP Remote IP address, `null` if not available.
  * @property string $scriptFile The entry script file path.
  * @property string $scriptUrl The relative URL of the entry script.
  * @property int $securePort Port number for secure requests.
- * @property-read string $serverName Server name, null if not available. This property is read-only.
- * @property-read int|null $serverPort Server port number, null if not available. This property is read-only.
+ * @property-read string $serverName Server name, null if not available.
+ * @property-read int|null $serverPort Server port number, null if not available.
  * @property string $url The currently requested relative URL. Note that the URI returned may be URL-encoded
  * depending on the client.
- * @property-read string|null $userAgent User agent, null if not available. This property is read-only.
- * @property-read string|null $userHost User host name, null if not available. This property is read-only.
- * @property-read string|null $userIP User IP address, null if not available. This property is read-only.
+ * @property-read string|null $userAgent User agent, null if not available.
+ * @property-read string|null $userHost User host name, null if not available.
+ * @property-read string|null $userIP User IP address, null if not available.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -121,7 +115,7 @@ class Request extends \yii\base\Request
      * You also need to include CSRF meta tags in your pages by using [[\yii\helpers\Html::csrfMetaTags()]].
      *
      * @see Controller::enableCsrfValidation
-     * @see http://en.wikipedia.org/wiki/Cross-site_request_forgery
+     * @see https://en.wikipedia.org/wiki/Cross-site_request_forgery
      */
     public $enableCsrfValidation = true;
     /**
@@ -227,6 +221,7 @@ class Request extends \yii\base\Request
         'X-Forwarded-For',
         'X-Forwarded-Host',
         'X-Forwarded-Proto',
+        'X-Forwarded-Port',
 
         // Microsoft:
         'Front-End-Https',
@@ -247,6 +242,18 @@ class Request extends \yii\base\Request
     public $ipHeaders = [
         'X-Forwarded-For', // Common
     ];
+    /**
+     * @var string[] List of headers where proxies store the real request port.
+     * It's not advisable to put insecure headers here.
+     * To use the `Forwarded Port`, the header must be added to [[secureHeaders]] list.
+     * The match of header names is case-insensitive.
+     * @see trustedHosts
+     * @see secureHeaders
+     * @since 2.0.46
+     */
+    public $portHeaders = [
+        'X-Forwarded-Port', // Common
+    ];
     /**
      * @var array list of headers to check for determining whether the connection is made via HTTPS.
      * The array keys are header names and the array value is a list of header values that indicate a secure connection.
@@ -570,7 +577,7 @@ public function getBodyParams()
             }
 
             $rawContentType = $this->getContentType();
-            if (($pos = strpos($rawContentType, ';')) !== false) {
+            if (($pos = strpos((string)$rawContentType, ';')) !== false) {
                 // e.g. text/html; charset=UTF-8
                 $contentType = substr($rawContentType, 0, $pos);
             } else {
@@ -603,8 +610,8 @@ public function getBodyParams()
 
     /**
      * Sets the request body parameters.
-     * @param array $values the request body parameters (name-value pairs)
-     * @see getBodyParam()
+     *
+     * @param array|object $values the request body parameters (name-value pairs)
      * @see getBodyParams()
      */
     public function setBodyParams($values)
@@ -614,7 +621,9 @@ public function setBodyParams($values)
 
     /**
      * Returns the named request body parameter value.
+     *
      * If the parameter does not exist, the second parameter passed to this method will be returned.
+     *
      * @param string $name the parameter name
      * @param mixed $defaultValue the default parameter value if the parameter does not exist.
      * @return mixed the parameter value
@@ -628,7 +637,7 @@ public function getBodyParam($name, $defaultValue = null)
         if (is_object($params)) {
             // unable to use `ArrayHelper::getValue()` due to different dots in key logic and lack of exception handling
             try {
-                return $params->{$name};
+                return isset($params->{$name}) ? $params->{$name} : $defaultValue;
             } catch (\Exception $e) {
                 return $defaultValue;
             }
@@ -737,10 +746,10 @@ public function getQueryParam($name, $defaultValue = null)
      * > application level in order to protect against such kind of attack.
      *
      * @property string|null schema and hostname part (with port number if needed) of the request URL
-     * (e.g. `http://www.yiiframework.com`), null if can't be obtained from `$_SERVER` and wasn't set.
+     * (e.g. `https://www.yiiframework.com`), null if can't be obtained from `$_SERVER` and wasn't set.
      * See [[getHostInfo()]] for security related notes on this property.
      * @return string|null schema and hostname part (with port number if needed) of the request URL
-     * (e.g. `http://www.yiiframework.com`), null if can't be obtained from `$_SERVER` and wasn't set.
+     * (e.g. `https://www.yiiframework.com`), null if can't be obtained from `$_SERVER` and wasn't set.
      * @see setHostInfo()
      */
     public function getHostInfo()
@@ -796,7 +805,7 @@ public function setHostInfo($value)
     public function getHostName()
     {
         if ($this->_hostName === null) {
-            $this->_hostName = parse_url($this->getHostInfo(), PHP_URL_HOST);
+            $this->_hostName = parse_url((string)$this->getHostInfo(), PHP_URL_HOST);
         }
 
         return $this->_hostName;
@@ -954,7 +963,7 @@ protected function resolvePathInfo()
         $pathInfo = urldecode($pathInfo);
 
         // try to encode in UTF8 if not so
-        // http://w3.org/International/questions/qa-forms-utf-8.html
+        // https://www.w3.org/International/questions/qa-forms-utf-8.en.html
         if (!preg_match('%^(?:
             [\x09\x0A\x0D\x20-\x7E]              # ASCII
             | [\xC2-\xDF][\x80-\xBF]             # non-overlong 2-byte
@@ -1114,7 +1123,7 @@ public function getIsSecureConnection()
 
     /**
      * Returns the server name.
-     * @return string server name, null if not available
+     * @return string|null server name, null if not available
      */
     public function getServerName()
     {
@@ -1122,11 +1131,23 @@ public function getServerName()
     }
 
     /**
-     * Returns the server port number.
+     * Returns the server port number. If a port is specified via a forwarding header (e.g. 'X-Forwarded-Port')
+     * and the remote host is a "trusted host" the that port will be used (see [[portHeaders]]),
+     * otherwise the default server port will be returned.
      * @return int|null server port number, null if not available
+     * @see portHeaders
      */
     public function getServerPort()
     {
+        foreach ($this->portHeaders as $portHeader) {
+            if ($this->headers->has($portHeader)) {
+                $port = $this->headers->get($portHeader);
+                if ($port !== null) {
+                    return $port;
+                }
+            }
+        }
+
         return isset($_SERVER['SERVER_PORT']) ? (int) $_SERVER['SERVER_PORT'] : null;
     }
 
@@ -1473,7 +1494,7 @@ public function setAcceptableContentTypes($value)
      * contained in [[getRawBody()]] or, in the case of the HEAD method, the
      * media type that would have been sent had the request been a GET.
      * For the MIME-types the user expects in response, see [[acceptableContentTypes]].
-     * @return string request content-type. Null is returned if this information is not available.
+     * @return string request content-type. Empty string is returned if this information is not available.
      * @link https://tools.ietf.org/html/rfc2616#section-14.17
      * HTTP 1.1 header field definitions
      */
@@ -1484,7 +1505,7 @@ public function getContentType()
         }
 
         //fix bug https://bugs.php.net/bug.php?id=66606
-        return $this->headers->get('Content-Type');
+        return $this->headers->get('Content-Type') ?: '';
     }
 
     private $_languages;
@@ -1735,7 +1756,7 @@ protected function loadCookies()
     /**
      * Returns the token used to perform CSRF validation.
      *
-     * This token is generated in a way to prevent [BREACH attacks](http://breachattack.com/). It may be passed
+     * This token is generated in a way to prevent [BREACH attacks](https://en.wikipedia.org/wiki/BREACH). It may be passed
      * along via a hidden field of an HTML form or an HTTP header value to support CSRF validation.
      * @param bool $regenerate whether to regenerate CSRF token. When this parameter is true, each time
      * this method is called, a new CSRF token will be generated and persisted (in session or cookie).
@@ -1756,7 +1777,7 @@ public function getCsrfToken($regenerate = false)
 
     /**
      * Loads the CSRF token from cookie or session.
-     * @return string the CSRF token loaded from cookie or session. Null is returned if the cookie or session
+     * @return string|null the CSRF token loaded from cookie or session. Null is returned if the cookie or session
      * does not have CSRF token.
      */
     protected function loadCsrfToken()
@@ -1786,7 +1807,7 @@ protected function generateCsrfToken()
     }
 
     /**
-     * @return string the CSRF token sent via [[CSRF_HEADER]] by browser. Null is returned if no such header is sent.
+     * @return string|null the CSRF token sent via [[CSRF_HEADER]] by browser. Null is returned if no such header is sent.
      */
     public function getCsrfTokenFromHeader()
     {
@@ -1819,7 +1840,7 @@ protected function createCsrfCookie($token)
      * Note that the method will NOT perform CSRF validation if [[enableCsrfValidation]] is false or the HTTP method
      * is among GET, HEAD or OPTIONS.
      *
-     * @param string $clientSuppliedToken the user-provided CSRF token to be validated. If null, the token will be retrieved from
+     * @param string|null $clientSuppliedToken the user-provided CSRF token to be validated. If null, the token will be retrieved from
      * the [[csrfParam]] POST field or HTTP header.
      * This parameter is available since version 2.0.4.
      * @return bool whether CSRF token is valid. If [[enableCsrfValidation]] is false, this method will return true.
diff --git a/framework/web/RequestParserInterface.php b/framework/web/RequestParserInterface.php
index 2108b827704..44a1051a6dd 100644
--- a/src/web/RequestParserInterface.php
+++ b/src/web/RequestParserInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/Response.php b/framework/web/Response.php
index a08f764df1f..8603b4ad908 100644
--- a/src/web/Response.php
+++ b/src/web/Response.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -37,27 +37,22 @@
  *
  * For more details and usage information on Response, see the [guide article on responses](guide:runtime-responses).
  *
- * @property-read CookieCollection $cookies The cookie collection. This property is read-only.
- * @property-write string $downloadHeaders The attachment file name. This property is write-only.
- * @property-read HeaderCollection $headers The header collection. This property is read-only.
- * @property-read bool $isClientError Whether this response indicates a client error. This property is
- * read-only.
- * @property-read bool $isEmpty Whether this response is empty. This property is read-only.
- * @property-read bool $isForbidden Whether this response indicates the current request is forbidden. This
- * property is read-only.
- * @property-read bool $isInformational Whether this response is informational. This property is read-only.
- * @property-read bool $isInvalid Whether this response has a valid [[statusCode]]. This property is
- * read-only.
+ * @property-read CookieCollection $cookies The cookie collection.
+ * @property-write string $downloadHeaders The attachment file name.
+ * @property-read HeaderCollection $headers The header collection.
+ * @property-read bool $isClientError Whether this response indicates a client error.
+ * @property-read bool $isEmpty Whether this response is empty.
+ * @property-read bool $isForbidden Whether this response indicates the current request is forbidden.
+ * @property-read bool $isInformational Whether this response is informational.
+ * @property-read bool $isInvalid Whether this response has a valid [[statusCode]].
  * @property-read bool $isNotFound Whether this response indicates the currently requested resource is not
- * found. This property is read-only.
- * @property-read bool $isOk Whether this response is OK. This property is read-only.
- * @property-read bool $isRedirection Whether this response is a redirection. This property is read-only.
- * @property-read bool $isServerError Whether this response indicates a server error. This property is
- * read-only.
- * @property-read bool $isSuccessful Whether this response is successful. This property is read-only.
+ * found.
+ * @property-read bool $isOk Whether this response is OK.
+ * @property-read bool $isRedirection Whether this response is a redirection.
+ * @property-read bool $isServerError Whether this response indicates a server error.
+ * @property-read bool $isSuccessful Whether this response is successful.
  * @property int $statusCode The HTTP status code to send with the response.
- * @property-write \Exception|\Error|\Throwable $statusCodeByException The exception object. This property is
- * write-only.
+ * @property-write \Throwable $statusCodeByException The exception object.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Carsten Brandt <mail@cebe.cc>
@@ -132,7 +127,7 @@ class Response extends \yii\base\Response
      */
     public $data;
     /**
-     * @var string the response content. When [[data]] is not null, it will be converted into [[content]]
+     * @var string|null the response content. When [[data]] is not null, it will be converted into [[content]]
      * according to [[format]] when the response is being sent out.
      * @see data
      */
@@ -147,7 +142,7 @@ class Response extends \yii\base\Response
      */
     public $stream;
     /**
-     * @var string the charset of the text response. If not set, it will use
+     * @var string|null the charset of the text response. If not set, it will use
      * the value of [[Application::charset]].
      */
     public $charset;
@@ -157,7 +152,7 @@ class Response extends \yii\base\Response
      */
     public $statusText = 'OK';
     /**
-     * @var string the version of the HTTP protocol to use. If not set, it will be determined via `$_SERVER['SERVER_PROTOCOL']`,
+     * @var string|null the version of the HTTP protocol to use. If not set, it will be determined via `$_SERVER['SERVER_PROTOCOL']`,
      * or '1.1' if that is not available.
      */
     public $version;
@@ -278,7 +273,7 @@ public function getStatusCode()
      * Sets the response status code.
      * This method will set the corresponding status text if `$text` is null.
      * @param int $value the status code
-     * @param string $text the status text. If not set, it will be set automatically based on the status code.
+     * @param string|null $text the status text. If not set, it will be set automatically based on the status code.
      * @throws InvalidArgumentException if the status code is invalid.
      * @return $this the response object itself
      */
@@ -302,7 +297,7 @@ public function setStatusCode($value, $text = null)
 
     /**
      * Sets the response status code based on the exception.
-     * @param \Exception|\Error|\Throwable $e the exception object.
+     * @param \Throwable $e the exception object.
      * @throws InvalidArgumentException if the status code is invalid.
      * @return $this the response object itself
      * @since 2.0.12
@@ -504,7 +499,7 @@ protected function sendContent()
      * ```
      *
      * @param string $filePath the path of the file to be sent.
-     * @param string $attachmentName the file name shown to the user. If null, it will be determined from `$filePath`.
+     * @param string|null $attachmentName the file name shown to the user. If null, it will be determined from `$filePath`.
      * @param array $options additional options for sending the file. The following options are supported:
      *
      *  - `mimeType`: the MIME type of the content. If not set, it will be guessed based on `$filePath`
@@ -639,10 +634,10 @@ public function sendStreamAsFile($handle, $attachmentName, $options = [])
     /**
      * Sets a default set of HTTP headers for file downloading purpose.
      * @param string $attachmentName the attachment file name
-     * @param string $mimeType the MIME type for the response. If null, `Content-Type` header will NOT be set.
+     * @param string|null $mimeType the MIME type for the response. If null, `Content-Type` header will NOT be set.
      * @param bool $inline whether the browser should open the file within the browser window. Defaults to false,
      * meaning a download dialog will pop up.
-     * @param int $contentLength the byte length of the file being downloaded. If null, `Content-Length` header will NOT be set.
+     * @param int|null $contentLength the byte length of the file being downloaded. If null, `Content-Length` header will NOT be set.
      * @return $this the response object itself
      */
     public function setDownloadHeaders($attachmentName, $mimeType = null, $inline = false, $contentLength = null)
@@ -716,11 +711,11 @@ protected function getHttpRange($fileSize)
      *
      * As this header directive is non-standard different directives exists for different web servers applications:
      *
-     * - Apache: [X-Sendfile](http://tn123.org/mod_xsendfile)
-     * - Lighttpd v1.4: [X-LIGHTTPD-send-file](http://redmine.lighttpd.net/projects/lighttpd/wiki/X-LIGHTTPD-send-file)
-     * - Lighttpd v1.5: [X-Sendfile](http://redmine.lighttpd.net/projects/lighttpd/wiki/X-LIGHTTPD-send-file)
-     * - Nginx: [X-Accel-Redirect](http://wiki.nginx.org/XSendfile)
-     * - Cherokee: [X-Sendfile and X-Accel-Redirect](http://www.cherokee-project.com/doc/other_goodies.html#x-sendfile)
+     * - Apache: [X-Sendfile](https://tn123.org/mod_xsendfile/)
+     * - Lighttpd v1.4: [X-LIGHTTPD-send-file](https://redmine.lighttpd.net/projects/lighttpd/wiki/X-LIGHTTPD-send-file)
+     * - Lighttpd v1.5: [X-Sendfile](https://redmine.lighttpd.net/projects/lighttpd/wiki/X-LIGHTTPD-send-file)
+     * - Nginx: [X-Accel-Redirect](https://www.nginx.com/resources/wiki/XSendfile)
+     * - Cherokee: [X-Sendfile and X-Accel-Redirect](https://cherokee-project.com/doc/other_goodies.html#x-sendfile)
      *
      * So for this method to work the X-SENDFILE option/module should be enabled by the web server and
      * a proper xHeader should be sent.
@@ -748,7 +743,7 @@ protected function getHttpRange($fileSize)
      * ```
      *
      * @param string $filePath file name with full path
-     * @param string $attachmentName file name shown to the user. If null, it will be determined from `$filePath`.
+     * @param string|null $attachmentName file name shown to the user. If null, it will be determined from `$filePath`.
      * @param array $options additional options for sending the file. The following options are supported:
      *
      *  - `mimeType`: the MIME type of the content. If not set, it will be guessed based on `$filePath`
@@ -864,7 +859,7 @@ protected function getDispositionHeaderValue($disposition, $attachmentName)
      *
      * @param string|array $url the URL to be redirected to. This can be in one of the following formats:
      *
-     * - a string representing a URL (e.g. "http://example.com")
+     * - a string representing a URL (e.g. "https://example.com")
      * - a string representing a URL alias (e.g. "@example.com")
      * - an array in the format of `[$route, ...name-value pairs...]` (e.g. `['site/index', 'ref' => 1]`).
      *   Note that the route is with respect to the whole application, instead of relative to a controller or module.
@@ -890,26 +885,29 @@ public function redirect($url, $statusCode = 302, $checkAjax = true)
             $url[0] = '/' . ltrim($url[0], '/');
         }
         $request = Yii::$app->getRequest();
-        $url = Url::to($url);
-        if (strncmp($url, '/', 1) === 0 && strncmp($url, '//', 2) !== 0) {
-            $url = $request->getHostInfo() . $url;
+        $normalizedUrl = Url::to($url);
+        if (
+            $normalizedUrl !== null
+            && strncmp($normalizedUrl, '/', 1) === 0
+            && strncmp($normalizedUrl, '//', 2) !== 0
+        ) {
+            $normalizedUrl = $request->getHostInfo() . $normalizedUrl;
         }
 
-        if ($checkAjax) {
-            if ($request->getIsAjax()) {
-                if (in_array($statusCode, [301, 302]) && preg_match('/Trident\/|MSIE[ ]/', $request->userAgent)) {
-                    $statusCode = 200;
-                }
-                if ($request->getIsPjax()) {
-                    $this->getHeaders()->set('X-Pjax-Url', $url);
-                } else {
-                    $this->getHeaders()->set('X-Redirect', $url);
-                }
+        if ($checkAjax && $request->getIsAjax()) {
+            if (
+                in_array($statusCode, [301, 302])
+                && preg_match('/Trident\/|MSIE[ ]/', (string)$request->userAgent)
+            ) {
+                $statusCode = 200;
+            }
+            if ($request->getIsPjax()) {
+                $this->getHeaders()->set('X-Pjax-Url', $normalizedUrl);
             } else {
-                $this->getHeaders()->set('Location', $url);
+                $this->getHeaders()->set('X-Redirect', $normalizedUrl);
             }
         } else {
-            $this->getHeaders()->set('Location', $url);
+            $this->getHeaders()->set('Location', $normalizedUrl);
         }
 
         $this->setStatusCode($statusCode);
diff --git a/framework/web/ResponseFormatterInterface.php b/framework/web/ResponseFormatterInterface.php
index 585c755a8dd..39bfde7da6a 100644
--- a/src/web/ResponseFormatterInterface.php
+++ b/src/web/ResponseFormatterInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/ServerErrorHttpException.php b/framework/web/ServerErrorHttpException.php
index 42e69c498bd..0f10fc8f97c 100644
--- a/src/web/ServerErrorHttpException.php
+++ b/src/web/ServerErrorHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -18,11 +18,11 @@ class ServerErrorHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(500, $message, $code, $previous);
     }
diff --git a/framework/web/Session.php b/framework/web/Session.php
index 5ac99277f50..01997ff5f5f 100644
--- a/src/web/Session.php
+++ b/src/web/Session.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -45,28 +45,26 @@
  *
  * For more details and usage information on Session, see the [guide article on sessions](guide:runtime-sessions-cookies).
  *
- * @property-read array $allFlashes Flash messages (key => message or key => [message1, message2]). This
- * property is read-only.
- * @property-read string $cacheLimiter Current cache limiter. This property is read-only.
- * @property-read array $cookieParams The session cookie parameters. This property is read-only.
- * @property-read int $count The number of session variables. This property is read-only.
+ * @property-read array $allFlashes Flash messages (key => message or key => [message1, message2]).
+ * @property-read string $cacheLimiter Current cache limiter.
+ * @property-read array $cookieParams The session cookie parameters.
+ * @property-read int $count The number of session variables.
  * @property-write string $flash The key identifying the flash message. Note that flash messages and normal
  * session variables share the same name space. If you have a normal session variable using the same name, its
- * value will be overwritten by this method. This property is write-only.
+ * value will be overwritten by this method.
  * @property float $gCProbability The probability (percentage) that the GC (garbage collection) process is
  * started on every session initialization.
  * @property bool $hasSessionId Whether the current request has sent the session ID.
  * @property string $id The current session ID.
- * @property-read bool $isActive Whether the session has started. This property is read-only.
- * @property-read SessionIterator $iterator An iterator for traversing the session variables. This property is
- * read-only.
+ * @property-read bool $isActive Whether the session has started.
+ * @property-read SessionIterator $iterator An iterator for traversing the session variables.
  * @property string $name The current session name.
  * @property string $savePath The current session save path, defaults to '/tmp'.
  * @property int $timeout The number of seconds after which data will be seen as 'garbage' and cleaned up. The
  * default value is 1440 seconds (or the value of "session.gc_maxlifetime" set in php.ini).
  * @property bool|null $useCookies The value indicating whether cookies should be used to store session IDs.
- * @property-read bool $useCustomStorage Whether to use custom storage. This property is read-only.
- * @property-read bool $useStrictMode Whether strict mode is enabled or not. This property is read-only.
+ * @property-read bool $useCustomStorage Whether to use custom storage.
+ * @property bool $useStrictMode Whether strict mode is enabled or not.
  * @property bool $useTransparentSessionID Whether transparent sid support is enabled or not, defaults to
  * false.
  *
@@ -662,6 +660,7 @@ public function gcSession($maxLifetime)
      * This method is required by the interface [[\IteratorAggregate]].
      * @return SessionIterator an iterator for traversing the session variables.
      */
+    #[\ReturnTypeWillChange]
     public function getIterator()
     {
         $this->open();
@@ -683,6 +682,7 @@ public function getCount()
      * This method is required by [[\Countable]] interface.
      * @return int number of items in the session.
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         return $this->getCount();
@@ -823,7 +823,7 @@ public function getFlash($key, $defaultValue = null, $delete = false)
      *
      * Note that if you use [[addFlash()]], `$message` will be an array, and you will have to adjust the above code.
      *
-     * [bootstrap alert]: http://getbootstrap.com/components/#alerts
+     * [bootstrap alert]: https://getbootstrap.com/docs/3.4/components/#alerts
      *
      * @param bool $delete whether to delete the flash messages right after this method is called.
      * If false, the flash messages will be automatically deleted in the next request.
@@ -964,6 +964,7 @@ public function hasFlash($key)
      * @param int|string $offset the offset to check on
      * @return bool
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         $this->open();
@@ -976,6 +977,7 @@ public function offsetExists($offset)
      * @param int|string $offset the offset to retrieve element.
      * @return mixed the element at the offset, null if no element is found at the offset
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         $this->open();
@@ -988,6 +990,7 @@ public function offsetGet($offset)
      * @param int|string $offset the offset to set element
      * @param mixed $item the element value
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $item)
     {
         $this->open();
@@ -998,6 +1001,7 @@ public function offsetSet($offset, $item)
      * This method is required by the interface [[\ArrayAccess]].
      * @param int|string $offset the offset to unset element
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         $this->open();
diff --git a/framework/web/SessionIterator.php b/framework/web/SessionIterator.php
index d8ccdf71ad0..e4b4c9eb809 100644
--- a/src/web/SessionIterator.php
+++ b/src/web/SessionIterator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -20,7 +20,7 @@ class SessionIterator implements \Iterator
      */
     private $_keys;
     /**
-     * @var mixed current key
+     * @var string|int|false current key
      */
     private $_key;
 
@@ -30,13 +30,15 @@ class SessionIterator implements \Iterator
      */
     public function __construct()
     {
-        $this->_keys = array_keys($_SESSION);
+        $this->_keys = array_keys(isset($_SESSION) ? $_SESSION : []);
+        $this->rewind();
     }
 
     /**
      * Rewinds internal array pointer.
      * This method is required by the interface [[\Iterator]].
      */
+    #[\ReturnTypeWillChange]
     public function rewind()
     {
         $this->_key = reset($this->_keys);
@@ -45,11 +47,12 @@ public function rewind()
     /**
      * Returns the key of the current array element.
      * This method is required by the interface [[\Iterator]].
-     * @return mixed the key of the current array element
+     * @return string|int|null the key of the current array element
      */
+    #[\ReturnTypeWillChange]
     public function key()
     {
-        return $this->_key;
+        return $this->_key === false ? null : $this->_key;
     }
 
     /**
@@ -57,20 +60,22 @@ public function key()
      * This method is required by the interface [[\Iterator]].
      * @return mixed the current array element
      */
+    #[\ReturnTypeWillChange]
     public function current()
     {
-        return isset($_SESSION[$this->_key]) ? $_SESSION[$this->_key] : null;
+        return $this->_key !== false && isset($_SESSION[$this->_key]) ? $_SESSION[$this->_key] : null;
     }
 
     /**
      * Moves the internal pointer to the next array element.
      * This method is required by the interface [[\Iterator]].
      */
+    #[\ReturnTypeWillChange]
     public function next()
     {
         do {
             $this->_key = next($this->_keys);
-        } while (!isset($_SESSION[$this->_key]) && $this->_key !== false);
+        } while ($this->_key !== false && !isset($_SESSION[$this->_key]));
     }
 
     /**
@@ -78,6 +83,7 @@ public function next()
      * This method is required by the interface [[\Iterator]].
      * @return bool
      */
+    #[\ReturnTypeWillChange]
     public function valid()
     {
         return $this->_key !== false;
diff --git a/framework/web/TooManyRequestsHttpException.php b/framework/web/TooManyRequestsHttpException.php
index eb602112575..193ab2841ea 100644
--- a/src/web/TooManyRequestsHttpException.php
+++ b/src/web/TooManyRequestsHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -22,11 +22,11 @@ class TooManyRequestsHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(429, $message, $code, $previous);
     }
diff --git a/framework/web/UnauthorizedHttpException.php b/framework/web/UnauthorizedHttpException.php
index 2f8350e7974..9e0ddc64eab 100644
--- a/src/web/UnauthorizedHttpException.php
+++ b/src/web/UnauthorizedHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -25,11 +25,11 @@ class UnauthorizedHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(401, $message, $code, $previous);
     }
diff --git a/framework/web/UnprocessableEntityHttpException.php b/framework/web/UnprocessableEntityHttpException.php
index e32faac3a62..492ff4c3041 100644
--- a/src/web/UnprocessableEntityHttpException.php
+++ b/src/web/UnprocessableEntityHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -24,11 +24,11 @@ class UnprocessableEntityHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(422, $message, $code, $previous);
     }
diff --git a/framework/web/UnsupportedMediaTypeHttpException.php b/framework/web/UnsupportedMediaTypeHttpException.php
index 5942ea2661d..c8c756435d7 100644
--- a/src/web/UnsupportedMediaTypeHttpException.php
+++ b/src/web/UnsupportedMediaTypeHttpException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -23,11 +23,11 @@ class UnsupportedMediaTypeHttpException extends HttpException
 {
     /**
      * Constructor.
-     * @param string $message error message
+     * @param string|null $message error message
      * @param int $code error code
-     * @param \Exception $previous The previous exception used for the exception chaining.
+     * @param \Throwable|null $previous The previous exception used for the exception chaining.
      */
-    public function __construct($message = null, $code = 0, \Exception $previous = null)
+    public function __construct($message = null, $code = 0, $previous = null)
     {
         parent::__construct(415, $message, $code, $previous);
     }
diff --git a/framework/web/UploadedFile.php b/framework/web/UploadedFile.php
index a6609703cd5..c5ac72f36e7 100644
--- a/src/web/UploadedFile.php
+++ b/src/web/UploadedFile.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -18,14 +18,14 @@
  * You can call [[getInstance()]] to retrieve the instance of an uploaded file,
  * and then use [[saveAs()]] to save it on the server.
  * You may also query other information about the file, including [[name]],
- * [[tempName]], [[type]], [[size]] and [[error]].
+ * [[tempName]], [[type]], [[size]], [[error]] and [[fullPath]].
  *
  * For more details and usage information on UploadedFile, see the [guide article on handling uploads](guide:input-file-upload).
  *
- * @property-read string $baseName Original file base name. This property is read-only.
- * @property-read string $extension File extension. This property is read-only.
+ * @property-read string $baseName Original file base name.
+ * @property-read string $extension File extension.
  * @property-read bool $hasError Whether there is an error with the uploaded file. Check [[error]] for
- * detailed error code information. This property is read-only.
+ * detailed error code information.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -57,11 +57,21 @@ class UploadedFile extends BaseObject
      * @see https://www.php.net/manual/en/features.file-upload.errors.php
      */
     public $error;
+    /**
+     * @var string|null The full path as submitted by the browser. Note this value does not always
+     * contain a real directory structure, and cannot be trusted. Available as of PHP 8.1.
+     * @since 2.0.46
+     */
+    public $fullPath;
 
     /**
-     * @var resource a temporary uploaded stream resource used within PUT and PATCH request.
+     * @var resource|null a temporary uploaded stream resource used within PUT and PATCH request.
      */
     private $_tempResource;
+
+    /**
+     * @var array[]
+     */
     private static $_files;
 
 
@@ -93,7 +103,7 @@ public function __toString()
      * @param \yii\base\Model $model the data model
      * @param string $attribute the attribute name. The attribute name may contain array indexes.
      * For example, '[1]file' for tabular file uploading; and 'file[1]' for an element in a file array.
-     * @return null|UploadedFile the instance of the uploaded file.
+     * @return UploadedFile|null the instance of the uploaded file.
      * Null is returned if no file is uploaded for the specified model attribute.
      * @see getInstanceByName()
      */
@@ -121,7 +131,7 @@ public static function getInstances($model, $attribute)
      * Returns an uploaded file according to the given file input name.
      * The name can be a plain string or a string like an array element (e.g. 'Post[imageFile]', or 'Post[0][imageFile]').
      * @param string $name the name of the file input field.
-     * @return null|UploadedFile the instance of the uploaded file.
+     * @return UploadedFile|null the instance of the uploaded file.
      * Null is returned if no file is uploaded for the specified name.
      */
     public static function getInstanceByName($name)
@@ -192,7 +202,7 @@ public function saveAs($file, $deleteTempFile = true)
      * Copy temporary file into file specified
      *
      * @param string $targetFile path of the file to copy to
-     * @return bool|int the total count of bytes copied, or false on failure
+     * @return int|false the total count of bytes copied, or false on failure
      * @since 2.0.32
      */
     protected function copyTempFile($targetFile)
@@ -236,17 +246,26 @@ public function getHasError()
     }
 
     /**
-     * Creates UploadedFile instances from $_FILE.
-     * @return array the UploadedFile instances
+     * Returns reformated data of uplodaded files.
+     *
+     * @return array[]
      */
     private static function loadFiles()
     {
         if (self::$_files === null) {
             self::$_files = [];
             if (isset($_FILES) && is_array($_FILES)) {
-                foreach ($_FILES as $class => $info) {
-                    $resource = isset($info['tmp_resource']) ? $info['tmp_resource'] : [];
-                    self::loadFilesRecursive($class, $info['name'], $info['tmp_name'], $info['type'], $info['size'], $info['error'], $resource);
+                foreach ($_FILES as $key => $info) {
+                    self::loadFilesRecursive(
+                        $key,
+                        $info['name'],
+                        $info['tmp_name'],
+                        $info['type'],
+                        $info['size'],
+                        $info['error'],
+                        isset($info['full_path']) ? $info['full_path'] : [],
+                        isset($info['tmp_resource']) ? $info['tmp_resource'] : []
+                    );
                 }
             }
         }
@@ -255,29 +274,41 @@ private static function loadFiles()
     }
 
     /**
-     * Creates UploadedFile instances from $_FILE recursively.
-     * @param string $key key for identifying uploaded file: class name and sub-array indexes
-     * @param mixed $names file names provided by PHP
-     * @param mixed $tempNames temporary file names provided by PHP
-     * @param mixed $types file types provided by PHP
-     * @param mixed $sizes file sizes provided by PHP
-     * @param mixed $errors uploading issues provided by PHP
+     * Recursive reformats data of uplodaded file(s).
+     *
+     * @param string $key key for identifying uploaded file(sub-array index)
+     * @param string[]|string $names file name(s) provided by PHP
+     * @param string[]|string $tempNames temporary file name(s) provided by PHP
+     * @param string[]|string $types file type(s) provided by PHP
+     * @param int[]|int $sizes file size(s) provided by PHP
+     * @param int[]|int $errors uploading issue(s) provided by PHP
+     * @param array|string|null $fullPaths the full path(s) as submitted by the browser/PHP
+     * @param array|resource|null $tempResources the resource(s)
      */
-    private static function loadFilesRecursive($key, $names, $tempNames, $types, $sizes, $errors, $tempResources)
+    private static function loadFilesRecursive($key, $names, $tempNames, $types, $sizes, $errors, $fullPaths, $tempResources)
     {
         if (is_array($names)) {
             foreach ($names as $i => $name) {
-                $resource = isset($tempResources[$i]) ? $tempResources[$i] : [];
-                self::loadFilesRecursive($key . '[' . $i . ']', $name, $tempNames[$i], $types[$i], $sizes[$i], $errors[$i], $resource);
+                self::loadFilesRecursive(
+                    $key . '[' . $i . ']',
+                    $name,
+                    $tempNames[$i],
+                    $types[$i],
+                    $sizes[$i],
+                    $errors[$i],
+                    isset($fullPaths[$i]) ? $fullPaths[$i] : null,
+                    isset($tempResources[$i]) ? $tempResources[$i] : null
+                );
             }
-        } elseif ((int) $errors !== UPLOAD_ERR_NO_FILE) {
+        } elseif ($errors != UPLOAD_ERR_NO_FILE) {
             self::$_files[$key] = [
                 'name' => $names,
                 'tempName' => $tempNames,
-                'tempResource' => $tempResources,
+                'tempResource' => is_resource($tempResources) ? $tempResources : null,
                 'type' => $types,
                 'size' => $sizes,
                 'error' => $errors,
+                'fullPath' => is_string($fullPaths) ? $fullPaths : null,
             ];
         }
     }
diff --git a/framework/web/UrlManager.php b/framework/web/UrlManager.php
index 92c73d3fe9e..292c4bc3e70 100644
--- a/src/web/UrlManager.php
+++ b/src/web/UrlManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -39,7 +39,7 @@
  * For more details and usage information on UrlManager, see the [guide article on routing](guide:runtime-routing).
  *
  * @property string $baseUrl The base URL that is used by [[createUrl()]] to prepend to created URLs.
- * @property string $hostInfo The host info (e.g. `http://www.example.com`) that is used by
+ * @property string $hostInfo The host info (e.g. `https://www.example.com`) that is used by
  * [[createAbsoluteUrl()]] to prepend to created URLs.
  * @property string $scriptUrl The entry script URL that is used by [[createUrl()]] to prepend to created
  * URLs.
@@ -635,7 +635,7 @@ public function setScriptUrl($value)
 
     /**
      * Returns the host info that is used by [[createAbsoluteUrl()]] to prepend to created URLs.
-     * @return string the host info (e.g. `http://www.example.com`) that is used by [[createAbsoluteUrl()]] to prepend to created URLs.
+     * @return string the host info (e.g. `https://www.example.com`) that is used by [[createAbsoluteUrl()]] to prepend to created URLs.
      * @throws InvalidConfigException if running in console application and [[hostInfo]] is not configured.
      */
     public function getHostInfo()
@@ -654,7 +654,7 @@ public function getHostInfo()
 
     /**
      * Sets the host info that is used by [[createAbsoluteUrl()]] to prepend to created URLs.
-     * @param string $value the host info (e.g. "http://www.example.com") that is used by [[createAbsoluteUrl()]] to prepend to created URLs.
+     * @param string $value the host info (e.g. "https://www.example.com") that is used by [[createAbsoluteUrl()]] to prepend to created URLs.
      */
     public function setHostInfo($value)
     {
diff --git a/framework/web/UrlNormalizer.php b/framework/web/UrlNormalizer.php
index 0b7c9406da4..7d7459e868b 100644
--- a/src/web/UrlNormalizer.php
+++ b/src/web/UrlNormalizer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/UrlNormalizerRedirectException.php b/framework/web/UrlNormalizerRedirectException.php
index 88147cf3a48..796e376ab82 100644
--- a/src/web/UrlNormalizerRedirectException.php
+++ b/src/web/UrlNormalizerRedirectException.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -38,15 +38,15 @@ class UrlNormalizerRedirectException extends \yii\base\Exception
      * @param int $statusCode HTTP status code used for redirection
      * @param bool|string $scheme the URI scheme to use in the generated URL for redirection.
      * This will be used as second parameter for [[\yii\helpers\Url::to()]]
-     * @param string $message the error message
+     * @param string|null $message the error message
      * @param int $code the error code
-     * @param \Exception $previous the previous exception used for the exception chaining
+     * @param \Throwable|null $previous the previous exception used for the exception chaining
      */
-    public function __construct($url, $statusCode = 302, $scheme = false, $message = null, $code = 0, \Exception $previous = null)
+    public function __construct($url, $statusCode = 302, $scheme = false, $message = null, $code = 0, $previous = null)
     {
         $this->url = $url;
         $this->scheme = $scheme;
         $this->statusCode = $statusCode;
-        parent::__construct($message, $code, $previous);
+        parent::__construct((string)$message, $code, $previous);
     }
 }
diff --git a/framework/web/UrlRule.php b/framework/web/UrlRule.php
index 84719ecdad9..56c71d8063c 100644
--- a/src/web/UrlRule.php
+++ b/src/web/UrlRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -25,7 +25,7 @@
  * ```
  *
  * @property-read null|int $createUrlStatus Status of the URL creation after the last [[createUrl()]] call.
- * `null` if rule does not provide info about create status. This property is read-only.
+ * `null` if rule does not provide info about create status.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
@@ -68,7 +68,7 @@ class UrlRule extends BaseObject implements UrlRuleInterface
     const CREATE_STATUS_PARAMS_MISMATCH = 4;
 
     /**
-     * @var string the name of this rule. If not set, it will use [[pattern]] as the name.
+     * @var string|null the name of this rule. If not set, it will use [[pattern]] as the name.
      */
     public $name;
     /**
@@ -79,7 +79,7 @@ class UrlRule extends BaseObject implements UrlRuleInterface
      */
     public $pattern;
     /**
-     * @var string the pattern used to parse and create the host info part of a URL (e.g. `http://example.com`).
+     * @var string|null the pattern used to parse and create the host info part of a URL (e.g. `https://example.com`).
      * @see pattern
      */
     public $host;
@@ -94,20 +94,20 @@ class UrlRule extends BaseObject implements UrlRuleInterface
      */
     public $defaults = [];
     /**
-     * @var string the URL suffix used for this rule.
+     * @var string|null the URL suffix used for this rule.
      * For example, ".html" can be used so that the URL looks like pointing to a static HTML page.
      * If not set, the value of [[UrlManager::suffix]] will be used.
      */
     public $suffix;
     /**
-     * @var string|array the HTTP verb (e.g. GET, POST, DELETE) that this rule should match.
+     * @var string|array|null the HTTP verb (e.g. GET, POST, DELETE) that this rule should match.
      * Use array to represent multiple verbs that this rule may match.
      * If this property is not set, the rule can match any verb.
      * Note that this property is only used when parsing a request. It is ignored for URL creation.
      */
     public $verb;
     /**
-     * @var int a value indicating if this rule should be used for both request parsing and URL creation,
+     * @var int|null a value indicating if this rule should be used for both request parsing and URL creation,
      * parsing only, or creation only.
      * If not set or 0, it means the rule is both request parsing and URL creation.
      * If it is [[PARSING_ONLY]], the rule is for request parsing only.
@@ -336,7 +336,7 @@ private function translatePattern($allowAppendSlash)
         $this->pattern = '#^' . trim(strtr($this->_template, $tr), '/') . '$#u';
 
         // if host starts with relative scheme, then insert pattern to match any
-        if (strncmp($this->host, '//', 2) === 0) {
+        if ($this->host !== null && strncmp($this->host, '//', 2) === 0) {
             $this->pattern = substr_replace($this->pattern, '[\w]+://', 2, 0);
         }
 
@@ -541,7 +541,7 @@ public function createUrl($manager, $route, $params)
     /**
      * Returns status of the URL creation after the last [[createUrl()]] call.
      *
-     * @return null|int Status of the URL creation after the last [[createUrl()]] call. `null` if rule does not provide
+     * @return int|null Status of the URL creation after the last [[createUrl()]] call. `null` if rule does not provide
      * info about create status.
      * @see createStatus
      * @since 2.0.12
diff --git a/framework/web/UrlRuleInterface.php b/framework/web/UrlRuleInterface.php
index c81018fb2ec..90339ab7595 100644
--- a/src/web/UrlRuleInterface.php
+++ b/src/web/UrlRuleInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/User.php b/framework/web/User.php
index 863b6d4b428..a23e6468e26 100644
--- a/src/web/User.php
+++ b/src/web/User.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -48,10 +48,9 @@
  * ```
  *
  * @property-read string|int $id The unique identifier for the user. If `null`, it means the user is a guest.
- * This property is read-only.
  * @property IdentityInterface|null $identity The identity object associated with the currently logged-in
  * user. `null` is returned if the user is not logged in (not authenticated).
- * @property-read bool $isGuest Whether the current user is a guest. This property is read-only.
+ * @property-read bool $isGuest Whether the current user is a guest.
  * @property string $returnUrl The URL that the user should be redirected to after login. Note that the type
  * of this property differs in getter and setter. See [[getReturnUrl()]] and [[setReturnUrl()]] for details.
  *
@@ -81,7 +80,7 @@ class User extends Component
      */
     public $enableSession = true;
     /**
-     * @var string|array the URL for login when [[loginRequired()]] is called.
+     * @var string|array|null the URL for login when [[loginRequired()]] is called.
      * If an array is given, [[UrlManager::createUrl()]] will be called to create the corresponding URL.
      * The first element of the array should be the route to the login action, and the rest of
      * the name-value pairs are GET parameters used to construct the login URL. For example,
@@ -99,21 +98,21 @@ class User extends Component
      */
     public $identityCookie = ['name' => '_identity', 'httpOnly' => true];
     /**
-     * @var int the number of seconds in which the user will be logged out automatically if the user
+     * @var int|null the number of seconds in which the user will be logged out automatically if the user
      * remains inactive. If this property is not set, the user will be logged out after
      * the current session expires (c.f. [[Session::timeout]]).
      * Note that this will not work if [[enableAutoLogin]] is `true`.
      */
     public $authTimeout;
     /**
-     * @var CheckAccessInterface|string|array The access checker object to use for checking access or the application
+     * @var CheckAccessInterface|string|array|null The access checker object to use for checking access or the application
      * component ID of the access checker.
      * If not set the application auth manager will be used.
      * @since 2.0.9
      */
     public $accessChecker;
     /**
-     * @var int the number of seconds in which the user will be logged out automatically
+     * @var int|null the number of seconds in which the user will be logged out automatically
      * regardless of activity.
      * Note that this will not work if [[enableAutoLogin]] is `true`.
      */
@@ -369,7 +368,7 @@ public function getIsGuest()
 
     /**
      * Returns a value that uniquely represents the user.
-     * @return string|int the unique identifier for the user. If `null`, it means the user is a guest.
+     * @return string|int|null the unique identifier for the user. If `null`, it means the user is a guest.
      * @see getIdentity()
      */
     public function getId()
@@ -385,7 +384,7 @@ public function getId()
      * This method reads the return URL from the session. It is usually used by the login action which
      * may call this method to redirect the browser to where it goes after successful authentication.
      *
-     * @param string|array $defaultUrl the default return URL in case it was not set previously.
+     * @param string|array|null $defaultUrl the default return URL in case it was not set previously.
      * If this is null and the return URL was not set previously, [[Application::homeUrl]] will be redirected to.
      * Please refer to [[setReturnUrl()]] on accepted format of the URL.
      * @return string the URL that the user should be redirected to after login.
@@ -655,9 +654,7 @@ public function switchIdentity($identity, $duration = 0)
         }
 
         $session = Yii::$app->getSession();
-        if (!YII_ENV_TEST) {
-            $session->regenerateID(true);
-        }
+        $session->regenerateID(true);
         $session->remove($this->idParam);
         $session->remove($this->authTimeoutParam);
         $session->remove($this->authKeyParam);
@@ -698,6 +695,9 @@ protected function renewAuthStatus()
             /* @var $class IdentityInterface */
             $class = $this->identityClass;
             $identity = $class::findIdentity($id);
+            if ($identity === null) {
+                $this->switchIdentity(null);
+            }
         }
 
         if ($identity !== null) {
@@ -728,10 +728,6 @@ protected function renewAuthStatus()
                 $this->renewIdentityCookie();
             }
         }
-
-        if ($this->getIdentity(false) === null) {
-            $this->switchIdentity(null);
-        }
     }
 
     /**
diff --git a/framework/web/UserEvent.php b/framework/web/UserEvent.php
index 1d2e5ae0a69..34a028910bf 100644
--- a/src/web/UserEvent.php
+++ b/src/web/UserEvent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/View.php b/framework/web/View.php
index 15a8f7b12df..c372fece58c 100644
--- a/src/web/View.php
+++ b/src/web/View.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -132,7 +132,6 @@ class View extends \yii\base\View
     public $jsFiles = [];
 
     private $_assetManager;
-
     /**
      * Whether [[endPage()]] has been called and all files have been registered
      * @var bool
@@ -203,7 +202,7 @@ public function endPage($ajaxMode = false)
      *
      * @param string $view the view name. Please refer to [[render()]] on how to specify this parameter.
      * @param array $params the parameters (name-value pairs) that will be extracted and made available in the view file.
-     * @param object $context the context that the view should use for rendering the view. If null,
+     * @param object|null $context the context that the view should use for rendering the view. If null,
      * existing [[context]] will be used.
      * @return string the rendering result
      * @see render()
@@ -337,7 +336,7 @@ public function registerAssetBundle($name, $position = null)
      * will result in the meta tag `<meta name="description" content="This website is about funny raccoons.">`.
      *
      * @param array $options the HTML attributes for the meta tag.
-     * @param string $key the key that identifies the meta tag. If two meta tags are registered
+     * @param string|null $key the key that identifies the meta tag. If two meta tags are registered
      * with the same key, the latter will overwrite the former. If this is null, the new meta tag
      * will be appended to the existing ones.
      */
@@ -374,7 +373,7 @@ public function registerCsrfMetaTags()
     /**
      * Registers a link tag.
      *
-     * For example, a link tag for a custom [favicon](http://www.w3.org/2005/10/howto-favicon)
+     * For example, a link tag for a custom [favicon](https://www.w3.org/2005/10/howto-favicon)
      * can be added like the following:
      *
      * ```php
@@ -387,7 +386,7 @@ public function registerCsrfMetaTags()
      * has more options for this kind of link tag.
      *
      * @param array $options the HTML attributes for the link tag.
-     * @param string $key the key that identifies the link tag. If two link tags are registered
+     * @param string|null $key the key that identifies the link tag. If two link tags are registered
      * with the same key, the latter will overwrite the former. If this is null, the new link tag
      * will be appended to the existing ones.
      */
@@ -404,7 +403,7 @@ public function registerLinkTag($options, $key = null)
      * Registers a CSS code block.
      * @param string $css the content of the CSS code block to be registered
      * @param array $options the HTML attributes for the `<style>`-tag.
-     * @param string $key the key that identifies the CSS code block. If null, it will use
+     * @param string|null $key the key that identifies the CSS code block. If null, it will use
      * $css as the key. If two CSS code blocks are registered with the same key, the latter
      * will overwrite the former.
      */
@@ -428,7 +427,7 @@ public function registerCss($css, $options = [], $key = null)
      * - `depends`: array, specifies the names of the asset bundles that this CSS file depends on.
      * - `appendTimestamp`: bool whether to append a timestamp to the URL.
      *
-     * @param string $key the key that identifies the CSS script file. If null, it will use
+     * @param string|null $key the key that identifies the CSS script file. If null, it will use
      * $url as the key. If two CSS files are registered with the same key, the latter
      * will overwrite the former.
      * @throws InvalidConfigException
@@ -452,7 +451,7 @@ public function registerCssFile($url, $options = [], $key = null)
      * - [[POS_READY]]: enclosed within jQuery(document).ready(). This is the default value.
      *   Note that by using this position, the method will automatically register the jQuery js file.
      *
-     * @param string $key the key that identifies the JS code block. If null, it will use
+     * @param string|null $key the key that identifies the JS code block. If null, it will use
      * $js as the key. If two JS code blocks are registered with the same key, the latter
      * will overwrite the former.
      */
@@ -476,7 +475,7 @@ public function registerJs($js, $position = self::POS_READY, $key = null)
      * - `depends`: array, specifies the names of the asset bundles that this CSS file depends on.
      * - `appendTimestamp`: bool whether to append a timestamp to the URL.
      *
-     * @param string $key the key that identifies the JS script file. If null, it will use
+     * @param string|null $key the key that identifies the JS script file. If null, it will use
      * $url as the key. If two JS files are registered with the same key at the same position, the latter
      * will overwrite the former. Note that position option takes precedence, thus files registered with the same key,
      * but different position option will not override each other.
@@ -551,7 +550,7 @@ private function registerFile($type, $url, $options = [], $key = null)
      *
      * Please refer to [[Html::jsFile()]] for other supported options.
      *
-     * @param string $key the key that identifies the JS script file. If null, it will use
+     * @param string|null $key the key that identifies the JS script file. If null, it will use
      * $url as the key. If two JS files are registered with the same key at the same position, the latter
      * will overwrite the former. Note that position option takes precedence, thus files registered with the same key,
      * but different position option will not override each other.
diff --git a/framework/web/ViewAction.php b/framework/web/ViewAction.php
index 84ca3195ebb..26435f37857 100644
--- a/src/web/ViewAction.php
+++ b/src/web/ViewAction.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/XmlResponseFormatter.php b/framework/web/XmlResponseFormatter.php
index e250cb4ab5e..652bc9f442b 100644
--- a/src/web/XmlResponseFormatter.php
+++ b/src/web/XmlResponseFormatter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -33,11 +33,11 @@ class XmlResponseFormatter extends Component implements ResponseFormatterInterfa
      */
     public $version = '1.0';
     /**
-     * @var string the XML encoding. If not set, it will use the value of [[Response::charset]].
+     * @var string|null the XML encoding. If not set, it will use the value of [[Response::charset]].
      */
     public $encoding;
     /**
-     * @var string|string[]|false the name of the root element. If set to false, null or is empty then no root tag
+     * @var string|string[]|null|false the name of the root element. If set to false, null or is empty then no root tag
      * should be added.
      *
      * Since 2.0.44 URI namespace could be specified by passing `[namespace, tag name]` array.
@@ -194,7 +194,7 @@ protected function getValidXmlElementName($name)
      *
      * @param mixed $name the name to test
      * @return bool
-     * @see http://stackoverflow.com/questions/2519845/how-to-check-if-string-is-a-valid-xml-element-name/2519943#2519943
+     * @see https://stackoverflow.com/questions/2519845/how-to-check-if-string-is-a-valid-xml-element-name/2519943#2519943
      * @since 2.0.12
      */
     protected function isValidXmlName($name)
diff --git a/framework/web/YiiAsset.php b/framework/web/YiiAsset.php
index 7595ee2d4c1..a66908b8a9d 100644
--- a/src/web/YiiAsset.php
+++ b/src/web/YiiAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
diff --git a/framework/web/migrations/m160313_153426_session_init.php b/framework/web/migrations/m160313_153426_session_init.php
index 9d5dfa6cb00..2ff3499a1f1 100644
--- a/src/web/migrations/m160313_153426_session_init.php
+++ b/src/web/migrations/m160313_153426_session_init.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\db\Migration;
@@ -25,7 +25,7 @@ public function up()
 
         switch ($this->db->driverName) {
             case 'mysql':
-                // http://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
+                // https://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci
                 $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
                 break;
             case 'sqlsrv':
diff --git a/framework/web/migrations/schema-mssql.sql b/framework/web/migrations/schema-mssql.sql
index 072cc315d59..64394cf8deb 100644
--- a/src/web/migrations/schema-mssql.sql
+++ b/src/web/migrations/schema-mssql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.8
  */
 
diff --git a/framework/web/migrations/schema-mysql.sql b/framework/web/migrations/schema-mysql.sql
index 083414e1d8d..c9be92619cf 100644
--- a/src/web/migrations/schema-mysql.sql
+++ b/src/web/migrations/schema-mysql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.8
  */
 
diff --git a/framework/web/migrations/schema-oci.sql b/framework/web/migrations/schema-oci.sql
index 7b5b6c7f345..f4b7de2e775 100644
--- a/src/web/migrations/schema-oci.sql
+++ b/src/web/migrations/schema-oci.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.8
  */
 
diff --git a/framework/web/migrations/schema-pgsql.sql b/framework/web/migrations/schema-pgsql.sql
index 8e8674f7861..77c3b557858 100644
--- a/src/web/migrations/schema-pgsql.sql
+++ b/src/web/migrations/schema-pgsql.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.8
  */
 
diff --git a/framework/web/migrations/schema-sqlite.sql b/framework/web/migrations/schema-sqlite.sql
index bdbfd466b61..57b1c27aff7 100644
--- a/src/web/migrations/schema-sqlite.sql
+++ b/src/web/migrations/schema-sqlite.sql
@@ -3,9 +3,9 @@
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @author Misbahul D Munir <misbahuldmunir@gmail.com>
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  * @since 2.0.8
  */
 
diff --git a/framework/widgets/ActiveField.php b/framework/widgets/ActiveField.php
index 9d86aeebab0..4d69e5b097c 100644
--- a/src/widgets/ActiveField.php
+++ b/src/widgets/ActiveField.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -20,8 +20,6 @@
  *
  * For more details and usage information on ActiveField, see the [guide article on forms](guide:input-forms).
  *
- * @property-read string $inputId The attribute `id` of the input element
- *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
  */
@@ -99,33 +97,33 @@ class ActiveField extends Component
      */
     public $hintOptions = ['class' => 'hint-block'];
     /**
-     * @var bool whether to enable client-side data validation.
+     * @var bool|null whether to enable client-side data validation.
      * If not set, it will take the value of [[ActiveForm::enableClientValidation]].
      */
     public $enableClientValidation;
     /**
-     * @var bool whether to enable AJAX-based data validation.
+     * @var bool|null whether to enable AJAX-based data validation.
      * If not set, it will take the value of [[ActiveForm::enableAjaxValidation]].
      */
     public $enableAjaxValidation;
     /**
-     * @var bool whether to perform validation when the value of the input field is changed.
+     * @var bool|null whether to perform validation when the value of the input field is changed.
      * If not set, it will take the value of [[ActiveForm::validateOnChange]].
      */
     public $validateOnChange;
     /**
-     * @var bool whether to perform validation when the input field loses focus.
+     * @var bool|null whether to perform validation when the input field loses focus.
      * If not set, it will take the value of [[ActiveForm::validateOnBlur]].
      */
     public $validateOnBlur;
     /**
-     * @var bool whether to perform validation while the user is typing in the input field.
+     * @var bool|null whether to perform validation while the user is typing in the input field.
      * If not set, it will take the value of [[ActiveForm::validateOnType]].
      * @see validationDelay
      */
     public $validateOnType;
     /**
-     * @var int number of milliseconds that the validation should be delayed when the user types in the field
+     * @var int|null number of milliseconds that the validation should be delayed when the user types in the field
      * and [[validateOnType]] is set `true`.
      * If not set, it will take the value of [[ActiveForm::validationDelay]].
      */
@@ -189,7 +187,7 @@ public function __toString()
      * Renders the whole field.
      * This method will generate the label, error tag, input tag and hint tag (if any), and
      * assemble them into HTML according to [[template]].
-     * @param string|callable $content the content within the field container.
+     * @param string|callable|null $content the content within the field container.
      * If `null` (not set), the default methods will be called to generate the label, error tag and input tag,
      * and use them as the content.
      * If a callable, it will be called to generate the content. The signature of the callable should be:
@@ -266,10 +264,10 @@ public function end()
 
     /**
      * Generates a label tag for [[attribute]].
-     * @param null|string|false $label the label to use. If `null`, the label will be generated via [[Model::getAttributeLabel()]].
+     * @param string|null|false $label the label to use. If `null`, the label will be generated via [[Model::getAttributeLabel()]].
      * If `false`, the generated field will not contain the label part.
      * Note that this will NOT be [[Html::encode()|encoded]].
-     * @param null|array $options the tag options in terms of name-value pairs. It will be merged with [[labelOptions]].
+     * @param array|null $options the tag options in terms of name-value pairs. It will be merged with [[labelOptions]].
      * The options will be rendered as the attributes of the resulting tag. The values will be HTML-encoded
      * using [[Html::encode()]]. If a value is `null`, the corresponding attribute will not be rendered.
      * @return $this the field object itself.
@@ -325,7 +323,7 @@ public function error($options = [])
 
     /**
      * Renders the hint tag.
-     * @param string|bool $content the hint content.
+     * @param string|bool|null $content the hint content.
      * If `null`, the hint will be generated via [[Model::getAttributeHint()]].
      * If `false`, the generated field will not contain the hint part.
      * Note that this will NOT be [[Html::encode()|encoded]].
diff --git a/framework/widgets/ActiveForm.php b/framework/widgets/ActiveForm.php
index 1d5fdc6dbe4..06a0bfee0f3 100644
--- a/src/widgets/ActiveForm.php
+++ b/src/widgets/ActiveForm.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -133,7 +133,7 @@ class ActiveForm extends Widget
      */
     public $enableClientScript = true;
     /**
-     * @var array|string the URL for performing AJAX-based validation. This property will be processed by
+     * @var array|string|null the URL for performing AJAX-based validation. This property will be processed by
      * [[Url::to()]]. Please refer to [[Url::to()]] for more details on how to configure this property.
      * If this property is not set, it will take the value of the form's action attribute.
      */
diff --git a/framework/widgets/ActiveFormAsset.php b/framework/widgets/ActiveFormAsset.php
index 42f3d2b11c5..43b2ae710b2 100644
--- a/src/widgets/ActiveFormAsset.php
+++ b/src/widgets/ActiveFormAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/BaseListView.php b/framework/widgets/BaseListView.php
index 3b6eddb31a4..cee83fcafa7 100644
--- a/src/widgets/BaseListView.php
+++ b/src/widgets/BaseListView.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/Block.php b/framework/widgets/Block.php
index 72e76d620bd..cc4ee5271c8 100644
--- a/src/widgets/Block.php
+++ b/src/widgets/Block.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/Breadcrumbs.php b/framework/widgets/Breadcrumbs.php
index b56aa0fbdf8..9def4aa5db7 100644
--- a/src/widgets/Breadcrumbs.php
+++ b/src/widgets/Breadcrumbs.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -68,7 +68,7 @@ class Breadcrumbs extends Widget
      */
     public $encodeLabels = true;
     /**
-     * @var array the first hyperlink in the breadcrumbs (called home link).
+     * @var array|null the first hyperlink in the breadcrumbs (called home link).
      * Please refer to [[links]] on the format of the link.
      * If this property is not set, it will default to a link pointing to [[\yii\web\Application::homeUrl]]
      * with the label 'Home'. If this property is false, the home link will not be rendered.
@@ -97,7 +97,7 @@ class Breadcrumbs extends Widget
      * ```php
      * [
      *     'label' => 'demo',
-     *     'url' => 'http://example.com',
+     *     'url' => 'https://example.com',
      *     'class' => 'external',
      * ]
      * ```
diff --git a/framework/widgets/ContentDecorator.php b/framework/widgets/ContentDecorator.php
index e926e9a8235..1b7d00781db 100644
--- a/src/widgets/ContentDecorator.php
+++ b/src/widgets/ContentDecorator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/DetailView.php b/framework/widgets/DetailView.php
index 62e0987fbd4..06b9fa4b566 100644
--- a/src/widgets/DetailView.php
+++ b/src/widgets/DetailView.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -108,13 +108,13 @@ class DetailView extends Widget
      */
     public $template = '<tr><th{captionOptions}>{label}</th><td{contentOptions}>{value}</td></tr>';
     /**
-     * @var array the HTML attributes for the container tag of this widget. The `tag` option specifies
+     * @var array|null the HTML attributes for the container tag of this widget. The `tag` option specifies
      * what container tag should be used. It defaults to `table` if not set.
      * @see \yii\helpers\Html::renderTagAttributes() for details on how attributes are being rendered.
      */
     public $options = ['class' => 'table table-striped table-bordered detail-view'];
     /**
-     * @var array|Formatter the formatter used to format model attribute values into displayable texts.
+     * @var array|Formatter|null the formatter used to format model attribute values into displayable texts.
      * This can be either an instance of [[Formatter]] or an configuration array for creating the [[Formatter]]
      * instance. If this property is not set, the `formatter` application component will be used.
      */
diff --git a/framework/widgets/FragmentCache.php b/framework/widgets/FragmentCache.php
index e30e997218c..580e5f497dd 100644
--- a/src/widgets/FragmentCache.php
+++ b/src/widgets/FragmentCache.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -19,7 +19,7 @@
  * FragmentCache is used by [[\yii\base\View]] to provide caching of page fragments.
  *
  * @property-read string|false $cachedContent The cached content. False is returned if valid content is not
- * found in the cache. This property is read-only.
+ * found in the cache.
  *
  * @author Qiang Xue <qiang.xue@gmail.com>
  * @since 2.0
diff --git a/framework/widgets/InputWidget.php b/framework/widgets/InputWidget.php
index eed67443d07..6bdab5a340b 100644
--- a/src/widgets/InputWidget.php
+++ b/src/widgets/InputWidget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -43,15 +43,15 @@ class InputWidget extends Widget
      */
     public $field;
     /**
-     * @var Model the data model that this widget is associated with.
+     * @var Model|null the data model that this widget is associated with.
      */
     public $model;
     /**
-     * @var string the model attribute that this widget is associated with.
+     * @var string|null the model attribute that this widget is associated with.
      */
     public $attribute;
     /**
-     * @var string the input name. This must be set if [[model]] and [[attribute]] are not set.
+     * @var string|null the input name. This must be set if [[model]] and [[attribute]] are not set.
      */
     public $name;
     /**
diff --git a/framework/widgets/LinkPager.php b/framework/widgets/LinkPager.php
index e6b27d30b94..9056981c31e 100644
--- a/src/widgets/LinkPager.php
+++ b/src/widgets/LinkPager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -119,7 +119,7 @@ class LinkPager extends Widget
     /**
      * @var bool whether to register link tags in the HTML header for prev, next, first and last page.
      * Defaults to `false` to avoid conflicts when multiple pagers are used on one page.
-     * @see http://www.w3.org/TR/html401/struct/links.html#h-12.1.2
+     * @see https://www.w3.org/TR/html401/struct/links.html#h-12.1.2
      * @see registerLinkTags()
      */
     public $registerLinkTags = false;
@@ -161,7 +161,7 @@ public function run()
     /**
      * Registers relational link tags in the html header for prev, next, first and last page.
      * These links are generated using [[\yii\data\Pagination::getLinks()]].
-     * @see http://www.w3.org/TR/html401/struct/links.html#h-12.1.2
+     * @see https://www.w3.org/TR/html401/struct/links.html#h-12.1.2
      */
     protected function registerLinkTags()
     {
diff --git a/framework/widgets/LinkSorter.php b/framework/widgets/LinkSorter.php
index a0e95990e38..8e5062ce355 100644
--- a/src/widgets/LinkSorter.php
+++ b/src/widgets/LinkSorter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -26,11 +26,11 @@
 class LinkSorter extends Widget
 {
     /**
-     * @var Sort the sort definition
+     * @var Sort|null the sort definition
      */
     public $sort;
     /**
-     * @var array list of the attributes that support sorting. If not set, it will be determined
+     * @var array|null list of the attributes that support sorting. If not set, it will be determined
      * using [[Sort::attributes]].
      */
     public $attributes;
diff --git a/framework/widgets/ListView.php b/framework/widgets/ListView.php
index 17a862ddb57..9ac0c0c24f6 100644
--- a/src/widgets/ListView.php
+++ b/src/widgets/ListView.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/MaskedInput.php b/framework/widgets/MaskedInput.php
index 632af1f3daa..0ed87e131f5 100644
--- a/src/widgets/MaskedInput.php
+++ b/src/widgets/MaskedInput.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -102,7 +102,26 @@ class MaskedInput extends InputWidget
      * @var string the hashed variable to store the pluginOptions
      */
     protected $_hashVar;
-
+    /**
+     * @var string[] the inputmask properties can be contained callbacks
+     */
+    protected $_jsCallbacks = [
+        'oncomplete',
+        'onincomplete',
+        'oncleared',
+        'onKeyDown',
+        'onBeforeMask',
+        'onBeforePaste',
+        'onBeforeWrite',
+        'onUnMask',
+        'onKeyValidation',
+        'isComplete',
+        // @deprecated removed in 5.0:
+        'preValidation',
+        'postValidation',
+        // @deprecated removed in 4.0:
+        'canClearPosition'
+    ];
 
     /**
      * Initializes the widget.
@@ -154,11 +173,9 @@ protected function initClientOptions()
         $options = $this->clientOptions;
         foreach ($options as $key => $value) {
             if (
-                !$value instanceof JsExpression
-                && in_array($key, [
-                    'oncomplete', 'onincomplete', 'oncleared', 'onKeyUp', 'onKeyDown', 'onBeforeMask',
-                    'onBeforePaste', 'onUnMask', 'isComplete', 'determineActiveMasksetIndex',
-                ], true)
+                !empty($value)
+                && !$value instanceof JsExpression
+                && in_array($key, $this->_jsCallbacks, true)
             ) {
                 $options[$key] = new JsExpression($value);
             }
@@ -178,10 +195,10 @@ public function registerClientScript()
             $this->clientOptions['mask'] = $this->mask;
         }
         $this->hashPluginOptions($view);
-        if (is_array($this->definitions) && !empty($this->definitions)) {
+        if (!empty($this->definitions) && is_array($this->definitions)) {
             $js .= ucfirst(self::PLUGIN_NAME) . '.extendDefinitions(' . Json::htmlEncode($this->definitions) . ');';
         }
-        if (is_array($this->aliases) && !empty($this->aliases)) {
+        if (!empty($this->aliases) && is_array($this->aliases)) {
             $js .= ucfirst(self::PLUGIN_NAME) . '.extendAliases(' . Json::htmlEncode($this->aliases) . ');';
         }
         $id = $this->options['id'];
diff --git a/framework/widgets/MaskedInputAsset.php b/framework/widgets/MaskedInputAsset.php
index b332190059d..57748be86f8 100644
--- a/src/widgets/MaskedInputAsset.php
+++ b/src/widgets/MaskedInputAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/Menu.php b/framework/widgets/Menu.php
index 7e60700ccfd..a70ad1f3e1a 100644
--- a/src/widgets/Menu.php
+++ b/src/widgets/Menu.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -141,24 +141,24 @@ class Menu extends Widget
      */
     public $options = [];
     /**
-     * @var string the CSS class that will be assigned to the first item in the main menu or each submenu.
+     * @var string|null the CSS class that will be assigned to the first item in the main menu or each submenu.
      * Defaults to null, meaning no such CSS class will be assigned.
      */
     public $firstItemCssClass;
     /**
-     * @var string the CSS class that will be assigned to the last item in the main menu or each submenu.
+     * @var string|null the CSS class that will be assigned to the last item in the main menu or each submenu.
      * Defaults to null, meaning no such CSS class will be assigned.
      */
     public $lastItemCssClass;
     /**
-     * @var string the route used to determine if a menu item is active or not.
+     * @var string|null the route used to determine if a menu item is active or not.
      * If not set, it will use the route of the current request.
      * @see params
      * @see isItemActive()
      */
     public $route;
     /**
-     * @var array the parameters used to determine if a menu item is active or not.
+     * @var array|null the parameters used to determine if a menu item is active or not.
      * If not set, it will use `$_GET`.
      * @see route
      * @see isItemActive()
diff --git a/framework/widgets/Pjax.php b/framework/widgets/Pjax.php
index 1e5d90104c1..fceaf1821a9 100644
--- a/src/widgets/Pjax.php
+++ b/src/widgets/Pjax.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -55,14 +55,14 @@ class Pjax extends Widget
      */
     public $options = [];
     /**
-     * @var string|false the jQuery selector of the links that should trigger pjax requests.
+     * @var string|null|false the jQuery selector of the links that should trigger pjax requests.
      * If not set, all links within the enclosed content of Pjax will trigger pjax requests.
      * If set to false, no code will be registered to handle links.
      * Note that if the response to the pjax request is a full page, a normal request will be sent again.
      */
     public $linkSelector;
     /**
-     * @var string|false the jQuery selector of the forms whose submissions should trigger pjax requests.
+     * @var string|null|false the jQuery selector of the forms whose submissions should trigger pjax requests.
      * If not set, all forms with `data-pjax` attribute within the enclosed content of Pjax will trigger pjax requests.
      * If set to false, no code will be registered to handle forms.
      * Note that if the response to the pjax request is a full page, a normal request will be sent again.
diff --git a/framework/widgets/PjaxAsset.php b/framework/widgets/PjaxAsset.php
index ee0100c8a4e..47795f683cf 100644
--- a/src/widgets/PjaxAsset.php
+++ b/src/widgets/PjaxAsset.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
diff --git a/framework/widgets/Spaceless.php b/framework/widgets/Spaceless.php
index e109e1fd3ab..c766dafa239 100644
--- a/src/widgets/Spaceless.php
+++ b/src/widgets/Spaceless.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\widgets;
@@ -41,9 +41,9 @@
  *
  * Note, never use this method with `pre` or `textarea` tags. It's not that trivial to deal with such tags
  * as it may seem at first sight. For this case you should consider using
- * [HTML Tidy Project](http://tidy.sourceforge.net/) instead.
+ * [HTML Tidy Project](https://www.html-tidy.org/) instead.
  *
- * @see http://tidy.sourceforge.net/
+ * @see https://www.html-tidy.org/
  * @author resurtm <resurtm@gmail.com>
  * @since 2.0
  */
diff --git a/framework/yii b/framework/yii
index 4cbdc47dda7..96b154c8a56 100755
--- a/src/yii
+++ b/src/yii
@@ -3,9 +3,9 @@
 /**
  * Yii console bootstrap file.
  *
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 defined('YII_DEBUG') or define('YII_DEBUG', true);
diff --git a/framework/yii.bat b/framework/yii.bat
index d516b3a1925..ce14c92bc88 100644
--- a/src/yii.bat
+++ b/src/yii.bat
@@ -4,9 +4,9 @@ rem -------------------------------------------------------------
 rem  Yii command line bootstrap script for Windows.
 rem
 rem  @author Qiang Xue <qiang.xue@gmail.com>
-rem  @link http://www.yiiframework.com/
+rem  @link https://www.yiiframework.com/
 rem  @copyright Copyright (c) 2008 Yii Software LLC
-rem  @license http://www.yiiframework.com/license/
+rem  @license https://www.yiiframework.com/license/
 rem -------------------------------------------------------------
 
 @setlocal
diff --git a/tests/IsOneOfAssert.php b/tests/IsOneOfAssert.php
index 790d0eee1e6..5c630b7d041 100644
--- a/tests/IsOneOfAssert.php
+++ b/tests/IsOneOfAssert.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit;
diff --git a/tests/ResultPrinter.php b/tests/ResultPrinter.php
index d9a8b51e5d2..89299f0557c 100644
--- a/tests/ResultPrinter.php
+++ b/tests/ResultPrinter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit;
diff --git a/tests/TestCase.php b/tests/TestCase.php
index c03501fe906..d18e1145949 100644
--- a/tests/TestCase.php
+++ b/tests/TestCase.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit;
@@ -82,6 +82,7 @@ protected function mockWebApplication($config = [], $appClass = '\yii\web\Applic
                     'cookieValidationKey' => 'wefJDF8sfdsfSDefwqdxj9oq',
                     'scriptFile' => __DIR__ . '/index.php',
                     'scriptUrl' => '/index.php',
+                    'isConsoleRequest' => false,
                 ],
             ],
         ], $config));
diff --git a/tests/bootstrap.php b/tests/bootstrap.php
index 16965e138cf..44714ab28da 100644
--- a/tests/bootstrap.php
+++ b/tests/bootstrap.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 // ensure we get report on all possible php errors
diff --git a/tests/compatibility.php b/tests/compatibility.php
index 5e379b389e1..5a14c6e36e2 100644
--- a/tests/compatibility.php
+++ b/tests/compatibility.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /*
diff --git a/tests/data/ar/ActiveRecord.php b/tests/data/ar/ActiveRecord.php
index 0862c50c651..65922ae08cd 100644
--- a/tests/data/ar/ActiveRecord.php
+++ b/tests/data/ar/ActiveRecord.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Alpha.php b/tests/data/ar/Alpha.php
index ba6f4a9192e..84f25246673 100644
--- a/tests/data/ar/Alpha.php
+++ b/tests/data/ar/Alpha.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
@@ -22,4 +22,4 @@ public function getBetas()
     {
         return $this->hasMany(Beta::className(), ['alpha_string_identifier' => 'string_identifier']);
     }
-}
\ No newline at end of file
+}
diff --git a/tests/data/ar/Animal.php b/tests/data/ar/Animal.php
index 0c6c96702e7..15a11af3660 100644
--- a/tests/data/ar/Animal.php
+++ b/tests/data/ar/Animal.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Beta.php b/tests/data/ar/Beta.php
index 463f467a752..cc740070966 100644
--- a/tests/data/ar/Beta.php
+++ b/tests/data/ar/Beta.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
@@ -23,4 +23,4 @@ public function getAlpha()
     {
         return $this->hasOne(Alpha::className(), ['string_identifier' => 'alpha_string_identifier']);
     }
-}
\ No newline at end of file
+}
diff --git a/tests/data/ar/BitValues.php b/tests/data/ar/BitValues.php
index f471a940cc6..27e045e1a10 100644
--- a/tests/data/ar/BitValues.php
+++ b/tests/data/ar/BitValues.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Cat.php b/tests/data/ar/Cat.php
index 954c52140a6..d72aec8310d 100644
--- a/tests/data/ar/Cat.php
+++ b/tests/data/ar/Cat.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Category.php b/tests/data/ar/Category.php
index 1ba58749be5..3e0390ffb4a 100644
--- a/tests/data/ar/Category.php
+++ b/tests/data/ar/Category.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/CroppedType.php b/tests/data/ar/CroppedType.php
index 92922a7e1fe..4e7a52c9c1c 100644
--- a/tests/data/ar/CroppedType.php
+++ b/tests/data/ar/CroppedType.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Customer.php b/tests/data/ar/Customer.php
index e22cce59edf..aef14891b24 100644
--- a/tests/data/ar/Customer.php
+++ b/tests/data/ar/Customer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/CustomerQuery.php b/tests/data/ar/CustomerQuery.php
index a53ec906d42..55efd4f7c04 100644
--- a/tests/data/ar/CustomerQuery.php
+++ b/tests/data/ar/CustomerQuery.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/CustomerWithConstructor.php b/tests/data/ar/CustomerWithConstructor.php
index 65b8ff929a1..e1ce957c33a 100644
--- a/tests/data/ar/CustomerWithConstructor.php
+++ b/tests/data/ar/CustomerWithConstructor.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/DefaultMultiplePk.php b/tests/data/ar/DefaultMultiplePk.php
index de936ae0fc4..73476203ee9 100644
--- a/tests/data/ar/DefaultMultiplePk.php
+++ b/tests/data/ar/DefaultMultiplePk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/DefaultPk.php b/tests/data/ar/DefaultPk.php
index 1a0d9ad9e4d..d1a25e9c752 100644
--- a/tests/data/ar/DefaultPk.php
+++ b/tests/data/ar/DefaultPk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Department.php b/tests/data/ar/Department.php
index 3d168e61aea..f3fff729d7c 100644
--- a/tests/data/ar/Department.php
+++ b/tests/data/ar/Department.php
@@ -1,9 +1,9 @@
 <?php
 
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Document.php b/tests/data/ar/Document.php
index ba44d64f160..e169ec79f88 100644
--- a/tests/data/ar/Document.php
+++ b/tests/data/ar/Document.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Dog.php b/tests/data/ar/Dog.php
index 02bd4bfa642..57199f4d7ab 100644
--- a/tests/data/ar/Dog.php
+++ b/tests/data/ar/Dog.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Dossier.php b/tests/data/ar/Dossier.php
index d5900f0a061..a00ac46caed 100644
--- a/tests/data/ar/Dossier.php
+++ b/tests/data/ar/Dossier.php
@@ -1,9 +1,9 @@
 <?php
 
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Employee.php b/tests/data/ar/Employee.php
index faec8fbf5c4..42278bc15ed 100644
--- a/tests/data/ar/Employee.php
+++ b/tests/data/ar/Employee.php
@@ -1,9 +1,9 @@
 <?php
 
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Item.php b/tests/data/ar/Item.php
index 8a9f2da8aeb..09b86030a04 100644
--- a/tests/data/ar/Item.php
+++ b/tests/data/ar/Item.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/NullValues.php b/tests/data/ar/NullValues.php
index afa454837a1..cddc57d33b5 100644
--- a/tests/data/ar/NullValues.php
+++ b/tests/data/ar/NullValues.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Order.php b/tests/data/ar/Order.php
index 6fbc5b0fde5..c2781d2c105 100644
--- a/tests/data/ar/Order.php
+++ b/tests/data/ar/Order.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
@@ -25,6 +25,8 @@ class Order extends ActiveRecord
 {
     public static $tableName;
 
+    public $virtualCustomerId = null;
+
     public static function tableName()
     {
         return static::$tableName ?: 'order';
@@ -238,4 +240,10 @@ public function getItemsFor8()
     {
         return $this->hasMany(Item::className(), ['id' => 'item_id'])->via('orderItemsFor8');
     }
+
+    public function getVirtualCustomer()
+    {
+        return $this->hasOne(Customer::className(), ['id' => 'virtualCustomerId']);
+    }
+
 }
diff --git a/tests/data/ar/OrderItem.php b/tests/data/ar/OrderItem.php
index 58623fc4ce9..d5ab911b8b4 100644
--- a/tests/data/ar/OrderItem.php
+++ b/tests/data/ar/OrderItem.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/OrderItemWithConstructor.php b/tests/data/ar/OrderItemWithConstructor.php
index b76ebdfba7e..83da3433c0f 100644
--- a/tests/data/ar/OrderItemWithConstructor.php
+++ b/tests/data/ar/OrderItemWithConstructor.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/OrderItemWithNullFK.php b/tests/data/ar/OrderItemWithNullFK.php
index cc50b62f5df..5ae8547f4c9 100644
--- a/tests/data/ar/OrderItemWithNullFK.php
+++ b/tests/data/ar/OrderItemWithNullFK.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/OrderWithConstructor.php b/tests/data/ar/OrderWithConstructor.php
index 82853d2ef7d..e981ab3433d 100644
--- a/tests/data/ar/OrderWithConstructor.php
+++ b/tests/data/ar/OrderWithConstructor.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/OrderWithNullFK.php b/tests/data/ar/OrderWithNullFK.php
index c4c539e3c52..efa82de1551 100644
--- a/tests/data/ar/OrderWithNullFK.php
+++ b/tests/data/ar/OrderWithNullFK.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Profile.php b/tests/data/ar/Profile.php
index 5b02be3aac5..d6fd9aee435 100644
--- a/tests/data/ar/Profile.php
+++ b/tests/data/ar/Profile.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/ProfileWithConstructor.php b/tests/data/ar/ProfileWithConstructor.php
index 57ecb137f2b..aeda652a19b 100644
--- a/tests/data/ar/ProfileWithConstructor.php
+++ b/tests/data/ar/ProfileWithConstructor.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Storage.php b/tests/data/ar/Storage.php
index df2ca78ef78..62d1a8fb68f 100644
--- a/tests/data/ar/Storage.php
+++ b/tests/data/ar/Storage.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/TestTrigger.php b/tests/data/ar/TestTrigger.php
index 1340744981a..0334f35955a 100644
--- a/tests/data/ar/TestTrigger.php
+++ b/tests/data/ar/TestTrigger.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/TestTriggerAlert.php b/tests/data/ar/TestTriggerAlert.php
index ca08e25f00a..48e10e66ad0 100644
--- a/tests/data/ar/TestTriggerAlert.php
+++ b/tests/data/ar/TestTriggerAlert.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/ar/Type.php b/tests/data/ar/Type.php
index 68d855720e2..3a53441fb72 100644
--- a/tests/data/ar/Type.php
+++ b/tests/data/ar/Type.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\ar;
diff --git a/tests/data/base/ArrayAccessObject.php b/tests/data/base/ArrayAccessObject.php
index bf62ef2b0e9..4ca7552c89a 100644
--- a/tests/data/base/ArrayAccessObject.php
+++ b/tests/data/base/ArrayAccessObject.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
@@ -29,6 +29,7 @@ class ArrayAccessObject extends TraversableObject implements \ArrayAccess
      * The return value will be casted to boolean if non-boolean was returned.
      * @since 2.0.14.1
      */
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return isset($this->data[$offset]);
@@ -44,6 +45,7 @@ public function offsetExists($offset)
      * @return mixed Can return all value types.
      * @since 2.0.14.1
      */
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         return $this->data[$offset];
@@ -62,6 +64,7 @@ public function offsetGet($offset)
      * @return void
      * @since 2.0.14.1
      */
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $value)
     {
         $this->data[$offset] = $value;
@@ -77,6 +80,7 @@ public function offsetSet($offset, $value)
      * @return void
      * @since 2.0.14.1
      */
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         unset($this->data[$offset]);
diff --git a/tests/data/base/CallableClass.php b/tests/data/base/CallableClass.php
index 42f4cf37ff3..0fa7fbc8833 100644
--- a/tests/data/base/CallableClass.php
+++ b/tests/data/base/CallableClass.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
@@ -13,4 +13,4 @@ public function __invoke()
     {
         return true;
     }
-}
\ No newline at end of file
+}
diff --git a/tests/data/base/InvalidRulesModel.php b/tests/data/base/InvalidRulesModel.php
index fd80c42478f..f15d6df062e 100644
--- a/tests/data/base/InvalidRulesModel.php
+++ b/tests/data/base/InvalidRulesModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
diff --git a/tests/data/base/RulesModel.php b/tests/data/base/RulesModel.php
index e8458ac36d0..ed5aa7683d9 100644
--- a/tests/data/base/RulesModel.php
+++ b/tests/data/base/RulesModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
diff --git a/tests/data/base/Singer.php b/tests/data/base/Singer.php
index 1dabe0b1f0c..649214cdcba 100644
--- a/tests/data/base/Singer.php
+++ b/tests/data/base/Singer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
diff --git a/tests/data/base/Speaker.php b/tests/data/base/Speaker.php
index 60d3df3800c..2cf83dc9eab 100644
--- a/tests/data/base/Speaker.php
+++ b/tests/data/base/Speaker.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
diff --git a/tests/data/base/TraversableObject.php b/tests/data/base/TraversableObject.php
index c8686b1f7de..436287e063f 100644
--- a/tests/data/base/TraversableObject.php
+++ b/tests/data/base/TraversableObject.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\base;
@@ -28,6 +28,7 @@ public function __construct(array $array)
      * @throws \Exception
      * @since 5.1.0
      */
+    #[\ReturnTypeWillChange]
     public function count()
     {
         throw new \Exception('Count called on object that should only be traversed.');
@@ -36,6 +37,7 @@ public function count()
     /**
      * {@inheritdoc}
      */
+    #[\ReturnTypeWillChange]
     public function current()
     {
         return $this->data[$this->position];
@@ -44,6 +46,7 @@ public function current()
     /**
      * {@inheritdoc}
      */
+    #[\ReturnTypeWillChange]
     public function next()
     {
         $this->position++;
@@ -52,6 +55,7 @@ public function next()
     /**
      * {@inheritdoc}
      */
+    #[\ReturnTypeWillChange]
     public function key()
     {
         return $this->position;
@@ -60,6 +64,7 @@ public function key()
     /**
      * {@inheritdoc}
      */
+    #[\ReturnTypeWillChange]
     public function valid()
     {
         return array_key_exists($this->position, $this->data);
@@ -68,6 +73,7 @@ public function valid()
     /**
      * {@inheritdoc}
      */
+    #[\ReturnTypeWillChange]
     public function rewind()
     {
         $this->position = 0;
diff --git a/tests/data/cache/MockDependency.php b/tests/data/cache/MockDependency.php
index 794dad8a644..68f01c1676a 100644
--- a/tests/data/cache/MockDependency.php
+++ b/tests/data/cache/MockDependency.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\cache;
diff --git a/tests/data/config-docker.php b/tests/data/config-docker.php
index ebdf671d96a..1d609a580c2 100644
--- a/tests/data/config-docker.php
+++ b/tests/data/config-docker.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/tests/data/config.php b/tests/data/config.php
index 33897f2877d..eb73f340d25 100644
--- a/tests/data/config.php
+++ b/tests/data/config.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/tests/data/console/controllers/FakeController.php b/tests/data/console/controllers/FakeController.php
index a5f20899eb6..36115dceb30 100644
--- a/tests/data/console/controllers/FakeController.php
+++ b/tests/data/console/controllers/FakeController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers;
diff --git a/tests/data/console/controllers/FakeEmptyController.php b/tests/data/console/controllers/FakeEmptyController.php
index ad2f3bf3ffb..8001e72ca1e 100644
--- a/tests/data/console/controllers/FakeEmptyController.php
+++ b/tests/data/console/controllers/FakeEmptyController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers;
diff --git a/tests/data/console/controllers/FakeNoDefaultController.php b/tests/data/console/controllers/FakeNoDefaultController.php
index 094fa26b2ef..fec8ebac3c7 100644
--- a/tests/data/console/controllers/FakeNoDefaultController.php
+++ b/tests/data/console/controllers/FakeNoDefaultController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers;
diff --git a/tests/data/console/controllers/fixtures/DependentActiveFixture.php b/tests/data/console/controllers/fixtures/DependentActiveFixture.php
index b702267c6d0..bb11b6a85c0 100644
--- a/tests/data/console/controllers/fixtures/DependentActiveFixture.php
+++ b/tests/data/console/controllers/fixtures/DependentActiveFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/FirstFixture.php b/tests/data/console/controllers/fixtures/FirstFixture.php
index 49e3f68da06..682a652d029 100644
--- a/tests/data/console/controllers/fixtures/FirstFixture.php
+++ b/tests/data/console/controllers/fixtures/FirstFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/FirstIndependentActiveFixture.php b/tests/data/console/controllers/fixtures/FirstIndependentActiveFixture.php
index 736c9025ac0..7b99df02865 100644
--- a/tests/data/console/controllers/fixtures/FirstIndependentActiveFixture.php
+++ b/tests/data/console/controllers/fixtures/FirstIndependentActiveFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/FixtureStorage.php b/tests/data/console/controllers/fixtures/FixtureStorage.php
index ec02a9e21e3..5234c5930d6 100644
--- a/tests/data/console/controllers/fixtures/FixtureStorage.php
+++ b/tests/data/console/controllers/fixtures/FixtureStorage.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/GlobalFixture.php b/tests/data/console/controllers/fixtures/GlobalFixture.php
index 9855902b95c..8d493229fbe 100644
--- a/tests/data/console/controllers/fixtures/GlobalFixture.php
+++ b/tests/data/console/controllers/fixtures/GlobalFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/SecondFixture.php b/tests/data/console/controllers/fixtures/SecondFixture.php
index 89bce81f5a2..645418c6470 100644
--- a/tests/data/console/controllers/fixtures/SecondFixture.php
+++ b/tests/data/console/controllers/fixtures/SecondFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/SecondIndependentActiveFixture.php b/tests/data/console/controllers/fixtures/SecondIndependentActiveFixture.php
index bec386a4958..7fcdcccbf2c 100644
--- a/tests/data/console/controllers/fixtures/SecondIndependentActiveFixture.php
+++ b/tests/data/console/controllers/fixtures/SecondIndependentActiveFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures;
diff --git a/tests/data/console/controllers/fixtures/subdir/FirstFixture.php b/tests/data/console/controllers/fixtures/subdir/FirstFixture.php
index 95b7ba3d414..2db058b8605 100644
--- a/tests/data/console/controllers/fixtures/subdir/FirstFixture.php
+++ b/tests/data/console/controllers/fixtures/subdir/FirstFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures\subdir;
diff --git a/tests/data/console/controllers/fixtures/subdir/SecondFixture.php b/tests/data/console/controllers/fixtures/subdir/SecondFixture.php
index eeae836b582..70810f18ac0 100644
--- a/tests/data/console/controllers/fixtures/subdir/SecondFixture.php
+++ b/tests/data/console/controllers/fixtures/subdir/SecondFixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\console\controllers\fixtures\subdir;
diff --git a/tests/data/console/migrate_create/add_columns_fk.php b/tests/data/console/migrate_create/add_columns_fk.php
index c80f4c90095..0d5afceda2d 100644
--- a/tests/data/console/migrate_create/add_columns_fk.php
+++ b/tests/data/console/migrate_create/add_columns_fk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/add_columns_prefix.php b/tests/data/console/migrate_create/add_columns_prefix.php
index c80f4c90095..0d5afceda2d 100644
--- a/tests/data/console/migrate_create/add_columns_prefix.php
+++ b/tests/data/console/migrate_create/add_columns_prefix.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/add_columns_test.php b/tests/data/console/migrate_create/add_columns_test.php
index ec4bdeb1851..9b1202ba54b 100644
--- a/tests/data/console/migrate_create/add_columns_test.php
+++ b/tests/data/console/migrate_create/add_columns_test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/add_two_columns_test.php b/tests/data/console/migrate_create/add_two_columns_test.php
index e58d53a59c4..08290fba742 100644
--- a/tests/data/console/migrate_create/add_two_columns_test.php
+++ b/tests/data/console/migrate_create/add_two_columns_test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_field_with_colon_default_values.php b/tests/data/console/migrate_create/create_field_with_colon_default_values.php
index 582b866c80b..d5996bc2a14 100644
--- a/tests/data/console/migrate_create/create_field_with_colon_default_values.php
+++ b/tests/data/console/migrate_create/create_field_with_colon_default_values.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_fields.php b/tests/data/console/migrate_create/create_fields.php
index 074cf3ba717..2248c3b24a8 100644
--- a/tests/data/console/migrate_create/create_fields.php
+++ b/tests/data/console/migrate_create/create_fields.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_fields_with_col_method_after_default_value.php b/tests/data/console/migrate_create/create_fields_with_col_method_after_default_value.php
index 8d8a579bb39..007f35e31f8 100644
--- a/tests/data/console/migrate_create/create_fields_with_col_method_after_default_value.php
+++ b/tests/data/console/migrate_create/create_fields_with_col_method_after_default_value.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_foreign_key.php b/tests/data/console/migrate_create/create_foreign_key.php
index dc5718307fa..5585ad2ec7d 100644
--- a/tests/data/console/migrate_create/create_foreign_key.php
+++ b/tests/data/console/migrate_create/create_foreign_key.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_id_field_not_as_pk.php b/tests/data/console/migrate_create/create_id_field_not_as_pk.php
index 0cefcb33679..c5dd1aaed56 100644
--- a/tests/data/console/migrate_create/create_id_field_not_as_pk.php
+++ b/tests/data/console/migrate_create/create_id_field_not_as_pk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_id_pk.php b/tests/data/console/migrate_create/create_id_pk.php
index ce5b17d1679..fa3e8ba5684 100644
--- a/tests/data/console/migrate_create/create_id_pk.php
+++ b/tests/data/console/migrate_create/create_id_pk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_prefix.php b/tests/data/console/migrate_create/create_prefix.php
index dc5718307fa..5585ad2ec7d 100644
--- a/tests/data/console/migrate_create/create_prefix.php
+++ b/tests/data/console/migrate_create/create_prefix.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_products_from_store_table.php b/tests/data/console/migrate_create/create_products_from_store_table.php
index 19453462c8a..ed3ffc01027 100644
--- a/tests/data/console/migrate_create/create_products_from_store_table.php
+++ b/tests/data/console/migrate_create/create_products_from_store_table.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_test.php b/tests/data/console/migrate_create/create_test.php
index 07afa073019..72e957e8a96 100644
--- a/tests/data/console/migrate_create/create_test.php
+++ b/tests/data/console/migrate_create/create_test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_title_pk.php b/tests/data/console/migrate_create/create_title_pk.php
index 51b45c40e85..cb4c765dcf2 100644
--- a/tests/data/console/migrate_create/create_title_pk.php
+++ b/tests/data/console/migrate_create/create_title_pk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_title_with_comma_default_values.php b/tests/data/console/migrate_create/create_title_with_comma_default_values.php
index aa1feab1284..3a90c89cb7f 100644
--- a/tests/data/console/migrate_create/create_title_with_comma_default_values.php
+++ b/tests/data/console/migrate_create/create_title_with_comma_default_values.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_unsigned_big_pk.php b/tests/data/console/migrate_create/create_unsigned_big_pk.php
index 3bbfb785ac9..09dd4451146 100644
--- a/tests/data/console/migrate_create/create_unsigned_big_pk.php
+++ b/tests/data/console/migrate_create/create_unsigned_big_pk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/create_unsigned_pk.php b/tests/data/console/migrate_create/create_unsigned_pk.php
index c460de79f2e..c2430a9a6af 100644
--- a/tests/data/console/migrate_create/create_unsigned_pk.php
+++ b/tests/data/console/migrate_create/create_unsigned_pk.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/default.php b/tests/data/console/migrate_create/default.php
index 5e05cb8b5b4..40696acc651 100644
--- a/tests/data/console/migrate_create/default.php
+++ b/tests/data/console/migrate_create/default.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/drop_columns_test.php b/tests/data/console/migrate_create/drop_columns_test.php
index 6f020f05cf6..495852c9476 100644
--- a/tests/data/console/migrate_create/drop_columns_test.php
+++ b/tests/data/console/migrate_create/drop_columns_test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/drop_fields.php b/tests/data/console/migrate_create/drop_fields.php
index 6c6c7e07fa4..44a35d6a773 100644
--- a/tests/data/console/migrate_create/drop_fields.php
+++ b/tests/data/console/migrate_create/drop_fields.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/drop_products_from_store_table.php b/tests/data/console/migrate_create/drop_products_from_store_table.php
index d4d3686f0ac..5827e3c39d0 100644
--- a/tests/data/console/migrate_create/drop_products_from_store_table.php
+++ b/tests/data/console/migrate_create/drop_products_from_store_table.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/drop_test.php b/tests/data/console/migrate_create/drop_test.php
index d4d3686f0ac..5827e3c39d0 100644
--- a/tests/data/console/migrate_create/drop_test.php
+++ b/tests/data/console/migrate_create/drop_test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/console/migrate_create/junction_test.php b/tests/data/console/migrate_create/junction_test.php
index 5ed397902f6..2297117af79 100644
--- a/tests/data/console/migrate_create/junction_test.php
+++ b/tests/data/console/migrate_create/junction_test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return <<<CODE
diff --git a/tests/data/helpers/CustomDebugInfo.php b/tests/data/helpers/CustomDebugInfo.php
index 94a01db9c9a..beb9e514bdb 100644
--- a/tests/data/helpers/CustomDebugInfo.php
+++ b/tests/data/helpers/CustomDebugInfo.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\helpers;
diff --git a/tests/data/i18n/messages/de-DE/test.php b/tests/data/i18n/messages/de-DE/test.php
index f703cc3254d..0ad7044f9e8 100644
--- a/tests/data/i18n/messages/de-DE/test.php
+++ b/tests/data/i18n/messages/de-DE/test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/tests/data/i18n/messages/de/test.php b/tests/data/i18n/messages/de/test.php
index 02739098647..1641c17721b 100644
--- a/tests/data/i18n/messages/de/test.php
+++ b/tests/data/i18n/messages/de/test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/tests/data/i18n/messages/en-150/test.php b/tests/data/i18n/messages/en-150/test.php
new file mode 100644
index 00000000000..4613070a65f
--- /dev/null
+++ b/tests/data/i18n/messages/en-150/test.php
@@ -0,0 +1,14 @@
+<?php
+/**
+ * @link https://www.yiiframework.com/
+ * @copyright Copyright (c) 2008 Yii Software LLC
+ * @license https://www.yiiframework.com/license/
+ */
+
+/**
+ * Messages are copy-pasted in \yiiunit\framework\i18n\DbMessageSourceTest::setUpBeforeClass()
+ * Do not forget to update it in after changing this file!
+ */
+return [
+    'The dog runs fast.' => 'The dog runs fast (en-150).',
+];
diff --git a/tests/data/i18n/messages/en-US/test.php b/tests/data/i18n/messages/en-US/test.php
index f5eef124df5..7157762f557 100644
--- a/tests/data/i18n/messages/en-US/test.php
+++ b/tests/data/i18n/messages/en-US/test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/tests/data/i18n/messages/ru/test.php b/tests/data/i18n/messages/ru/test.php
index 959a3797cef..e3990b616be 100644
--- a/tests/data/i18n/messages/ru/test.php
+++ b/tests/data/i18n/messages/ru/test.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /**
diff --git a/tests/data/modules/magic/Module.php b/tests/data/modules/magic/Module.php
index 9041005f006..9e1c9662771 100644
--- a/tests/data/modules/magic/Module.php
+++ b/tests/data/modules/magic/Module.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\modules\magic;
diff --git a/tests/data/modules/magic/controllers/ETagController.php b/tests/data/modules/magic/controllers/ETagController.php
index 19b0f1ab673..6c282022cc1 100644
--- a/tests/data/modules/magic/controllers/ETagController.php
+++ b/tests/data/modules/magic/controllers/ETagController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\modules\magic\controllers;
diff --git a/tests/data/modules/magic/controllers/subFolder/SubController.php b/tests/data/modules/magic/controllers/subFolder/SubController.php
index 7b2a247fc3f..824a00aa475 100644
--- a/tests/data/modules/magic/controllers/subFolder/SubController.php
+++ b/tests/data/modules/magic/controllers/subFolder/SubController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\modules\magic\controllers\subFolder;
diff --git a/tests/data/rbac/UserID.php b/tests/data/rbac/UserID.php
index e87cd0195ae..3a70d63ebff 100644
--- a/tests/data/rbac/UserID.php
+++ b/tests/data/rbac/UserID.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\rbac;
diff --git a/tests/data/validators/TestValidator.php b/tests/data/validators/TestValidator.php
index c98b17e7720..c6d9e3fe641 100644
--- a/tests/data/validators/TestValidator.php
+++ b/tests/data/validators/TestValidator.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators;
diff --git a/tests/data/validators/models/FakedValidationModel.php b/tests/data/validators/models/FakedValidationModel.php
index bb74d969e4d..bbdfc9fafb2 100644
--- a/tests/data/validators/models/FakedValidationModel.php
+++ b/tests/data/validators/models/FakedValidationModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators\models;
@@ -51,7 +51,7 @@ public function inlineVal($attribute, $params, $validator, $current)
         return true;
     }
 
-    public function clientInlineVal($attribute, $params, $validator, $current)
+    public function clientInlineVal($attribute, $params, $validator, $current, $view = null)
     {
         return \func_get_args();
     }
diff --git a/tests/data/validators/models/ValidatorTestEachAndInlineMethodModel.php b/tests/data/validators/models/ValidatorTestEachAndInlineMethodModel.php
index e87af1bcd5e..e7932f6d716 100644
--- a/tests/data/validators/models/ValidatorTestEachAndInlineMethodModel.php
+++ b/tests/data/validators/models/ValidatorTestEachAndInlineMethodModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators\models;
diff --git a/tests/data/validators/models/ValidatorTestFunctionModel.php b/tests/data/validators/models/ValidatorTestFunctionModel.php
index 57463bef2e9..67d47c38a26 100644
--- a/tests/data/validators/models/ValidatorTestFunctionModel.php
+++ b/tests/data/validators/models/ValidatorTestFunctionModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators\models;
diff --git a/tests/data/validators/models/ValidatorTestMainModel.php b/tests/data/validators/models/ValidatorTestMainModel.php
index 141fed28c12..f801f5635e7 100644
--- a/tests/data/validators/models/ValidatorTestMainModel.php
+++ b/tests/data/validators/models/ValidatorTestMainModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators\models;
diff --git a/tests/data/validators/models/ValidatorTestRefModel.php b/tests/data/validators/models/ValidatorTestRefModel.php
index d1ad3a5fca1..fdfd7f2dadd 100644
--- a/tests/data/validators/models/ValidatorTestRefModel.php
+++ b/tests/data/validators/models/ValidatorTestRefModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators\models;
diff --git a/tests/data/validators/models/ValidatorTestTypedPropModel.php b/tests/data/validators/models/ValidatorTestTypedPropModel.php
index 0a2714796f1..fa838e183d8 100644
--- a/tests/data/validators/models/ValidatorTestTypedPropModel.php
+++ b/tests/data/validators/models/ValidatorTestTypedPropModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\data\validators\models;
diff --git a/tests/data/views/widgets/ListView/item.php b/tests/data/views/widgets/ListView/item.php
index f543715af5b..63f7d95964c 100644
--- a/tests/data/views/widgets/ListView/item.php
+++ b/tests/data/views/widgets/ListView/item.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /* @var $model array|object */
diff --git a/tests/framework/BaseYiiTest.php b/tests/framework/BaseYiiTest.php
index ee2d91184b8..4e17fff0668 100644
--- a/tests/framework/BaseYiiTest.php
+++ b/tests/framework/BaseYiiTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework;
diff --git a/tests/framework/ChangeLogTest.php b/tests/framework/ChangeLogTest.php
index 4a4d738cd95..eef6cae4585 100644
--- a/tests/framework/ChangeLogTest.php
+++ b/tests/framework/ChangeLogTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework;
diff --git a/tests/framework/ar/ActiveRecordTestTrait.php b/tests/framework/ar/ActiveRecordTestTrait.php
index 4c34161eda6..3bb161f7f8f 100644
--- a/tests/framework/ar/ActiveRecordTestTrait.php
+++ b/tests/framework/ar/ActiveRecordTestTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\ar;
diff --git a/tests/framework/base/ActionFilterTest.php b/tests/framework/base/ActionFilterTest.php
index b7b33503990..7a527beb77b 100644
--- a/tests/framework/base/ActionFilterTest.php
+++ b/tests/framework/base/ActionFilterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ApplicationTest.php b/tests/framework/base/ApplicationTest.php
index e6be5bb64e8..bfddeae9d9c 100644
--- a/tests/framework/base/ApplicationTest.php
+++ b/tests/framework/base/ApplicationTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
@@ -66,7 +66,7 @@ function () {
         $this->assertSame('Bootstrap with yii\base\Module', Yii::getLogger()->messages[3][0]);
         $this->assertSame('Bootstrap with Closure', Yii::getLogger()->messages[4][0]);
     }
-    
+
     public function testModuleId()
     {
         $this->mockApplication(['id' => 'app-basic']);
diff --git a/tests/framework/base/BCObject.php b/tests/framework/base/BCObject.php
index 95343e1cf60..ac86dbd074c 100644
--- a/tests/framework/base/BCObject.php
+++ b/tests/framework/base/BCObject.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/BaseObjectTest.php b/tests/framework/base/BaseObjectTest.php
index 86ac66b0f7d..98280fef25e 100644
--- a/tests/framework/base/BaseObjectTest.php
+++ b/tests/framework/base/BaseObjectTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/BehaviorTest.php b/tests/framework/base/BehaviorTest.php
index ecfeb2330d0..b77a074d4be 100644
--- a/tests/framework/base/BehaviorTest.php
+++ b/tests/framework/base/BehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ComponentTest.php b/tests/framework/base/ComponentTest.php
index cea50aac547..e2fdbc6e02b 100644
--- a/tests/framework/base/ComponentTest.php
+++ b/tests/framework/base/ComponentTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ControllerTest.php b/tests/framework/base/ControllerTest.php
index 1ba8e0caf6d..654a5ddc19b 100644
--- a/tests/framework/base/ControllerTest.php
+++ b/tests/framework/base/ControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/DynamicModelTest.php b/tests/framework/base/DynamicModelTest.php
index c2dc1c724fc..0c4a25110b3 100644
--- a/tests/framework/base/DynamicModelTest.php
+++ b/tests/framework/base/DynamicModelTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ErrorExceptionTest.php b/tests/framework/base/ErrorExceptionTest.php
index fdf58888b1a..615b706fa6d 100644
--- a/tests/framework/base/ErrorExceptionTest.php
+++ b/tests/framework/base/ErrorExceptionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/EventTest.php b/tests/framework/base/EventTest.php
index 670600fa29a..f99d12bedb7 100644
--- a/tests/framework/base/EventTest.php
+++ b/tests/framework/base/EventTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ExposedSecurity.php b/tests/framework/base/ExposedSecurity.php
index d653575a0cd..45d310445c6 100644
--- a/tests/framework/base/ExposedSecurity.php
+++ b/tests/framework/base/ExposedSecurity.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ModelTest.php b/tests/framework/base/ModelTest.php
index 428f3fb1b91..f941d72fba8 100644
--- a/tests/framework/base/ModelTest.php
+++ b/tests/framework/base/ModelTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
@@ -526,7 +526,7 @@ public function rules()
     {
         return [
             [['id'], 'required', 'except' => 'administration'],
-            [['name', 'description'], 'filter', 'filter' => 'trim'],
+            [['name', 'description'], 'filter', 'filter' => 'trim', 'skipOnEmpty' => true],
             [['is_disabled'], 'boolean', 'on' => 'administration'],
         ];
     }
diff --git a/tests/framework/base/ModuleTest.php b/tests/framework/base/ModuleTest.php
index c4b3ae43dce..bbe36311279 100644
--- a/tests/framework/base/ModuleTest.php
+++ b/tests/framework/base/ModuleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
@@ -37,11 +37,22 @@ public function testTrueParentModule()
         $this->assertEquals('parent', $child2->module->id);
     }
 
-    public function testControllerPath()
+    public function testGetControllerPath()
     {
         $module = new TestModule('test');
+        $controllerPath = __DIR__ . DIRECTORY_SEPARATOR . 'controllers';
+
         $this->assertEquals('yiiunit\framework\base\controllers', $module->controllerNamespace);
-        $this->assertEquals(__DIR__ . DIRECTORY_SEPARATOR . 'controllers', str_replace(['/', '\\'], DIRECTORY_SEPARATOR, $module->controllerPath));
+        $this->assertEquals($controllerPath, str_replace(['/', '\\'], DIRECTORY_SEPARATOR, $module->getControllerPath()));
+    }
+
+    public function testSetControllerPath()
+    {
+        $module = new TestModule('test');
+        $controllerPath = __DIR__ . DIRECTORY_SEPARATOR . 'controllers';
+
+        $module->setControllerPath($controllerPath);
+        $this->assertEquals($controllerPath, $module->getControllerPath());
     }
 
     public function testSetupVersion()
diff --git a/tests/framework/base/SecurityTest.php b/tests/framework/base/SecurityTest.php
index 215999c12aa..d50fc0ab44d 100644
--- a/tests/framework/base/SecurityTest.php
+++ b/tests/framework/base/SecurityTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
@@ -1046,7 +1046,12 @@ public function dataProviderDeriveKey()
      */
     public function testHkdf($hash, $ikm, $salt, $info, $l, $prk, $okm)
     {
-        $dk = $this->security->hkdf($hash, hex2bin($ikm), hex2bin($salt), hex2bin($info), $l);
+        $dk = $this->security->hkdf(
+            (string)$hash,
+            hex2bin((string)$ikm),
+            hex2bin((string)$salt),
+            hex2bin((string)$info),
+            $l);
         $this->assertEquals($okm, bin2hex($dk));
     }
 
diff --git a/tests/framework/base/StaticInstanceTraitTest.php b/tests/framework/base/StaticInstanceTraitTest.php
index 658f6500903..d007925f50a 100644
--- a/tests/framework/base/StaticInstanceTraitTest.php
+++ b/tests/framework/base/StaticInstanceTraitTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ThemeTest.php b/tests/framework/base/ThemeTest.php
index 006f5160082..145380f3a7b 100644
--- a/tests/framework/base/ThemeTest.php
+++ b/tests/framework/base/ThemeTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
diff --git a/tests/framework/base/ViewTest.php b/tests/framework/base/ViewTest.php
index 58e16415dd3..f568a5a7145 100644
--- a/tests/framework/base/ViewTest.php
+++ b/tests/framework/base/ViewTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
@@ -79,8 +79,8 @@ public function testRelativePathInView()
 
         $baseView = "{$this->testViewPath}/theme1/base.php";
         file_put_contents($baseView, <<<'PHP'
-<?php 
-    echo $this->render("sub"); 
+<?php
+    echo $this->render("sub");
 ?>
 PHP
         );
diff --git a/tests/framework/base/WidgetTest.php b/tests/framework/base/WidgetTest.php
index 33542a18b32..9517fed7e5b 100644
--- a/tests/framework/base/WidgetTest.php
+++ b/tests/framework/base/WidgetTest.php
@@ -1,14 +1,16 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\base;
 
+use Yii;
 use yii\base\Widget;
 use yii\base\WidgetEvent;
+use yii\di\Container;
 use yiiunit\TestCase;
 
 /**
@@ -46,6 +48,30 @@ public function testBeginEnd()
         $this->assertSame('<run-test>', $output);
     }
 
+    /**
+     * @see https://github.com/yiisoft/yii2/issues/19030
+     */
+    public function testDependencyInjection()
+    {
+        Yii::$container = new Container();
+        Yii::$container->setDefinitions([
+            TestWidgetB::className() => [
+                'class' => TestWidget::className()
+            ]
+        ]);
+
+        ob_start();
+        ob_implicit_flush(false);
+
+        $widget = TestWidgetB::begin(['id' => 'test']);
+        $this->assertTrue($widget instanceof TestWidget);
+        TestWidgetB::end();
+
+        $output = ob_get_clean();
+
+        $this->assertSame('<run-test>', $output);
+    }
+
     /**
      * @depends testBeginEnd
      */
diff --git a/tests/framework/base/fixtures/themes/basic/views/site/index.php b/tests/framework/base/fixtures/themes/basic/views/site/index.php
index d63e9ec967f..3b11977a245 100644
--- a/tests/framework/base/fixtures/themes/basic/views/site/index.php
+++ b/tests/framework/base/fixtures/themes/basic/views/site/index.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
diff --git a/tests/framework/base/fixtures/themes/christmas/views/site/index.php b/tests/framework/base/fixtures/themes/christmas/views/site/index.php
index d63e9ec967f..3b11977a245 100644
--- a/tests/framework/base/fixtures/themes/christmas/views/site/index.php
+++ b/tests/framework/base/fixtures/themes/christmas/views/site/index.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
diff --git a/tests/framework/base/fixtures/themes/christmas/views/site/main.php b/tests/framework/base/fixtures/themes/christmas/views/site/main.php
index d63e9ec967f..3b11977a245 100644
--- a/tests/framework/base/fixtures/themes/christmas/views/site/main.php
+++ b/tests/framework/base/fixtures/themes/christmas/views/site/main.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
diff --git a/tests/framework/behaviors/AttributeBehaviorTest.php b/tests/framework/behaviors/AttributeBehaviorTest.php
index b97e37fe136..3159603bac9 100644
--- a/tests/framework/behaviors/AttributeBehaviorTest.php
+++ b/tests/framework/behaviors/AttributeBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/AttributeTypecastBehaviorTest.php b/tests/framework/behaviors/AttributeTypecastBehaviorTest.php
index d4ce8d13632..ee84530e53d 100644
--- a/tests/framework/behaviors/AttributeTypecastBehaviorTest.php
+++ b/tests/framework/behaviors/AttributeTypecastBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/AttributesBehaviorTest.php b/tests/framework/behaviors/AttributesBehaviorTest.php
index 0f2dbbaa77e..d26ddbc8b48 100644
--- a/tests/framework/behaviors/AttributesBehaviorTest.php
+++ b/tests/framework/behaviors/AttributesBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/BlameableBehaviorConsoleTest.php b/tests/framework/behaviors/BlameableBehaviorConsoleTest.php
index c7732a24b22..4a220125521 100755
--- a/tests/framework/behaviors/BlameableBehaviorConsoleTest.php
+++ b/tests/framework/behaviors/BlameableBehaviorConsoleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/BlameableBehaviorTest.php b/tests/framework/behaviors/BlameableBehaviorTest.php
index 7b54c99db9b..b9e1a86b081 100644
--- a/tests/framework/behaviors/BlameableBehaviorTest.php
+++ b/tests/framework/behaviors/BlameableBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/OptimisticLockBehaviorTest.php b/tests/framework/behaviors/OptimisticLockBehaviorTest.php
index 1a7c9ae3e57..fe041eab9af 100644
--- a/tests/framework/behaviors/OptimisticLockBehaviorTest.php
+++ b/tests/framework/behaviors/OptimisticLockBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/SluggableBehaviorTest.php b/tests/framework/behaviors/SluggableBehaviorTest.php
index 094f01f58bd..cf9e9ceddda 100644
--- a/tests/framework/behaviors/SluggableBehaviorTest.php
+++ b/tests/framework/behaviors/SluggableBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/behaviors/TimestampBehaviorTest.php b/tests/framework/behaviors/TimestampBehaviorTest.php
index 4d9803ca824..22365f17993 100644
--- a/tests/framework/behaviors/TimestampBehaviorTest.php
+++ b/tests/framework/behaviors/TimestampBehaviorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\behaviors;
diff --git a/tests/framework/caching/ApcCacheTest.php b/tests/framework/caching/ApcCacheTest.php
index 2ff66692660..809286bbd89 100644
--- a/tests/framework/caching/ApcCacheTest.php
+++ b/tests/framework/caching/ApcCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/ArrayCacheTest.php b/tests/framework/caching/ArrayCacheTest.php
index bcfdd98ec36..2e970175914 100644
--- a/tests/framework/caching/ArrayCacheTest.php
+++ b/tests/framework/caching/ArrayCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/CacheTestCase.php b/tests/framework/caching/CacheTestCase.php
index cb9df3c5086..7eb00321a35 100644
--- a/tests/framework/caching/CacheTestCase.php
+++ b/tests/framework/caching/CacheTestCase.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\caching;
@@ -156,6 +156,13 @@ public function testArrayAccess()
         $this->assertInstanceOf('stdClass', $cache['arrayaccess_test']);
     }
 
+    public function testGetValueNonExistent()
+    {
+        $cache = $this->getCacheInstance();
+
+        $this->assertFalse($this->invokeMethod($cache, 'getValue', ['non_existent_key']));
+    }
+
     public function testGetNonExistent()
     {
         $cache = $this->getCacheInstance();
diff --git a/tests/framework/caching/DbCacheTest.php b/tests/framework/caching/DbCacheTest.php
index 1de319ce1bf..b18b30e2bcd 100644
--- a/tests/framework/caching/DbCacheTest.php
+++ b/tests/framework/caching/DbCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/DbDependencyTest.php b/tests/framework/caching/DbDependencyTest.php
index d7c01900d3d..bd801e3528c 100644
--- a/tests/framework/caching/DbDependencyTest.php
+++ b/tests/framework/caching/DbDependencyTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/DbQueryDependencyTest.php b/tests/framework/caching/DbQueryDependencyTest.php
index 0d718544f77..f8a50183dcd 100644
--- a/tests/framework/caching/DbQueryDependencyTest.php
+++ b/tests/framework/caching/DbQueryDependencyTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
@@ -108,4 +108,30 @@ public function testCustomMethodCallback()
 
         $this->assertTrue($dependency->isChanged($cache));
     }
+
+    /**
+     * @depends testCustomMethod
+     */
+    public function testReusableAndCustomMethodCallback()
+    {
+        $db = $this->getConnection(false);
+        $cache = new ArrayCache();
+
+        $dependency = new DbQueryDependency();
+        $dependency->db = $db;
+        $dependency->query = (new Query())
+            ->from('dependency_item')
+            ->andWhere(['value' => 'not exist']);
+        $dependency->reusable = true;
+        $dependency->method = function (Query $query, $db) {
+            return $query->orWhere(['value' => 'initial'])->exists($db);
+        };
+
+        $dependency->evaluateDependency($cache);
+        $this->assertFalse($dependency->isChanged($cache));
+
+        $db->createCommand()->delete('dependency_item')->execute();
+
+        $this->assertTrue($dependency->isChanged($cache));
+    }
 }
diff --git a/tests/framework/caching/DependencyTest.php b/tests/framework/caching/DependencyTest.php
index a97ca9f92be..ff7dc5faaec 100644
--- a/tests/framework/caching/DependencyTest.php
+++ b/tests/framework/caching/DependencyTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/FileCacheTest.php b/tests/framework/caching/FileCacheTest.php
index 55f2fcad1ea..c9f6ee8f51f 100644
--- a/tests/framework/caching/FileCacheTest.php
+++ b/tests/framework/caching/FileCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/MemCacheTest.php b/tests/framework/caching/MemCacheTest.php
index 0487a1695f8..3444c8eca30 100644
--- a/tests/framework/caching/MemCacheTest.php
+++ b/tests/framework/caching/MemCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/MemCachedTest.php b/tests/framework/caching/MemCachedTest.php
index 78f66789956..8b6b735b433 100644
--- a/tests/framework/caching/MemCachedTest.php
+++ b/tests/framework/caching/MemCachedTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
@@ -27,6 +27,12 @@ protected function getCacheInstance()
             $this->markTestSkipped('memcached not installed. Skipping.');
         }
 
+        if (PHP_VERSION_ID >= 80100 && version_compare(phpversion('memcached'), '3.1.5', '<=')) {
+            $php_version = phpversion();
+            $memcached_version = phpversion('memcached');
+            $this->markTestSkipped("memcached version $memcached_version is not ready for PHP $php_version. Skipping.");
+        }
+
         // check whether memcached is running and skip tests if not.
         if (!@stream_socket_client('127.0.0.1:11211', $errorNumber, $errorDescription, 0.5)) {
             $this->markTestSkipped('No memcached server running at ' . '127.0.0.1:11211' . ' : ' . $errorNumber . ' - ' . $errorDescription);
diff --git a/tests/framework/caching/MssqlCacheTest.php b/tests/framework/caching/MssqlCacheTest.php
index af1091e730c..324f1fcc036 100644
--- a/tests/framework/caching/MssqlCacheTest.php
+++ b/tests/framework/caching/MssqlCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/PgSQLCacheTest.php b/tests/framework/caching/PgSQLCacheTest.php
index 193f971f78e..76a4c6cc6b5 100644
--- a/tests/framework/caching/PgSQLCacheTest.php
+++ b/tests/framework/caching/PgSQLCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link      http://www.yiiframework.com/
+ * @link      https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license   http://www.yiiframework.com/license/
+ * @license   https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/TagDependencyTest.php b/tests/framework/caching/TagDependencyTest.php
index b56c91b9955..fc133796799 100644
--- a/tests/framework/caching/TagDependencyTest.php
+++ b/tests/framework/caching/TagDependencyTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/WinCacheTest.php b/tests/framework/caching/WinCacheTest.php
index 5ebdf7d85e6..df7fac26946 100644
--- a/tests/framework/caching/WinCacheTest.php
+++ b/tests/framework/caching/WinCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/XCacheTest.php b/tests/framework/caching/XCacheTest.php
index e8fe20bd8bb..68859325ffe 100644
--- a/tests/framework/caching/XCacheTest.php
+++ b/tests/framework/caching/XCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/caching/ZendDataCacheTest.php b/tests/framework/caching/ZendDataCacheTest.php
index 9531738b825..728b0042953 100644
--- a/tests/framework/caching/ZendDataCacheTest.php
+++ b/tests/framework/caching/ZendDataCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\caching;
diff --git a/tests/framework/console/ControllerTest.php b/tests/framework/console/ControllerTest.php
index d5ce60c0762..a38cb7ea372 100644
--- a/tests/framework/console/ControllerTest.php
+++ b/tests/framework/console/ControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console;
@@ -286,18 +286,24 @@ public function testHelpOptionWithModule()
         $this->assertEquals(FakeHelpController::getActionIndexLastCallParams(), ['news/posts/index']);
     }
 
-
     /**
-     * Tests if action help does not include (class) type hinted arguments.
-     * @see #10372
+     * @see https://github.com/yiisoft/yii2/issues/19028
      */
-    public function testHelpSkipsTypeHintedArguments()
+    public function testGetActionArgsHelp()
     {
         $controller = new FakeController('fake', Yii::$app);
-        $help = $controller->getActionArgsHelp($controller->createAction('with-complex-type-hint'));
-
-        $this->assertArrayNotHasKey('typedArgument', $help);
-        $this->assertArrayHasKey('simpleArgument', $help);
+        $help = $controller->getActionArgsHelp($controller->createAction('aksi2'));
+
+        $this->assertArrayHasKey('values', $help);
+        if (PHP_MAJOR_VERSION > 5) {
+            // declared type
+            $this->assertEquals('array', $help['values']['type']);
+        } else {
+            $this->markTestSkipped('Can not test declared type of parameter $values on PHP < 7.0');
+        }
+        $this->assertArrayHasKey('value', $help);
+        // PHPDoc type
+        $this->assertEquals('string', $help['value']['type']);
     }
 
     public function testGetActionHelpSummaryOnNull()
diff --git a/tests/framework/console/FakeController.php b/tests/framework/console/FakeController.php
index d3a39b27748..22158049d29 100644
--- a/tests/framework/console/FakeController.php
+++ b/tests/framework/console/FakeController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console;
@@ -57,9 +57,13 @@ public function actionIndex()
 
     public function actionAksi1($fromParam, $other = 'default')
     {
-        return[$fromParam, $other];
+        return [$fromParam, $other];
     }
 
+    /**
+     * @param string $value the string value
+     * @return array
+     */
     public function actionAksi2(array $values, $value)
     {
         return [$values, $value];
@@ -89,11 +93,6 @@ public function actionTrimargs($param1 = null)
         return func_get_args();
     }
 
-    public function actionWithComplexTypeHint(self $typedArgument, $simpleArgument)
-    {
-        return $simpleArgument;
-    }
-
     public function actionStatus($status = 0)
     {
         return $status;
diff --git a/tests/framework/console/FakeHelpController.php b/tests/framework/console/FakeHelpController.php
index 9b0ea50b891..88d54a53975 100644
--- a/tests/framework/console/FakeHelpController.php
+++ b/tests/framework/console/FakeHelpController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console;
diff --git a/tests/framework/console/FakeHelpControllerWithoutOutput.php b/tests/framework/console/FakeHelpControllerWithoutOutput.php
index fbd581adf26..02e8af60c59 100644
--- a/tests/framework/console/FakeHelpControllerWithoutOutput.php
+++ b/tests/framework/console/FakeHelpControllerWithoutOutput.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console;
diff --git a/tests/framework/console/FakePhp71Controller.php b/tests/framework/console/FakePhp71Controller.php
index 985940d6bbc..dbed836f8d1 100644
--- a/tests/framework/console/FakePhp71Controller.php
+++ b/tests/framework/console/FakePhp71Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console;
diff --git a/tests/framework/console/RequestTest.php b/tests/framework/console/RequestTest.php
index 796741da673..64d36e9df93 100644
--- a/tests/framework/console/RequestTest.php
+++ b/tests/framework/console/RequestTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\console\Request;
diff --git a/tests/framework/console/UnknownCommandExceptionTest.php b/tests/framework/console/UnknownCommandExceptionTest.php
index bbecc50ac71..63dd11ccd97 100644
--- a/tests/framework/console/UnknownCommandExceptionTest.php
+++ b/tests/framework/console/UnknownCommandExceptionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console;
diff --git a/tests/framework/console/controllers/AssetControllerTest.php b/tests/framework/console/controllers/AssetControllerTest.php
index ad1f853bbef..f9fe4be33c2 100644
--- a/tests/framework/console/controllers/AssetControllerTest.php
+++ b/tests/framework/console/controllers/AssetControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/BaseMessageControllerTest.php b/tests/framework/console/controllers/BaseMessageControllerTest.php
index b3485967e45..90d77736209 100644
--- a/tests/framework/console/controllers/BaseMessageControllerTest.php
+++ b/tests/framework/console/controllers/BaseMessageControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
@@ -608,12 +608,12 @@ public function testMessageExtractActionWhenMessageUsingParamsReturnedFromMethod
             echo PHP_EOL, Yii::t('app', '3. Message with param from function call {val}', [
                 'val' => date('Y-m-d'),
             ]);
-            
+
             // the next call creates the bug:
             echo PHP_EOL, Yii::t('app', '4. Message with param from method call {val}', [
                 'val' => \Yii::\$app->formatter->asDecimal(23, 4),
             ]);
-            
+
             // after the bug:
             echo PHP_EOL, Yii::t('app', '5. Simple message');
             echo PHP_EOL, Yii::t('app', '6. Message with simple param {val}', [
diff --git a/tests/framework/console/controllers/CacheControllerTest.php b/tests/framework/console/controllers/CacheControllerTest.php
index 9f5f127afb8..907c6da4d3f 100644
--- a/tests/framework/console/controllers/CacheControllerTest.php
+++ b/tests/framework/console/controllers/CacheControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/DbMessageControllerTest.php b/tests/framework/console/controllers/DbMessageControllerTest.php
index 0f539e591aa..1c5707dab94 100644
--- a/tests/framework/console/controllers/DbMessageControllerTest.php
+++ b/tests/framework/console/controllers/DbMessageControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/EchoMigrateController.php b/tests/framework/console/controllers/EchoMigrateController.php
index 1bef5654d5c..44faf4a5d49 100644
--- a/tests/framework/console/controllers/EchoMigrateController.php
+++ b/tests/framework/console/controllers/EchoMigrateController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/FixtureControllerTest.php b/tests/framework/console/controllers/FixtureControllerTest.php
index d33e78e9bb1..49ad96b31df 100644
--- a/tests/framework/console/controllers/FixtureControllerTest.php
+++ b/tests/framework/console/controllers/FixtureControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/HelpControllerTest.php b/tests/framework/console/controllers/HelpControllerTest.php
index c86d6ef40de..68c4f61772f 100644
--- a/tests/framework/console/controllers/HelpControllerTest.php
+++ b/tests/framework/console/controllers/HelpControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
@@ -123,7 +123,7 @@ public function testActionListActionOptions()
         ]);
         $result = Console::stripAnsiFormat($this->runControllerAction('list-action-options', ['action' => 'help/list-action-options']));
         $this->assertEqualsWithoutLE(<<<'STRING'
-action:route to action
+action: route to action
 
 --interactive: whether to run the command interactively.
 --color: whether to enable ANSI color in the output.If not set, ANSI color will only be enabled for terminals that support it.
diff --git a/tests/framework/console/controllers/MigrateControllerTest.php b/tests/framework/console/controllers/MigrateControllerTest.php
index 31e235adaea..714b233b82b 100644
--- a/tests/framework/console/controllers/MigrateControllerTest.php
+++ b/tests/framework/console/controllers/MigrateControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
@@ -78,6 +78,22 @@ protected function assertCommandCreatedFile($expectedFile, $migrationName, $tabl
         $this->assertFileContent($expectedFile, $class, $table, $namespace);
     }
 
+    /**
+     * Check config namespace but without input namespace
+     * @param mixed $expectedFile
+     * @param mixed $migrationName
+     * @param mixed $table
+     * @param array $params
+     */
+    protected function assertCommandCreatedFileWithoutNamespaceInput($expectedFile, $migrationName, $table, $params = [])
+    {
+        $params[0] = $migrationName;
+        list($config, $namespace, $class) = $this->prepareMigrationNameData($this->migrationNamespace . '\\' . $migrationName);
+
+        $this->runMigrateControllerAction('create', $params, $config);
+        $this->assertFileContent($expectedFile, $class, $table, $namespace);
+    }
+
     public function assertFileContentJunction($expectedFile, $class, $junctionTable, $firstTable, $secondTable, $namespace = null)
     {
         if ($namespace) {
@@ -101,6 +117,23 @@ protected function assertCommandCreatedJunctionFile($expectedFile, $migrationNam
         $this->assertFileContentJunction($expectedFile, $class, $junctionTable, $firstTable, $secondTable, $namespace);
     }
 
+    /**
+     * Check config namespace but without input namespace
+     * @param mixed $expectedFile
+     * @param mixed $migrationName
+     * @param mixed $junctionTable
+     * @param mixed $firstTable
+     * @param mixed $secondTable
+     */
+    protected function assertCommandCreatedJunctionFileWithoutNamespaceInput($expectedFile, $migrationName, $junctionTable, $firstTable, $secondTable)
+    {
+        list($config, $namespace, $class) = $this->prepareMigrationNameData($this->migrationNamespace . '\\' . $migrationName);
+
+        $this->runMigrateControllerAction('create', [$migrationName], $config);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
+        $this->assertFileContentJunction($expectedFile, $class, $junctionTable, $firstTable, $secondTable, $namespace);
+    }
+
     protected function prepareMigrationNameData($migrationName)
     {
         $config = [];
@@ -318,6 +351,7 @@ public function testGenerateMigration($expectedFile, $migrationName, $table, $pa
             $table,
             $params
         );
+        $this->assertCommandCreatedFileWithoutNamespaceInput($expectedFile, $migrationName, $table, $params);
     }
 
     /**
@@ -369,6 +403,13 @@ public function testGenerateJunctionMigration($migrationName, $junctionTable, $f
             $firstTable,
             $secondTable
         );
+        $this->assertCommandCreatedJunctionFileWithoutNamespaceInput(
+            'junction_test',
+            $migrationName,
+            $junctionTable,
+            $firstTable,
+            $secondTable
+        );
     }
 
     public function testUpdatingLongNamedMigration()
diff --git a/tests/framework/console/controllers/MigrateControllerTestTrait.php b/tests/framework/console/controllers/MigrateControllerTestTrait.php
index 7b8cd1647f5..bb71b5df1a9 100644
--- a/tests/framework/console/controllers/MigrateControllerTestTrait.php
+++ b/tests/framework/console/controllers/MigrateControllerTestTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/PHPMessageControllerTest.php b/tests/framework/console/controllers/PHPMessageControllerTest.php
index b42b38e4345..d3a8074a665 100644
--- a/tests/framework/console/controllers/PHPMessageControllerTest.php
+++ b/tests/framework/console/controllers/PHPMessageControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/POMessageControllerTest.php b/tests/framework/console/controllers/POMessageControllerTest.php
index 97a60fe6ae2..0aac7f2c8d3 100644
--- a/tests/framework/console/controllers/POMessageControllerTest.php
+++ b/tests/framework/console/controllers/POMessageControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/SilencedCacheController.php b/tests/framework/console/controllers/SilencedCacheController.php
index fdeaef7cd11..bc7b9f7237c 100644
--- a/tests/framework/console/controllers/SilencedCacheController.php
+++ b/tests/framework/console/controllers/SilencedCacheController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/controllers/StdOutBufferControllerTrait.php b/tests/framework/console/controllers/StdOutBufferControllerTrait.php
index 74494360358..819d685cf7d 100644
--- a/tests/framework/console/controllers/StdOutBufferControllerTrait.php
+++ b/tests/framework/console/controllers/StdOutBufferControllerTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\controllers;
diff --git a/tests/framework/console/stubs/DummyService.php b/tests/framework/console/stubs/DummyService.php
index b1be9fd21f4..a22ea914f1b 100644
--- a/tests/framework/console/stubs/DummyService.php
+++ b/tests/framework/console/stubs/DummyService.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\stubs;
diff --git a/tests/framework/console/widgets/TableTest.php b/tests/framework/console/widgets/TableTest.php
index e90598d088e..95e7c60e462 100644
--- a/tests/framework/console/widgets/TableTest.php
+++ b/tests/framework/console/widgets/TableTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\console\widgets;
diff --git a/tests/framework/data/ActiveDataFilterTest.php b/tests/framework/data/ActiveDataFilterTest.php
index 7e22c9ddbbc..9e4fbe7ca62 100644
--- a/tests/framework/data/ActiveDataFilterTest.php
+++ b/tests/framework/data/ActiveDataFilterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/ActiveDataProviderCloningTest.php b/tests/framework/data/ActiveDataProviderCloningTest.php
index 1027baf47cd..931533f7d86 100644
--- a/tests/framework/data/ActiveDataProviderCloningTest.php
+++ b/tests/framework/data/ActiveDataProviderCloningTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/ActiveDataProviderTest.php b/tests/framework/data/ActiveDataProviderTest.php
index b496dcb96bf..57f866ee809 100644
--- a/tests/framework/data/ActiveDataProviderTest.php
+++ b/tests/framework/data/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/ArrayDataProviderTest.php b/tests/framework/data/ArrayDataProviderTest.php
index a2da0e4a362..6c9af6e98bf 100644
--- a/tests/framework/data/ArrayDataProviderTest.php
+++ b/tests/framework/data/ArrayDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/BaseDataProviderTest.php b/tests/framework/data/BaseDataProviderTest.php
index ca2c9d7c514..ea5ae21cb69 100644
--- a/tests/framework/data/BaseDataProviderTest.php
+++ b/tests/framework/data/BaseDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/DataFilterTest.php b/tests/framework/data/DataFilterTest.php
index 24908539808..1508a28ccde 100644
--- a/tests/framework/data/DataFilterTest.php
+++ b/tests/framework/data/DataFilterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
@@ -332,6 +332,18 @@ public function dataProviderNormalize()
                     ],
                 ],
             ],
+            [
+                [
+                    'name' => [
+                        'like' => 'foo',
+                    ],
+                ],
+                [
+                    'name' => [
+                        'LIKE' => 'foo',
+                    ],
+                ],
+            ],
             [
                 [
                     'and' => [
diff --git a/tests/framework/data/PaginationTest.php b/tests/framework/data/PaginationTest.php
index 5f2d3488f8f..a50cba3745c 100644
--- a/tests/framework/data/PaginationTest.php
+++ b/tests/framework/data/PaginationTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/SortTest.php b/tests/framework/data/SortTest.php
index 89cd8a0d69e..19367bfa2c2 100644
--- a/tests/framework/data/SortTest.php
+++ b/tests/framework/data/SortTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/data/SqlDataProviderTest.php b/tests/framework/data/SqlDataProviderTest.php
index b08274865ed..465764f334b 100644
--- a/tests/framework/data/SqlDataProviderTest.php
+++ b/tests/framework/data/SqlDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\data;
diff --git a/tests/framework/db/ActiveQueryModelConnectionTest.php b/tests/framework/db/ActiveQueryModelConnectionTest.php
index fdef6d55b2c..86dff975fd4 100644
--- a/tests/framework/db/ActiveQueryModelConnectionTest.php
+++ b/tests/framework/db/ActiveQueryModelConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/ActiveQueryTest.php b/tests/framework/db/ActiveQueryTest.php
index 50b8a6eda3c..3d3f451865c 100644
--- a/tests/framework/db/ActiveQueryTest.php
+++ b/tests/framework/db/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/ActiveRecordTest.php b/tests/framework/db/ActiveRecordTest.php
index 0088a9091a0..e1908ebc7dd 100644
--- a/tests/framework/db/ActiveRecordTest.php
+++ b/tests/framework/db/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
@@ -1361,7 +1361,7 @@ public function testDefaultValues()
         $model->char_col2 = 'not something';
         $model->loadDefaultValues(false);
         $this->assertEquals('something', $model->char_col2);
-        
+
         // Cropped model with 2 attributes/columns
         $model = new CroppedType();
         $model->loadDefaultValues();
@@ -1529,6 +1529,29 @@ public function testPopulateWithoutPk()
         ];
         $this->assertEquals($expected, $aggregation);
 
+        // tests with single pk asArray with eager loading
+        $aggregation = Customer::find()
+            ->select(['{{customer}}.[[status]]', 'SUM({{order}}.[[total]]) AS [[sumtotal]]'])
+            ->joinWith('ordersPlain')
+            ->groupBy('{{customer}}.[[status]]')
+            ->orderBy('status')
+            ->asArray()
+            ->all();
+
+        $expected = [
+            [
+                'status' => 1,
+                'sumtotal' => 183,
+                'ordersPlain' => [],
+            ],
+            [
+                'status' => 2,
+                'sumtotal' => 0,
+                'ordersPlain' => [],
+            ],
+        ];
+        $this->assertEquals($expected, $aggregation);
+
         // tests with single pk with Models
         $aggregation = Customer::find()
             ->select(['{{customer}}.[[status]]', 'SUM({{order}}.[[total]]) AS [[sumTotal]]'])
@@ -2136,4 +2159,15 @@ public function testUnlinkWithViaOnCondition($delete, $count)
             'item_id' => null,
         ]));
     }
+
+    public function testVirtualRelation()
+    {
+        /* @var $orderClass ActiveRecordInterface */
+        $orderClass = $this->getOrderClass();
+        $order = $orderClass::findOne(2);
+        $order->virtualCustomerId = $order->customer_id;
+
+        $this->assertNotNull($order->virtualCustomer);
+    }
+
 }
diff --git a/tests/framework/db/AnyCaseValue.php b/tests/framework/db/AnyCaseValue.php
index ad91498c663..e347fc6b2af 100644
--- a/tests/framework/db/AnyCaseValue.php
+++ b/tests/framework/db/AnyCaseValue.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/AnyValue.php b/tests/framework/db/AnyValue.php
index e36ed25ba59..db3a13ba0c5 100644
--- a/tests/framework/db/AnyValue.php
+++ b/tests/framework/db/AnyValue.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/BatchQueryResultTest.php b/tests/framework/db/BatchQueryResultTest.php
index 4fbae97f98d..54487083e72 100644
--- a/tests/framework/db/BatchQueryResultTest.php
+++ b/tests/framework/db/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/ColumnSchemaBuilderTest.php b/tests/framework/db/ColumnSchemaBuilderTest.php
index 374ee09cf83..43cec2780c8 100644
--- a/tests/framework/db/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/CommandTest.php b/tests/framework/db/CommandTest.php
index ec88e98dcbe..15ac5f4160f 100644
--- a/tests/framework/db/CommandTest.php
+++ b/tests/framework/db/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/CompareValue.php b/tests/framework/db/CompareValue.php
index d94b4848a46..41a690b34a5 100644
--- a/tests/framework/db/CompareValue.php
+++ b/tests/framework/db/CompareValue.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/ConnectionTest.php b/tests/framework/db/ConnectionTest.php
index 2136e01e84a..39e6677610b 100644
--- a/tests/framework/db/ConnectionTest.php
+++ b/tests/framework/db/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/DatabaseTestCase.php b/tests/framework/db/DatabaseTestCase.php
index 56f80f716c1..53ea945623e 100644
--- a/tests/framework/db/DatabaseTestCase.php
+++ b/tests/framework/db/DatabaseTestCase.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
@@ -130,7 +130,7 @@ protected function replaceQuotes($sql)
                 return $sql;
         }
     }
-    
+
     /**
      * @return \yii\db\Connection
      */
diff --git a/tests/framework/db/GetTablesAliasTestTrait.php b/tests/framework/db/GetTablesAliasTestTrait.php
index dc03e5ef40f..a3a00a10ea1 100644
--- a/tests/framework/db/GetTablesAliasTestTrait.php
+++ b/tests/framework/db/GetTablesAliasTestTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/QueryBuilderTest.php b/tests/framework/db/QueryBuilderTest.php
index 3f0fd800e70..2bf20ad9283 100644
--- a/tests/framework/db/QueryBuilderTest.php
+++ b/tests/framework/db/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
@@ -1184,6 +1184,7 @@ public function conditionProvider()
             //in using array object containing only null value
             [['in', 'id', new TraversableObject([null])], '[[id]] IS NULL', []],
             [['not in', 'id', new TraversableObject([null])], '[[id]] IS NOT NULL', []],
+            [['not in', new Expression('id'), new TraversableObject([null])], '[[id]] IS NOT NULL', []],
 
             'composite in using array objects' => [
                 ['in', new TraversableObject(['id', 'name']), new TraversableObject([
@@ -1196,6 +1197,7 @@ public function conditionProvider()
 
             // in object conditions
             [new InCondition('id', 'in', 1), '[[id]]=:qp0', [':qp0' => 1]],
+            [new InCondition(new Expression('id'), 'in', 1), '[[id]]=:qp0', [':qp0' => 1]],
             [new InCondition('id', 'in', [1]), '[[id]]=:qp0', [':qp0' => 1]],
             [new InCondition('id', 'not in', 1), '[[id]]<>:qp0', [':qp0' => 1]],
             [new InCondition('id', 'not in', [1]), '[[id]]<>:qp0', [':qp0' => 1]],
@@ -1237,6 +1239,7 @@ public function conditionProvider()
             case 'sqlite':
                 $conditions = array_merge($conditions, [
                     [['in', ['id', 'name'], [['id' => 1, 'name' => 'foo'], ['id' => 2, 'name' => 'bar']]], '(([[id]] = :qp0 AND [[name]] = :qp1) OR ([[id]] = :qp2 AND [[name]] = :qp3))', [':qp0' => 1, ':qp1' => 'foo', ':qp2' => 2, ':qp3' => 'bar']],
+                    [['in', [new Expression('id'), 'name'], [['id' => 1, 'name' => 'foo'], ['id' => 2, 'name' => 'bar']]], '(([[id]] = :qp0 AND [[name]] = :qp1) OR ([[id]] = :qp2 AND [[name]] = :qp3))', [':qp0' => 1, ':qp1' => 'foo', ':qp2' => 2, ':qp3' => 'bar']],
                     [['not in', ['id', 'name'], [['id' => 1, 'name' => 'foo'], ['id' => 2, 'name' => 'bar']]], '(([[id]] != :qp0 OR [[name]] != :qp1) AND ([[id]] != :qp2 OR [[name]] != :qp3))', [':qp0' => 1, ':qp1' => 'foo', ':qp2' => 2, ':qp3' => 'bar']],
                     //[ ['in', ['id', 'name'], (new Query())->select(['id', 'name'])->from('users')->where(['active' => 1])], 'EXISTS (SELECT 1 FROM (SELECT [[id]], [[name]] FROM [[users]] WHERE [[active]]=:qp0) AS a WHERE a.[[id]] = [[id AND a.]]name[[ = ]]name`)', [':qp0' => 1] ],
                     //[ ['not in', ['id', 'name'], (new Query())->select(['id', 'name'])->from('users')->where(['active' => 1])], 'NOT EXISTS (SELECT 1 FROM (SELECT [[id]], [[name]] FROM [[users]] WHERE [[active]]=:qp0) AS a WHERE a.[[id]] = [[id]] AND a.[[name = ]]name`)', [':qp0' => 1] ],
@@ -1246,6 +1249,7 @@ public function conditionProvider()
                 $conditions = array_merge($conditions, [
                     [['in', ['id', 'name'], [['id' => 1, 'name' => 'foo'], ['id' => 2, 'name' => 'bar']]], '([[id]], [[name]]) IN ((:qp0, :qp1), (:qp2, :qp3))', [':qp0' => 1, ':qp1' => 'foo', ':qp2' => 2, ':qp3' => 'bar']],
                     [['not in', ['id', 'name'], [['id' => 1, 'name' => 'foo'], ['id' => 2, 'name' => 'bar']]], '([[id]], [[name]]) NOT IN ((:qp0, :qp1), (:qp2, :qp3))', [':qp0' => 1, ':qp1' => 'foo', ':qp2' => 2, ':qp3' => 'bar']],
+                    [['not in', [new Expression('id'), 'name'], [['id' => 1, 'name' => 'foo'], ['id' => 2, 'name' => 'bar']]], '([[id]], [[name]]) NOT IN ((:qp0, :qp1), (:qp2, :qp3))', [':qp0' => 1, ':qp1' => 'foo', ':qp2' => 2, ':qp3' => 'bar']],
                     [['in', ['id', 'name'], (new Query())->select(['id', 'name'])->from('users')->where(['active' => 1])], '([[id]], [[name]]) IN (SELECT [[id]], [[name]] FROM [[users]] WHERE [[active]]=:qp0)', [':qp0' => 1]],
                     [['not in', ['id', 'name'], (new Query())->select(['id', 'name'])->from('users')->where(['active' => 1])], '([[id]], [[name]]) NOT IN (SELECT [[id]], [[name]] FROM [[users]] WHERE [[active]]=:qp0)', [':qp0' => 1]],
                 ]);
diff --git a/tests/framework/db/QueryTest.php b/tests/framework/db/QueryTest.php
index ac7df07ea39..5dbcc0b0b7d 100644
--- a/tests/framework/db/QueryTest.php
+++ b/tests/framework/db/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
@@ -21,7 +21,7 @@ public function testSelect()
         $query = new Query();
         $query->select('*');
         $this->assertEquals(['*' => '*'], $query->select);
-        $this->assertNull($query->distinct);
+        $this->assertFalse($query->distinct);
         $this->assertNull($query->selectOption);
 
         $query = new Query();
diff --git a/tests/framework/db/SchemaTest.php b/tests/framework/db/SchemaTest.php
index 323cd56daab..b3200207e99 100644
--- a/tests/framework/db/SchemaTest.php
+++ b/tests/framework/db/SchemaTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/UnqueryableQueryMock.php b/tests/framework/db/UnqueryableQueryMock.php
index 6d56a10b714..8eb2cfa4dc5 100644
--- a/tests/framework/db/UnqueryableQueryMock.php
+++ b/tests/framework/db/UnqueryableQueryMock.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db;
diff --git a/tests/framework/db/cubrid/ActiveDataProviderTest.php b/tests/framework/db/cubrid/ActiveDataProviderTest.php
index 2124ab0c984..3f1f9720812 100644
--- a/tests/framework/db/cubrid/ActiveDataProviderTest.php
+++ b/tests/framework/db/cubrid/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/ActiveFixtureTest.php b/tests/framework/db/cubrid/ActiveFixtureTest.php
index e4b3b0c2a69..98b977d0177 100644
--- a/tests/framework/db/cubrid/ActiveFixtureTest.php
+++ b/tests/framework/db/cubrid/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/ActiveQueryTest.php b/tests/framework/db/cubrid/ActiveQueryTest.php
index 356d68a7db7..61726e24870 100644
--- a/tests/framework/db/cubrid/ActiveQueryTest.php
+++ b/tests/framework/db/cubrid/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/ActiveRecordTest.php b/tests/framework/db/cubrid/ActiveRecordTest.php
index 5a04840682c..fb5839913fc 100644
--- a/tests/framework/db/cubrid/ActiveRecordTest.php
+++ b/tests/framework/db/cubrid/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/BatchQueryResultTest.php b/tests/framework/db/cubrid/BatchQueryResultTest.php
index b85b7916633..513526a5acd 100644
--- a/tests/framework/db/cubrid/BatchQueryResultTest.php
+++ b/tests/framework/db/cubrid/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/ColumnSchemaBuilderTest.php b/tests/framework/db/cubrid/ColumnSchemaBuilderTest.php
index b6cdc92fb9a..3a05be5d29b 100644
--- a/tests/framework/db/cubrid/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/cubrid/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/CommandTest.php b/tests/framework/db/cubrid/CommandTest.php
index 75b9746c0ee..b44dec70391 100644
--- a/tests/framework/db/cubrid/CommandTest.php
+++ b/tests/framework/db/cubrid/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/ConnectionTest.php b/tests/framework/db/cubrid/ConnectionTest.php
index 41cb42f2a5b..8e375d8f15c 100644
--- a/tests/framework/db/cubrid/ConnectionTest.php
+++ b/tests/framework/db/cubrid/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/ExistValidatorTest.php b/tests/framework/db/cubrid/ExistValidatorTest.php
index daa435f706d..ebc7855b15c 100644
--- a/tests/framework/db/cubrid/ExistValidatorTest.php
+++ b/tests/framework/db/cubrid/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/QueryBuilderTest.php b/tests/framework/db/cubrid/QueryBuilderTest.php
index 33679a34f32..6dc54e56375 100644
--- a/tests/framework/db/cubrid/QueryBuilderTest.php
+++ b/tests/framework/db/cubrid/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/QueryTest.php b/tests/framework/db/cubrid/QueryTest.php
index 39b948a8661..ba06845db94 100644
--- a/tests/framework/db/cubrid/QueryTest.php
+++ b/tests/framework/db/cubrid/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/SchemaTest.php b/tests/framework/db/cubrid/SchemaTest.php
index ec46fd4b597..246958e870e 100644
--- a/tests/framework/db/cubrid/SchemaTest.php
+++ b/tests/framework/db/cubrid/SchemaTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/cubrid/UniqueValidatorTest.php b/tests/framework/db/cubrid/UniqueValidatorTest.php
index 0685f9c37ed..67152c5614f 100644
--- a/tests/framework/db/cubrid/UniqueValidatorTest.php
+++ b/tests/framework/db/cubrid/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\cubrid;
diff --git a/tests/framework/db/mssql/ActiveDataProviderTest.php b/tests/framework/db/mssql/ActiveDataProviderTest.php
index 9e1664e4640..47078c52e3a 100644
--- a/tests/framework/db/mssql/ActiveDataProviderTest.php
+++ b/tests/framework/db/mssql/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/ActiveFixtureTest.php b/tests/framework/db/mssql/ActiveFixtureTest.php
index ff88a8dd99b..0ef64a8ba3d 100644
--- a/tests/framework/db/mssql/ActiveFixtureTest.php
+++ b/tests/framework/db/mssql/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/ActiveQueryTest.php b/tests/framework/db/mssql/ActiveQueryTest.php
index b0940c025ca..60ec61e44cd 100644
--- a/tests/framework/db/mssql/ActiveQueryTest.php
+++ b/tests/framework/db/mssql/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/ActiveRecordTest.php b/tests/framework/db/mssql/ActiveRecordTest.php
index 7ac16865d3a..4fab6394ed4 100644
--- a/tests/framework/db/mssql/ActiveRecordTest.php
+++ b/tests/framework/db/mssql/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/BatchQueryResultTest.php b/tests/framework/db/mssql/BatchQueryResultTest.php
index 492373d72c1..185089c7bdc 100644
--- a/tests/framework/db/mssql/BatchQueryResultTest.php
+++ b/tests/framework/db/mssql/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/ColumnSchemaBuilderTest.php b/tests/framework/db/mssql/ColumnSchemaBuilderTest.php
index 020d59853ed..783d4aa1fef 100644
--- a/tests/framework/db/mssql/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/mssql/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/CommandTest.php b/tests/framework/db/mssql/CommandTest.php
index 17d1852b9fc..b09f87bb6b8 100644
--- a/tests/framework/db/mssql/CommandTest.php
+++ b/tests/framework/db/mssql/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/ConnectionTest.php b/tests/framework/db/mssql/ConnectionTest.php
index e2a8defa803..8e68b18375d 100644
--- a/tests/framework/db/mssql/ConnectionTest.php
+++ b/tests/framework/db/mssql/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/DbMessageSourceTest.php b/tests/framework/db/mssql/DbMessageSourceTest.php
index 64a2ad0e3a8..aaa251d1769 100644
--- a/tests/framework/db/mssql/DbMessageSourceTest.php
+++ b/tests/framework/db/mssql/DbMessageSourceTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/ExistValidatorTest.php b/tests/framework/db/mssql/ExistValidatorTest.php
index 0eed9c810a4..de63ba8b13c 100644
--- a/tests/framework/db/mssql/ExistValidatorTest.php
+++ b/tests/framework/db/mssql/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/QueryBuilderTest.php b/tests/framework/db/mssql/QueryBuilderTest.php
index 3a17357be7b..c1213d6bc9f 100644
--- a/tests/framework/db/mssql/QueryBuilderTest.php
+++ b/tests/framework/db/mssql/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/QueryTest.php b/tests/framework/db/mssql/QueryTest.php
index 250120b6645..c4df28000da 100644
--- a/tests/framework/db/mssql/QueryTest.php
+++ b/tests/framework/db/mssql/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/SchemaTest.php b/tests/framework/db/mssql/SchemaTest.php
index 28f456b7561..2546450564a 100644
--- a/tests/framework/db/mssql/SchemaTest.php
+++ b/tests/framework/db/mssql/SchemaTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mssql/UniqueValidatorTest.php b/tests/framework/db/mssql/UniqueValidatorTest.php
index 097f054947a..732e85ca136 100644
--- a/tests/framework/db/mssql/UniqueValidatorTest.php
+++ b/tests/framework/db/mssql/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mssql;
diff --git a/tests/framework/db/mysql/ActiveDataProviderTest.php b/tests/framework/db/mysql/ActiveDataProviderTest.php
index 76162f20ab3..ed59f0e034f 100644
--- a/tests/framework/db/mysql/ActiveDataProviderTest.php
+++ b/tests/framework/db/mysql/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/ActiveFixtureTest.php b/tests/framework/db/mysql/ActiveFixtureTest.php
index c949f2a3142..5b1aa0b12f7 100644
--- a/tests/framework/db/mysql/ActiveFixtureTest.php
+++ b/tests/framework/db/mysql/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/ActiveQueryTest.php b/tests/framework/db/mysql/ActiveQueryTest.php
index 02f6caa9097..90445aee476 100644
--- a/tests/framework/db/mysql/ActiveQueryTest.php
+++ b/tests/framework/db/mysql/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/ActiveRecordTest.php b/tests/framework/db/mysql/ActiveRecordTest.php
index 7ea1b84b189..27105693fed 100644
--- a/tests/framework/db/mysql/ActiveRecordTest.php
+++ b/tests/framework/db/mysql/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/BatchQueryResultTest.php b/tests/framework/db/mysql/BatchQueryResultTest.php
index 3c7fa2a641d..0bea8bdf58a 100644
--- a/tests/framework/db/mysql/BatchQueryResultTest.php
+++ b/tests/framework/db/mysql/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/ColumnSchemaBuilderTest.php b/tests/framework/db/mysql/ColumnSchemaBuilderTest.php
index 83d5ccd0fb9..e930deeff79 100644
--- a/tests/framework/db/mysql/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/mysql/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/CommandTest.php b/tests/framework/db/mysql/CommandTest.php
index c28a01d9767..0cd6e63aabf 100644
--- a/tests/framework/db/mysql/CommandTest.php
+++ b/tests/framework/db/mysql/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/ConnectionTest.php b/tests/framework/db/mysql/ConnectionTest.php
index 8a8f36e0db4..1d564e15ccf 100644
--- a/tests/framework/db/mysql/ConnectionTest.php
+++ b/tests/framework/db/mysql/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/ExistValidatorTest.php b/tests/framework/db/mysql/ExistValidatorTest.php
index bbc8ee45e9d..c503b9445c9 100644
--- a/tests/framework/db/mysql/ExistValidatorTest.php
+++ b/tests/framework/db/mysql/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/QueryBuilderTest.php b/tests/framework/db/mysql/QueryBuilderTest.php
index 21399b4f351..e77985c59f4 100644
--- a/tests/framework/db/mysql/QueryBuilderTest.php
+++ b/tests/framework/db/mysql/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/QueryTest.php b/tests/framework/db/mysql/QueryTest.php
index b33d64a8eb9..9f647308c6f 100644
--- a/tests/framework/db/mysql/QueryTest.php
+++ b/tests/framework/db/mysql/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/SchemaTest.php b/tests/framework/db/mysql/SchemaTest.php
index b5419821e8e..4e602a317ea 100644
--- a/tests/framework/db/mysql/SchemaTest.php
+++ b/tests/framework/db/mysql/SchemaTest.php
@@ -1,13 +1,15 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
 use yii\db\Expression;
 
+use yii\db\mysql\ColumnSchema;
+use yii\db\mysql\Schema;
 use yiiunit\framework\db\AnyCaseValue;
 
 /**
@@ -101,7 +103,7 @@ public function testAlternativeDisplayOfDefaultCurrentTimestampInMariaDB()
          * We do not have a real database MariaDB >= 10.2.3 for tests, so we emulate the information that database
          * returns in response to the query `SHOW FULL COLUMNS FROM ...`
          */
-        $schema = new \yii\db\mysql\Schema();
+        $schema = new Schema();
         $column = $this->invokeMethod($schema, 'loadColumnSchema', [[
             'field' => 'emulated_MariaDB_field',
             'type' => 'timestamp',
@@ -114,11 +116,36 @@ public function testAlternativeDisplayOfDefaultCurrentTimestampInMariaDB()
             'comment' => '',
         ]]);
 
-        $this->assertInstanceOf(\yii\db\mysql\ColumnSchema::className(), $column);
+        $this->assertInstanceOf(ColumnSchema::className(), $column);
         $this->assertInstanceOf(Expression::className(), $column->defaultValue);
         $this->assertEquals('CURRENT_TIMESTAMP', $column->defaultValue);
     }
 
+    /**
+     * When displayed in the INFORMATION_SCHEMA.COLUMNS table, a default CURRENT TIMESTAMP is provided
+     * as NULL.
+     *
+     * @see https://github.com/yiisoft/yii2/issues/19047
+     */
+    public function testAlternativeDisplayOfDefaultCurrentTimestampAsNullInMariaDB()
+    {
+        $schema = new Schema();
+        $column = $this->invokeMethod($schema, 'loadColumnSchema', [[
+            'field' => 'emulated_MariaDB_field',
+            'type' => 'timestamp',
+            'collation' => NULL,
+            'null' => 'NO',
+            'key' => '',
+            'default' => NULL,
+            'extra' => '',
+            'privileges' => 'select,insert,update,references',
+            'comment' => '',
+        ]]);
+
+        $this->assertInstanceOf(ColumnSchema::className(), $column);
+        $this->assertEquals(NULL, $column->defaultValue);
+    }
+
     public function getExpectedColumns()
     {
         $version = $this->getConnection()->getSchema()->getServerVersion();
diff --git a/tests/framework/db/mysql/UniqueValidatorTest.php b/tests/framework/db/mysql/UniqueValidatorTest.php
index 98651263d23..c6a3146bb26 100644
--- a/tests/framework/db/mysql/UniqueValidatorTest.php
+++ b/tests/framework/db/mysql/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql;
diff --git a/tests/framework/db/mysql/connection/DeadLockTest.php b/tests/framework/db/mysql/connection/DeadLockTest.php
index 4e6dd8482a6..40f6d573f87 100644
--- a/tests/framework/db/mysql/connection/DeadLockTest.php
+++ b/tests/framework/db/mysql/connection/DeadLockTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\mysql\connection;
@@ -31,6 +31,9 @@ class DeadLockTest extends \yiiunit\framework\db\mysql\ConnectionTest
      */
     public function testDeadlockException()
     {
+        if (PHP_VERSION_ID >= 70400 && PHP_VERSION_ID < 70500) {
+            $this->markTestSkipped('Stable failed in PHP 7.4');
+        }
         if (!\function_exists('pcntl_fork')) {
             $this->markTestSkipped('pcntl_fork() is not available');
         }
diff --git a/tests/framework/db/oci/ActiveDataProviderTest.php b/tests/framework/db/oci/ActiveDataProviderTest.php
index 7831afceea9..1be794ebef8 100644
--- a/tests/framework/db/oci/ActiveDataProviderTest.php
+++ b/tests/framework/db/oci/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/ActiveFixtureTest.php b/tests/framework/db/oci/ActiveFixtureTest.php
index 55ecc8cdeb3..ca19388f56a 100644
--- a/tests/framework/db/oci/ActiveFixtureTest.php
+++ b/tests/framework/db/oci/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/ActiveQueryTest.php b/tests/framework/db/oci/ActiveQueryTest.php
index 848fc7591b1..6d195bc0dba 100644
--- a/tests/framework/db/oci/ActiveQueryTest.php
+++ b/tests/framework/db/oci/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/ActiveRecordTest.php b/tests/framework/db/oci/ActiveRecordTest.php
index 91442a5a411..6be10ccc352 100644
--- a/tests/framework/db/oci/ActiveRecordTest.php
+++ b/tests/framework/db/oci/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/BatchQueryResultTest.php b/tests/framework/db/oci/BatchQueryResultTest.php
index 821989c9b21..224ecde73d7 100644
--- a/tests/framework/db/oci/BatchQueryResultTest.php
+++ b/tests/framework/db/oci/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/ColumnSchemaBuilderTest.php b/tests/framework/db/oci/ColumnSchemaBuilderTest.php
index 9535ac87b3f..8e0a8e96bbf 100644
--- a/tests/framework/db/oci/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/oci/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/CommandTest.php b/tests/framework/db/oci/CommandTest.php
index 319f3fca943..5fb29cbd75f 100644
--- a/tests/framework/db/oci/CommandTest.php
+++ b/tests/framework/db/oci/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/ConnectionTest.php b/tests/framework/db/oci/ConnectionTest.php
index d4aef99c82c..0d0bf842ef6 100644
--- a/tests/framework/db/oci/ConnectionTest.php
+++ b/tests/framework/db/oci/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/ExistValidatorTest.php b/tests/framework/db/oci/ExistValidatorTest.php
index 5c5c5831e25..f621f0bfb9f 100644
--- a/tests/framework/db/oci/ExistValidatorTest.php
+++ b/tests/framework/db/oci/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/QueryBuilderTest.php b/tests/framework/db/oci/QueryBuilderTest.php
index daed2d13c22..5bf3b831636 100644
--- a/tests/framework/db/oci/QueryBuilderTest.php
+++ b/tests/framework/db/oci/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/QueryTest.php b/tests/framework/db/oci/QueryTest.php
index d5acd3cc963..fa583ae42e4 100644
--- a/tests/framework/db/oci/QueryTest.php
+++ b/tests/framework/db/oci/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/SchemaTest.php b/tests/framework/db/oci/SchemaTest.php
index b0335b3a84e..a8540f729a2 100644
--- a/tests/framework/db/oci/SchemaTest.php
+++ b/tests/framework/db/oci/SchemaTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/oci/UniqueValidatorTest.php b/tests/framework/db/oci/UniqueValidatorTest.php
index 2ce07dee46e..c597e5b4012 100644
--- a/tests/framework/db/oci/UniqueValidatorTest.php
+++ b/tests/framework/db/oci/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\oci;
diff --git a/tests/framework/db/pgsql/ActiveDataProviderTest.php b/tests/framework/db/pgsql/ActiveDataProviderTest.php
index e74517e14e6..4ea8784f921 100644
--- a/tests/framework/db/pgsql/ActiveDataProviderTest.php
+++ b/tests/framework/db/pgsql/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/ActiveFixtureTest.php b/tests/framework/db/pgsql/ActiveFixtureTest.php
index fec995a5296..d745fb55388 100644
--- a/tests/framework/db/pgsql/ActiveFixtureTest.php
+++ b/tests/framework/db/pgsql/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/ActiveQueryTest.php b/tests/framework/db/pgsql/ActiveQueryTest.php
index bbf3ec5112f..9a0318f9053 100644
--- a/tests/framework/db/pgsql/ActiveQueryTest.php
+++ b/tests/framework/db/pgsql/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/ActiveRecordTest.php b/tests/framework/db/pgsql/ActiveRecordTest.php
index 175da28c777..da471666165 100644
--- a/tests/framework/db/pgsql/ActiveRecordTest.php
+++ b/tests/framework/db/pgsql/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/BatchQueryResultTest.php b/tests/framework/db/pgsql/BatchQueryResultTest.php
index e9356116d9b..f4796371399 100644
--- a/tests/framework/db/pgsql/BatchQueryResultTest.php
+++ b/tests/framework/db/pgsql/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/ColumnSchemaBuilderTest.php b/tests/framework/db/pgsql/ColumnSchemaBuilderTest.php
index 641d7800c2a..32d4f0eb463 100644
--- a/tests/framework/db/pgsql/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/pgsql/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/CommandTest.php b/tests/framework/db/pgsql/CommandTest.php
index ce3b20eb6cb..6b24d6938d2 100644
--- a/tests/framework/db/pgsql/CommandTest.php
+++ b/tests/framework/db/pgsql/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\tests\unit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/ConnectionTest.php b/tests/framework/db/pgsql/ConnectionTest.php
index f91f603d5b9..2baa79e3b8d 100644
--- a/tests/framework/db/pgsql/ConnectionTest.php
+++ b/tests/framework/db/pgsql/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/ExistValidatorTest.php b/tests/framework/db/pgsql/ExistValidatorTest.php
index 5f57c1ea48f..4f9a7bc98eb 100644
--- a/tests/framework/db/pgsql/ExistValidatorTest.php
+++ b/tests/framework/db/pgsql/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/QueryBuilderTest.php b/tests/framework/db/pgsql/QueryBuilderTest.php
index a5cc6f2fb5f..918f3021c3a 100644
--- a/tests/framework/db/pgsql/QueryBuilderTest.php
+++ b/tests/framework/db/pgsql/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
@@ -70,7 +70,7 @@ public function conditionProvider()
     {
         return array_merge(parent::conditionProvider(), [
             // adding conditions for ILIKE i.e. case insensitive LIKE
-            // http://www.postgresql.org/docs/8.3/static/functions-matching.html#FUNCTIONS-LIKE
+            // https://www.postgresql.org/docs/8.3/functions-matching.html#FUNCTIONS-LIKE
 
             // empty values
             [['ilike', 'name', []], '0=1', []],
@@ -185,7 +185,7 @@ public function testAlterColumn()
         $expected = 'ALTER TABLE "foo1" ALTER COLUMN "bar" TYPE varchar(255), ALTER COLUMN "bar" DROP DEFAULT, ALTER COLUMN "bar" DROP NOT NULL, ADD CONSTRAINT foo1_bar_check CHECK (char_length(bar) > 5)';
         $sql = $qb->alterColumn('foo1', 'bar', $this->string(255)->check('char_length(bar) > 5'));
         $this->assertEquals($expected, $sql);
-        
+
         $expected = 'ALTER TABLE "foo1" ALTER COLUMN "bar" TYPE varchar(255), ALTER COLUMN "bar" SET DEFAULT \'\', ALTER COLUMN "bar" DROP NOT NULL';
         $sql = $qb->alterColumn('foo1', 'bar', $this->string(255)->defaultValue(''));
         $this->assertEquals($expected, $sql);
diff --git a/tests/framework/db/pgsql/QueryTest.php b/tests/framework/db/pgsql/QueryTest.php
index 61dc5189221..2fe80782d47 100644
--- a/tests/framework/db/pgsql/QueryTest.php
+++ b/tests/framework/db/pgsql/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/SchemaTest.php b/tests/framework/db/pgsql/SchemaTest.php
index 1c5017c0ab2..a36aaba069e 100644
--- a/tests/framework/db/pgsql/SchemaTest.php
+++ b/tests/framework/db/pgsql/SchemaTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/pgsql/UniqueValidatorTest.php b/tests/framework/db/pgsql/UniqueValidatorTest.php
index 754297b0324..c94138a6ddb 100644
--- a/tests/framework/db/pgsql/UniqueValidatorTest.php
+++ b/tests/framework/db/pgsql/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\pgsql;
diff --git a/tests/framework/db/sqlite/ActiveDataProviderTest.php b/tests/framework/db/sqlite/ActiveDataProviderTest.php
index 9961cef3af4..a79b54bfd99 100644
--- a/tests/framework/db/sqlite/ActiveDataProviderTest.php
+++ b/tests/framework/db/sqlite/ActiveDataProviderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/ActiveFixtureTest.php b/tests/framework/db/sqlite/ActiveFixtureTest.php
index 3eb2efd12fe..c7e17238d49 100644
--- a/tests/framework/db/sqlite/ActiveFixtureTest.php
+++ b/tests/framework/db/sqlite/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/ActiveQueryTest.php b/tests/framework/db/sqlite/ActiveQueryTest.php
index 0b3ba0638d5..b68d4042874 100644
--- a/tests/framework/db/sqlite/ActiveQueryTest.php
+++ b/tests/framework/db/sqlite/ActiveQueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/ActiveRecordTest.php b/tests/framework/db/sqlite/ActiveRecordTest.php
index d70d0d275ef..96a9128e9ba 100644
--- a/tests/framework/db/sqlite/ActiveRecordTest.php
+++ b/tests/framework/db/sqlite/ActiveRecordTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/BatchQueryResultTest.php b/tests/framework/db/sqlite/BatchQueryResultTest.php
index d5aac40624e..bfdfa4daf4a 100644
--- a/tests/framework/db/sqlite/BatchQueryResultTest.php
+++ b/tests/framework/db/sqlite/BatchQueryResultTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/ColumnSchemaBuilderTest.php b/tests/framework/db/sqlite/ColumnSchemaBuilderTest.php
index 7831c80454c..c8e7d5b06e3 100644
--- a/tests/framework/db/sqlite/ColumnSchemaBuilderTest.php
+++ b/tests/framework/db/sqlite/ColumnSchemaBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/CommandTest.php b/tests/framework/db/sqlite/CommandTest.php
index c840ce0b099..23012f38fec 100644
--- a/tests/framework/db/sqlite/CommandTest.php
+++ b/tests/framework/db/sqlite/CommandTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/ConnectionTest.php b/tests/framework/db/sqlite/ConnectionTest.php
index 28691c52cb0..5ff572313f6 100644
--- a/tests/framework/db/sqlite/ConnectionTest.php
+++ b/tests/framework/db/sqlite/ConnectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/ExistValidatorTest.php b/tests/framework/db/sqlite/ExistValidatorTest.php
index 8c8652a60ea..3bce962107f 100644
--- a/tests/framework/db/sqlite/ExistValidatorTest.php
+++ b/tests/framework/db/sqlite/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/QueryBuilderTest.php b/tests/framework/db/sqlite/QueryBuilderTest.php
index 084674f5f8a..fa3619aca92 100644
--- a/tests/framework/db/sqlite/QueryBuilderTest.php
+++ b/tests/framework/db/sqlite/QueryBuilderTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/QueryTest.php b/tests/framework/db/sqlite/QueryTest.php
index e5ee6151194..939a41ed679 100644
--- a/tests/framework/db/sqlite/QueryTest.php
+++ b/tests/framework/db/sqlite/QueryTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/SchemaTest.php b/tests/framework/db/sqlite/SchemaTest.php
index 06d3c142077..a79a2c40149 100644
--- a/tests/framework/db/sqlite/SchemaTest.php
+++ b/tests/framework/db/sqlite/SchemaTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/SqlTokenizerTest.php b/tests/framework/db/sqlite/SqlTokenizerTest.php
index 0e5c4e6a9f8..451c16a8327 100644
--- a/tests/framework/db/sqlite/SqlTokenizerTest.php
+++ b/tests/framework/db/sqlite/SqlTokenizerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/sqlite/UniqueValidatorTest.php b/tests/framework/db/sqlite/UniqueValidatorTest.php
index 9a7d513a846..3dd6e5254ee 100644
--- a/tests/framework/db/sqlite/UniqueValidatorTest.php
+++ b/tests/framework/db/sqlite/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\db\sqlite;
diff --git a/tests/framework/db/testBatchInsertWithYield.php b/tests/framework/db/testBatchInsertWithYield.php
index d9efb4093fa..f40c3833319 100644
--- a/tests/framework/db/testBatchInsertWithYield.php
+++ b/tests/framework/db/testBatchInsertWithYield.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 /* @var $this \yiiunit\framework\db\CommandTest  */
diff --git a/tests/framework/di/ContainerTest.php b/tests/framework/di/ContainerTest.php
index 71c8e2f2691..4df6140a819 100644
--- a/tests/framework/di/ContainerTest.php
+++ b/tests/framework/di/ContainerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di;
@@ -24,6 +24,7 @@
 use yiiunit\framework\di\stubs\FooProperty;
 use yiiunit\framework\di\stubs\Kappa;
 use yiiunit\framework\di\stubs\Qux;
+use yiiunit\framework\di\stubs\QuxAnother;
 use yiiunit\framework\di\stubs\QuxInterface;
 use yiiunit\framework\di\stubs\QuxFactory;
 use yiiunit\framework\di\stubs\UnionTypeNotNull;
@@ -673,4 +674,56 @@ public function testUnionTypeWithClassConstructorParameters()
         $this->expectException('TypeError');
         (new Container())->get(UnionTypeNotNull::className());
     }
+
+    public function testResolveCallableDependenciesUnionTypes()
+    {
+        if (PHP_VERSION_ID < 80000) {
+            $this->markTestSkipped('Can not be tested on PHP < 8.0');
+            return;
+        }
+
+        $this->mockApplication([
+            'components' => [
+                Beta::className(),
+            ],
+        ]);
+
+        Yii::$container->set('yiiunit\framework\di\stubs\QuxInterface', [
+            'class' => Qux::className(),
+        ]);
+
+        $className = 'yiiunit\framework\di\stubs\StaticMethodsWithUnionTypes';
+
+        $params = Yii::$container->resolveCallableDependencies([$className, 'withBetaUnion']);
+        $this->assertInstanceOf(Beta::classname(), $params[0]);
+
+        $params = Yii::$container->resolveCallableDependencies([$className, 'withBetaUnionInverse']);
+        $this->assertInstanceOf(Beta::classname(), $params[0]);
+
+        $params = Yii::$container->resolveCallableDependencies([$className, 'withBetaAndQuxUnion']);
+        $this->assertInstanceOf(Beta::classname(), $params[0]);
+
+        $params = Yii::$container->resolveCallableDependencies([$className, 'withQuxAndBetaUnion']);
+        $this->assertInstanceOf(Qux::classname(), $params[0]);
+    }
+
+    public function testResolveCallableDependenciesIntersectionTypes()
+    {
+        if (PHP_VERSION_ID < 80100) {
+            $this->markTestSkipped('Can not be tested on PHP < 8.1');
+            return;
+        }
+
+        Yii::$container->set('yiiunit\framework\di\stubs\QuxInterface', [
+            'class' => Qux::className(),
+        ]);
+
+        $className = 'yiiunit\framework\di\stubs\StaticMethodsWithIntersectionTypes';
+
+        $params = Yii::$container->resolveCallableDependencies([$className, 'withQuxInterfaceAndQuxAnotherIntersection']);
+        $this->assertInstanceOf(Qux::classname(), $params[0]);
+
+        $params = Yii::$container->resolveCallableDependencies([$className, 'withQuxAnotherAndQuxInterfaceIntersection']);
+        $this->assertInstanceOf(QuxAnother::classname(), $params[0]);
+    }
 }
diff --git a/tests/framework/di/InstanceTest.php b/tests/framework/di/InstanceTest.php
index a5b23c5fd15..fe61a6bdf95 100644
--- a/tests/framework/di/InstanceTest.php
+++ b/tests/framework/di/InstanceTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di;
diff --git a/tests/framework/di/ServiceLocatorTest.php b/tests/framework/di/ServiceLocatorTest.php
index 1a49a9fc4f1..d20a81ff55a 100644
--- a/tests/framework/di/ServiceLocatorTest.php
+++ b/tests/framework/di/ServiceLocatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di;
diff --git a/tests/framework/di/stubs/Bar.php b/tests/framework/di/stubs/Bar.php
index 77d60910377..193f144302a 100644
--- a/tests/framework/di/stubs/Bar.php
+++ b/tests/framework/di/stubs/Bar.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/BarSetter.php b/tests/framework/di/stubs/BarSetter.php
index 355d41d0498..f782968c8f9 100644
--- a/tests/framework/di/stubs/BarSetter.php
+++ b/tests/framework/di/stubs/BarSetter.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link      http://www.yiiframework.com/
+ * @link      https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license   http://www.yiiframework.com/license/
+ * @license   https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/Corge.php b/tests/framework/di/stubs/Corge.php
index 1d1ba047f21..cf2710f4f1e 100644
--- a/tests/framework/di/stubs/Corge.php
+++ b/tests/framework/di/stubs/Corge.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/Foo.php b/tests/framework/di/stubs/Foo.php
index 9e10ea35203..ab467542a0a 100644
--- a/tests/framework/di/stubs/Foo.php
+++ b/tests/framework/di/stubs/Foo.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/FooBaz.php b/tests/framework/di/stubs/FooBaz.php
index f33603e6bf3..3c884ab34c6 100644
--- a/tests/framework/di/stubs/FooBaz.php
+++ b/tests/framework/di/stubs/FooBaz.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/FooProperty.php b/tests/framework/di/stubs/FooProperty.php
index 022d2e3729e..0b45dc37779 100644
--- a/tests/framework/di/stubs/FooProperty.php
+++ b/tests/framework/di/stubs/FooProperty.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link      http://www.yiiframework.com/
+ * @link      https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license   http://www.yiiframework.com/license/
+ * @license   https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/Qux.php b/tests/framework/di/stubs/Qux.php
index 6fffbdd8bd1..86541268af1 100644
--- a/tests/framework/di/stubs/Qux.php
+++ b/tests/framework/di/stubs/Qux.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/QuxAnother.php b/tests/framework/di/stubs/QuxAnother.php
new file mode 100644
index 00000000000..3e21d0bf9bd
--- /dev/null
+++ b/tests/framework/di/stubs/QuxAnother.php
@@ -0,0 +1,17 @@
+<?php
+/**
+ * @link https://www.yiiframework.com/
+ * @copyright Copyright (c) 2008 Yii Software LLC
+ * @license https://www.yiiframework.com/license/
+ */
+
+namespace yiiunit\framework\di\stubs;
+
+use yii\base\BaseObject;
+
+class QuxAnother extends BaseObject implements QuxInterface
+{
+    public function quxMethod()
+    {
+    }
+}
diff --git a/tests/framework/di/stubs/QuxFactory.php b/tests/framework/di/stubs/QuxFactory.php
index fd6972ab77a..69f6bd17d62 100644
--- a/tests/framework/di/stubs/QuxFactory.php
+++ b/tests/framework/di/stubs/QuxFactory.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/QuxInterface.php b/tests/framework/di/stubs/QuxInterface.php
index 8815021c6ca..e9c8c12fcc8 100644
--- a/tests/framework/di/stubs/QuxInterface.php
+++ b/tests/framework/di/stubs/QuxInterface.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/stubs/StaticMethodsWithIntersectionTypes.php b/tests/framework/di/stubs/StaticMethodsWithIntersectionTypes.php
new file mode 100644
index 00000000000..1bb348fdd98
--- /dev/null
+++ b/tests/framework/di/stubs/StaticMethodsWithIntersectionTypes.php
@@ -0,0 +1,15 @@
+<?php
+
+namespace yiiunit\framework\di\stubs;
+
+// Syntax valid only for PHP 8.1+
+class StaticMethodsWithIntersectionTypes
+{
+    public static function withQuxInterfaceAndQuxAnotherIntersection(QuxInterface & QuxAnother $Qux)
+    {
+    }
+
+    public static function withQuxAnotherAndQuxInterfaceIntersection(QuxAnother & QuxInterface $Qux)
+    {
+    }
+}
diff --git a/tests/framework/di/stubs/StaticMethodsWithUnionTypes.php b/tests/framework/di/stubs/StaticMethodsWithUnionTypes.php
new file mode 100644
index 00000000000..bc257ac48f2
--- /dev/null
+++ b/tests/framework/di/stubs/StaticMethodsWithUnionTypes.php
@@ -0,0 +1,23 @@
+<?php
+
+namespace yiiunit\framework\di\stubs;
+
+// Syntax valid only for PHP 8.0+
+class StaticMethodsWithUnionTypes
+{
+    public static function withBetaUnion(string | Beta $beta)
+    {
+    }
+
+    public static function withBetaUnionInverse(Beta | string $beta)
+    {
+    }
+
+    public static function withBetaAndQuxUnion(Beta | QuxInterface $betaOrQux)
+    {
+    }
+
+    public static function withQuxAndBetaUnion(QuxInterface | Beta $betaOrQux)
+    {
+    }
+}
diff --git a/tests/framework/di/stubs/Variadic.php b/tests/framework/di/stubs/Variadic.php
index e822c96782f..b20a02f6c39 100644
--- a/tests/framework/di/stubs/Variadic.php
+++ b/tests/framework/di/stubs/Variadic.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\di\stubs;
diff --git a/tests/framework/di/testContainerWithVariadicCallable.php b/tests/framework/di/testContainerWithVariadicCallable.php
index c6fd0c8a440..3095f197409 100644
--- a/tests/framework/di/testContainerWithVariadicCallable.php
+++ b/tests/framework/di/testContainerWithVariadicCallable.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\di\Container;
diff --git a/tests/framework/filters/AccessRuleTest.php b/tests/framework/filters/AccessRuleTest.php
index c30cf5de05b..4c2ded2d2dd 100644
--- a/tests/framework/filters/AccessRuleTest.php
+++ b/tests/framework/filters/AccessRuleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
@@ -548,7 +548,7 @@ public function testMatchIPWildcard()
         $rule->allow = false;
         $this->assertNull($rule->allows($action, $user, $request));
     }
-    
+
     public function testMatchIPMask()
     {
         $action = $this->mockAction();
diff --git a/tests/framework/filters/AjaxFilterTest.php b/tests/framework/filters/AjaxFilterTest.php
index e34335ccbdf..c101f0c4f23 100644
--- a/tests/framework/filters/AjaxFilterTest.php
+++ b/tests/framework/filters/AjaxFilterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
diff --git a/tests/framework/filters/ContentNegotiatorTest.php b/tests/framework/filters/ContentNegotiatorTest.php
index e7a3792ae65..d52bb367c93 100644
--- a/tests/framework/filters/ContentNegotiatorTest.php
+++ b/tests/framework/filters/ContentNegotiatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
diff --git a/tests/framework/filters/CorsTest.php b/tests/framework/filters/CorsTest.php
index cfbf272d7f8..4874c2d8c65 100644
--- a/tests/framework/filters/CorsTest.php
+++ b/tests/framework/filters/CorsTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
diff --git a/tests/framework/filters/HostControlTest.php b/tests/framework/filters/HostControlTest.php
index 0cb1bc8d25d..39478fe00ed 100644
--- a/tests/framework/filters/HostControlTest.php
+++ b/tests/framework/filters/HostControlTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
diff --git a/tests/framework/filters/HttpCacheTest.php b/tests/framework/filters/HttpCacheTest.php
index fc0ceb27428..8f0f0da6054 100644
--- a/tests/framework/filters/HttpCacheTest.php
+++ b/tests/framework/filters/HttpCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
diff --git a/tests/framework/filters/PageCacheTest.php b/tests/framework/filters/PageCacheTest.php
index f13ce4890c0..0d69a1a76e9 100644
--- a/tests/framework/filters/PageCacheTest.php
+++ b/tests/framework/filters/PageCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
@@ -116,6 +116,16 @@ public function cacheTestCaseProvider()
                     'test-header-2' => false,
                 ],
             ]],
+            [[
+                'name' => 'originalNameHeaders',
+                'properties' => [
+                    'cacheHeaders' => ['Test-Header-1'],
+                ],
+                'headers' => [
+                    'Test-Header-1' => true,
+                    'Test-Header-2' => false,
+                ],
+            ]],
 
             // All together
             [[
@@ -233,10 +243,12 @@ public function testCache($testCase)
         }
         // Headers
         if (isset($testCase['headers'])) {
+            $headersExpected = Yii::$app->response->headers->toOriginalArray();
             foreach ($testCase['headers'] as $name => $expected) {
                 $this->assertSame($expected, Yii::$app->response->headers->has($name), $testCase['name']);
                 if ($expected) {
                     $this->assertSame($headers[$name], Yii::$app->response->headers->get($name), $testCase['name']);
+                    $this->assertArrayHasKey($name, $headersExpected);
                 }
             }
         }
diff --git a/tests/framework/filters/RateLimiterTest.php b/tests/framework/filters/RateLimiterTest.php
index 0b44eb2edb9..1bbaad6e299 100644
--- a/tests/framework/filters/RateLimiterTest.php
+++ b/tests/framework/filters/RateLimiterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters;
diff --git a/tests/framework/filters/auth/AuthMethodTest.php b/tests/framework/filters/auth/AuthMethodTest.php
index c55293b0e30..beea7740c19 100644
--- a/tests/framework/filters/auth/AuthMethodTest.php
+++ b/tests/framework/filters/auth/AuthMethodTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\auth;
diff --git a/tests/framework/filters/auth/AuthTest.php b/tests/framework/filters/auth/AuthTest.php
index b0dbe20dcbf..102d215064e 100644
--- a/tests/framework/filters/auth/AuthTest.php
+++ b/tests/framework/filters/auth/AuthTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\auth;
diff --git a/tests/framework/filters/auth/BasicAuthTest.php b/tests/framework/filters/auth/BasicAuthTest.php
index f5d552493e5..9de3a523218 100644
--- a/tests/framework/filters/auth/BasicAuthTest.php
+++ b/tests/framework/filters/auth/BasicAuthTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\auth;
@@ -78,7 +78,7 @@ public function testHttpBasicAuthCustom($token, $login)
         $filter = [
             'class' => HttpBasicAuth::className(),
             'auth' => function ($username, $password) {
-                if (preg_match('/\d$/', $username)) {
+                if (preg_match('/\d$/', (string)$username)) {
                     return UserIdentity::findIdentity($username);
                 }
 
diff --git a/tests/framework/filters/auth/CompositeAuthTest.php b/tests/framework/filters/auth/CompositeAuthTest.php
index 77c43207664..9476d9f9911 100644
--- a/tests/framework/filters/auth/CompositeAuthTest.php
+++ b/tests/framework/filters/auth/CompositeAuthTest.php
@@ -1,27 +1,47 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\auth;
 
 use Yii;
-use yii\filters\auth\AuthMethod;
 use yii\filters\auth\CompositeAuth;
 use yii\filters\auth\HttpBearerAuth;
+use yii\filters\auth\HttpHeaderAuth;
 use yii\rest\Controller;
 use yiiunit\framework\web\UserIdentity;
 
 /**
  * @author Ezekiel Fernandez <ezekiel_p_fernandez@yahoo.com>
  */
-class TestAuth extends AuthMethod
+class TestAuth extends HttpHeaderAuth
 {
     public function authenticate($user, $request, $response)
     {
-        return $user;
+        $authHeader = $request->getHeaders()->get($this->header);
+
+        if ($authHeader !== null) {
+            if ($this->pattern !== null) {
+                if (preg_match($this->pattern, $authHeader, $matches)) {
+                    $authHeader = $matches[1];
+                } else {
+                    return null;
+                }
+            }
+
+            $identity = \yiiunit\framework\filters\stubs\UserIdentity::findIdentity($authHeader);
+            if ($identity === null) {
+                $this->challenge($response);
+                $this->handleFailure($response);
+            }
+
+            return $identity;
+        }
+
+        return null;
     }
 }
 
@@ -29,6 +49,8 @@ class TestController extends Controller
 {
     public $authMethods = [];
 
+    public $optional = [];
+
     public function actionA()
     {
         return 'success';
@@ -72,6 +94,7 @@ public function behaviors()
                 'authMethods' => $this->authMethods ?: [
                     TestAuth::className(),
                 ],
+                'optional' => $this->optional
             ],
         ];
     }
@@ -106,6 +129,7 @@ protected function setUp()
     public function testCallingRunWithCompleteRoute()
     {
         /** @var TestController $controller */
+        Yii::$app->request->headers->set('X-Api-Key', 'user1');
         $controller = Yii::$app->createController('test')[0];
         $this->assertEquals('success', $controller->run('test/d'));
     }
@@ -116,6 +140,7 @@ public function testCallingRunWithCompleteRoute()
     public function testRunAction()
     {
         /** @var TestController $controller */
+        Yii::$app->request->headers->set('X-Api-Key', 'user1');
         $controller = Yii::$app->createController('test')[0];
         $this->assertEquals('success', $controller->run('b'));
     }
@@ -123,22 +148,123 @@ public function testRunAction()
     public function testRunButWithActionIdOnly()
     {
         /** @var TestController $controller */
+        Yii::$app->request->headers->set('X-Api-Key', 'user1');
         $controller = Yii::$app->createController('test')[0];
         $this->assertEquals('success', $controller->run('c'));
     }
 
-    public function testCompositeAuth()
+    public function testRunWithWrongToken()
+    {
+        /** @var TestController $controller */
+        Yii::$app->request->headers->set('X-Api-Key', 'wrong-user');
+        $controller = Yii::$app->createController('test')[0];
+        $this->expectException('yii\web\UnauthorizedHttpException');
+        $controller->run('a');
+    }
+
+    public function testRunWithoutAuthHeader()
+    {
+        /** @var TestController $controller */
+        $controller = Yii::$app->createController('test')[0];
+        $this->expectException('yii\web\UnauthorizedHttpException');
+        $controller->run('a');
+    }
+
+    public function testRunWithOptionalAction()
     {
-        Yii::$app->request->headers->set('Authorization', base64_encode("foo:bar"));
-        /** @var TestAuthController $controller */
+        /** @var TestController $controller */
         $controller = Yii::$app->createController('test')[0];
-        $controller->authMethods = [
-            HttpBearerAuth::className(),
-            TestAuth::className(),
+        $controller->optional = ['a'];
+        $this->assertEquals('success', $controller->run('a'));
+    }
+
+    public function compositeAuthDataProvider()
+    {
+        return [
+            //base usage
+            [
+                [
+                    HttpBearerAuth::className(),
+                    TestAuth::className(),
+                ],
+                'b',
+                true
+            ],
+            //empty auth methods
+            [
+                [],
+                'b',
+                true
+            ],
+            //only "a", run "b"
+            [
+                [
+                    HttpBearerAuth::className(),
+                    [
+                        'class' => TestAuth::className(),
+                        'only' => ['a']
+                    ],
+                ],
+                'b',
+                false
+            ],
+            //only "a", run "a"
+            [
+                [
+                    HttpBearerAuth::className(),
+                    [
+                        'class' => TestAuth::className(),
+                        'only' => ['a']
+                    ],
+                ],
+                'a',
+                true
+            ],
+            //except "b", run "a"
+            [
+                [
+                    HttpBearerAuth::className(),
+                    [
+                        'class' => TestAuth::className(),
+                        'except' => ['b']
+                    ],
+                ],
+                'a',
+                true
+            ],
+            //except "b", run "b"
+            [
+                [
+                    HttpBearerAuth::className(),
+                    [
+                        'class' => TestAuth::className(),
+                        'except' => ['b']
+                    ],
+                ],
+                'b',
+                false
+            ]
         ];
-        try {
-            $this->assertEquals('success', $controller->run('b'));
-        } catch (UnauthorizedHttpException $e) {
+    }
+
+    /**
+     * @param array $authMethods
+     * @param string $actionId
+     * @param bool $expectedAuth
+     *
+     * @dataProvider compositeAuthDataProvider
+     */
+    public function testCompositeAuth($authMethods, $actionId, $expectedAuth)
+    {
+        Yii::$app->request->headers->set('X-Api-Key', 'user1');
+        /** @var TestController $controller */
+        $controller = Yii::$app->createController('test')[0];
+        $controller->authMethods = $authMethods;
+        if( $expectedAuth)
+            $this->assertEquals('success', $controller->run($actionId));
+        else {
+            $this->expectException('yii\web\UnauthorizedHttpException');
+            $controller->run($actionId);
         }
     }
 }
diff --git a/tests/framework/filters/stubs/ExposedLogger.php b/tests/framework/filters/stubs/ExposedLogger.php
index 951ae55a115..28d292686f1 100644
--- a/tests/framework/filters/stubs/ExposedLogger.php
+++ b/tests/framework/filters/stubs/ExposedLogger.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\stubs;
diff --git a/tests/framework/filters/stubs/MockAuthManager.php b/tests/framework/filters/stubs/MockAuthManager.php
index bcf2cc0faa6..62dcd6a09ef 100644
--- a/tests/framework/filters/stubs/MockAuthManager.php
+++ b/tests/framework/filters/stubs/MockAuthManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\stubs;
diff --git a/tests/framework/filters/stubs/RateLimit.php b/tests/framework/filters/stubs/RateLimit.php
index 59ec0229707..e00e733af1f 100644
--- a/tests/framework/filters/stubs/RateLimit.php
+++ b/tests/framework/filters/stubs/RateLimit.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\stubs;
diff --git a/tests/framework/filters/stubs/UserIdentity.php b/tests/framework/filters/stubs/UserIdentity.php
index f0556a5451e..74aeb1926cd 100644
--- a/tests/framework/filters/stubs/UserIdentity.php
+++ b/tests/framework/filters/stubs/UserIdentity.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\filters\stubs;
diff --git a/tests/framework/grid/ActionColumnTest.php b/tests/framework/grid/ActionColumnTest.php
index 6d679a64ca5..7b15414d43c 100644
--- a/tests/framework/grid/ActionColumnTest.php
+++ b/tests/framework/grid/ActionColumnTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\grid;
diff --git a/tests/framework/grid/CheckboxColumnTest.php b/tests/framework/grid/CheckboxColumnTest.php
index 273e870bbda..6a2442019c7 100644
--- a/tests/framework/grid/CheckboxColumnTest.php
+++ b/tests/framework/grid/CheckboxColumnTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\grid;
diff --git a/tests/framework/grid/DataColumnTest.php b/tests/framework/grid/DataColumnTest.php
index 487d15deb80..6642566d778 100644
--- a/tests/framework/grid/DataColumnTest.php
+++ b/tests/framework/grid/DataColumnTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\grid;
diff --git a/tests/framework/grid/GridViewTest.php b/tests/framework/grid/GridViewTest.php
index dc35f39dcb9..392aefbd0ba 100644
--- a/tests/framework/grid/GridViewTest.php
+++ b/tests/framework/grid/GridViewTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\grid;
diff --git a/tests/framework/grid/RadiobuttonColumnTest.php b/tests/framework/grid/RadiobuttonColumnTest.php
index b0f27111a7e..51292d3d2ce 100644
--- a/tests/framework/grid/RadiobuttonColumnTest.php
+++ b/tests/framework/grid/RadiobuttonColumnTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\grid;
diff --git a/tests/framework/helpers/ArrayHelperTest.php b/tests/framework/helpers/ArrayHelperTest.php
index 614d074af78..063eeafcaf6 100644
--- a/tests/framework/helpers/ArrayHelperTest.php
+++ b/tests/framework/helpers/ArrayHelperTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
@@ -1185,29 +1185,35 @@ public function testHtmlDecode()
             3 => 'blank',
             [
                 '<>' => 'a&lt;&gt;b',
+                '&lt;a&gt;' => '&lt;a href=&quot;index.php?a=1&amp;b=2&quot;&gt;link&lt;/a&gt;',
                 '23' => true,
             ],
         ];
-        $this->assertEquals([
+
+        $expected = [
             'abc' => '123',
             '&lt;' => '>',
             'cde' => false,
             3 => 'blank',
             [
                 '<>' => 'a<>b',
+                '&lt;a&gt;' => '<a href="index.php?a=1&b=2">link</a>',
                 '23' => true,
             ],
-        ], ArrayHelper::htmlDecode($array));
-        $this->assertEquals([
+        ];
+        $this->assertEquals($expected, ArrayHelper::htmlDecode($array));
+        $expected = [
             'abc' => '123',
             '<' => '>',
             'cde' => false,
             3 => 'blank',
             [
                 '<>' => 'a<>b',
+                '<a>' => '<a href="index.php?a=1&b=2">link</a>',
                 '23' => true,
             ],
-        ], ArrayHelper::htmlDecode($array, false));
+        ];
+        $this->assertEquals($expected, ArrayHelper::htmlDecode($array, false));
     }
 
     public function testIsIn()
@@ -1436,6 +1442,72 @@ public function testArrayAccessWithMagicProperty()
         $this->assertEquals(42, ArrayHelper::getValue($model, 'magic'));
         $this->assertEquals('ta-da', ArrayHelper::getValue($model, 'moreMagic'));
     }
+
+    /**
+     * @dataProvider dataProviderRecursiveSort
+     *
+     * @return void
+     */
+    public function testRecursiveSort($expected_result, $input_array)
+    {
+        $actual = ArrayHelper::recursiveSort($input_array);
+        $this->assertEquals($expected_result, $actual);
+    }
+
+    /**
+     * Data provider for [[testRecursiveSort()]].
+     * @return array test data
+     */
+    public function dataProviderRecursiveSort()
+    {
+        return [
+            //Normal index array
+            [
+                [1, 2, 3, 4],
+                [4, 1, 3, 2]
+            ],
+            //Normal associative array
+            [
+                ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4],
+                ['b' => 2, 'a' => 1, 'd' => 4, 'c' => 3],
+            ],
+            //Normal index array
+            [
+                [1, 2, 3, 4],
+                [4, 1, 3, 2]
+            ],
+            //Multidimensional associative array
+            [
+                [
+                    'a' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4],
+                    'b' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4],
+                    'c' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4],
+                    'd' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4],
+                ],
+                [
+                    'b' => ['a' => 1, 'd' => 4, 'b' => 2, 'c' => 3],
+                    'd' => ['b' => 2, 'c' => 3, 'a' => 1, 'd' => 4],
+                    'c' => ['c' => 3, 'a' => 1, 'd' => 4, 'b' => 2],
+                    'a' => ['d' => 4, 'b' => 2, 'c' => 3, 'a' => 1],
+                ],
+            ],
+            //Multidimensional associative array
+            [
+                [
+                    'a' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4]],
+                    'b' => ['a' => 1, 'b' => 2, 'c' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4], 'd' => 4],
+                    'c' => ['a' => 1, 'b' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4], 'c' => 3, 'd' => 4],
+                    'd' => ['a' => ['a' => 1, 'b' => 2, 'c' => 3, 'd' => 4], 'b' => 2, 'c' => 3, 'd' => 4],
+                ],
+                [
+                    'b' => ['a' => 1, 'd' => 4, 'b' => 2, 'c' => ['b' => 2, 'c' => 3, 'a' => 1, 'd' => 4]],
+                    'd' => ['b' => 2, 'c' => 3, 'a' => ['a' => 1, 'd' => 4, 'b' => 2, 'c' => 3], 'd' => 4],
+                    'c' => ['c' => 3, 'a' => 1, 'd' => 4, 'b' => ['c' => 3, 'a' => 1, 'd' => 4, 'b' => 2]],
+                    'a' => ['d' => ['d' => 4, 'b' => 2, 'c' => 3, 'a' => 1], 'b' => 2, 'c' => 3, 'a' => 1],
+                ]
+            ],
+        ];
+    }
 }
 
 class Post1
@@ -1477,6 +1549,7 @@ public function __construct($container)
         $this->container = $container;
     }
 
+    #[\ReturnTypeWillChange]
     public function offsetSet($offset, $value)
     {
         if (is_null($offset)) {
@@ -1486,16 +1559,19 @@ public function offsetSet($offset, $value)
         }
     }
 
+    #[\ReturnTypeWillChange]
     public function offsetExists($offset)
     {
         return array_key_exists($offset, $this->container);
     }
 
+    #[\ReturnTypeWillChange]
     public function offsetUnset($offset)
     {
         unset($this->container[$offset]);
     }
 
+    #[\ReturnTypeWillChange]
     public function offsetGet($offset)
     {
         return $this->offsetExists($offset) ? $this->container[$offset] : null;
@@ -1519,26 +1595,31 @@ protected function getContainerKey($keyIndex)
         return array_key_exists($keyIndex, $keys) ? $keys[$keyIndex] : false;
     }
 
+    #[\ReturnTypeWillChange]
     public function rewind()
     {
         $this->position = 0;
     }
 
+    #[\ReturnTypeWillChange]
     public function current()
     {
         return $this->offsetGet($this->getContainerKey($this->position));
     }
 
+    #[\ReturnTypeWillChange]
     public function key()
     {
         return $this->getContainerKey($this->position);
     }
 
+    #[\ReturnTypeWillChange]
     public function next()
     {
         ++$this->position;
     }
 
+    #[\ReturnTypeWillChange]
     public function valid()
     {
         $key = $this->getContainerKey($this->position);
diff --git a/tests/framework/helpers/ConsoleStub.php b/tests/framework/helpers/ConsoleStub.php
index 0c743158c7d..7b09f1ba4a7 100644
--- a/tests/framework/helpers/ConsoleStub.php
+++ b/tests/framework/helpers/ConsoleStub.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/ConsoleTest.php b/tests/framework/helpers/ConsoleTest.php
index 7db7af585b3..b729e266910 100644
--- a/tests/framework/helpers/ConsoleTest.php
+++ b/tests/framework/helpers/ConsoleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/FallbackInflector.php b/tests/framework/helpers/FallbackInflector.php
index aacd8a53f07..27cd226c0be 100644
--- a/tests/framework/helpers/FallbackInflector.php
+++ b/tests/framework/helpers/FallbackInflector.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/FileHelperTest.php b/tests/framework/helpers/FileHelperTest.php
index 09da3d29606..df33c8c1801 100644
--- a/tests/framework/helpers/FileHelperTest.php
+++ b/tests/framework/helpers/FileHelperTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 use yii\helpers\FileHelper;
@@ -708,7 +708,7 @@ public function testGetMimeType()
         file_put_contents($file, 'some text');
         $this->assertEquals('text/plain', FileHelper::getMimeType($file));
 
-        // see http://stackoverflow.com/questions/477816/what-is-the-correct-json-content-type
+        // see https://stackoverflow.com/questions/477816/what-is-the-correct-json-content-type
         // JSON/JSONP should not use text/plain - see http://jibbering.com/blog/?p=514
         // with "fileinfo" extension enabled, returned MIME is not quite correctly "text/plain"
         // without "fileinfo" it falls back to getMimeTypeByExtension() and returns application/json
@@ -717,6 +717,24 @@ public function testGetMimeType()
         $this->assertTrue(in_array(FileHelper::getMimeType($file), ['application/json', 'text/plain']));
     }
 
+    public function testGetUploadedImageMimeTypes()
+    {
+        $ds = DIRECTORY_SEPARATOR;
+        $phpunitPath = Yii::getAlias('@yiiunit');
+        $runtimeLocation = Yii::getAlias('@yiiunit/runtime');
+        $resourceSourceLocation = "{$phpunitPath}{$ds}framework{$ds}validators{$ds}data{$ds}mimeType";
+
+        $pngFile = "{$runtimeLocation}{$ds}php1234";
+        copy("{$resourceSourceLocation}{$ds}test.png", $pngFile);
+
+        $this->assertEquals('image/png', FileHelper::getMimeType($pngFile));
+
+        $jpgFile = "{$runtimeLocation}{$ds}php4567";
+        copy("{$resourceSourceLocation}{$ds}test.jpg", $jpgFile);
+
+        $this->assertEquals('image/jpeg', FileHelper::getMimeType($jpgFile));
+    }
+
     public function testNormalizePath()
     {
         $ds = DIRECTORY_SEPARATOR;
diff --git a/tests/framework/helpers/FormatConverterTest.php b/tests/framework/helpers/FormatConverterTest.php
index ecd2d706247..3dffe4e0823 100644
--- a/tests/framework/helpers/FormatConverterTest.php
+++ b/tests/framework/helpers/FormatConverterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/HtmlTest.php b/tests/framework/helpers/HtmlTest.php
index 5b2c9de0090..91cc82f9e4a 100644
--- a/tests/framework/helpers/HtmlTest.php
+++ b/tests/framework/helpers/HtmlTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
@@ -775,6 +775,14 @@ public function testCheckboxList()
 <label><input type="checkbox" name="test[]" value="1.10"> 1.10</label></div>
 EOD;
         $this->assertEqualsWithoutLE($expected, Html::checkboxList('test', ['1.1'], ['1' => '1', '1.1' => '1.1', '1.10' => '1.10'], ['strict' => true]));
+        $this->assertEqualsWithoutLE($expected, Html::checkboxList('test', [1.1], ['1' => '1', '1.1' => '1.1', '1.10' => '1.10'], ['strict' => true]));
+
+        $expected = <<<'EOD'
+<div><label><input type="checkbox" name="test[]" value="1"> 1</label>
+<label><input type="checkbox" name="test[]" value="1.1" checked> 1.1</label>
+<label><input type="checkbox" name="test[]" value="1.10" checked> 1.10</label></div>
+EOD;
+        $this->assertEqualsWithoutLE($expected, Html::checkboxList('test', [1.1], ['1' => '1', '1.1' => '1.1', '1.10' => '1.10']));
     }
 
     public function testRadioListWithArrayExpression()
@@ -923,6 +931,14 @@ public function testRadioList()
 <label><input type="radio" name="test" value="1.10"> 1.10</label></div>
 EOD;
         $this->assertEqualsWithoutLE($expected, Html::radioList('test', ['1.1'], ['1' => '1', '1.1' => '1.1', '1.10' => '1.10'], ['strict' => true]));
+        $this->assertEqualsWithoutLE($expected, Html::radioList('test', [1.1], ['1' => '1', '1.1' => '1.1', '1.10' => '1.10'], ['strict' => true]));
+
+        $expected = <<<'EOD'
+<div><label><input type="radio" name="test" value="1"> 1</label>
+<label><input type="radio" name="test" value="1.1" checked> 1.1</label>
+<label><input type="radio" name="test" value="1.10" checked> 1.10</label></div>
+EOD;
+        $this->assertEqualsWithoutLE($expected, Html::radioList('test', ['1.1'], ['1' => '1', '1.1' => '1.1', '1.10' => '1.10']));
     }
 
     public function testUl()
@@ -1069,6 +1085,15 @@ public function testRenderOptions()
         $data = ['1' => '1', '1.1' => '1.1', '1.10' => '1.10'];
         $attributes = ['strict' => true];
         $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions(['1.1'], $data, $attributes));
+        $attributes = ['strict' => true];
+        $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions([1.1], $data, $attributes));
+
+        $expected = <<<'EOD'
+<option value="1">1</option>
+<option value="1.1" selected>1.1</option>
+<option value="1.10" selected>1.10</option>
+EOD;
+        $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions([1.1], $data));
 
         $expected = <<<'EOD'
 <option value="1">1</option>
@@ -1080,14 +1105,37 @@ public function testRenderOptions()
         $data = ['1' => '1', '1.1' => '1.1', 'group' => ['1.10' => '1.10']];
         $attributes = ['strict' => true];
         $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions(['1.10'], $data, $attributes));
+
+        $expected = <<<'EOD'
+<option value="">Please select</option>
+<option value="1">Yes</option>
+<option value="0" selected>No</option>
+EOD;
+        $data = [true => 'Yes', false => 'No'];
+        $attributes = ['prompt' => 'Please select'];
+        $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions(false, $data, $attributes));
+        //$attributes = ['prompt' => 'Please select'];
+        //$this->assertEqualsWithoutLE($expected, Html::renderSelectOptions([false], $data, $attributes));
+
+        $expected = <<<'EOD'
+<option value="">Please select</option>
+<option value="1">Yes</option>
+<option value="0">No</option>
+EOD;
+        $attributes = ['prompt' => 'Please select', 'strict' => true];
+        $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions(false, $data, $attributes));
+        $attributes = ['prompt' => 'Please select', 'strict' => true];
+        $this->assertEqualsWithoutLE($expected, Html::renderSelectOptions([false], $data, $attributes));
     }
 
-    public function testRenderAttributes()
+    public function testRenderTagAttributes()
     {
         $this->assertEquals('', Html::renderTagAttributes([]));
         $this->assertEquals(' name="test" value="1&lt;&gt;"', Html::renderTagAttributes(['name' => 'test', 'empty' => null, 'value' => '1<>']));
         $this->assertEquals(' checked disabled', Html::renderTagAttributes(['checked' => true, 'disabled' => true, 'hidden' => false]));
         $this->assertEquals(' class="first second"', Html::renderTagAttributes(['class' => ['first', 'second']]));
+        Html::$normalizeClassAttribute = true;
+        $this->assertEquals(' class="first second"', Html::renderTagAttributes(['class' => ['first second', 'first']]));
         $this->assertEquals('', Html::renderTagAttributes(['class' => []]));
         $this->assertEquals(' style="width: 100px; height: 200px;"', Html::renderTagAttributes(['style' => ['width' => '100px', 'height' => '200px']]));
         $this->assertEquals('', Html::renderTagAttributes(['style' => []]));
diff --git a/tests/framework/helpers/InflectorTest.php b/tests/framework/helpers/InflectorTest.php
index dd56d86e597..e9be96563b5 100644
--- a/tests/framework/helpers/InflectorTest.php
+++ b/tests/framework/helpers/InflectorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/JsonTest.php b/tests/framework/helpers/JsonTest.php
index 3db445f5af8..b2bcf0b86a3 100644
--- a/tests/framework/helpers/JsonTest.php
+++ b/tests/framework/helpers/JsonTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/MarkdownTest.php b/tests/framework/helpers/MarkdownTest.php
index 627f984c546..7514e142362 100644
--- a/tests/framework/helpers/MarkdownTest.php
+++ b/tests/framework/helpers/MarkdownTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/MimeTest.php b/tests/framework/helpers/MimeTest.php
index fd9d848c57c..0d4aa3792b2 100644
--- a/tests/framework/helpers/MimeTest.php
+++ b/tests/framework/helpers/MimeTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
@@ -18,6 +18,7 @@ public function testMimeAliases()
     {
         $this->assertSame(
             [
+                'text/rtf' => 'application/rtf',
                 'text/xml' => 'application/xml',
                 'image/svg' => 'image/svg+xml',
                 'image/x-bmp' => 'image/bmp',
@@ -37,8 +38,7 @@ public function testMimeAliases()
 
     public function testMimeTypes()
     {
-        $this->assertSame(
-            [
+        $coreMimeTypes = [
                 '3dml' => 'text/vnd.in3d.3dml',
                 '3ds' => 'image/x-3ds',
                 '3g2' => 'video/3gpp2',
@@ -385,6 +385,7 @@ public function testMimeTypes()
                 'jam' => 'application/vnd.jam',
                 'jar' => 'application/java-archive',
                 'java' => 'text/x-java-source',
+                'jfif' => 'image/jpeg',
                 'jisp' => 'application/vnd.jisp',
                 'jlt' => 'application/vnd.hp-jlyt',
                 'jnlp' => 'application/x-java-jnlp-file',
@@ -430,6 +431,7 @@ public function testMimeTypes()
                 'log' => 'text/plain',
                 'lostxml' => 'application/lost+xml',
                 'lrf' => 'application/octet-stream',
+                0 => 'application/vnd.lotus-1-2-3',
                 'lrm' => 'application/vnd.ms-lrm',
                 'ltf' => 'application/vnd.frogans.ltf',
                 'lvp' => 'audio/vnd.lucent.voice',
@@ -521,7 +523,6 @@ public function testMimeTypes()
                 'mseed' => 'application/vnd.fdsn.mseed',
                 'mseq' => 'application/vnd.mseq',
                 'msf' => 'application/vnd.epson.msf',
-                0 => 'application/vnd.lotus-1-2-3',
                 'msh' => 'model/mesh',
                 'msi' => 'application/x-msdownload',
                 'msl' => 'application/vnd.mobius.msl',
@@ -1024,7 +1025,13 @@ public function testMimeTypes()
                 'zir' => 'application/vnd.zul',
                 'zirz' => 'application/vnd.zul',
                 'zmm' => 'application/vnd.handheld-entertainment+xml',
-            ],
+            ];
+
+        if (PHP_VERSION_ID >= 80100) {
+            $coreMimeTypes = array_replace($coreMimeTypes, array('xz' => 'application/octet-stream'));
+        }
+
+        $this->assertSame($coreMimeTypes,
             require __DIR__ . '/../../../framework/helpers/mimeTypes.php'
         );
     }
diff --git a/tests/framework/helpers/ReplaceArrayValueTest.php b/tests/framework/helpers/ReplaceArrayValueTest.php
index d055483ac3d..458746276fa 100644
--- a/tests/framework/helpers/ReplaceArrayValueTest.php
+++ b/tests/framework/helpers/ReplaceArrayValueTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/StringHelperTest.php b/tests/framework/helpers/StringHelperTest.php
index 9ec2dc1f8d1..56acdb0c268 100644
--- a/tests/framework/helpers/StringHelperTest.php
+++ b/tests/framework/helpers/StringHelperTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/UnsetArrayValueTest.php b/tests/framework/helpers/UnsetArrayValueTest.php
index 6d3b943a29a..411b74ffa3c 100644
--- a/tests/framework/helpers/UnsetArrayValueTest.php
+++ b/tests/framework/helpers/UnsetArrayValueTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/UrlTest.php b/tests/framework/helpers/UrlTest.php
index e8c11858e15..0f2b6584eb9 100644
--- a/tests/framework/helpers/UrlTest.php
+++ b/tests/framework/helpers/UrlTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/helpers/VarDumperTest.php b/tests/framework/helpers/VarDumperTest.php
index 6bc818e3453..434876398a2 100644
--- a/tests/framework/helpers/VarDumperTest.php
+++ b/tests/framework/helpers/VarDumperTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\helpers;
diff --git a/tests/framework/i18n/DbMessageSourceTest.php b/tests/framework/i18n/DbMessageSourceTest.php
index 6e9b5363031..e295365ed86 100644
--- a/tests/framework/i18n/DbMessageSourceTest.php
+++ b/tests/framework/i18n/DbMessageSourceTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/FallbackMessageFormatterTest.php b/tests/framework/i18n/FallbackMessageFormatterTest.php
index b5b692cad92..5faab06d67e 100644
--- a/tests/framework/i18n/FallbackMessageFormatterTest.php
+++ b/tests/framework/i18n/FallbackMessageFormatterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/FormatterDateTest.php b/tests/framework/i18n/FormatterDateTest.php
index d6c8a58ff38..43fc1311cb9 100644
--- a/tests/framework/i18n/FormatterDateTest.php
+++ b/tests/framework/i18n/FormatterDateTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
@@ -250,7 +250,7 @@ public function testIntlDateRangeLow()
      */
     public function testDateRangeLow()
     {
-        // http://en.wikipedia.org/wiki/Year_2038_problem
+        // https://en.wikipedia.org/wiki/Year_2038_problem
         $this->assertSame('13-12-1901', $this->formatter->asDate('1901-12-13', 'dd-MM-yyyy'));
         $this->assertSame('12-12-1901', $this->formatter->asDate('1901-12-12', 'dd-MM-yyyy'));
 
@@ -270,7 +270,7 @@ public function testIntlDateRangeHigh()
      */
     public function testDateRangeHigh()
     {
-        // http://en.wikipedia.org/wiki/Year_2038_problem
+        // https://en.wikipedia.org/wiki/Year_2038_problem
         $this->assertSame('19-01-2038', $this->formatter->asDate('2038-01-19', 'dd-MM-yyyy'));
         $this->assertSame('20-01-2038', $this->formatter->asDate('2038-01-20', 'dd-MM-yyyy'));
 
@@ -346,7 +346,7 @@ public function testAsRelativeTime()
         $this->assertSame('12 years ago', $this->formatter->asRelativeTime($this->buildDateSubIntervals('2014-03-13', [$interval_12_years]), $dateNow));
 
         // Tricky 31-days month stuff
-        // See: http://www.gnu.org/software/tar/manual/html_section/Relative-items-in-date-strings.html
+        // See: https://www.gnu.org/software/tar/manual/html_section/Relative-items-in-date-strings.html
         $dateNow = new DateTime('2014-03-31');
         $dateThen = new DateTime('2014-03-03');
         $this->assertSame('28 days ago', $this->formatter->asRelativeTime($this->buildDateSubIntervals('2014-03-31', [$interval_1_month]), $dateNow));
@@ -401,7 +401,7 @@ public function testAsRelativeTime()
         $this->assertSame('in 12 years', $this->formatter->asRelativeTime($this->buildDateSubIntervals('2014-03-13', [$interval_12_years]), $dateNow));
 
         // Tricky 31-days month stuff
-        // See: http://www.gnu.org/software/tar/manual/html_section/Relative-items-in-date-strings.html
+        // See: https://www.gnu.org/software/tar/manual/html_section/Relative-items-in-date-strings.html
         $dateNow = new DateTime('2014-03-03');
         $dateThen = new DateTime('2014-03-31');
         $this->assertSame('in a month', $this->formatter->asRelativeTime($this->buildDateSubIntervals('2014-03-03', [$interval_1_month]), $dateNow));
@@ -789,7 +789,7 @@ public function testIntlTimeWithTimezoneInfo()
      *
      * it is a PHP bug: https://bugs.php.net/bug.php?id=45543
      * Fixed in this commit: https://github.com/php/php-src/commit/22dba2f5f3211efe6c3b9bb24734c811ca64c68c#diff-7b738accc3d60f74c259da18588ddc5dL2996
-     * Fixed in PHP >5.4.26 and >5.5.10. http://3v4l.org/mlZX7
+     * Fixed in PHP >5.4.26 and >5.5.10. https://3v4l.org/mlZX7
      *
      * @dataProvider provideTimezones
      * @param string $dtz
diff --git a/tests/framework/i18n/FormatterNumberTest.php b/tests/framework/i18n/FormatterNumberTest.php
index 635917ec690..234c9a5ea24 100755
--- a/tests/framework/i18n/FormatterNumberTest.php
+++ b/tests/framework/i18n/FormatterNumberTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/FormatterTest.php b/tests/framework/i18n/FormatterTest.php
index 300f2b7148f..a44b74aec60 100644
--- a/tests/framework/i18n/FormatterTest.php
+++ b/tests/framework/i18n/FormatterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
@@ -34,14 +34,15 @@ protected function setUp()
             'timeZone' => 'UTC',
             'language' => 'ru-RU',
         ]);
-        $this->formatter = new Formatter(['locale' => 'en-US']);
+        if (!isset($this->formatter)) {
+            $this->formatter = new Formatter(['locale' => 'en-US']);
+        }
     }
 
     protected function tearDown()
     {
         parent::tearDown();
         IntlTestHelper::resetIntlStatus();
-        $this->formatter = null;
     }
 
     public function testFormat()
diff --git a/tests/framework/i18n/GettextMessageSourceTest.php b/tests/framework/i18n/GettextMessageSourceTest.php
index 036682e71eb..24e678bbd55 100644
--- a/tests/framework/i18n/GettextMessageSourceTest.php
+++ b/tests/framework/i18n/GettextMessageSourceTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/GettextMoFileTest.php b/tests/framework/i18n/GettextMoFileTest.php
index fd3401f300a..a45e03fc619 100644
--- a/tests/framework/i18n/GettextMoFileTest.php
+++ b/tests/framework/i18n/GettextMoFileTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/GettextPoFileTest.php b/tests/framework/i18n/GettextPoFileTest.php
index d32f312f012..2c202fad235 100644
--- a/tests/framework/i18n/GettextPoFileTest.php
+++ b/tests/framework/i18n/GettextPoFileTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/I18NTest.php b/tests/framework/i18n/I18NTest.php
index 727dcbb3184..77a514acaf0 100644
--- a/tests/framework/i18n/I18NTest.php
+++ b/tests/framework/i18n/I18NTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
@@ -129,6 +129,8 @@ public function testSourceLanguageFallback()
         // target is a different language than source
         $this->assertEquals('Собака бегает быстро.', $i18n->translate('test', $msg, [], 'ru-RU'));
         $this->assertEquals('Собака бегает быстро.', $i18n->translate('test', $msg, [], 'ru'));
+        $this->assertEquals('The dog runs fast (en-150).', $i18n->translate('test', $msg, [], 'en-150'));
+        $this->assertEquals('The dog runs fast.', $i18n->translate('test', $msg, [], 'en'));
 
         // language is set to null
         $this->assertEquals($msg, $i18n->translate('test', $msg, [], null));
@@ -150,7 +152,7 @@ public function testTranslateParams2()
         $msg = 'His name is {name} and his speed is about {n, number} km/h.';
         $params = [
             'n' => 42,
-            'name' => 'DA VINCI', // http://petrix.com/dognames/d.html
+            'name' => 'DA VINCI', // https://petrix.com/dognames/d.html
         ];
         $this->assertEquals('His name is DA VINCI and his speed is about 42 km/h.', $this->i18n->translate('test', $msg, $params, 'en-US'));
         $this->assertEquals('Er heißt DA VINCI und ist 42 km/h schnell.', $this->i18n->translate('test', $msg, $params, 'de-DE'));
diff --git a/tests/framework/i18n/IntlTestHelper.php b/tests/framework/i18n/IntlTestHelper.php
index ab502140829..b90ee41d597 100644
--- a/tests/framework/i18n/IntlTestHelper.php
+++ b/tests/framework/i18n/IntlTestHelper.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 // override information about intl
diff --git a/tests/framework/i18n/LocaleTest.php b/tests/framework/i18n/LocaleTest.php
index b70f7ca3724..60d1951eca9 100644
--- a/tests/framework/i18n/LocaleTest.php
+++ b/tests/framework/i18n/LocaleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/i18n/MessageFormatterTest.php b/tests/framework/i18n/MessageFormatterTest.php
index 182d029a26c..164ed7e2fe1 100644
--- a/tests/framework/i18n/MessageFormatterTest.php
+++ b/tests/framework/i18n/MessageFormatterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\i18n;
diff --git a/tests/framework/log/ArrayTarget.php b/tests/framework/log/ArrayTarget.php
index e655573fc51..42ce194e8cb 100644
--- a/tests/framework/log/ArrayTarget.php
+++ b/tests/framework/log/ArrayTarget.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/DbTargetTest.php b/tests/framework/log/DbTargetTest.php
index 1a4f68d642b..9d118d21bc1 100644
--- a/tests/framework/log/DbTargetTest.php
+++ b/tests/framework/log/DbTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/DispatcherTest.php b/tests/framework/log/DispatcherTest.php
index 0f74cf6edc9..5cb35b52e3c 100644
--- a/tests/framework/log/DispatcherTest.php
+++ b/tests/framework/log/DispatcherTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log {
diff --git a/tests/framework/log/EmailTargetTest.php b/tests/framework/log/EmailTargetTest.php
index 9e5497b3756..7c3b4e008f2 100644
--- a/tests/framework/log/EmailTargetTest.php
+++ b/tests/framework/log/EmailTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/FileTargetTest.php b/tests/framework/log/FileTargetTest.php
index a0f6726b588..217a94af0f0 100644
--- a/tests/framework/log/FileTargetTest.php
+++ b/tests/framework/log/FileTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
@@ -25,14 +25,6 @@ protected function setUp()
         $this->mockApplication();
     }
 
-    public function booleanDataProvider()
-    {
-        return [
-            [true],
-            [false],
-        ];
-    }
-
     /**
      * Tests that log directory isn't created during init process
      * @see https://github.com/yiisoft/yii2/issues/15662
@@ -50,11 +42,7 @@ public function testInit()
         );
     }
 
-    /**
-     * @dataProvider booleanDataProvider
-     * @param bool $rotateByCopy
-     */
-    public function testRotate($rotateByCopy)
+    public function testRotate()
     {
         $logFile = Yii::getAlias('@yiiunit/runtime/log/filetargettest.log');
         FileHelper::removeDirectory(dirname($logFile));
@@ -71,7 +59,6 @@ public function testRotate($rotateByCopy)
                     'maxFileSize' => 1024, // 1 MB
                     'maxLogFiles' => 1, // one file for rotation and one normal log file
                     'logVars' => [],
-                    'rotateByCopy' => $rotateByCopy,
                 ],
             ],
         ]);
diff --git a/tests/framework/log/LoggerTest.php b/tests/framework/log/LoggerTest.php
index 1aa5587b16e..d5ffa83aca4 100644
--- a/tests/framework/log/LoggerTest.php
+++ b/tests/framework/log/LoggerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/MySQLTargetTest.php b/tests/framework/log/MySQLTargetTest.php
index fc7fd01d6a4..74a264ad7c1 100644
--- a/tests/framework/log/MySQLTargetTest.php
+++ b/tests/framework/log/MySQLTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/PgSQLTargetTest.php b/tests/framework/log/PgSQLTargetTest.php
index d33af5c5ac6..1eee4df9d3c 100644
--- a/tests/framework/log/PgSQLTargetTest.php
+++ b/tests/framework/log/PgSQLTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/SqliteTargetTest.php b/tests/framework/log/SqliteTargetTest.php
index 4084727a0e0..1a7ef072dcb 100644
--- a/tests/framework/log/SqliteTargetTest.php
+++ b/tests/framework/log/SqliteTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/log/SyslogTargetTest.php b/tests/framework/log/SyslogTargetTest.php
index b1591b72de8..3c9efd10aec 100644
--- a/tests/framework/log/SyslogTargetTest.php
+++ b/tests/framework/log/SyslogTargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\log {
diff --git a/tests/framework/log/TargetTest.php b/tests/framework/log/TargetTest.php
index c09757c83af..eace93aa3bf 100644
--- a/tests/framework/log/TargetTest.php
+++ b/tests/framework/log/TargetTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\log;
diff --git a/tests/framework/mail/BaseMailerTest.php b/tests/framework/mail/BaseMailerTest.php
index 09d12f7dcef..dc7e43deb0e 100644
--- a/tests/framework/mail/BaseMailerTest.php
+++ b/tests/framework/mail/BaseMailerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mail;
diff --git a/tests/framework/mail/BaseMessageTest.php b/tests/framework/mail/BaseMessageTest.php
index fbe9b57136b..9741f5d66d7 100644
--- a/tests/framework/mail/BaseMessageTest.php
+++ b/tests/framework/mail/BaseMessageTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mail;
diff --git a/tests/framework/models/JsonModel.php b/tests/framework/models/JsonModel.php
index f30dfce67f8..688f9623a43 100644
--- a/tests/framework/models/JsonModel.php
+++ b/tests/framework/models/JsonModel.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\models;
@@ -24,6 +24,7 @@ class JsonModel extends DynamicModel implements \JsonSerializable
     /**
      * @return array
      */
+    #[\ReturnTypeWillChange]
     public function jsonSerialize()
     {
         return $this->data;
diff --git a/tests/framework/mutex/FileMutexTest.php b/tests/framework/mutex/FileMutexTest.php
index 2c9d79061f3..48e3778c6ec 100644
--- a/tests/framework/mutex/FileMutexTest.php
+++ b/tests/framework/mutex/FileMutexTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mutex;
diff --git a/tests/framework/mutex/MutexTestTrait.php b/tests/framework/mutex/MutexTestTrait.php
index 1f8959f640d..20da6dac668 100644
--- a/tests/framework/mutex/MutexTestTrait.php
+++ b/tests/framework/mutex/MutexTestTrait.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mutex;
@@ -97,7 +97,7 @@ public function testMutexIsAcquired($mutexName)
         $this->assertFalse($mutexOne->isAcquired($mutexName));
         $this->assertTrue($mutexOne->acquire($mutexName));
         $this->assertTrue($mutexOne->isAcquired($mutexName));
-        
+
         $this->assertFalse($mutexTwo->isAcquired($mutexName));
 
         $this->assertTrue($mutexOne->release($mutexName));
@@ -110,9 +110,9 @@ public static function mutexDataProvider()
     {
         $utf = <<<'UTF'
 𝐘˛𝜄 ӏ𝕤 𝗮 𝔣𝖺𐑈𝝉, 𐑈ℯ𝔠ｕ𝒓𝗲, 𝝰𝞹𝒹 𝖊𝘧𝒇𝗶𝕔𝖎ⅇπτ Ｐ𝘏𝙿 𝖿г𝖺ｍ𝖾ｗσｒ𝐤.
-𝓕lе𝘅ӏᏏlе 𝞬𝖾𝘁 ϱ𝘳ɑ𝖌ｍ𝛼𝓉ͺ𝖼. 
-𝑊ﮭ𝚛𝛞𝓼 𝔯𝕚𝕘һ𝞃 σ𝚞𝞽 ०𝒇 𝐭𝙝ҽ 𝗯𝘰𝘹. 
-𝓗𝚊𝘀 𝓇𝖾𝙖𝐬ﻬ𝓃𝕒ᖯl𝔢 ꓒ𝘦քα𝗎l𝐭ꜱ. 
+𝓕lе𝘅ӏᏏlе 𝞬𝖾𝘁 ϱ𝘳ɑ𝖌ｍ𝛼𝓉ͺ𝖼.
+𝑊ﮭ𝚛𝛞𝓼 𝔯𝕚𝕘һ𝞃 σ𝚞𝞽 ०𝒇 𝐭𝙝ҽ 𝗯𝘰𝘹.
+𝓗𝚊𝘀 𝓇𝖾𝙖𝐬ﻬ𝓃𝕒ᖯl𝔢 ꓒ𝘦քα𝗎l𝐭ꜱ.
 😱
 UTF;
 
diff --git a/tests/framework/mutex/MysqlMutexTest.php b/tests/framework/mutex/MysqlMutexTest.php
index ae34d3781be..8ef4aa21d06 100644
--- a/tests/framework/mutex/MysqlMutexTest.php
+++ b/tests/framework/mutex/MysqlMutexTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mutex;
diff --git a/tests/framework/mutex/PgsqlMutexTest.php b/tests/framework/mutex/PgsqlMutexTest.php
index 4bdecb173e1..e8a3507cfd5 100644
--- a/tests/framework/mutex/PgsqlMutexTest.php
+++ b/tests/framework/mutex/PgsqlMutexTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mutex;
diff --git a/tests/framework/mutex/RetryAcquireTraitTest.php b/tests/framework/mutex/RetryAcquireTraitTest.php
index 5b80bfb53e0..a4adb417990 100644
--- a/tests/framework/mutex/RetryAcquireTraitTest.php
+++ b/tests/framework/mutex/RetryAcquireTraitTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mutex;
diff --git a/tests/framework/mutex/mocks/DumbMutex.php b/tests/framework/mutex/mocks/DumbMutex.php
index c7086d5517c..cd490223200 100644
--- a/tests/framework/mutex/mocks/DumbMutex.php
+++ b/tests/framework/mutex/mocks/DumbMutex.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\mutex\mocks;
diff --git a/tests/framework/rbac/ActionRule.php b/tests/framework/rbac/ActionRule.php
index 336052fc383..6a16b04985d 100644
--- a/tests/framework/rbac/ActionRule.php
+++ b/tests/framework/rbac/ActionRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/AuthorRule.php b/tests/framework/rbac/AuthorRule.php
index 88611a96bff..12e9ca6806c 100644
--- a/tests/framework/rbac/AuthorRule.php
+++ b/tests/framework/rbac/AuthorRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/DbManagerTestCase.php b/tests/framework/rbac/DbManagerTestCase.php
index 4cc792b66f1..b2828871ba7 100644
--- a/tests/framework/rbac/DbManagerTestCase.php
+++ b/tests/framework/rbac/DbManagerTestCase.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/ExposedPhpManager.php b/tests/framework/rbac/ExposedPhpManager.php
index ec92b106039..092307313a3 100644
--- a/tests/framework/rbac/ExposedPhpManager.php
+++ b/tests/framework/rbac/ExposedPhpManager.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/ManagerTestCase.php b/tests/framework/rbac/ManagerTestCase.php
index 1574eb1994a..e68378c541e 100644
--- a/tests/framework/rbac/ManagerTestCase.php
+++ b/tests/framework/rbac/ManagerTestCase.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/MySQLManagerCacheTest.php b/tests/framework/rbac/MySQLManagerCacheTest.php
index ec7d1c6735e..6bf268e3717 100644
--- a/tests/framework/rbac/MySQLManagerCacheTest.php
+++ b/tests/framework/rbac/MySQLManagerCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/MySQLManagerTest.php b/tests/framework/rbac/MySQLManagerTest.php
index f51b6561e2a..19fce3106fd 100644
--- a/tests/framework/rbac/MySQLManagerTest.php
+++ b/tests/framework/rbac/MySQLManagerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/PgSQLManagerCacheTest.php b/tests/framework/rbac/PgSQLManagerCacheTest.php
index b833a1ae413..d06c9e9875d 100644
--- a/tests/framework/rbac/PgSQLManagerCacheTest.php
+++ b/tests/framework/rbac/PgSQLManagerCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/PgSQLManagerTest.php b/tests/framework/rbac/PgSQLManagerTest.php
index 01e805deb24..34167d93e8a 100644
--- a/tests/framework/rbac/PgSQLManagerTest.php
+++ b/tests/framework/rbac/PgSQLManagerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/rbac/PhpManagerTest.php b/tests/framework/rbac/PhpManagerTest.php
index abb3a50ce32..38107d26a84 100644
--- a/tests/framework/rbac/PhpManagerTest.php
+++ b/tests/framework/rbac/PhpManagerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\rbac;
diff --git a/tests/framework/rbac/SqliteManagerTest.php b/tests/framework/rbac/SqliteManagerTest.php
index 43bc992d4c8..b684257c3e0 100644
--- a/tests/framework/rbac/SqliteManagerTest.php
+++ b/tests/framework/rbac/SqliteManagerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rbac;
diff --git a/tests/framework/requirements/YiiRequirementCheckerTest.php b/tests/framework/requirements/YiiRequirementCheckerTest.php
index 57b9b619d8e..46b131dadce 100644
--- a/tests/framework/requirements/YiiRequirementCheckerTest.php
+++ b/tests/framework/requirements/YiiRequirementCheckerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 require_once __DIR__ . '/../../../framework/requirements/YiiRequirementChecker.php';
diff --git a/tests/framework/rest/IndexActionTest.php b/tests/framework/rest/IndexActionTest.php
index 385749c13f7..ffbf6e98944 100644
--- a/tests/framework/rest/IndexActionTest.php
+++ b/tests/framework/rest/IndexActionTest.php
@@ -3,6 +3,9 @@
 namespace yiiunit\framework\rest;
 
 use Yii;
+use yii\data\ActiveDataProvider;
+use yii\data\Pagination;
+use yii\data\Sort;
 use yii\db\ActiveRecord;
 use yii\db\Query;
 use yii\rest\ActiveController;
@@ -63,6 +66,123 @@ public function testPrepareSearchQueryAttribute()
             $sql
         );
     }
+
+    /**
+     * @dataProvider dataProviderTestPrepareDataProviderWithPaginationAndSorting
+     *
+     * @param string $sql
+     * @param array $params
+     * @param string $expectedRawSql
+     */
+    public function testPrepareDataProviderWithPaginationAndSorting(
+        $pagination,
+        $sort,
+        $expectedPaginationPageSize = null,
+        $expectedPaginationDefaultPageSize = null,
+        $expectedSortOrders = [],
+        $expectedSortDefaultOrder = null
+    ) {
+        Yii::$app->getRequest()->setBodyParams([
+            'per-page' => 11,
+            'sort' => '-test-sort'
+        ]);
+
+        $controller = new RestController(
+            'rest',
+            new Module('rest'), [
+            'modelClass' => IndexActionModel::className(),
+            'actions' => [
+                'index' => [
+                    'class' => IndexAction::className(),
+                    'modelClass' => IndexActionModel::className(),
+                    'pagination' => $pagination,
+                    'sort' => $sort,
+                ],
+            ],
+        ]);
+
+        /** @var ActiveDataProvider $dataProvider */
+        $dataProvider = $controller->createAction('index')->runWithParams([]);
+        $actualPagination = $dataProvider->getPagination();
+        $actualSort = $dataProvider->getSort();
+
+        if ($pagination === false) {
+            $this->assertFalse($actualPagination);
+        } else {
+            $this->assertEquals($expectedPaginationPageSize, $actualPagination->pageSize);
+            $this->assertEquals($expectedPaginationDefaultPageSize, $actualPagination->defaultPageSize);
+        }
+
+        if ($sort === false) {
+            $this->assertFalse($actualSort);
+        } else {
+            $this->assertEquals($expectedSortOrders, $actualSort->getOrders());
+            $this->assertEquals($expectedSortDefaultOrder, $actualSort->defaultOrder);
+        }
+    }
+
+    /**
+     * Data provider for [[testPrepareDataProviderWithPaginationAndSorting()]].
+     * @return array test data
+     */
+    public function dataProviderTestPrepareDataProviderWithPaginationAndSorting()
+    {
+        return [
+            [ // Default config
+                [],
+                [],
+                11, // page size set as param in test
+                (new Pagination())->defaultPageSize,
+                [],
+                null
+            ],
+            [ // Default config
+                [],
+                [
+                    'attributes' => ['test-sort'],
+                ],
+                11, // page size set as param in test
+                (new Pagination())->defaultPageSize,
+                ['test-sort' => SORT_DESC], // test sort set as param in test
+                null
+            ],
+            [ // Config via array
+                [
+                    'pageSize' => 12, // Testing a fixed page size
+                    'defaultPageSize' => 991,
+                ],
+                [
+                    'attributes' => ['test-sort'],
+                    'defaultOrder' => [
+                        'created_at_1' => SORT_DESC,
+                    ],
+                ],
+                12,
+                991,
+                ['test-sort' => SORT_DESC], // test sort set as param in test
+                ['created_at_1' => SORT_DESC]
+            ],
+            [ // Config via objects
+                new Pagination([
+                    'defaultPageSize' => 992,
+                ]),
+                new Sort([
+                    'attributes' => ['created_at_2'],
+                    'defaultOrder' => [
+                        'created_at_2' => SORT_DESC,
+                    ],
+                ]),
+                11, // page size set as param in test
+                992,
+                ['created_at_2' => SORT_DESC], // test sort set as param in test is ignored
+                ['created_at_2' => SORT_DESC]
+            ],
+            [ // Disable pagination and sort
+                false,
+                false,
+            ]
+        ];
+    }
 }
 
 class RestController extends ActiveController
diff --git a/tests/framework/rest/SerializerTest.php b/tests/framework/rest/SerializerTest.php
index 6fd70974987..361aba38a91 100644
--- a/tests/framework/rest/SerializerTest.php
+++ b/tests/framework/rest/SerializerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rest;
@@ -540,6 +540,7 @@ public function extraFields()
         return static::$extraFields;
     }
 
+    #[\ReturnTypeWillChange]
     public function jsonSerialize()
     {
         return $this->getAttributes();
@@ -550,6 +551,7 @@ class TestModel4 implements \JsonSerializable
     public $field5 = 'test5';
     public $field6 = 'test6';
 
+    #[\ReturnTypeWillChange]
     public function jsonSerialize()
     {
         return [
diff --git a/tests/framework/rest/UrlRuleTest.php b/tests/framework/rest/UrlRuleTest.php
index 748cf2c7483..0228742ce18 100644
--- a/tests/framework/rest/UrlRuleTest.php
+++ b/tests/framework/rest/UrlRuleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\rest;
diff --git a/tests/framework/test/ActiveFixtureTest.php b/tests/framework/test/ActiveFixtureTest.php
index 67a26e256f9..ba52d0e286d 100644
--- a/tests/framework/test/ActiveFixtureTest.php
+++ b/tests/framework/test/ActiveFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\test;
diff --git a/tests/framework/test/ArrayFixtureTest.php b/tests/framework/test/ArrayFixtureTest.php
index e95a07db7a6..50ec62c3282 100644
--- a/tests/framework/test/ArrayFixtureTest.php
+++ b/tests/framework/test/ArrayFixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\test;
diff --git a/tests/framework/test/FixtureTest.php b/tests/framework/test/FixtureTest.php
index e5b66570f65..25c57bc5537 100644
--- a/tests/framework/test/FixtureTest.php
+++ b/tests/framework/test/FixtureTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\test;
diff --git a/tests/framework/test/custom/customer.php b/tests/framework/test/custom/customer.php
index 065bc3caaed..ac5876acba0 100644
--- a/tests/framework/test/custom/customer.php
+++ b/tests/framework/test/custom/customer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return [
diff --git a/tests/framework/test/data/array_fixture.php b/tests/framework/test/data/array_fixture.php
index 39cc75fb2b9..ed4a13d99cf 100644
--- a/tests/framework/test/data/array_fixture.php
+++ b/tests/framework/test/data/array_fixture.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return [
diff --git a/tests/framework/test/data/customer.php b/tests/framework/test/data/customer.php
index aeb1fcb3944..246792e50db 100644
--- a/tests/framework/test/data/customer.php
+++ b/tests/framework/test/data/customer.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return [
diff --git a/tests/framework/test/data/profile.php b/tests/framework/test/data/profile.php
index 42be0916164..51bf2057bbe 100644
--- a/tests/framework/test/data/profile.php
+++ b/tests/framework/test/data/profile.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 return [
diff --git a/tests/framework/validators/BooleanValidatorTest.php b/tests/framework/validators/BooleanValidatorTest.php
index 9835422ebf0..63331f6136f 100644
--- a/tests/framework/validators/BooleanValidatorTest.php
+++ b/tests/framework/validators/BooleanValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
@@ -85,7 +85,7 @@ public function testErrorMessage()
         $obj->attrD = [];
 
         $this->assertEquals(
-            'yii.validation.boolean(value, messages, {"trueValue":true,"falseValue":false,"message":"attrB must be either \"true\" or \"false\".","skipOnEmpty":1,"strict":1});',
+            'yii.validation.boolean(value, messages, {"trueValue":true,"falseValue":false,"message":"attrB must be either \u0022true\u0022 or \u0022false\u0022.","skipOnEmpty":1,"strict":1});',
             $validator->clientValidateAttribute($obj, 'attrB', new ViewStub())
         );
     }
diff --git a/tests/framework/validators/CompareValidatorTest.php b/tests/framework/validators/CompareValidatorTest.php
index a0740def208..cbb91c7d5e7 100644
--- a/tests/framework/validators/CompareValidatorTest.php
+++ b/tests/framework/validators/CompareValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/DateValidatorTest.php b/tests/framework/validators/DateValidatorTest.php
index 804c63ae7f3..fc3cd1ef3d6 100644
--- a/tests/framework/validators/DateValidatorTest.php
+++ b/tests/framework/validators/DateValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
@@ -1001,7 +1001,7 @@ public function testIntlValidateAttributeRangeOld()
     /**
      * Returns true if the version of ICU is old and has a bug that makes it
      * impossible to parse two digit years properly.
-     * @see http://bugs.icu-project.org/trac/ticket/9836
+     * @see https://unicode-org.atlassian.net/browse/ICU-9836
      * @return bool
      */
     private function checkOldIcuBug()
diff --git a/tests/framework/validators/DefaultValueValidatorTest.php b/tests/framework/validators/DefaultValueValidatorTest.php
index cdd68315b8b..9b25a1166ee 100644
--- a/tests/framework/validators/DefaultValueValidatorTest.php
+++ b/tests/framework/validators/DefaultValueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/EachValidatorTest.php b/tests/framework/validators/EachValidatorTest.php
index 52c43707ca8..8e32327b2f3 100644
--- a/tests/framework/validators/EachValidatorTest.php
+++ b/tests/framework/validators/EachValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/EmailValidatorTest.php b/tests/framework/validators/EmailValidatorTest.php
index 9aed158e5b9..7687b2bdc8f 100644
--- a/tests/framework/validators/EmailValidatorTest.php
+++ b/tests/framework/validators/EmailValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/ExistValidatorTest.php b/tests/framework/validators/ExistValidatorTest.php
index 45759d90167..259efe86e0d 100644
--- a/tests/framework/validators/ExistValidatorTest.php
+++ b/tests/framework/validators/ExistValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
@@ -10,6 +10,7 @@
 use yii\base\Exception;
 use yii\validators\ExistValidator;
 use yiiunit\data\ar\ActiveRecord;
+use yiiunit\data\ar\Customer;
 use yiiunit\data\ar\Order;
 use yiiunit\data\ar\OrderItem;
 use yiiunit\data\validators\models\ValidatorTestMainModel;
@@ -268,4 +269,31 @@ public function testForceMaster()
 
         ActiveRecord::$db = $this->getConnection();
     }
+
+    public function testSecondTargetAttributeWithError()
+    {
+        $validator = new ExistValidator(['targetAttribute' => ['email', 'name']]);
+        $customer = new Customer();
+        $customer->email = 'user11111@example.com';
+        $customer->name = 'user11111';
+
+        $validator->validateAttribute($customer, 'email');
+        $this->assertTrue($customer->hasErrors('email'));
+
+        $customer->clearErrors();
+
+        $customer->addError('name', 'error');
+        $validator->validateAttribute($customer, 'email');
+        $this->assertFalse($customer->hasErrors('email')); // validator should be skipped
+
+        $validator = new ExistValidator([
+            'targetAttribute' => ['email', 'name'],
+            'skipOnError' => false,
+        ]);
+
+        $customer->clearErrors();
+        $customer->addError('name', 'error');
+        $validator->validateAttribute($customer, 'email');
+        $this->assertTrue($customer->hasErrors('email')); // validator should not be skipped
+    }
 }
diff --git a/tests/framework/validators/FileValidatorTest.php b/tests/framework/validators/FileValidatorTest.php
index 2ce3c797ca3..f6af4ec6816 100644
--- a/tests/framework/validators/FileValidatorTest.php
+++ b/tests/framework/validators/FileValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
@@ -535,7 +535,7 @@ public function testValidateMimeTypeMaskInvalid($fileName, $mask)
 
     public function validMimeTypes()
     {
-        return array_filter([
+        $validMimeTypes = array_filter([
             ['test.svg', 'image/*', 'svg'],
             ['test.jpg', 'image/*', 'jpg'],
             ['test.png', 'image/*', 'png'],
@@ -545,6 +545,14 @@ public function validMimeTypes()
             ['test.odt', 'application/vnd*', 'odt'],
             ['test.tar.xz', 'application/x-xz', 'tar.xz'],
         ]);
+
+        if (PHP_VERSION_ID >= 80100) {
+            $v81_zx = ['test.tar.xz', 'application/octet-stream', 'tar.xz'];
+            array_pop($validMimeTypes);
+            $validMimeTypes[] = $v81_zx;
+        }
+
+        return $validMimeTypes;
     }
 
     public function invalidMimeTypes()
diff --git a/tests/framework/validators/FilterValidatorTest.php b/tests/framework/validators/FilterValidatorTest.php
index f0b25ab3648..06153d934a3 100644
--- a/tests/framework/validators/FilterValidatorTest.php
+++ b/tests/framework/validators/FilterValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/IpValidatorTest.php b/tests/framework/validators/IpValidatorTest.php
index 7d22c563323..a6a365ffb46 100644
--- a/tests/framework/validators/IpValidatorTest.php
+++ b/tests/framework/validators/IpValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/NumberValidatorTest.php b/tests/framework/validators/NumberValidatorTest.php
index f8f3b2f346d..82f643f83d5 100644
--- a/tests/framework/validators/NumberValidatorTest.php
+++ b/tests/framework/validators/NumberValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/RangeValidatorTest.php b/tests/framework/validators/RangeValidatorTest.php
index 7990dd49aec..d86e0224e2b 100644
--- a/tests/framework/validators/RangeValidatorTest.php
+++ b/tests/framework/validators/RangeValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/RegularExpressionValidatorTest.php b/tests/framework/validators/RegularExpressionValidatorTest.php
index 8c1939055ad..76166d45a01 100644
--- a/tests/framework/validators/RegularExpressionValidatorTest.php
+++ b/tests/framework/validators/RegularExpressionValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/RequiredValidatorTest.php b/tests/framework/validators/RequiredValidatorTest.php
index 1d4fde051d8..a45f3b10ef9 100644
--- a/tests/framework/validators/RequiredValidatorTest.php
+++ b/tests/framework/validators/RequiredValidatorTest.php
@@ -1,12 +1,13 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
 
+use yii\base\Model;
 use yii\validators\RequiredValidator;
 use yiiunit\data\validators\models\FakedValidationModel;
 use yiiunit\TestCase;
@@ -66,4 +67,33 @@ public function testValidateAttribute()
         $val->validateAttribute($m, 'attr_val');
         $this->assertFalse($m->hasErrors('attr_val'));
     }
+
+    public function testErrorClientMessage()
+    {
+        $validator = new RequiredValidator(['message' => '<strong>error</strong> for {attribute}']);
+
+        $obj = new ModelForReqValidator();
+
+        $this->assertEquals(
+            'yii.validation.required(value, messages, {"message":"\u003Cstrong\u003Eerror\u003C\/strong\u003E for \u003Cb\u003EAttr\u003C\/b\u003E"});',
+            $validator->clientValidateAttribute($obj, 'attr', new ViewStub())
+        );
+    }
+}
+
+class ModelForReqValidator extends Model
+{
+    public $attr;
+
+    public function rules()
+    {
+        return [
+            [['attr'], 'required'],
+        ];
+    }
+
+    public function attributeLabels()
+    {
+        return ['attr' => '<b>Attr</b>'];
+    }
 }
diff --git a/tests/framework/validators/StringValidatorTest.php b/tests/framework/validators/StringValidatorTest.php
index 42413fe78d6..bef0db0deb3 100644
--- a/tests/framework/validators/StringValidatorTest.php
+++ b/tests/framework/validators/StringValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/UniqueValidatorTest.php b/tests/framework/validators/UniqueValidatorTest.php
index fac59485d53..0c5149e5887 100644
--- a/tests/framework/validators/UniqueValidatorTest.php
+++ b/tests/framework/validators/UniqueValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
@@ -505,6 +505,33 @@ public function testForceMaster()
 
         ActiveRecord::$db = $this->getConnection();
     }
+
+    public function testSecondTargetAttributeWithError()
+    {
+        $validator = new UniqueValidator(['targetAttribute' => ['email', 'name']]);
+        $customer = new Customer();
+        $customer->email = 'user1@example.com';
+        $customer->name = 'user1';
+
+        $validator->validateAttribute($customer, 'email');
+        $this->assertTrue($customer->hasErrors('email'));
+
+        $customer->clearErrors();
+
+        $customer->addError('name', 'error');
+        $validator->validateAttribute($customer, 'email');
+        $this->assertFalse($customer->hasErrors('email')); // validator should be skipped
+
+        $validator = new UniqueValidator([
+            'targetAttribute' => ['email', 'name'],
+            'skipOnError' => false,
+        ]);
+
+        $customer->clearErrors();
+        $customer->addError('name', 'error');
+        $validator->validateAttribute($customer, 'email');
+        $this->assertTrue($customer->hasErrors('email')); // validator should not be skipped
+    }
 }
 
 class WithCustomer extends Customer {
diff --git a/tests/framework/validators/UrlValidatorTest.php b/tests/framework/validators/UrlValidatorTest.php
index 3243e8bf383..7872d9d21e9 100644
--- a/tests/framework/validators/UrlValidatorTest.php
+++ b/tests/framework/validators/UrlValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
diff --git a/tests/framework/validators/ValidatorTest.php b/tests/framework/validators/ValidatorTest.php
index a7b22e56937..3f3eb8c0dd0 100644
--- a/tests/framework/validators/ValidatorTest.php
+++ b/tests/framework/validators/ValidatorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\validators;
@@ -217,19 +217,20 @@ public function testValidateAttribute()
 
     public function testClientValidateAttribute()
     {
+        $view = new \yii\base\View();
         $val = new TestValidator();
         $this->assertNull(
-            $val->clientValidateAttribute($this->getTestModel(), 'attr_runMe1', [])
-        ); //todo pass a view instead of array
+            $val->clientValidateAttribute($this->getTestModel(), 'attr_runMe1', $view)
+        );
 
         // Access to validator in inline validation (https://github.com/yiisoft/yii2/issues/6242)
 
         $model = new FakedValidationModel();
         $val = Validator::createValidator('inlineVal', $model, ['val_attr_a'], ['params' => ['foo' => 'bar']]);
         $val->clientValidate = 'clientInlineVal';
-        $args = $val->clientValidateAttribute($model, 'val_attr_a', null);
+        $args = $val->clientValidateAttribute($model, 'val_attr_a', $view);
 
-        $this->assertCount(4, $args);
+        $this->assertCount(5, $args);
         $this->assertEquals('val_attr_a', $args[0]);
         $this->assertEquals(['foo' => 'bar'], $args[1]);
         $this->assertInstanceOf(InlineValidator::className(), $args[2]);
diff --git a/tests/framework/web/AssetBundleTest.php b/tests/framework/web/AssetBundleTest.php
index e1a0234293a..a0399d0aa85 100644
--- a/tests/framework/web/AssetBundleTest.php
+++ b/tests/framework/web/AssetBundleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/AssetConverterTest.php b/tests/framework/web/AssetConverterTest.php
index 49bcd3e789e..4b618bc81c0 100644
--- a/tests/framework/web/AssetConverterTest.php
+++ b/tests/framework/web/AssetConverterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/ControllerTest.php b/tests/framework/web/ControllerTest.php
index 2d9b92a072f..21680f08cc6 100644
--- a/tests/framework/web/ControllerTest.php
+++ b/tests/framework/web/ControllerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
@@ -80,7 +80,6 @@ public function testNullableInjectedActionParams()
                 ],
             ],
         ]));
-        $this->mockWebApplication(['controller' => $this->controller]);
 
         $injectionAction = new InlineAction('injection', $this->controller, 'actionNullableInjection');
         $params = [];
@@ -195,7 +194,6 @@ public function testInjectedActionParams()
                 ],
             ],
         ]));
-        $this->mockWebApplication(['controller' => $this->controller]);
 
         $injectionAction = new InlineAction('injection', $this->controller, 'actionInjection');
         $params = ['between' => 'test', 'after' => 'another', 'before' => 'test'];
diff --git a/tests/framework/web/ErrorActionTest.php b/tests/framework/web/ErrorActionTest.php
index 7b6c0fa6f27..73211650012 100644
--- a/tests/framework/web/ErrorActionTest.php
+++ b/tests/framework/web/ErrorActionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/ErrorHandlerTest.php b/tests/framework/web/ErrorHandlerTest.php
index 9fdd41fcb6d..1634c572d4a 100644
--- a/tests/framework/web/ErrorHandlerTest.php
+++ b/tests/framework/web/ErrorHandlerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/FakeController.php b/tests/framework/web/FakeController.php
index 572d169e5b9..0124456f3e6 100644
--- a/tests/framework/web/FakeController.php
+++ b/tests/framework/web/FakeController.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/FakePhp71Controller.php b/tests/framework/web/FakePhp71Controller.php
index 3aae2868b3d..d8aa0e406c5 100644
--- a/tests/framework/web/FakePhp71Controller.php
+++ b/tests/framework/web/FakePhp71Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/FakePhp7Controller.php b/tests/framework/web/FakePhp7Controller.php
index 5b3ae0b8269..4d267a85e15 100644
--- a/tests/framework/web/FakePhp7Controller.php
+++ b/tests/framework/web/FakePhp7Controller.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/FormatterTest.php b/tests/framework/web/FormatterTest.php
index 05cec3a7e39..e89e6dcf18c 100644
--- a/tests/framework/web/FormatterTest.php
+++ b/tests/framework/web/FormatterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/GroupUrlRuleTest.php b/tests/framework/web/GroupUrlRuleTest.php
index 6801ed01a4b..9bc8b26684d 100644
--- a/tests/framework/web/GroupUrlRuleTest.php
+++ b/tests/framework/web/GroupUrlRuleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
@@ -240,6 +240,21 @@ protected function getTestsForParseRequest()
                     ['create', false],
                 ],
             ],
+            [
+                'slash prefix',
+                [
+                    'prefix' => '/',
+                    'rules' => [
+                        'login' => 'user/login',
+                        'logout' => 'user/logout',
+                    ],
+                ],
+                [
+                    ['login', 'user/login'],
+                    ['logout', 'user/logout'],
+                    ['create', false],
+                ],
+            ],
             [
                 'prefix only',
                 [
diff --git a/tests/framework/web/HeaderCollectionTest.php b/tests/framework/web/HeaderCollectionTest.php
index 7fe9c889f54..5b967ab6e7c 100644
--- a/tests/framework/web/HeaderCollectionTest.php
+++ b/tests/framework/web/HeaderCollectionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
@@ -24,4 +24,92 @@ public function testFromArray()
         ]);
         $this->assertEquals($location, $headerCollection->get('Location'));
     }
+
+    public function testSetter()
+    {
+        $headerCollection = new HeaderCollection();
+
+        $this->assertSame('default', $headerCollection->get('X-Header', 'default'));
+        $this->assertFalse($headerCollection->has('X-Header'));
+
+        $headerCollection->set('X-Header', '1');
+        $this->assertTrue($headerCollection->has('X-Header'));
+        $this->assertTrue($headerCollection->offsetExists('X-Header'));
+        $this->assertSame('1', $headerCollection->get('X-Header'));
+        $this->assertSame(['1'], $headerCollection->get('X-Header', null, false));
+        $this->assertTrue($headerCollection->has('x-header'));
+        $this->assertSame('1', $headerCollection->get('x-header'));
+        $this->assertSame(['1'], $headerCollection->get('x-header', null, false));
+        $this->assertSame('1', $headerCollection->get('x-hEadER'));
+        $this->assertSame(['1'], $headerCollection->get('x-hEadER', null, false));
+        $this->assertSame(['x-header' => ['1']], $headerCollection->toArray());
+        $this->assertSame(['X-Header' => ['1']], $headerCollection->toOriginalArray());
+
+        $headerCollection->set('X-HEADER', '2');
+        $this->assertSame('2', $headerCollection->get('X-Header'));
+        $this->assertSame('2', $headerCollection->get('x-header'));
+        $this->assertSame('2', $headerCollection->get('x-hEadER'));
+        $this->assertSame(['x-header' => ['2']], $headerCollection->toArray());
+        $this->assertSame(['X-HEADER' => ['2']], $headerCollection->toOriginalArray());
+
+        $headerCollection->offsetSet('X-HEADER', '3');
+        $this->assertSame('3', $headerCollection->get('X-Header'));
+    }
+
+    public function testSetterDefault()
+    {
+        $headerCollection = new HeaderCollection();
+        $headerCollection->setDefault('X-Header', '1');
+        $this->assertSame(['1'], $headerCollection->get('X-Header', null, false));
+
+        $headerCollection->setDefault('X-Header', '2');
+        $this->assertSame(['1'], $headerCollection->get('X-Header', null, false));
+    }
+
+    public function testAdder()
+    {
+        $headerCollection = new HeaderCollection();
+        $headerCollection->add('X-Header', '1');
+        $this->assertSame('1', $headerCollection->get('X-Header'));
+        $this->assertSame(['1'], $headerCollection->get('X-Header', null, false));
+        $this->assertSame('1', $headerCollection->get('x-header'));
+        $this->assertSame(['1'], $headerCollection->get('x-header', null, false));
+        $this->assertSame('1', $headerCollection->get('x-hEadER'));
+        $this->assertSame(['1'], $headerCollection->get('x-hEadER', null, false));
+        $this->assertSame(['x-header' => ['1']], $headerCollection->toArray());
+        $this->assertSame(['X-Header' => ['1']], $headerCollection->toOriginalArray());
+
+        $headerCollection->add('X-HEADER', '2');
+        $this->assertSame('1', $headerCollection->get('X-Header'));
+        $this->assertSame('1', $headerCollection->get('x-header'));
+        $this->assertSame('1', $headerCollection->get('x-hEadER'));
+        $this->assertSame(['1', '2'], $headerCollection->get('x-header', null, false));
+        $this->assertSame(['x-header' => ['1', '2']], $headerCollection->toArray());
+        $this->assertSame(['X-Header' => ['1', '2']], $headerCollection->toOriginalArray());
+    }
+
+    public function testRemover()
+    {
+        $headerCollection = new HeaderCollection();
+        $headerCollection->add('X-Header', '1');
+        $this->assertSame(1, $headerCollection->count());
+        $this->assertSame(1, $headerCollection->getCount());
+        $headerCollection->remove('X-Header');
+        $this->assertSame(0, $headerCollection->count());
+
+        $headerCollection->add('X-Header', '1');
+        $this->assertSame(1, $headerCollection->count());
+        $headerCollection->remove('x-header');
+        $this->assertSame(0, $headerCollection->count());
+
+        $headerCollection->add('X-Header', '1');
+        $headerCollection->offsetUnset('X-HEADER');
+        $this->assertSame(0, $headerCollection->count());
+
+        $headerCollection->add('X-Header-1', '1');
+        $headerCollection->add('X-Header-2', '1');
+        $this->assertSame(2, $headerCollection->count());
+        $headerCollection->removeAll();
+        $this->assertSame(0, $headerCollection->count());
+    }
 }
diff --git a/tests/framework/web/JsonResponseFormatterTest.php b/tests/framework/web/JsonResponseFormatterTest.php
index 9fa248a0b66..c724bb1b68a 100644
--- a/tests/framework/web/JsonResponseFormatterTest.php
+++ b/tests/framework/web/JsonResponseFormatterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/MultipartFormDataParserTest.php b/tests/framework/web/MultipartFormDataParserTest.php
index 4447defec20..489a5ef9f59 100644
--- a/tests/framework/web/MultipartFormDataParserTest.php
+++ b/tests/framework/web/MultipartFormDataParserTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
@@ -219,7 +219,7 @@ public function testForce()
         $this->assertNotEmpty($_FILES['someFile']);
         $this->assertFalse(isset($_FILES['existingFile']));
     }
-    
+
     public function testParseUnicodeInFileName()
     {
         $unicodeName = 'х.jpg'; // this is Russian "х"
diff --git a/tests/framework/web/Post.php b/tests/framework/web/Post.php
index 61255097ba7..3422273db8b 100644
--- a/tests/framework/web/Post.php
+++ b/tests/framework/web/Post.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/RequestTest.php b/tests/framework/web/RequestTest.php
index 2891372ce79..fd4bcb021cc 100644
--- a/tests/framework/web/RequestTest.php
+++ b/tests/framework/web/RequestTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
@@ -1111,6 +1111,33 @@ public function testTrustedHostAndInjectedXForwardedFor($remoteAddress, $xForwar
         $this->assertSame($expectedUserIp, $request->getUserIP());
     }
 
+    public function trustedHostAndXForwardedPortDataProvider()
+    {
+        return [
+            'defaultPlain' => ['1.1.1.1', 80, null, null, 80],
+            'defaultSSL' => ['1.1.1.1', 443, null, null, 443],
+            'untrustedForwardedSSL' => ['1.1.1.1', 80, 443, ['10.0.0.0/8'], 80],
+            'untrustedForwardedPlain' => ['1.1.1.1', 443, 80, ['10.0.0.0/8'], 443],
+            'trustedForwardedSSL' => ['10.10.10.10', 80, 443, ['10.0.0.0/8'], 443],
+            'trustedForwardedPlain' => ['10.10.10.10', 443, 80, ['10.0.0.0/8'], 80],
+        ];
+    }
+
+    /**
+     * @dataProvider trustedHostAndXForwardedPortDataProvider
+     */
+    public function testTrustedHostAndXForwardedPort($remoteAddress, $requestPort, $xForwardedPort, $trustedHosts, $expectedPort)
+    {
+        $_SERVER['REMOTE_ADDR'] = $remoteAddress;
+        $_SERVER['SERVER_PORT'] = $requestPort;
+        $_SERVER['HTTP_X_FORWARDED_PORT'] = $xForwardedPort;
+        $params = [
+            'trustedHosts' => $trustedHosts,
+        ];
+        $request = new Request($params);
+        $this->assertSame($expectedPort, $request->getServerPort());
+    }
+
     /**
      * @testWith    ["POST", "GET", "POST"]
      *              ["POST", "OPTIONS", "POST"]
diff --git a/tests/framework/web/ResponseTest.php b/tests/framework/web/ResponseTest.php
index 60b71a6825c..12ee7ef2d4e 100644
--- a/tests/framework/web/ResponseTest.php
+++ b/tests/framework/web/ResponseTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
@@ -12,8 +12,8 @@
 use RuntimeException;
 use Yii;
 use yii\helpers\StringHelper;
+use yii\web\Cookie;
 use yii\web\HttpException;
-use yii\web\Request;
 use yii\web\Response;
 use yiiunit\framework\web\mocks\TestRequestComponent;
 
@@ -60,7 +60,7 @@ public function rightRanges()
      */
     public function testSendFileRanges($rangeHeader, $expectedHeader, $length, $expectedContent)
     {
-        $dataFile = \Yii::getAlias('@yiiunit/data/web/data.txt');
+        $dataFile = Yii::getAlias('@yiiunit/data/web/data.txt');
         $fullContent = file_get_contents($dataFile);
         $_SERVER['HTTP_RANGE'] = 'bytes=' . $rangeHeader;
         ob_start();
@@ -71,9 +71,12 @@ public function testSendFileRanges($rangeHeader, $expectedHeader, $length, $expe
         $this->assertEquals(206, $this->response->statusCode);
         $headers = $this->response->headers;
         $this->assertEquals('bytes', $headers->get('Accept-Ranges'));
-        $this->assertEquals('bytes ' . $expectedHeader . '/' . StringHelper::byteLength($fullContent), $headers->get('Content-Range'));
+        $this->assertEquals(
+            'bytes ' . $expectedHeader . '/' . StringHelper::byteLength($fullContent),
+            $headers->get('Content-Range')
+        );
         $this->assertEquals('text/plain', $headers->get('Content-Type'));
-        $this->assertEquals("$length", $headers->get('Content-Length'));
+        $this->assertEquals((string)$length, $headers->get('Content-Length'));
     }
 
     public function wrongRanges()
@@ -96,7 +99,7 @@ public function testSendFileWrongRanges($rangeHeader)
     {
         $this->expectException('yii\web\RangeNotSatisfiableHttpException');
 
-        $dataFile = \Yii::getAlias('@yiiunit/data/web/data.txt');
+        $dataFile = Yii::getAlias('@yiiunit/data/web/data.txt');
         $_SERVER['HTTP_RANGE'] = 'bytes=' . $rangeHeader;
         $this->response->sendFile($dataFile);
     }
@@ -112,9 +115,7 @@ protected function generateTestFileContent()
     public function testSendContentAsFile()
     {
         ob_start();
-        $this->response->sendContentAsFile('test', 'test.txt')->send([
-            'mimeType' => 'text/plain',
-        ]);
+        $this->response->sendContentAsFile('test', 'test.txt')->send();
         $content = ob_get_clean();
 
         static::assertEquals('test', $content);
@@ -128,18 +129,46 @@ public function testSendContentAsFile()
     public function testRedirect()
     {
         $_SERVER['REQUEST_URI'] = 'http://test-domain.com/';
-        $this->assertEquals($this->response->redirect('')->headers->get('location'), '/');
-        $this->assertEquals($this->response->redirect('http://some-external-domain.com')->headers->get('location'), 'http://some-external-domain.com');
-        $this->assertEquals($this->response->redirect('/')->headers->get('location'), '/');
-        $this->assertEquals($this->response->redirect('/something-relative')->headers->get('location'), '/something-relative');
-        $this->assertEquals($this->response->redirect(['/'])->headers->get('location'), '/index.php?r=');
-        $this->assertEquals($this->response->redirect(['view'])->headers->get('location'), '/index.php?r=view');
-        $this->assertEquals($this->response->redirect(['/controller'])->headers->get('location'), '/index.php?r=controller');
-        $this->assertEquals($this->response->redirect(['/controller/index'])->headers->get('location'), '/index.php?r=controller%2Findex');
-        $this->assertEquals($this->response->redirect(['//controller/index'])->headers->get('location'), '/index.php?r=controller%2Findex');
-        $this->assertEquals($this->response->redirect(['//controller/index', 'id' => 3])->headers->get('location'), '/index.php?r=controller%2Findex&id=3');
-        $this->assertEquals($this->response->redirect(['//controller/index', 'id_1' => 3, 'id_2' => 4])->headers->get('location'), '/index.php?r=controller%2Findex&id_1=3&id_2=4');
-        $this->assertEquals($this->response->redirect(['//controller/index', 'slug' => 'äöüß!"§$%&/()'])->headers->get('location'), '/index.php?r=controller%2Findex&slug=%C3%A4%C3%B6%C3%BC%C3%9F%21%22%C2%A7%24%25%26%2F%28%29');
+        $this->assertEquals('/', $this->response->redirect('')->headers->get('location'));
+        $this->assertFalse($this->response->redirect(null)->headers->get('location'));
+        $this->assertEquals(
+            'http://some-external-domain.com',
+            $this->response->redirect('http://some-external-domain.com')->headers->get('location')
+        );
+        $this->assertEquals('/', $this->response->redirect('/')->headers->get('location'));
+        $this->assertEquals(
+            '/something-relative',
+            $this->response->redirect('/something-relative')->headers->get('location')
+        );
+        $this->assertEquals('/index.php?r=', $this->response->redirect(['/'])->headers->get('location'));
+        $this->assertEquals(
+            '/index.php?r=view',
+            $this->response->redirect(['view'])->headers->get('location')
+        );
+        $this->assertEquals(
+            '/index.php?r=controller',
+            $this->response->redirect(['/controller'])->headers->get('location')
+        );
+        $this->assertEquals(
+            '/index.php?r=controller%2Findex',
+            $this->response->redirect(['/controller/index'])->headers->get('location')
+        );
+        $this->assertEquals(
+            '/index.php?r=controller%2Findex',
+            $this->response->redirect(['//controller/index'])->headers->get('location')
+        );
+        $this->assertEquals(
+            '/index.php?r=controller%2Findex&id=3',
+            $this->response->redirect(['//controller/index', 'id' => 3])->headers->get('location')
+        );
+        $this->assertEquals(
+            '/index.php?r=controller%2Findex&id_1=3&id_2=4',
+            $this->response->redirect(['//controller/index', 'id_1' => 3, 'id_2' => 4])->headers->get('location')
+        );
+        $this->assertEquals(
+            '/index.php?r=controller%2Findex&slug=%C3%A4%C3%B6%C3%BC%C3%9F%21%22%C2%A7%24%25%26%2F%28%29',
+            $this->response->redirect(['//controller/index', 'slug' => 'äöüß!"§$%&/()'])->headers->get('location')
+        );
     }
 
     /**
@@ -164,25 +193,37 @@ public function testAjaxRedirectInternetExplorer11($userAgent, $statusCodes) {
 
     /**
      * @link https://blogs.msdn.microsoft.com/ieinternals/2013/09/21/internet-explorer-11s-many-user-agent-strings/
-     * @link https://stackoverflow.com/a/31279980/6856708
+     * @link https://stackoverflow.com/questions/30591706/what-is-the-user-agent-string-name-for-microsoft-edge/31279980#31279980
      * @link https://developers.whatismybrowser.com/useragents/explore/software_name/chrome/
      * @link https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent/Firefox
      * @return array
      */
     public function dataProviderAjaxRedirectInternetExplorer11() {
         return [
-            ['Mozilla/5.0 (Android 4.4; Mobile; rv:41.0) Gecko/41.0 Firefox/41.0', [301 => 301, 302 => 302]],                   // Firefox
-            ['Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko', [301 => 200, 302 => 200]],                        // IE 11
-            ['Mozilla/5.0 (Windows NT 6.3; Trident/7.0; .NET4.0E; .NET4.0C; rv:11.0) like Gecko', [301 => 200, 302 => 200]],    // IE 11
-            ['Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36', [301 => 301, 302 => 302]],      // Chrome
-            ['Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.10136', [301 => 301, 302 => 302]],    // Edge
-            ['Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)', [301 => 200, 302 => 200]],                // special windows versions (for tablets or IoT devices)
+            ['Mozilla/5.0 (Android 4.4; Mobile; rv:41.0) Gecko/41.0 Firefox/41.0', [301 => 301, 302 => 302]], // Firefox
+            ['Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko', [301 => 200, 302 => 200]], // IE 11
+            [ // IE 11
+                'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; .NET4.0E; .NET4.0C; rv:11.0) like Gecko',
+                [301 => 200, 302 => 200]
+            ],
+            [ // Chrome
+                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36',
+                [301 => 301, 302 => 302]
+            ],
+            [ // Edge
+                'Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.10136',
+                [301 => 301, 302 => 302]
+            ],
+            [ // special windows versions (for tablets or IoT devices)
+                'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)',
+                [301 => 200, 302 => 200]
+            ],
         ];
     }
 
     /**
      * @dataProvider dataProviderSetStatusCodeByException
-     * @param \Exception $exception
+     * @param Exception $exception
      * @param int $statusCode
      */
     public function testSetStatusCodeByException($exception, $statusCode)
@@ -198,9 +239,7 @@ public function testNonSeekableStream()
     {
         $stream = fopen('php://output', 'r+');
         ob_start();
-        $this->response
-            ->sendStreamAsFile($stream, 'test-stream')
-            ->send();
+        $this->response->sendStreamAsFile($stream, 'test-stream')->send();
         ob_get_clean();
         static::assertEquals(200, $this->response->statusCode);
     }
@@ -321,20 +360,23 @@ public function testSettingStreamToNullOn304()
     public function testSendFileWithInvalidCharactersInFileName()
     {
         $response = new Response();
-        $dataFile = \Yii::getAlias('@yiiunit/data/web/data.txt');
+        $dataFile = Yii::getAlias('@yiiunit/data/web/data.txt');
 
         $response->sendFile($dataFile, "test\x7Ftest.txt");
 
-        $this->assertSame("attachment; filename=\"test_test.txt\"; filename*=utf-8''test%7Ftest.txt", $response->headers['content-disposition']);
+        $this->assertSame(
+            "attachment; filename=\"test_test.txt\"; filename*=utf-8''test%7Ftest.txt",
+            $response->headers['content-disposition']
+        );
     }
 
     public function testSameSiteCookie()
     {
         $response = new Response();
-        $response->cookies->add(new \yii\web\Cookie([
+        $response->cookies->add(new Cookie([
             'name'     => 'test',
             'value'    => 'testValue',
-            'sameSite' => \yii\web\Cookie::SAME_SITE_STRICT,
+            'sameSite' => Cookie::SAME_SITE_STRICT,
         ]));
 
         ob_start();
@@ -378,7 +420,7 @@ protected function assertEmptyContentOn($statusCode, $callback = null)
     protected function assertSettingStreamToNullOn($statusCode)
     {
         $response = new Response();
-        $dataFile = \Yii::getAlias('@yiiunit/data/web/data.txt');
+        $dataFile = Yii::getAlias('@yiiunit/data/web/data.txt');
 
         $response->sendFile($dataFile);
         $response->setStatusCode($statusCode);
diff --git a/tests/framework/web/UploadedFileTest.php b/tests/framework/web/UploadedFileTest.php
index d374a733335..0e0892ac004 100644
--- a/tests/framework/web/UploadedFileTest.php
+++ b/tests/framework/web/UploadedFileTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/UrlManagerCreateUrlTest.php b/tests/framework/web/UrlManagerCreateUrlTest.php
index a2f894c24bc..27045ead258 100644
--- a/tests/framework/web/UrlManagerCreateUrlTest.php
+++ b/tests/framework/web/UrlManagerCreateUrlTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/UrlManagerParseUrlTest.php b/tests/framework/web/UrlManagerParseUrlTest.php
index 57848ce0440..9111c02cc1d 100644
--- a/tests/framework/web/UrlManagerParseUrlTest.php
+++ b/tests/framework/web/UrlManagerParseUrlTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/UrlManagerTest.php b/tests/framework/web/UrlManagerTest.php
index f81c00305c0..3de942ba8fd 100644
--- a/tests/framework/web/UrlManagerTest.php
+++ b/tests/framework/web/UrlManagerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/UrlNormalizerTest.php b/tests/framework/web/UrlNormalizerTest.php
index f31f8b1ff8d..e2d8201149b 100644
--- a/tests/framework/web/UrlNormalizerTest.php
+++ b/tests/framework/web/UrlNormalizerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/UrlRuleTest.php b/tests/framework/web/UrlRuleTest.php
index 69bcfacb54b..6dbfbc60598 100644
--- a/tests/framework/web/UrlRuleTest.php
+++ b/tests/framework/web/UrlRuleTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/UserTest.php b/tests/framework/web/UserTest.php
index b37eeed313e..e02fe1cf4d7 100644
--- a/tests/framework/web/UserTest.php
+++ b/tests/framework/web/UserTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yii\web;
@@ -56,8 +56,8 @@ public function testLoginExpires()
                 'authManager' => [
                     'class' => PhpManager::className(),
                     'itemFile' => '@runtime/user_test_rbac_items.php',
-                     'assignmentFile' => '@runtime/user_test_rbac_assignments.php',
-                     'ruleFile' => '@runtime/user_test_rbac_rules.php',
+                    'assignmentFile' => '@runtime/user_test_rbac_assignments.php',
+                    'ruleFile' => '@runtime/user_test_rbac_rules.php',
                 ],
             ],
         ];
@@ -169,6 +169,7 @@ public function testCookieCleanup()
         ];
 
         $this->mockWebApplication($appConfig);
+        $id1 = Yii::$app->session->id;
         Yii::$app->session->removeAll();
 
         $cookie = new Cookie(Yii::$app->user->identityCookie);
@@ -176,16 +177,21 @@ public function testCookieCleanup()
         $cookiesMock->add($cookie);
         Yii::$app->user->getIdentity();
         $this->assertEquals(strlen($cookiesMock->getValue(Yii::$app->user->identityCookie['name'])), 0);
+        $this->assertSame($id1, Yii::$app->session->id);
 
         Yii::$app->user->login(UserIdentity::findIdentity('user1'), 3600);
         $this->assertFalse(Yii::$app->user->isGuest);
         $this->assertSame(Yii::$app->user->id, 'user1');
         $this->assertNotEquals(strlen($cookiesMock->getValue(Yii::$app->user->identityCookie['name'])), 0);
+        $id2 = Yii::$app->session->id;
+        $this->assertNotSame($id1, $id2);
 
         Yii::$app->user->login(UserIdentity::findIdentity('user2'), 0);
         $this->assertFalse(Yii::$app->user->isGuest);
         $this->assertSame(Yii::$app->user->id, 'user2');
         $this->assertEquals(strlen($cookiesMock->getValue(Yii::$app->user->identityCookie['name'])), 0);
+        $id3 = Yii::$app->session->id;
+        $this->assertNotSame($id2, $id3);
     }
 
     /**
@@ -225,7 +231,7 @@ public function testLoginRequired()
             ],
         ];
         $this->mockWebApplication($appConfig);
-
+        $id = Yii::$app->session->id;
 
         $user = Yii::$app->user;
 
@@ -234,6 +240,7 @@ public function testLoginRequired()
         $user->loginRequired();
         $this->assertEquals('normal', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
 
         $this->reset();
@@ -242,12 +249,13 @@ public function testLoginRequired()
 
         $user->loginRequired();
         $this->assertEquals(Yii::$app->getHomeUrl(), $user->getReturnUrl());
-        // AJAX requests don't update returnUrl but they do cause redirection.
+        // AJAX requests don't update returnUrl, but they do cause redirection.
         $this->assertTrue(Yii::$app->response->getIsRedirection());
 
         $user->loginRequired(false);
         $this->assertEquals('ajax', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         Yii::$app->request->setUrl('json-only');
@@ -255,6 +263,7 @@ public function testLoginRequired()
         $user->loginRequired(true, false);
         $this->assertEquals('json-only', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         Yii::$app->request->setUrl('json-only');
@@ -262,6 +271,7 @@ public function testLoginRequired()
         $user->loginRequired(true, false);
         $this->assertEquals('json-only', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         Yii::$app->request->setUrl('accept-all');
@@ -269,6 +279,7 @@ public function testLoginRequired()
         $user->loginRequired();
         $this->assertEquals('accept-all', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         Yii::$app->request->setUrl('json-and-accept-all');
@@ -278,6 +289,7 @@ public function testLoginRequired()
         } catch (ForbiddenHttpException $e) {
         }
         $this->assertFalse(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         Yii::$app->request->setUrl('accept-html-json');
@@ -285,6 +297,7 @@ public function testLoginRequired()
         $user->loginRequired();
         $this->assertEquals('accept-html-json', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         Yii::$app->request->setUrl('accept-html-json');
@@ -292,6 +305,7 @@ public function testLoginRequired()
         $user->loginRequired();
         $this->assertEquals('accept-html-json', $user->getReturnUrl());
         $this->assertTrue(Yii::$app->response->getIsRedirection());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         $_SERVER['REQUEST_METHOD'] = 'POST';
@@ -299,6 +313,7 @@ public function testLoginRequired()
         Yii::$app->getSession()->set($user->returnUrlParam, null);
         $user->loginRequired();
         $this->assertNull(Yii::$app->getSession()->get($user->returnUrlParam));
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         $_SERVER['REQUEST_METHOD'] = 'GET';
@@ -306,6 +321,7 @@ public function testLoginRequired()
         Yii::$app->getSession()->set($user->returnUrlParam, null);
         $user->loginRequired();
         $this->assertEquals('set-return-url-on-get-request', Yii::$app->getSession()->get($user->returnUrlParam));
+        $this->assertSame($id, Yii::$app->session->id);
 
         // Confirm that returnUrl is not set.
         $this->reset();
@@ -316,11 +332,13 @@ public function testLoginRequired()
         } catch (ForbiddenHttpException $e) {
         }
         $this->assertNotEquals('json-only', $user->getReturnUrl());
+        $this->assertSame($id, Yii::$app->session->id);
 
         $this->reset();
         $_SERVER['HTTP_ACCEPT'] = 'text/json;q=0.1';
         $this->expectException('yii\\web\\ForbiddenHttpException');
         $user->loginRequired();
+        $this->assertSame($id, Yii::$app->session->id);
     }
 
     public function testLoginRequiredException1()
@@ -482,8 +500,10 @@ public function testSessionAuthWithMissingKey()
         $this->mockWebApplication($appConfig);
 
         Yii::$app->session->set('__id', 'user1');
+        $id = Yii::$app->session->id;
 
         $this->assertNotNull(Yii::$app->user->getIdentity());
+        $this->assertSame($id, Yii::$app->session->id);
     }
 
     public function testSessionAuthWithInvalidKey()
@@ -497,12 +517,13 @@ public function testSessionAuthWithInvalidKey()
         ];
 
         $this->mockWebApplication($appConfig);
+        $id = Yii::$app->session->id;
 
         Yii::$app->session->set('__id', 'user1');
         Yii::$app->session->set('__authKey', 'invalid');
 
-
         $this->assertNull(Yii::$app->user->getIdentity());
+        $this->assertSame($id, Yii::$app->session->id);
     }
 
     public function testSessionAuthWithValidKey()
@@ -516,11 +537,33 @@ public function testSessionAuthWithValidKey()
         ];
 
         $this->mockWebApplication($appConfig);
+        $id = Yii::$app->session->id;
 
         Yii::$app->session->set('__id', 'user1');
         Yii::$app->session->set('__authKey', 'ABCD1234');
 
         $this->assertNotNull(Yii::$app->user->getIdentity());
+        $this->assertSame($id, Yii::$app->session->id);
+    }
+
+    public function testSessionAuthWhenIdentityReturnsNull()
+    {
+        $appConfig = [
+            'components' => [
+                'user' => [
+                    'identityClass' => UserIdentity::className(),
+                ],
+            ],
+        ];
+
+        $this->mockWebApplication($appConfig);
+        $id = Yii::$app->session->id;
+
+        Yii::$app->session->set('__id', 'user999999');
+        Yii::$app->session->set('__authKey', 'ABCD1234');
+
+        $this->assertNull(Yii::$app->user->getIdentity());
+        $this->assertNotSame($id, Yii::$app->session->id);
     }
 }
 
diff --git a/tests/framework/web/ViewTest.php b/tests/framework/web/ViewTest.php
index e9e6cc0f595..d572998cf65 100644
--- a/tests/framework/web/ViewTest.php
+++ b/tests/framework/web/ViewTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/XmlResponseFormatterTest.php b/tests/framework/web/XmlResponseFormatterTest.php
index 20a63f81769..a1050ef165b 100644
--- a/tests/framework/web/XmlResponseFormatterTest.php
+++ b/tests/framework/web/XmlResponseFormatterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web;
diff --git a/tests/framework/web/mocks/TestRequestComponent.php b/tests/framework/web/mocks/TestRequestComponent.php
index 6cda5f65520..83f33588fbb 100644
--- a/tests/framework/web/mocks/TestRequestComponent.php
+++ b/tests/framework/web/mocks/TestRequestComponent.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\mocks;
diff --git a/tests/framework/web/session/AbstractDbSessionTest.php b/tests/framework/web/session/AbstractDbSessionTest.php
index 835ea13b21c..5fdfe50f98b 100644
--- a/tests/framework/web/session/AbstractDbSessionTest.php
+++ b/tests/framework/web/session/AbstractDbSessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session;
diff --git a/tests/framework/web/session/CacheSessionTest.php b/tests/framework/web/session/CacheSessionTest.php
index e31b0f970f2..d34f7b7f82f 100644
--- a/tests/framework/web/session/CacheSessionTest.php
+++ b/tests/framework/web/session/CacheSessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session;
diff --git a/tests/framework/web/session/SessionTest.php b/tests/framework/web/session/SessionTest.php
index 6ad327f68f7..1270aa4afed 100644
--- a/tests/framework/web/session/SessionTest.php
+++ b/tests/framework/web/session/SessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session;
diff --git a/tests/framework/web/session/mssql/DbSessionTest.php b/tests/framework/web/session/mssql/DbSessionTest.php
index 0186eddd335..9c203dfbaf9 100644
--- a/tests/framework/web/session/mssql/DbSessionTest.php
+++ b/tests/framework/web/session/mssql/DbSessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session\mssql;
diff --git a/tests/framework/web/session/mysql/DbSessionTest.php b/tests/framework/web/session/mysql/DbSessionTest.php
index 7282b6bee6b..01ceaf74b59 100644
--- a/tests/framework/web/session/mysql/DbSessionTest.php
+++ b/tests/framework/web/session/mysql/DbSessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session\mysql;
diff --git a/tests/framework/web/session/pgsql/DbSessionTest.php b/tests/framework/web/session/pgsql/DbSessionTest.php
index 2512f334e9f..8ef66fd0130 100644
--- a/tests/framework/web/session/pgsql/DbSessionTest.php
+++ b/tests/framework/web/session/pgsql/DbSessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session\pgsql;
diff --git a/tests/framework/web/session/sqlite/DbSessionTest.php b/tests/framework/web/session/sqlite/DbSessionTest.php
index bfa911df075..e13539cebd0 100644
--- a/tests/framework/web/session/sqlite/DbSessionTest.php
+++ b/tests/framework/web/session/sqlite/DbSessionTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\session\sqlite;
diff --git a/tests/framework/web/stubs/CachedUrlRule.php b/tests/framework/web/stubs/CachedUrlRule.php
index 9444fff9638..996185180a5 100644
--- a/tests/framework/web/stubs/CachedUrlRule.php
+++ b/tests/framework/web/stubs/CachedUrlRule.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\stubs;
diff --git a/tests/framework/web/stubs/ModelStub.php b/tests/framework/web/stubs/ModelStub.php
index 2e378202937..459bb8f2942 100644
--- a/tests/framework/web/stubs/ModelStub.php
+++ b/tests/framework/web/stubs/ModelStub.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\stubs;
diff --git a/tests/framework/web/stubs/VendorImage.php b/tests/framework/web/stubs/VendorImage.php
index 386d65e3e10..6ef0d6c73b6 100644
--- a/tests/framework/web/stubs/VendorImage.php
+++ b/tests/framework/web/stubs/VendorImage.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\web\stubs;
diff --git a/tests/framework/widgets/ActiveFieldTest.php b/tests/framework/widgets/ActiveFieldTest.php
index d4d94d12911..ad723dd4798 100644
--- a/tests/framework/widgets/ActiveFieldTest.php
+++ b/tests/framework/widgets/ActiveFieldTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/ActiveFormTest.php b/tests/framework/widgets/ActiveFormTest.php
index 79908614778..64f921b0c24 100644
--- a/tests/framework/widgets/ActiveFormTest.php
+++ b/tests/framework/widgets/ActiveFormTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/BlockTest.php b/tests/framework/widgets/BlockTest.php
index 318c82a9cbd..c7b8ad2f6ec 100644
--- a/tests/framework/widgets/BlockTest.php
+++ b/tests/framework/widgets/BlockTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/BreadcrumbsTest.php b/tests/framework/widgets/BreadcrumbsTest.php
index a5a76e88810..5a4fddcbb3b 100644
--- a/tests/framework/widgets/BreadcrumbsTest.php
+++ b/tests/framework/widgets/BreadcrumbsTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/ContentDecoratorTest.php b/tests/framework/widgets/ContentDecoratorTest.php
index ed23c928cab..02fc9a49766 100644
--- a/tests/framework/widgets/ContentDecoratorTest.php
+++ b/tests/framework/widgets/ContentDecoratorTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/DetailViewTest.php b/tests/framework/widgets/DetailViewTest.php
index 19ca733948e..a2fd34ef124 100644
--- a/tests/framework/widgets/DetailViewTest.php
+++ b/tests/framework/widgets/DetailViewTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/FragmentCacheTest.php b/tests/framework/widgets/FragmentCacheTest.php
index 2a0b31d1555..a3b040e8f9d 100644
--- a/tests/framework/widgets/FragmentCacheTest.php
+++ b/tests/framework/widgets/FragmentCacheTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/LinkPagerTest.php b/tests/framework/widgets/LinkPagerTest.php
index 2f921c5ec39..265b891362b 100644
--- a/tests/framework/widgets/LinkPagerTest.php
+++ b/tests/framework/widgets/LinkPagerTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/LinkSorterTest.php b/tests/framework/widgets/LinkSorterTest.php
index 8d607221e4f..13d4311da73 100644
--- a/tests/framework/widgets/LinkSorterTest.php
+++ b/tests/framework/widgets/LinkSorterTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/ListViewTest.php b/tests/framework/widgets/ListViewTest.php
index c6545a3dc20..6d3ff286f1f 100644
--- a/tests/framework/widgets/ListViewTest.php
+++ b/tests/framework/widgets/ListViewTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/MenuTest.php b/tests/framework/widgets/MenuTest.php
index 70e84466b9f..192bb44131f 100644
--- a/tests/framework/widgets/MenuTest.php
+++ b/tests/framework/widgets/MenuTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/PjaxTest.php b/tests/framework/widgets/PjaxTest.php
index 4af4979d221..e08d5776f17 100644
--- a/tests/framework/widgets/PjaxTest.php
+++ b/tests/framework/widgets/PjaxTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
diff --git a/tests/framework/widgets/SpacelessTest.php b/tests/framework/widgets/SpacelessTest.php
index 577f47ce84b..ef27047e2c6 100644
--- a/tests/framework/widgets/SpacelessTest.php
+++ b/tests/framework/widgets/SpacelessTest.php
@@ -1,8 +1,8 @@
 <?php
 /**
- * @link http://www.yiiframework.com/
+ * @link https://www.yiiframework.com/
  * @copyright Copyright (c) 2008 Yii Software LLC
- * @license http://www.yiiframework.com/license/
+ * @license https://www.yiiframework.com/license/
  */
 
 namespace yiiunit\framework\widgets;
